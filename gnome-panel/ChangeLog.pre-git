==================== 2.26.1 ====================

2009-04-14  Vincent Untz  <vuntz@gnome.org>

	Correctly handle icons for all locations in the menu, via the right use
	of GIcon. Fix bug #578859.

	* menu.c: (do_icons_to_add), (load_icons_handler): just use
	gtk_image_set_from_gicon() instead of trying to get an icon name or a
	pixbuf out of a GIcon
	* panel-util.[ch]: (panel_util_get_pixbuf_from_g_loadable_icon): killed
	(panel_util_get_icon_name_from_g_icon): make static

==================== 2.26.0 ====================

2009-03-15  Vincent Untz  <vuntz@gnome.org>

	Mark desktop files as trusted when it makes sense.

	* libpanel-util/panel-keyfile.[ch]: (_panel_key_file_make_executable):
	new, mark a file as executable
	(panel_key_file_to_file): prepend a #! header to the desktop file if
	there's none, and mark the file as executable
	(panel_key_file_copy_and_mark_trusted): new, does what it says :-)
	* menu.c: (add_app_to_desktop): update to use
	panel_key_file_copy_and_mark_trusted() instead of g_file_copy() so that
	the copied file is marked as trusted

2009-03-11  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_local_gio),
	(panel_place_menu_item_append_remote_gio): ignore shadow mounts.

==================== 2.25.92 ====================

2009-02-26  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/panel-error.c: (panel_error_dialog): Use close button
	instead of ok button in error dialogs.

2009-02-24  Vincent Untz  <vuntz@gnome.org>

	Fix some randr-interaction by connecting to the monitors-changed
	signal.
	Fix bug #572933.
	Patch by Matthias Clasen <mclasen@redhat.com>

	* panel-multiscreen.c: (panel_multiscreen_reinit_idle),
	(panel_multiscreen_queue_reinit): use an idle loop as callback since we
	can get two signals emitted at the same time.
	(panel_multiscreen_init): connect to monitors-changed too
	(panel_multiscreen_reinit): trivial update

==================== 2.25.91 ====================

2009-02-16  Vincent Untz  <vuntz@gnome.org>

	* panel-default-setup.entries: remove mixer from the panel layout since
	we don't use an applet by default anymore (it's in the notification
	area now). Distributions still shipping the applet will probably patch
	this back.

==================== 2.25.90 ====================

2009-01-21  Frederic Crozat  <fcrozat@mandriva.com>

	* panel-applet-frame.c:
	* panel.c:
	Fix format security warnings.

2009-01-21  Vincent Untz  <vuntz@gnome.org>

	If an applet is not loading, it blocks the panel initial animation. So
	add a timeout of 5 seconds to always show the panels after this
	timeout.

	* applet.c: (panel_applet_queue_initial_unhide_toplevels): GSourceFunc
	again, and remove the timeout
	(panel_applet_stop_loading), (panel_applet_load_idle_handler): trivial
	updates
	(panel_applet_load_queued_applets): add the timeout

==================== 2.25.5.1 ====================

2009-01-21  Vincent Untz  <vuntz@gnome.org>

	* applet.c: (panel_applet_load_idle_handler): add missing break that
	makes the panel reach an assertion when a separator exists in the user
	configuration.

==================== 2.25.5 ====================

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_menu_items_append_from_desktop): respect
	TryExec in the desktop file.
	Based on patch by Matthias Clasen <mclasen@redhat.com>
	Fix bug #555710.

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	* applet.c: (panel_applet_stop_loading): the assertion there was wrong,
	and caused a crash when reloading an applet that crashed.

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	* panel-toplevel.c: (panel_toplevel_update_struts): do not recompute
	the end position of the initial animation, since it's not needed, and
	it overrides the struts conflict resolution.

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	* panel-session.c: (panel_session_init): add a reminder about things to
	check when migrating to eggsmclient.

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	Connect to the session manager only when we're really ready, so that
	the struts are really set. Therefore, nautilus doesn't have jumping
	icons on login.
	Fix bug #563635.
	Based on patch by Behdad Esfahbod <behdad@gnome.org>

	* main.c: (main): don't connect to the session manager automatically,
	and move the session initialization code just before we enter the
	main loop
	* panel-session.c: (panel_session_init): connect to the session manager

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	* panel-toplevel.c: (panel_toplevel_button_press_event): don't require
	the mouse button modifier to move a non-expanded panel. Only the
	handles can be grabbed, and they're there for that.

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	Correctly set the struts before and during the initial toplevel
	animation, so that desktop icons don't jump.
	Part of bug #554343.
	Loosely based on some code by Ray Strode <rstrode@redhat.com>

	* panel-toplevel.c: (panel_toplevel_update_struts): if we're still
	doing the initial animation, then we're really only interested in the
	end of animation coordinates for the struts. Also fix a typo in code
	that might have weird side-effects on multiscreen.
	(panel_toplevel_update_auto_hide_position): if we're looking for the
	end position of animation, then get the real auto-hide size. It's
	useful for the initial animation where the position is hidden (and
	therefore, we don't get the real auto-hide size).
	(panel_toplevel_update_animating_position): mark the initial animation
	as done.
	(panel_toplevel_update_position): trivial update
	(panel_toplevel_update_geometry): cleanup
	(panel_toplevel_initially_hide): don't set the struts here, it's
	useless
	(panel_toplevel_calculate_animation_end_geometry): new, split from
	panel_toplevel_start_animation() so that it can be used elsewhere.
	Also, a toplevel that is in its initial animation (but not a
	auto-hiding toplevel) should have its end position computed as its
	normal position
	(panel_toplevel_start_animation): some trivial update
	(panel_toplevel_auto_unhide_timeout_handler): remove
	initial_animation_done = TRUE here, since it's not what we want and
	makes things ugly.

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	Fix initial un-hiding of newly created panels. And also make sure that
	a panel that was unused but put back in the configuration gets its
	applets/objects loaded.

	* applet.c: (panel_applet_queue_initial_unhide_toplevels): simplify
	(panel_applet_stop_loading): trivial update
	(panel_applet_load_idle_handler): if there's no applet to load anymore,
	then do the initial unhiding. This is necessary in case there's still
	an applet in the configuration that matches no panel -- else, we're
	blocked with no visible panel at all.
	(panel_applet_load_queued_applets): don't put
	panel_applet_queue_initial_unhide_toplevels() in the idle loop and call
	it correctly. It already queues stuff in the idle loop...
	* panel-profile.c: (panel_profile_load_and_show_toplevel): for panels
	added during runtime, we also check if there are some applets/objects
	that might belong to it.
	(panel_profile_load_and_show_toplevel_startup): old version of
	panel_profile_load_and_show_toplevel(), only used on panel startup
	(panel_profile_object_id_list_update): new, based on
	panel_profile_object_id_list_notify() so that it can be used elsewhere
	(panel_profile_object_id_list_notify): just call
	panel_profile_object_id_list_notify()
	(panel_profile_load): use panel_profile_load_and_show_toplevel_startup()

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	First part of smoothing the panel slide-in on login.
	Part of bug #554343.
	Patch by Ray Strode <rstrode@redhat.com>, with a few minor bug
	fixes/changes from me.

	We delay the slide-in until all panel objects are loaded.

	* applet.[ch]: (panel_applet_queue_initial_unhide_toplevels): new
	(panel_applet_stop_loading): new, when an object has stopped loading,
	we look if we should queue an unhide
	(panel_applet_load_idle_handler): put the applet that is being loaded
	in the list of applets loading, and call panel_applet_stop_loading()
	when it makes sense
	(panel_applet_load_queued_applets): unhide the panels if there's no
	applet to load
	* panel-applet-frame.c: (panel_applet_frame_activated): consolidate
	freeing stuff in case of error, and call panel_applet_stop_loading()
	* panel-toplevel.[ch]: (panel_toplevel_attach_to_widget): an attached
	toplevel (ie, drawer) should not have an initial animation
	(panel_toplevel_initially_hide): don't queue an unhide here, but still
	update the struts
	(panel_toplevel_queue_initial_unhide): new

2009-01-20  Vincent Untz  <vuntz@gnome.org>

	Only move panel with the mouse when a mouse button modifier is used
	(the same one as in metacity). Ie: you can drag the panel to move it
	when pressing Alt.
	Fix bug #309721.
	Based on patch by William Lachance <wrlach@gmail.com>

	* panel-bindings.[ch]: monitor the gconf key for the mouse button
	modifier and provide an API to access it
	(panel_binding_set_from_string): fix typo in warning
	(panel_binding_watch): don't translate warning
	(panel_bindings_mouse_modifier_set_from_string): new
	(panel_bindings_mouse_modifier_changed): new
	(panel_bindings_initialise): don't translate warning, handle the mouse
	button modifier stuff too
	(panel_bindings_set_entries): trivial update
	(panel_bindings_get_mouse_button_modifier_keymask): new
	* panel-toplevel.c: (panel_toplevel_button_press_event): look at the
	modifier mask before starting the move

2009-01-15  Vincent Untz  <vuntz@gnome.org>

	Fix gnome-panel part of bug #536915.
	Based on patch by Ray Strode <rstrode@redhat.com>

	* libpanel-util/panel-session-manager.[ch]:
	(panel_session_manager_is_shutdown_available): new, to tell if shutdown
	is available from the session manager
	* panel-action-button.c:
	(panel_action_shutdown_reboot_is_disabled): use the new method for the
	action buttons

==================== 2.25.3 ====================

2008-12-16  Bastien Nocera  <hadess@hadess.net>

	* panel-menu-items.c (panel_place_menu_item_create_menu): Remove
	nautilus-cd-burner from the Places menu, it's now in the System Tools
	instead (Closes: #508385)

2008-12-11  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/panel-show.c: (panel_show_help): plug leak

2008-12-11  Vincent Untz  <vuntz@gnome.org>

	Stop using gnome_util_user_shell(). This not needed, unless we want to
	have the aliases defined in a shell work in the run dialog. I'm nearly
	sure no other "run dialog"-type programs do this anyway, and it's
	really not a command line from the shell (redirecting output doesn't
	work, eg).
	And some much needed cleanups.

	* panel-run-dialog.c: (command_is_executable): don't accept URI, and
	return the stuff that g_shell_parse_argv() gives us so we don't have
	to call it twice
	(panel_run_dialog_launch_command): no gnome_util_user_shell() anymore,
	and minor updates
	(panel_run_dialog_execute): remove some useless stuff, don't assume we
	can run a program over http, do not accept applications if they're
	started by URI (file:///) -- it doesn't really make sense anyway; stop
	mixing the strings with the disk encoding and utf-8
	(panel_run_dialog_create_desktop_file): ditto (more or less), and make
	consistent

2008-12-10  Vincent Untz  <vuntz@gnome.org>

	* panel-action-button.c: remove FIXME

2008-12-10  Vincent Untz  <vuntz@gnome.org>

	Stop using GnomeHelp, and use gtk_show_uri() for displaying help.

	* panel-util.[ch]: (panel_show_help): kill
	* libpanel-util/panel-show.[ch]: (_panel_show_error_dialog): use
	g_markup_printf_escaped()
	(panel_show_uri):
	(panel_show_uri_force_mime_type): fix a check
	(_panel_show_help_error_dialog), (_panel_show_help_handle_error),
	(panel_show_help): new, they all do what their name imply

	* applet.c: (applet_callback_callback):
	* panel-action-button.c: (panel_action_button_invoke_menu):
	* panel-addto.c: (panel_addto_dialog_response):
	* panel-context-menu.c: (panel_context_menu_show_help):
	* panel-ditem-editor.c: (response_cb):
	* panel-menu-bar.c: (panel_menu_bar_invoke_menu):
	* panel-menu-button.c: (panel_menu_button_invoke_menu):
	* panel-properties-dialog.c: (panel_properties_dialog_response):
	* panel-run-dialog.c: (panel_run_dialog_response):
	updates for panel_show_help()

	* panel-action-button.c: fix help for "connect to server"

	* libpanel-util/panel-launch.c: (_panel_launch_error_dialog): escape
	the name of the application since it will be used inside markup
	(_panel_launch_handle_error): new, to factorize code
	(panel_app_info_launch_uris):
	(panel_launch_desktop_file_with_fallback): use
	_panel_launch_handle_error()

2008-12-10  Vincent Untz  <vuntz@gnome.org>

	Use gio to launch desktop files, instead of gnome-desktop.

	* panel-util.[ch]: (panel_ditem_launch),
	(panel_util_launch_from_key_file), (panel_launch_desktop_file): kill
	* libpanel-util/panel-launch.[ch]: new, with some nice API
	* libpanel-util/Makefile.am: add new file
	* libpanel-util/panel-show.c: (_panel_app_info_launch_uri): killed
	(panel_show_nautilus_search_uri): use panel_app_info_launch_uri()
	(panel_show_uri_force_mime_type): use panel_app_info_launch_uri()
	* launcher.c: (launcher_launch), (drag_data_received_cb): use
	panel_launch_key_file()
	* panel-action-button.c: (panel_action_search): use
	panel_launch_desktop_file_with_fallback()
	* panel-menu-bar.c: (panel_menu_bar_invoke_menu): use
	panel_launch_desktop_file_with_fallback()
	* panel-menu-button.c: (panel_menu_button_invoke_menu): ditto
	* panel-menu-items.c: (panel_menu_item_activate_desktop_file): use
	panel_launch_desktop_file()

2008-12-10  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/panel-list.c: (panel_g_list_swap_next),
	(panel_g_list_swap_prev), (panel_g_list_resort_item),
	(panel_g_slist_make_unique): various minor cleanups to avoid possible
	misuses of this API

2008-12-10  Vincent Untz  <vuntz@gnome.org>

	* panel-util.[ch]: move all panel_g_(s)list functions to...
	* libpanel-util/panel-list.[ch]: ... here (new files)
	* libpanel-util/Makefile.am: add new file
	* panel-profile.c:
	* panel-widget.c: include panel-list.h

2008-12-09  Vincent Untz  <vuntz@gnome.org>

	Remove dependency on gnome_util_home_file()

	* launcher.h: move PANEL_LAUNCHERS_PATH to panel-util.c
	* launcher.c: (panel_launcher_delete): update to use
	panel_launcher_is_in_personal_path()
	Move some functions to panel-util.c. That's suboptimal, but I can't
	figure out yet how I want the code to be organized, so...
	* panel-util.c: (panel_launcher_get_personal_path): new, real
	gnome_util_home_file() killer
	(panel_launcher_is_in_personal_path): new, does what the name implies
	(panel_launcher_get_gfile),
	(panel_launcher_get_uri), (panel_launcher_get_filename): moved from
	launcher.c
	(panel_make_full_path): trivial update
	* panel-util.h: also remove UpdateFunction which was unused

2008-12-09  Vincent Untz  <vuntz@gnome.org>

	* panel-properties-dialog.c:
	(panel_properties_dialog_setup_image_chooser): remove the filter
	chooser in the file chooser: since there's only one filter, the chooser
	is not really useful.

2008-12-09  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: (panel_run_dialog_launch_command): Use
	gnome_desktop_prepend_terminal_to_vector() instead of
	gnome_prepend_terminal_to_vector(), to slowly get rid of libgnome

2008-12-09  Vincent Untz  <vuntz@gnome.org>

	* panel-background.c:
	(panel_background_set_image_background_on_widget): don't use a cairo
	matrix, we can do the same thing by just shifting the pixmap in
	gdk_cairo_set_source_pixmap()

2008-12-09  Vincent Untz  <vuntz@gnome.org>

	Lots of "remove deprecated API usage" and single include fun.

	* panel-compatibility.c: (copy_gconf_dir):
	s/gconf_entry_free/gconf_entry_unref
	* panel-applet-frame.c: add missing include for glib/gi18n.h
	(panel_applet_frame_activated): fix buglet where gtk_object_sink() was
	used but we really wanted g_object_unref
	* applet.c: (panel_applet_recreate_menu):
	s/gtk_widget_unref/g_object_unref
	(panel_applet_create_menu): use g_object_ref_sink
	* panel-bindings.c: (panel_binding_clear_entry):
	s/gtk_binding_entry_clear/gtk_binding_entry_remove/
	* menu.c: (panel_load_menu_image_deferred): use g_object_ref_sink
	* panel-background.c:
	(panel_background_set_no_background_on_widget):
	s/gtk_rc_style_unref/g_object_unref
	* panel-widget.c: (remove_tab_bindings), (remove_move_bindings),
	(remove_all_move_bindings):
	s/gtk_binding_entry_clear/gtk_binding_entry_remove/
	(panel_widget_cremove): s/gtk_widget_(un)ref/g_object_(un)ref/
	* panel-gconf.c: (panel_gconf_copy_dir),
	(panel_gconf_associate_schemas_in_dir):
	s/gconf_entry_free/gconf_entry_unref
	* panel-config-global.c: (panel_global_config_load):
	s/gconf_entry_free/gconf_entry_unref
	* panel-addto.c: add missing glib/gi18n.h
	* applet.h:
	* panel-action-button.h:
	* panel-action-protocol.h:
	* panel-applet-frame.h:
	* panel-bindings.h:
	* panel-compatibility.h:
	* panel-enums.h:
	* panel-menu-bar.h:
	* panel-menu-items.h:
	* panel-profile.h:
	* panel-stock-icons.[ch]:
	* panel-struts.h:
	* panel-types.h:
	* panel-xutils.h:
	* xstuff.h: single include!

2008-12-09  Vincent Untz  <vuntz@gnome.org>

	* panel-context-menu.c: (panel_context_menu_show_about_dialog): use
	parenthesis instead of angle brackets for a mail address. Fix bug
	#551237.

2008-12-09  Vincent Untz  <vuntz@gnome.org>

	* panel-background.c:
	(panel_background_set_image_background_on_widget): use
	gdk_cairo_set_source_pixmap() now that it's available, instead of
	custom code.

2008-12-09  Vincent Untz  <vuntz@gnome.org>

	* main.c: (main): set an application name. It's used by the gio
	authentication dialog.

2008-12-09  Vincent Untz  <vuntz@gnome.org>

	* main.c: (main): don't call gnome_authentication_manager_init()
	anymore. Since we use gio, we don't need to do this which was needed
	for gnome-vfs.

2008-12-08  Vincent Untz  <vuntz@gnome.org>

	Use dbus-based uniquification instead of bonobo-based, and makes it
	possible to replace a currently running panel.
	Based on patch by Colin Walters <walters@verbum.org>
	Fix bug #558534.

	* GNOME_Panel.server.in: kill
	* Makefile.am: updated for file removal
	* main.c: (main): add a --replace option to replace the current panel
	* panel-session.c: (panel_session_handle_die_request): just call
	panel_shell_quit()
	* panel-shell.[ch]: this is pretty much rewritten

2008-12-08  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/panel-cleanup.c: (panel_cleanup_register),
	(panel_cleanup_unregister): accept NULL data

2008-12-08  Vincent Untz  <vuntz@gnome.org>

	* panel-action-button.c: use C_() instead of Q_().
	* panel-menu-items.c: (panel_place_menu_item_create_menu),
	(panel_menu_items_append_lock_logout): ditto
	* panel-properties-dialog.c:
	(panel_properties_dialog_setup_orientation_combo): use NC_() and
	then g_dpgettext2() instead of Q_()
	Based on patch by Philip Withnall <bugzilla@tecnocode.co.uk>
	Fix bug #558418, part of a GNOME Goal.

==================== 2.24.2 ====================

==================== 2.24.1 ====================

==================== 2.24.0 ====================

2008-09-22  Vincent Untz  <vuntz@gnome.org>

	* panel-properties-dialog.glade: fix for GTK+ adjustment enforcement
	http://mail.gnome.org/archives/desktop-devel-list/2008-September/msg00148.html

2008-09-11  Benjamin Berg  <benjamin@sipsolutions.net>

	* menu.c: (panel_create_menu):
	* panel-context-menu.c: (panel_context_menu_create):
	Name the panel menus "gnome-panel-main-menu" for the menubar and
	main menu applet. The panels context menu is now called
	"gnome-panel-context-menu".

==================== 2.23.92 ====================

2008-09-09  Vincent Untz  <vuntz@gnome.org>

	Revert the auto-hide behavior change that got introduced in 2.23.6.
	It was annoying for users.

	* panel-toplevel.c: (panel_toplevel_get_effective_auto_hide_size): new
	function, to know the effective auto hide size
	(panel_toplevel_update_struts): use
	panel_toplevel_get_effective_auto_hide_size() for the strut
	(panel_toplevel_update_auto_hide_position): use
	panel_toplevel_get_effective_auto_hide_size() now

==================== 2.23.91 ====================

2008-08-31  Seán de Búrca  <sdeburca@svn.gnome.org>

	* panel-context-menu.c: (panel_context_menu_show_about_dialog):
	Set title of about dialog to allow for correct translation. Fixes bug
	#549902.

==================== 2.23.90.1 ====================

2008-08-21  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/panel-session-manager.c:
	(panel_session_manager_request_logout): update for signature change for
	the Logout method

==================== 2.23.90 ====================

2008-08-18 Baptiste Mille-Mathias <baptiste.millemathias@gmail.com>

	* panel-icon-names.h: change the bookmark icon name according to latest
	gnome-icon-theme, so version 2.23.90 is needed now,
	Patch from Michael Monreal <michael.monreal@gmx.net>.
	Fix bug #547626.

==================== 2.23.6 ====================

2008-08-04  Vincent Untz  <vuntz@gnome.org>

	* panel-toplevel.c: (panel_toplevel_update_struts): remove the special
	case for auto-hidden panels. We just update the struts as if they were
	normal panels, with their current position.
	This changes a bit the behavior (ie, full-screen windows resize when
	the panel gets unhidden and then hidden again), but after playing with
	it, I think the new behavior is actually quite nice. If we revert the
	change, then we'll have to fix bug #529031 by clamping auto_hide_size,
	like we do in panel_toplevel_update_auto_hide_position().
	Fix bug #529031.

2008-08-04  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_make_unique_desktop_path_from_name): go back to
	NAME_MAX instead of MAXNAMLEN since the former is POSIX and not all OS
	have MAXNAMLEN either. Since we have to be compatible with all OS out
	there, use MAXNAMLEN if NAME_MAX is not defined on the OS.
	Fix bug #500341.

2008-08-04  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-bar.c: (panel_menu_bar_hide_tooltip_and_focus): renamed
	from panel_menu_bar_hide_tooltip(), and also unfocus the focused
	child of the toplevel when opening the menu. This fixes a cosmetic
	issue.
	(panel_menu_bar_setup_tooltip): updated
	Fix bug #308632.

2008-08-04  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_menu_items_append_lock_logout): don't show
	logout/shutdown if it's locked down. Remove extra separator that got
	added when screensaver is locked down.
	End of bug #522453.

2008-08-04  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_lock_screen_action_available),
	(panel_lock_screen_action): check the lock screen lockdown setting
	before doing anything. The UI is already blocking the user for locking
	the screen (by making the widget non-sensitive, eg), but this is extra
	safety.
	* gnome-desktop-item-edit.c: update to make it compile because of this
	change...
	Based on a patch from Matt Keenan <matt.keenan@sun.com>
	Part of bug #522453

2008-08-04  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: (panel_run_dialog_execute): s/url/uri/

2008-08-04  Vincent Untz  <vuntz@gnome.org>

	Mount volumes if needed in panel_show_*
	Based on patch by Matthias Clasen <mclasen@redhat.com>
	Fix bug #529243

	* libpanel-util/panel-show.c: (_panel_show_mount_async_callback): new,
	callback when the mount operation is finished
	(_panel_show_handle_error): improve code, and handle
	G_IO_ERROR_NOT_MOUNTED
	(_panel_app_info_launch_uri): updated
	(panel_show_uri): ditto

2008-08-04  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/Makefile.am: add new files
	* libpanel-util/panel-error.[ch]: new, moved from panel-util.c
	* libpanel-util/panel-glib.[ch]: moved some functions from panel-util.c
	here and rename them: panel_g_lookup_in_data_dirs(),
	panel_g_utf8_strstrcase()
	also add panel_g_lookup_in_applications_dirs
	* libpanel-util/panel-show.[ch]: new, to ease showing of URIs

	* panel-util.[ch]:
	(panel_error_dialog): moved to libpanel-util/panel-error.c
	(panel_ensure_dir): use g_mkdir()
	(panel_lookup_in_data_dirs): moved to libpanel-util/panel-error.c
	(panel_util_utf8_strstrcase): ditto
	(panel_util_gdk_pixbuf_load_from_stream): kill because we use GTK+ 2.13
	now
	(panel_util_get_pixbuf_from_g_loadable_icon): use
	gdk_pixbuf_new_from_stream()

	* launcher.c: (launch_url): simply call panel_show_uri()
	(create_launcher): use panel_g_lookup_in_applications_dirs()
	* panel-addto.c: (panel_addto_filter_func): small update
	(panel_compatibility_migrate_applications_scheme): use
	panel_g_lookup_in_applications_dirs()
	* panel-menu-items.c: (activate_uri_on_screen): simply use
	panel_show_uri()
	(activate_uri): fix parameter name
	(activate_path): new, to change a path into a uri before
	activate_uri_on_screen()
	(activate_home_uri): call activate_path()
	(activate_desktop_uri): ditto
	(volume_mount_cb): s/path/uri
	* panel-recent.c: (show_uri): simply use
	panel_show_uri_force_mime_type()
	(recent_documents_activate_cb): add a comment
	* panel-run-dialog.c: (panel_run_dialog_show_url): kill
	(panel_run_dialog_execute): use panel_show_uri()
	(panel_run_dialog_find_command_idle): updated

	* gnome-desktop-item-edit.c: #include update
	* panel-action-button.c: ditto
	* panel-compatibility.c: ditto
	* panel-context-menu.c: ditto
	* panel-menu-button.c: ditto
	* panel-menu-bar.c:  ditto
	* panel-properties-dialog.c: ditto
	* panel-shell.c: ditto

2008-08-03  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_menu_item_mount_volume): use
	GtkMountOperation
	* panel-mount-operation.[ch]: kill those files
	* Makefile.am: updated

2008-08-03  Vincent Untz  <vuntz@gnome.org>

	* panel-multiscreen.c: (panel_multiscreen_x),
	(panel_multiscreen_y), (panel_multiscreen_width),
	(panel_multiscreen_height),
	(panel_multiscreen_is_at_visible_extreme):
	Fix assertion. Patch by Matthias Clasen <mclasen@redhat.com>
	Fix bug #544881

==================== 2.23.5 ====================

2008-07-22  Vincent Untz  <vuntz@gnome.org>

	* panel-default-setup.entries: s/top_panel/bottom_panel/ in some
	bottom_panel definitions

2008-06-30  Vincent Untz  <vuntz@gnome.org>

	Fix compiler warnings. Patch by Kjartan Maraas <kmaraas@gnome.org>.
	Part of bug #521409.

	* button-widget.c: (button_widget_unrealize),
	(button_widget_get_icon_theme), (button_widget_get_pixbuf):
	* launcher.c: (drag_drop_cb):
	* panel-action-button.c: (panel_action_connect_server):
	* panel-applet-frame.c:
	* panel-background-monitor.c:
	* panel-ditem-editor.c: (panel_ditem_editor_save):
	* panel-force-quit.c:
	* panel-frame.c:
	* panel-menu-bar.c:
	* panel-menu-button.c:
	* panel-menu-items.c:
	* panel-multiscreen.c: (panel_multiscreen_reinit):
	* panel-separator.c:
	* panel-toplevel.c: (panel_toplevel_calc_floating),
	(panel_toplevel_get_auto_hide):
	* panel-widget.c: (panel_widget_reparent):
	* xstuff.c: (zoom_expose):

2008-06-30  Vincent Untz  <vuntz@gnome.org>

	* launcher.c: (setup_button): fox crash when editing launcher
	properties on OS where NULL isn't a good idea in printf(). Patch by
	Marcel Telka <marcel@telka.sk>. Fix bug #528581.

2008-06-30  Vincent Untz  <vuntz@gnome.org>

	s/string_empty/PANEL_GLIB_STR_EMPTY/

	* libpanel-util/Makefile.am: updated
	* libpanel-util/panel-glib.h: add new file, with only the
	PANEL_GLIB_STR_EMPTY macro right now...
	* panel-util.h: remove string_empty

	* launcher.c: (setup_button):
	* panel-addto.c: (panel_addto_make_text),
	(panel_addto_name_change):
	* panel-menu-items.c: (panel_menu_items_append_from_desktop):
	* panel-properties-dialog.c:
	(panel_properties_dialog_setup_image_chooser),
	(panel_properties_dialog_update_background_image):
	* panel-util.c: (panel_util_get_file_display_for_common_files),
	(panel_util_set_tooltip_text):
	* panel.c: (drop_url): actuall do the
	s/string_empty/PANEL_GLIB_STR_EMPTY/

2008-06-27  Luca Ferretti  <elle.uca@libero.it>

	* panel-icon-names.h: Use non-legacy icon "system-shutdown" from
	fd.o naming spec instead "gnome-shutdown". The icon is yet available
	in gnome-icon-theme.

==================== 2.23.4 ====================

2008-06-17  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/panel-power-manager.h:
	* libpanel-util/panel-session-manager.[ch]: fix distcheck.Again.

2008-06-17  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/panel-power-manager.c: fix distcheck

2008-06-06  Rodney Dawes  <dobey@gnome.org>

	* panel-icon-names.h:
	Use system-log-out instead of gnome-logout
	Use image-missing instead of gnome-unknown

2008-06-06  Vincent Untz  <vuntz@gnome.org>

	Use the gnome-session DBus API to log out/shut down. The dialog is also
	displayed by gnome-session.
	Fix bug #507391

	* Makefile.am: remove files
	* panel-gdm.[ch]: killed, not used anymore
	* panel-logout.[ch]: killed, not used anymore
	* panel-session.[ch]: remove panel_session_request_logout()
	* libpanel-util/Makefile.am: add new files
	* libpanel-util/panel-session-manager.[ch]: new, object to interact
	with the session manager
	* panel-action-button.c: (panel_action_logout): use PanelSessionManager
	API
	(panel_action_shutdown): ditto
	(panel_action_shutdown_reboot_is_disabled): updated, with a comment
	about a regression
	* libpanel-util/panel-power-manager.c: remove useless includes
	(panel_power_manager_can_suspend): add g_return_val_if_fail
	(panel_power_manager_can_hibernate): add g_return_val_if_fail
	(panel_power_manager_attempt_suspend): add g_return_if_fail
	(panel_power_manager_attempt_hibernate): add g_return_if_fail

2008-06-06  Vincent Untz  <vuntz@gnome.org>

	* Makefile.am:
	* libpanel-util/Makefile.am:
	* panel-power-manager.[ch]: move PanelPowerManager to libpanel-util
	* panel-logout.c: update the include for the change

2008-06-06  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/panel-dbus-service.[ch]: rename
	panel_dbus_service_init_service to panel_dbus_service_define_service
	* panel-power-manager.c: (panel_power_manager_constructor): updated for
	this change

2008-06-06  Vincent Untz  <vuntz@gnome.org>

	* panel-power-manager.[ch]: rename panel_get_power_manager() to
	panel_power_manager_get()
	* panel-logout.c: (panel_logout_init): updated for this change

2008-06-06  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/panel-cleanup.[ch]: add description
	* libpanel-util/panel-keyfile.[ch]: ditto
	* libpanel-util/Makefile.am: add new file
	* libpanel-util/panel-dbus-service.[ch]: new utility object to make it
	easier to use dbus services. Maybe this is insane, but I have the
	feeling I'm going to duplicate lots of code without this.
	* panel-power-manager.[ch]: basically port to PanelDBusService and:
	(panel_get_power_manager): use panel_cleanup_register()

2008-06-05  Vincent Untz  <vuntz@gnome.org>

	* libpanel-util/Makefile.am: add new file
	* libpanel-util/panel-cleanup.[ch]: small utility API to ease cleanup
	when the panel exits
	* main.c: (main): use new API
	* panel-gconf.c: (panel_gconf_get_client): ditto

2008-06-05  Vincent Untz  <vuntz@gnome.org>

	Let's start cleaning up the source. Okay, this attempt will certainly
	fail at some point ;-)
	First step, create an internal libpanel-util library where we put some
	utility functions.
	We start with the GKeyFile extensions.

	* Makefile.am: updated for this change
	* libpanel-util/Makefile.am: new
	* libpanel-util/panel-keyfile.[ch]: new, based on panel-util.c code
	* panel-ditem-editor.c: s/panel_util_key_file/panel_key_file/g
	* panel-menu-items.c: s/panel_util_key_file/panel_key_file/g
	* panel-run-dialog.c: s/panel_util_key_file/panel_key_file/g
	* panel-util.[ch]: s/panel_util_key_file/panel_key_file/g and remove
	panel_util_key_file*
	* launcher.c: s/panel_util_key_file/panel_key_file/g
	* gnome-desktop-item-edit.c: s/panel_util_key_file/panel_key_file/g

==================== 2.23.3 ====================

2008-05-20  Vincent Untz  <vuntz@gnome.org>

	* panel-addto.c: (panel_addto_setup_launcher_drag): use an URI and not
	a path when setting the drag source for text/uri-list. Fix bug #532171.

2008-05-16  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (activate_uri_on_screen): new, based on
	activate_uri
	(activate_uri): just call activate_uri_on_screen
	(volume_mount_cb): open the mount after having mounted it
	Fix bug #528423

==================== 2.23.2.1 ====================

==================== 2.23.2 ====================

2008-05-07  Vincent Untz  <vuntz@gnome.org>

	* panel-recent.c: (show_uri): do not only look for applications that
	can open URI; if the file is gio-native (file://), then it's fine to
	get applications that can open paths.

==================== 2.23.1 ====================

==================== 2.22.1.3 ====================

==================== 2.22.1.2 ====================

==================== 2.22.1.1 ====================

==================== 2.22.1 ====================

2008-04-04  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: (panel_applet_frame_load): plug potential leak
	(panel_applet_frame_finalize): correctly release the bonobo object.
	This fixes bug #513347, and also bug #522025 as a side-effect.
	Thanks to Michael Meeks <michael.meeks@novell.com> for the hint!

2008-03-18  Frederic Crozat  <fcrozat@mandriva.com>

	* panel-logout.c: convert username / login
	to UTF-8 if current locale is not UTF-8.

==================== 2.22.0 ====================

==================== 2.21.92 ====================

2008-02-25  Alexander Larsson  <alexl@redhat.com>

        * panel-menu-items.c:
        * panel-util.c:
	g_uri_get_scheme -> g_uri_parse_scheme

2008-02-25  Alexander Larsson  <alexl@redhat.com>

	* launcher.c (panel_launcher_delete):
	Use g_file_has_prefix instead of renamed
	g_file_contains_file.

2008-02-21  Vincent Untz  <vuntz@gnome.org>

	Make drawer work again. Fix bug #517191.

	* panel-toplevel.c: (panel_toplevel_initially_hide):
	explicitly do everything for the initial hide here. And don't hide for
	drawers.
	(panel_toplevel_realize): initially hide here
	(panel_toplevel_init): don't initially hide here

2008-02-20  Vincent Untz  <vuntz@gnome.org>

	* gnome-desktop-item-edit.c: (main): make creating .desktop files with
	--create-new work again. Also fix a leak.
	Fix bug #517617

2008-02-13  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	* panel-recent.c: (show_uri):
	Add FIXME for really minor things to handle in the future...

2008-02-12  Vincent Untz  <vuntz@gnome.org>

	Use the customized CD icons when there's one.
	Fix bug #516032

	* menu.[ch]: make IconToLoad handle GIcon
	(icon_to_load_free): updated
	(icon_to_load_copy): ditto
	(load_icons_handler): load from GIcon when there's one
	(create_submenu_entry): updated for panel_load_menu_image_deferred()
	change
	(create_menuitem): ditto
	(setup_menu_item_with_icon): take a GIcon parameter
	(panel_load_menu_image_deferred): ditto, and use it
	* panel-menu-items.c: (panel_menu_items_append_from_desktop): updated
	for setup_menu_item_with_icon() change
	(panel_menu_items_append_place_item): add a GIcon parameter and use it
	(panel_menu_items_create_action_item_full): updated
	for setup_menu_item_with_icon() change
	(panel_place_menu_item_append_gtk_bookmarks): updated
	for setup_menu_item_with_icon() change
	(panel_menu_item_append_drive): directly use the GIcon
	(panel_menu_item_append_volume): ditto
	(panel_menu_item_append_mount): ditto
	(panel_place_menu_item_append_local_gio): updated
	for setup_menu_item_with_icon() change
	(panel_place_menu_item_append_remote_gio): updated
	for setup_menu_item_with_icon() change
	(panel_place_menu_item_create_menu): updated for
	panel_menu_items_append_place_item() change
	* panel-recent.c: (panel_recent_append_documents_menu): updated for
	setup_menu_item_with_icon() change
	* panel-util.[ch]: (panel_util_gdk_pixbuf_load_from_stream): new,
	stolen from eel
	(panel_util_get_pixbuf_from_g_loadable_icon): new, load a
	GLoadableIcon in a pixbuf

==================== 2.21.91 ====================

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	Fancy launcher animation when in a composited environment.
	Based on patch by Denis Washington <denisw@svn.gnome.org>
	Fix bug #479562

	* launcher.c: (launcher_launch), (drag_data_received_cb): update for
	xstuff_zoom_animate change
	* xstuff.[ch]: (zoom_timeout): new, redraw the zoom window
	(zoom_expose): new, fill the zoom window with the current state of the
	animation, or free resources at the end
	(draw_zoom_animation_composited): new, magic stuff inside :-)
	(draw_zoom_animation): remove trailing spaces
	(xstuff_zoom_animate): use the fancy effect if the screen is
	composited

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	Improve startup animation by starting the toplevels totally hidden.

	* panel-toplevel.c: add a new initial_animation_done field
	(panel_toplevel_update_auto_hide_position): if we haven't done the
	startup animation, set the auto hide size to 0
	(panel_toplevel_animation_timeout): when finishing an animation, mark
	that we're done with the initial startup animation
	(panel_toplevel_auto_unhide_timeout_handler): disable startup
	animation if there's no animation, for auto-hiding toplevels, unhide
	and hide again the toplevel so we can animate to the autohide size
	(panel_toplevel_init): init new field

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	Smooth animation between two auto-hide sizes.

	* panel-toplevel.c: (panel_toplevel_start_animation): don't override
	the timeout id if we already have one. Keep the current handler since
	it will work with the new goal too.
	(panel_toplevel_set_auto_hide_size): if the panel is auto-hidden, then
	unhide and hide the panel so that we have an animation towards the new
	size

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	Switch back to 24x24 icons again.
	Based on patch by Matthias Clasen <mclasen@redhat.com>
	Fix bug #487051

	* button-widget.c: (button_widget_size_allocate): handle 24x24 icons
	too
	* menu.c: (panel_make_menu_icon): scale the icon to the size only if
	it's not a bit smaller (ie, don't scale to 24 if we get 22)
	* panel-stock-icons.c: (panel_init_stock_icons_and_items): use 24x24
	for the menu bar icon
	* panel-stock-icons.h: default menu icon size is 24

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	Better bonobo applets asynchronous loading.
	Patch by openSUSE people (don't know who, probably Rodrigo Moya or
	Michael Meeks).
	Fix bug #499973.

	* panel-applet-frame.c: (panel_applet_frame_load): use
	bonobo-activation instead of moniker
	(panel_applet_frame_construct_moniker): renamed to...
	(panel_applet_frame_construct_item): this, and updated
	(panel_applet_frame_activated): do lots of complex stuff I don't fully
	understand :-) But it works! I promise!

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel-logout.c: (panel_logout_init): center the window
	(panel_logout_new): focus the window. Patch by Matthias Clasen
	<mclasen@redhat.com>. Fix bug #514026

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	Animate panel startup.
	Based on patch by William Jon McCann <mccann@jhu.edu>
	Fix bug #513756.

	* panel-toplevel.c: (get_delta): use GTimeVal
	(panel_toplevel_update_animating_position): updated for get_delta()
	change
	(panel_toplevel_realize): queue an automatic unhide
	(panel_toplevel_animation_timeout): updated
	(panel_toplevel_get_animation_time): make the time depend on the
	speed only
	(panel_toplevel_start_animation): updated for
	panel_toplevel_get_animation_time() change
	(panel_toplevel_initially_hide): new
	(panel_toplevel_init): initially make the toplevel automatically
	hidden

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_local_gio): put
	items in a submenu if there are too many items. Fix a regression.

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_menu_item_mount_volume): update for API
	change in gio

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_util_get_icon_for_uri): remove workaround for
	application/x-gnome-saved-search places. We don't need the
	fast-content-type anymore. Maybe this was needed before because of a
	bug in gio?

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_util_get_file_description): new, to get the
	description of a GFile
	(panel_util_get_label_for_uri): rework to use the description of the
	GFile when available

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_local_gio),
	(panel_place_menu_item_append_remote_gio): use g_file_is_native()
	instead of looking at the URI scheme

2008-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel.c: (drop_uri): finish gio port

2008-02-10  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_local_gio): add
	back a string that was removed and will be used again soon. Right now,
	it's just sitting there, useless. But it's temporary :-)

2008-02-10  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_volumes): renamed
	to...
	(panel_place_menu_item_append_local_gio): this. Also add mounts that
	have no volume and that have a root with a file: scheme
	(panel_place_menu_item_append_mounts): renamed to...
	(panel_place_menu_item_append_remote_gio): this. Only add mounts that
	have not a root with a file: scheme
	(panel_place_menu_item_create_menu): updated

2008-02-10  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_menu_items_append_from_desktop): fix
	compilation
	(panel_place_menu_item_drives_changed): new
	(panel_place_menu_item_volumes_changed): new
	(panel_place_menu_item_finalize): disconnect new signal handlers
	(panel_place_menu_item_init): connect to the drive-* and volume-*
	signals too

2008-02-10  Vincent Untz  <vuntz@gnome.org>

	Once upon a time, someone created gio. And those words were told:
	"thou shall port your application to gio".
	And people worked hard towards this goal.

	* Makefile.am:
	* panel-mount-operation.[ch]: add PanelMountOperation, stolen from eel
	* panel-menu-items.c: (activate_uri): easy port to gio
	(panel_menu_items_append_from_desktop):  ditto
	(panel_place_menu_item_append_gtk_bookmarks): harder, but still okay
	port to gio
	(drive_poll_for_media_cb): new, callback when polling a drive. There's
	a FIXME: should we automount the newly discovered volume?
	(panel_menu_item_rescan_drive): new, we poll a drive when we activate
	it
	(panel_menu_item_append_drive): new, to append a drive to the menu
	(volume_mount_cb): new, callback when mounting a volume. There's a
	FIXME: should we activate the URI of the new mount?
	(panel_menu_item_mount_volume): new, we mount a volume when we
	activate it
	(panel_menu_item_append_volume): new, to append a volume to the menu
	(panel_menu_item_append_mount): new, to append a mount to the menu
	(panel_place_menu_item_append_volumes): new, based on nautilus code
	(panel_place_menu_item_append_mounts): ditto
	(panel_place_menu_item_create_menu): simplify code to get the name of
	the Home folder, easy port to gio
	(panel_place_menu_item_gtk_bookmarks_changed): updated
	(panel_place_menu_item_mounts_changed): updated
	(panel_place_menu_item_finalize): updated
	(panel_place_menu_item_init): easy port
	* panel-util.[ch]: (panel_util_get_icon_name_from_g_icon): export
	(panel_util_get_file_display_name_if_mount): fix leak
	(panel_util_get_file_icon_name_if_mount): fix leak

2008-02-10  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_util_get_label_for_uri): typo in translator
	comment

2008-02-10  Vincent Untz  <vuntz@gnome.org>

	I wonder what this commit is about. Maybe some gio port work? Oh,
	right, it is about this. Cool.

	* gnome-desktop-item-edit.c: (panel_gconf_get_client): add sucky
	symbols for linking with panel-util.o
	* launcher.c: (panel_launcher_get_gfile): new, get a GFile of the
	location of the launcher
	(panel_launcher_get_uri): gio port
	(launch_url): we don't need to make the url canonical
	(drag_data_received_cb): get rid of gnome-vfs
	(panel_launcher_delete): gio port
	(setup_button): get rid of gnome-vfs
	(panel_launcher_find_writable_uri): ditto
	(panel_launcher_create_with_id): ditto
	(panel_launcher_create_copy): gio port
	* panel-ditem-editor.c: (panel_ditem_editor_constructor): gio port
	* panel-icon-names.h: add two icons
	* panel-recent.c: (show_uri): port to gio. We'll need to use
	GdkAppLaunchContext when we can depend on the new gtk+, though.
	* panel-run-dialog.c: (panel_run_dialog_set_default_icon): use the
	launcher icon as a default icon for drag and drop
	(command_is_executable): trivial gio port
	(panel_run_dialog_execute): trivial gio port, thanks to
	panel_util_get_file_optional_homedir()
	(entry_drag_data_received): trivial gio port
	(panel_run_dialog_create_desktop_file): trivial gio port, thanks to
	panel_util_get_file_optional_homedir()
	Also fix a crash when dragging the icon for a command without an icon
	by setting the .desktop icon to the launcher one
	(pixmap_drag_data_get): we want an URI here, not a path
	* panel-util.c: (internal_panel_is_uri_writable): kill
	(panel_is_uri_writable): gio port
	(panel_uri_exists): ditto
	(panel_make_unique_desktop_uri): ditto
	(panel_util_key_file_load_from_uri): ditto
	(panel_util_get_vfs_method_display_name): killed
	(panel_util_get_icon_for_uri_method): killed
	(panel_util_get_gfile_root): new, get the root parent of a GFile
	(panel_util_get_icon_name_from_g_icon): new, get an icon name that
	exists in the default icon theme from a GIcon
	(panel_util_get_file_display_name_if_mount): new, get name of a GFile
	if it's the root of a GMount
	(panel_util_get_file_display_for_common_files): new, get name of
	GFiles that are common
	(panel_util_get_file_display_name): new, utility to easily get the
	display name
	(panel_util_get_file_icon_name_if_mount): new, get icon name of a
	GFile if it's the root of a GMount
	(panel_util_get_icon_for_uri_known_folders): updated, port to gio and
	add icon for /
	(panel_util_get_label_for_uri): gio port. Explicitly mention the
	algorithm. There's a bug for hostnames, though.
	(panel_util_get_icon_for_uri): gio port. Explicitly mention the
	algorithm.
	(panel_util_get_file_optional_homedir): new, get a GFile from a
	location which might be relative to $HOME
	* panel-util.h: updated
	* panel.c: (drop_urilist): use the content-type, not the
	fast-content-type. It's okay. This is a rarely used operation anyway.

2008-02-10  Vincent Untz  <vuntz@gnome.org>

	Lalalala. gio port. Lalalala.

	* gnome-desktop-item-edit.c: (get_uri): killed
	(main): straight port, really easy.

2008-02-10  Vincent Untz  <vuntz@gnome.org>

	Continue gio port...

	* menu.c: (drag_data_get_menu_cb): simplify with g_filename_to_uri()
	* panel.c: (drop_urilist): port the function to gio

2008-02-09  Vincent Untz  <vuntz@gnome.org>

	Port menu.c to gio.
	Based on patch by Diego Escalante Urrelo <diegoe@gnome.org>
	Fix part of bug #509756.

	* menu.c: (add_app_to_desktop): straight port
	(drag_data_get_menu_cb): ditto

2008-02-09  Benjamin Berg  <benjamin@sipsolutions.net>

	* panel-toplevel.c: (panel_toplevel_expose):
	Fix bug #497998. This correct the orientation of the panel handles.

==================== 2.21.90 ====================

2008-01-29  Elijah Newren  <newren gnome org>

	* xstuff.c: (get_typed_property_data):
	Fix G_STRFUNC usage so that it compiles.

2008-01-28  Christian Persch  <chpe@gnome.org>

	* xstuff.c: (get_typed_property_data): 
	Use G_STRFUNC instead of the deprecated G_GNUC_FUNCTION.

2008-01-28  Vincent Untz  <vuntz@gnome.org>

	* panel-logout.c: (panel_logout_timeout): if the name of the user is
	"Unknown", then display the login name.
	Fix bug #509129, based on patch by Martin Schoen
	<martin_schoen@gmx.de>

==================== 2.21.5 ====================

==================== 2.20.1 ====================

==================== 2.20.0.1 ====================

2007-09-18  Vincent Untz  <vuntz@gnome.org>

	* panel-icon-names.h: revert the previous commit: it breaks some icon
	themes. We'll give some time to the authors to fix their themes, and
	use the new icon name in 2.22.

==================== 2.20.0 ====================

2007-09-17  Vincent Untz  <vuntz@gnome.org>

	* panel-icon-names.h: use new icon name for logout.
	Patch by Luca Ferretti <elle.uca@libero.it>
	Fix bug #472254

2007-09-11  Ray Strode  <rstrode@redhat.com>

	* panel-toplevel.c: (panel_toplevel_attach_to_widget): 
	fix typo in previous commit.

2007-09-11  Ray Strode  <rstrode@redhat.com>

	* panel-toplevel.c: (panel_toplevel_attach_to_widget): 
	Show drawers on same monitor as the panels they're 
	attached to (bug 300883).

==================== 2.19.92 ====================

2007-08-29  Jaap Haitsma  <jaap@haitsma.org>

	* panel-icon-names.h: Use system-search i.s.o. removed gnome-searchtool
	icon. Fixes bug #470194 

2007-08-27  Frederic Peters  <fpeters@0d.be>

	reviewed by: Vincent Untz

	* menu.c: (create_submenu_entry): do not show tooltips for application
	categories in menu. (bug 463919)

2007-08-27  Frederic Peters  <fpeters@0d.be>

	reviewed by: Vincent Untz

	* panel-logout.c: (panel_logout_timeout): fallback to user name when
	real name is empty. (bug 456925)

==================== 2.19.6 ====================

2007-08-01  Ray Strode  <rstrode@redhat.com>

	* panel-power-manager.c: (panel_power_manager_on_name_owner_change),
	(panel_power_manager_ensure_gpm_connection),
	(panel_power_manager_can_suspend),
	(panel_power_manager_can_hibernate): 
	Use new freedesktop.org power management interface.  Patch by
	Matthias Clasen <mclasen@redhat.com> (bug 460400)

2007-07-25  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_util_set_tooltip_text): remove old signal
	handler for query-tooltip when setting a new tooltip
	Fix bug #459973. Patch by Matthias Clasen <mclasen@redhat.com>

2007-07-16  Vincent Untz  <vuntz@gnome.org>

	* panel-profile.c: (panel_profile_load_toplevel): really look at the
	gconfvalue for x_right/y_bottom (just use -1 if it isn't set). This
	is needed for people coming from old versions of GNOME. If we don't do
	this, the returned value is 0, and the panel moves from the left to
	the right, eg.

==================== 2.19.5 ====================

2007-07-07  Vincent Untz  <vuntz@gnome.org>

	* panel-context-menu.c: (panel_context_menu_show_about_dialog): use
	program-name instead of name property for GtkAboutDialog.
	Fix bug #438903.

2007-07-03  Bastien Nocera  <hadess@hadess.net>

	* panel-action-button.c: (panel_action_force_quit):
	* panel-action-protocol.c: (panel_action_protocol_kill_dialog),
	(panel_action_protocol_filter), (panel_action_protocol_init):
	* panel-force-quit.c: (panel_force_quit):
	* panel-force-quit.h: Add the _GNOME_PANEL_ACTION_KILL_DIALOG message
	to allow a keybinding for the force quit dialogue to be added
	(Closes: #442625)

2007-07-01  Vincent Untz  <vuntz@gnome.org>

	* button-widget.c: (button_widget_expose): add a detail for the arrow
	in the button widget

2007-07-01  Vincent Untz  <vuntz@gnome.org>

	* menu.[ch]: (create_item_context_menu): don't use setup_menuitem(),
	but gtk_menu_item_new_with_mnemonic() since we don't need what
	setup_menuitem() does
	(setup_menuitem): always create invisible mnemonic
	(create_submenu_entry): updated
	(create_menuitem): updated
	(setup_menu_item_with_icon): always create invisible mnemonic
	* panel-menu-items.c:
	* panel-recent.c: updated for
	setup_menuitem()/setup_menu_item_with_icon() change

2007-07-01  Vincent Untz  <vuntz@gnome.org>

	* panel-toplevel.c: add two comments to help with understanding the
	code.

2007-07-01  Vincent Untz  <vuntz@gnome.org>

	Migrate to GtkTooltip.

	* panel-util.[ch]: (panel_util_query_tooltip_cb): new, check if
	tooltips are enabled but displaying one
	(panel_util_set_tooltip_text): wrapper for tooltip for the panel,
	since we need to check if the tooltips are enabled in the panel config.
	* panel-config-global.c: simplify, since we don't need to do the
	GtkTooltips stuff
	* main.c: (main):
	* panel-globals.h: remove useless global GtkTooltips variable
	* drawer.c:
	* launcher.c:
	* menu.c:
	* panel-action-button.c:
	* panel-menu-button.c:
	* panel-menu-items.c:
	* panel-recent.c: use panel_util_set_tooltip_text()
	* panel-menu-bar.c: (panel_menu_bar_enter_applications): kill
	(panel_menu_bar_enter_places): kill
	(panel_menu_bar_enter_desktop): kill
	(panel_menu_bar_reinit_tooltip): updated
	(panel_menu_bar_hide_tooltip): updated
	(panel_menu_bar_setup_tooltip): simplify thanks to GtkTooltip
	* gnome-desktop-item-edit.c:
	(panel_global_config_get_tooltips_enabled): needed symbol for
	compilation. This is just a hacky workaround.

2007-07-01  Vincent Untz  <vuntz@gnome.org>

	* panel-icon-names.h: add icon for home folder
	* panel-menu-items.c: (activate_home_uri): new
	(panel_place_menu_item_create_menu): don't use nautilus-home.desktop,
	but create a "place" menu item. Fix bug #338700.
	Also, put an uri for the Desktop menu item, else it will crash on drag
	and drop.
	* panel-util.c: (panel_util_get_icon_for_uri_known_folders): new, gets
	the icon for some well-know folders ($HOME, $Desktop)
	(panel_util_get_icon_for_uri): updated to use
	panel_util_get_icon_for_uri_known_folders()
	* panel.c: (drop_uri): get the icon too
	(drop_urilist): updated, don't get an icon here for uris

2007-07-01  Vincent Untz  <vuntz@gnome.org>

	* panel-lockdown.c: (panel_lockdown_notify_find): compare the
	GCallbacks too, instead of just checking that the GCallback that we
	have in our list is not NULL. That was probably a typo.
	Fix bug #301308.

2007-07-01  Vincent Untz  <vuntz@gnome.org>

	Make it possible to have bigger panels (up to 1/5 the screen size).
	Help for people wanting sidebars.
	Fix bug #355010.

	* panel-properties-dialog.glade: don't have a page_size of 12 for the
	size spin button
	* panel-properties-dialog.c:
	(panel_properties_dialog_setup_size_spin): don't hardcode the maximum
	size and use panel_toplevel_get_maximum_size()
	(panel_properties_dialog_update_orientation): update the spin button
	maximum size
	* panel-toplevel.[ch]: (panel_toplevel_update_size): take into account
	the maximum size computed by panel_toplevel_get_maximum_size() too
	(panel_toplevel_get_maximum_size): new, gets the maximum size, which
	depends on the monitor size

2007-06-29  Vincent Untz  <vuntz@gnome.org>

	* panel.[ch]: (panel_destroy): disconnect the "deactivate" signal
	handler
	(panel_menu_get): simplify
	(make_popup_panel_menu): make static
	Should fix bug #448025, where the panel was crashing because the
	toplevel is used while already destroyed

2007-06-29  Vincent Untz  <vuntz@gnome.org>

	Add fields to PanelToplevel to have the possibility to use a position
	relative from the right and/or bottom of the monitor. This is mainly
	for non-expanded panels. This fixes the panel position:
	 - after a resolution change: if the panel was at the bottom or right
	   of the screen and the resolution goes down and up again, we no
	   longer have a panel that starts to be floating for no reason
	 - when the panel is at the right of the screen and its size grows
	   (because of a tasklist): it no longer becomes centered or snaps to
	   the left of the screen.
	This change should still compatibility with older configuration: if
	you log in with an older GNOME after having used 2.20, things should
	still work as expected.
	Fix bug #107622 (and maybe other bugs).

	* panel-toplevel.schemas.in: add x_right, y_bottom keys for toplevels
	* panel-default-setup.entries: add those keys in the default setup
	* panel-profile.c: (panel_profile_queue_toplevel_location_change):
	(panel_profile_connect_to_toplevel):
	(panel_profile_toplevel_change_notify):
	(panel_profile_load_toplevel):
	(panel_profile_can_be_moved_freely): basically, a dumb update to
	handle the new keys (I just searched for what was done for the x and y
	keys and copied that)
	* panel-toplevel.[ch]: add new fields and properties for x_right and
	y_bottom
	(panel_toplevel_begin_grab_op): updated
	(panel_toplevel_cancel_grab_op): updated
	(panel_toplevel_resize_to_pointer): update y_bottom and x_right when
	this is necessary
	(panel_toplevel_move_to): fix x (y) when x_centered (y_centered) is
	true, and compute the new x_right/y_bottom values
	(panel_toplevel_calc_floating): use position from x_right/y_bottom
	when they're different from -1
	(panel_toplevel_update_normal_position): don't set x/y after snapping:
	this is just wrong, since setting x/y should only be done after a
	direct change by the user (and not automatically). This function is
	only used to update the x/y in the geometry, and not in the config.
	Also, to determine if we need to snap, only use x/y (with right/bottom
	variants) from the config, not the computed values imposed by
	constraints. This part fix the case where a panel is right aligned,
	but gets centered and then left aligned because its size grows
	(panel_toplevel_update_auto_hide_position): same update
	(panel_toplevel_update_expanded_position): compute x_right and
	y_bottom too, and notify of their changes when needed
	(panel_toplevel_update_position): handle x_right/y_bottom in the
	temporary position_centered case, and core part of the change: use
	x_right/y_bottom when they're not -1
	(panel_toplevel_set_property): updated for new properties
	(panel_toplevel_get_property): ditto
	(panel_toplevel_class_init): ditto
	(panel_toplevel_init): ditto
	(panel_toplevel_set_expand): small update to put the right values for
	x_right/y_bottom
	(panel_toplevel_set_orientation): when rotating a centered panel, set
	the relevant x_right/y_bottom value to -1 (since the rotated panel is
	centered (but not "force-centered"), its position is relative to the
	left/top
	(panel_toplevel_set_x): add x_right handling
	(panel_toplevel_set_y): add y_bottom handling
	(panel_toplevel_get_position): add x_right/y_bottom handling

2007-06-26  Vincent Untz  <vuntz@gnome.org>

	* gnome-desktop-item-edit.c: (main): use
	g_option_context_set_translation_domain() to translate the description
	Patch by Gabor Kelemen <kelemeng@gnome.hu>. Fix bug #450158

2007-06-26  Vincent Untz  <vuntz@gnome.org>

	* panel-icon-names.h: new icon for recent documents
	* panel-recent.c: (panel_recent_append_documents_menu): use new icon
	for this.
	Fix bug #450894

2007-06-26  Vincent Untz  <vuntz@gnome.org>

	Improve handling of size hints from applets. This is needed to have
	the latest tasklist (libwnck 2.19.5) to correctly work.
	For non-expanded panels, this means we have to "forward" the size
	hints from all applets using it from PanelWidget to PanelToplevel.
	This is a non-trivial change because it might break panel
	sizing and positioning...

	* panel-toplevel.c: (panel_toplevel_update_size_from_hints): new, when
	there are size hints, try to share all the remaining space on the
	screen that is not needed by applets not using size hints between
	applets using size hints. This breaks a bit the separation between
	PanelWidget and PanelToplevel, but I can't think of any other way to
	do this.
	(panel_toplevel_update_size): use
	panel_toplevel_update_size_from_hints(), and make it nicely work for
	drawers
	* panel-widget.[ch]: (panel_widget_size_request): don't take into
	account for the size request applets using size hints. Instead, keep a
	list of those applets, to be used later.
	(panel_widget_count_expanded_applets): kill
	(panel_widget_size_allocate):
	 - for packed panels: the toplevel will have decided which size to use
	   for applets using size hints. We don't need the "compression" part
	   anymore. Of course, we can have an overflow, but we didn't handle
	   this before anyway, so...
	 - for expanded panels: the cell and the minimum cell should be the
	   minimum size in the size hints for applets using size hints: using
	   the requested size is wrong since the requested size generally is
	   "the best size" for the applet, which is not the smaller size the
	   applet can handle. Also fix minor bugs where the minimum cell for
	   applets using size hints is just too big for the panel.
	(panel_widget_finalize): clean new fields
	(panel_widget_init): init new fields
	(panel_widget_set_applet_size_hints): check that the size hints are
	valid before accepting them
	* panel-applet-frame.c:
	(panel_applet_frame_set_size_hints_from_any): simplify a bit

2007-06-26  Vincent Untz  <vuntz@gnome.org>

	* panel.c: (drop_uri): fix call to panel_util_get_label_for_uri()

2007-06-19  Vincent Untz  <vuntz@gnome.org>

	* panel-toplevel.c: (panel_toplevel_calc_new_orientation): do not
	choose height over width for the "should I change orientation"
	distance because the orientation is horizontal: since the geometry of
	the panel might not have been updated, those may be swapped (eg, if
	you had an horizontal panel and it becomes vertical, they're swapped
	for some time). Instead, choose the lowest of the two which is correct
	all cases, even when the height is bigger than the width in an
	horizontal panel (think about it for a few minutes).
	Fix the "panel goes a bit crazy when moving it around", also known as
	bug #394670.

==================== 2.19.4 ====================

2007-06-15  Vincent Untz  <vuntz@gnome.org>

	* menu.c: (menu_destroy_context_menu): new
	(create_item_context_menu): when the menu item is destroyed, also
	destroy the context menu and block the restoring of grabs which would
	fail since the applications menu has been destroyed.
	Fix bug #350626.

2007-06-14  Vincent Untz  <vuntz@gnome.org>

	* launcher.c: (is_this_drop_ok), (drag_drop_cb): use
	gdk_atom_intern_static_string() instead of gdk_atom_intern()
	* panel-action-protocol.c: (panel_action_protocol_init): ditto
	* panel-background-monitor.c: (panel_background_monitor_init): ditto

2007-06-14  Vincent Untz  <vuntz@gnome.org>

	Use new glib API where it makes sense.

	* applet.c: (panel_applet_save_position): use g_timeout_add_seconds()
	* menu.c: (add_app_to_desktop): use g_get_user_special_dir() to know
	where's the desktop
	* panel-ditem-editor.c: (panel_ditem_editor_changed),
	(panel_ditem_editor_revert): use g_timeout_add_seconds()
	* panel-menu-items.c: (activate_uri): small update
	(activate_desktop_uri): new,  use g_get_user_special_dir() to know
	where's the desktop
	(panel_place_menu_item_create_menu): use activate_desktop_uri() for
	the desktop menu item

==================== 2.19.3 ====================

2007-05-26  Vincent Untz  <vuntz@gnome.org>

	* panel-properties-dialog.c:
	(panel_properties_dialog_update_for_attached): change title of the
	dialog to Drawer Properties if the toplevel is a drawer.
	Fix bug #319284

2007-05-26  Vincent Untz  <vuntz@gnome.org>

	* panel-icon-names.h: add new icon
	* panel-menu-items.c: (panel_place_menu_item_append_volumes): use an
	icon for removable media menu item
	Fix FIXME and bug #343180

2007-05-26  Vincent Untz  <vuntz@gnome.org>

	* panel-ditem-editor.c: (panel_ditem_editor_name_changed),
	(panel_ditem_editor_comment_changed),
	(panel_ditem_editor_icon_changed), (panel_ditem_editor_revert): use
	panel_util_key_file_remove_all_locale_key()
	* panel-util.[ch]: (panel_util_key_file_remove_all_locale_key): new,
	to remove all localized and non-locale versions of a key.
	Fix bug #363818

2007-05-26  Vincent Untz  <vuntz@gnome.org>

	* panel-properties-dialog.c:
	(panel_properties_dialog_image_changed): ignore the first
	selection-changed signals, since they're bogus (GTK+ bug #327243)
	(panel_properties_dialog_setup_image_chooser): initialize helper.
	Fix bug #412479

2007-05-26  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: (panel_applet_frame_set_flags_from_any):
	update the background if a handle was added. Fix initial background
	not working for handles.
	Fix bug #343168

2007-05-25  Vincent Untz  <vuntz@gnome.org>

	* panel-icon-names.h: add new icons
	* panel-menu-items.c: (activate_uri): handle x-nautilus-search uri by
	directly launching nautilus. This is ugly, though.
	(panel_place_menu_item_append_gtk_bookmarks): accept trash and
	x-nautilus-search uri, and also use the new functions from panel-util
	* panel-util.[ch]: (panel_util_get_vfs_method_display_name): new
	(panel_util_get_icon_for_uri_method): new
	(panel_util_get_label_for_uri): new
	(panel_util_get_icon_for_uri): new
	Most of this is copied from nautilus.
	* panel.c: (drop_uri): use panel_util_get_label_for_uri()
	(drop_urilist): add FIXME
	Fix bug #402628, bug #309598.

2007-05-25  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: (program_list_selection_changed): don't reset
	visibility of all programs in the program list. And beautify the code.
	Fix bug #339963

2007-05-25  Vincent Untz  <vuntz@gnome.org>

	* panel-ditem-editor.c: (panel_ditem_editor_setup_ui): set default
	response
	(panel_ditem_editor_activated): emits a reponse for the dialog
	(panel_ditem_editor_connect_signals): connect to the activate signal
	for the entries
	Fix bug #440690

2007-05-25  Vincent Untz  <vuntz@gnome.org>

	* panel-ditem-editor.c: (panel_ditem_editor_setup_ui): always put
	initial focus on the name entry
	Fix part of bug #440690

2007-05-25  Vincent Untz  <vuntz@gnome.org>

	* gnome-desktop-item-edit.c: (main): use
	panel_ditem_editor_new_directory() when it makes sense
	* panel-ditem-editor.[ch]: add a new type-directory construct-only
	property to know if the file is for .directory files
	(panel_ditem_editor_constructor): set the Type key to directory if
	we're editing a .directory file, and cache this information in
	type_directory 
	(panel_ditem_editor_get_property): updated for new property
	(panel_ditem_editor_set_property): updated for new property
	(panel_ditem_editor_class_init): updated for new property
	(panel_ditem_editor_get_item_type): properly handle the .directory
	case
	(panel_ditem_editor_setup_ui): don't show the combo if we edit a new
	.directory file
	(panel_ditem_editor_init): update
	(setup_icon_entry): update
	(panel_ditem_editor_save): update, and make the error message
	.directory aware
	(panel_ditem_editor_new_full): new
	(panel_ditem_editor_new): update to call panel_ditem_editor_new_full()
	(panel_ditem_editor_new_directory): new
	(panel_ditem_editor_set_type_directory): new
	(panel_ditem_editor_get_type_directory): new
	Fix bug #437940

2007-05-17  Vincent Untz  <vuntz@gnome.org>

	* panel-force-quit.c: (kill_window_question): set title, since the
	dialog appears in tasklist now
	* panel-recent.c: (recent_documents_clear_cb): ditto

2007-05-17  Vincent Untz  <vuntz@gnome.org>

	* panel-logout.c: (panel_logout_timeout): add username of the current
	user to the logout dialog

2007-05-17  Vincent Untz  <vuntz@gnome.org>

	* panel-recent.c: (recent_documents_clear_cb): fix compilation

2007-05-16  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: (panel_applet_frame_loading_failed): make the
	dialog a warning insted of a question
	* panel-force-quit.c: (kill_window_question): make dialog text more
	HIG compliant, make it a warning, don't skip the taskbar
	* panel-logout.c: (panel_logout_init): don't skip the pager for the
	dialog
	* panel-recent.c: (recent_documents_clear_cb): make the dialog a
	question, don't skip the tasklist
	* panel.c: (panel_deletion_dialog): don't set a title to the dialog,
	and make the dialog a warning
	Fix bug #324627

2007-05-15  Vincent Untz  <vuntz@gnome.org>

	* button-widget.[ch]: (button_widget_realize),
	(button_widget_unset_pixbufs), (button_widget_reload_pixbuf),
	(button_widget_icon_theme_changed), (button_widget_finalize),
	(button_widget_get_property), (button_widget_set_property),
	(button_widget_expose), (button_widget_size_request),
	(button_widget_size_allocate), (button_widget_activate),
	(button_widget_button_press), (button_widget_init),
	(button_widget_class_init), (button_widget_set_activatable),
	(button_widget_get_activatable), (button_widget_set_icon_name),
	(button_widget_get_icon_name), (button_widget_set_orientation),
	(button_widget_get_orientation), (button_widget_set_has_arrow),
	(button_widget_get_has_arrow), (button_widget_set_dnd_highlight),
	(button_widget_get_dnd_highlight),
	(button_widget_set_ignore_leave), (button_widget_get_ignore_leave),
	(button_widget_get_icon_theme), (button_widget_get_pixbuf):
	Use a private structure to contain object data
	Make "ignore-leave" a property
	Add button_widget_set_ignore_leave(),
	button_widget_get_ignore_leave(), button_widget_get_icon_theme() and
	button_widget_get_pixbuf()
	* launcher.c: (setup_button): updated to use
	button_widget_get_icon_theme()
	(panel_launcher_set_dnd_enabled): updated to use
	button_widget_get_pixbuf()
	* panel-menu-button.c: (panel_menu_button_menu_deactivated),
	(panel_menu_button_popup_menu): updated to use
	button_widget_set_ignore_leave()

2007-05-15  Vincent Untz  <vuntz@gnome.org>

	* launcher.c: (setup_button): if the value for the Icon key is empty,
	use the launcher icon

2007-05-15  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_make_unique_desktop_path_from_name): use
	MAXNAMLEN instead of NAME_MAX, for BSD/Solaris compatibility
	Fix bug #438637. Patch by Damien Carbery <damien.carbery@sun.com>

==================== 2.19.2 ====================

2007-05-13  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: (panel_applet_frame_cnx_broken),
	(panel_applet_frame_loading_failed): set a title for the error dialogs
	since they're shown in the tasklist

2007-05-13  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_error_dialog): set a title when we show the
	dialog in the tasklist

2007-05-13  Vincent Untz  <vuntz@gnome.org>

	* launcher.c: (launcher_properties): don't set a parent window,
	because we don't want the dialog to be transient to a panel toplevel
	(panel_launcher_create_from_info): set a parent for the error dialog
	* panel-applet-frame.c: (panel_applet_frame_reload_response): destroy
	the dialog anyway if we're in an inconsistent state
	(panel_applet_frame_cnx_broken): set urgency hint on the dialog
	(panel_applet_frame_loading_failed): ditto, and register the dialog as
	an open dialog
	* panel-context-menu.c: (panel_context_menu_delete_panel): set a
	parent for the error dialog
	* panel-logout.c: (panel_logout_init): add FIXME
	* panel-properties-dialog.c: (panel_properties_dialog_present): set a
	parent for the error dialog
	* panel-util.c: (panel_error_dialog): if we don't have a parent, show
	the dialog in the task bar since we don't have any real other windows
	shown on the screen. This follows the HIG.
	* panel-widget.c: (panel_widget_register_open_dialog): show the dialog
	in the task bar, for the same reason.

2007-05-13  Vincent Untz  <vuntz@gnome.org>

	* launcher.c: (panel_launcher_create_with_id): if we have a file URI,
	we need to unescape the URI before putting the filename in gconf,
	since the file on disk is unescaped.
	Fix bug #432942

2007-05-13  Vincent Untz  <vuntz@gnome.org>

	* Makefile.am: install data in $(datadir)/gnome-panel/ instead of
	$(datadir)/gnome/panel/
	Fix bug #436461

2007-05-13  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_make_unique_desktop_path_from_name): remove
	duplicate g_free() which makes the panel crash

2007-05-13  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_error_dialog):
	* panel-context-menu.c: (panel_context_menu_show_about_dialog):
	* panel.c: (panel_deletion_dialog): don't call
	gtk_window_set_wmclass() since GTK+ doc says "Don't use this
	function."

2007-05-13  Vincent Untz  <vuntz@gnome.org>

	* gnome-panel.desktop.in.in: renamed from gnome-panel.desktop.in and
	add a comment
	* panel-context-menu.c: (panel_context_menu_show_about_dialog): update
	description to be less geeky
	* Makefile.am: updated

2007-05-12  Vincent Untz  <vuntz@gnome.org>

	* panel-ditem-editor.c: (type_combo_changed): change mnemonic for
	Command.
	Fix bug #419780

2007-05-12  Vincent Untz  <vuntz@gnome.org>

	* gnome-desktop-item-edit.c: (get_unique_name): kill
	(find_uri_on_save): use panel_make_unique_desktop_path_from_name()
	instead
	* panel-util.[ch]: (panel_make_unique_desktop_path_from_name): new,
	based on code from panel_make_unique_desktop_uri(), but also takes
	into account NAME_MAX
	(panel_make_unique_desktop_uri): use
	panel_make_unique_desktop_path_from_name()
	Fix bug #426281

2007-05-12  Vincent Untz  <vuntz@gnome.org>

	* panel-gdm.c: (gdm_init_protocol_connection): prefer the new path for
	the gdm socket.
	Fix bug #437460. Patch by Loïc Minier <lool+gnome@via.ecp.fr>

2007-05-12  Vincent Untz  <vuntz@gnome.org>

	* panel-action-button.c: (panel_action_shutdown_reboot_is_disabled):
	renamed from panel_action_shutdown_is_disabled()
	* panel-logout.c: (panel_logout_new): only show restart/shutdown
	buttons when gdm supports the actions
	Fix bug #433792. Patch by Brian Cameron <Brian.Cameron@Sun.Com>

2007-05-12  Vincent Untz  <vuntz@gnome.org>

	* panel-icon-names.h: new file, containing defines for all named icons
	we use. So that the names are easy to change.
	* Makefile.am: add new file
	* drawer.c: (create_drawer_applet):
	* drawer.h:
	* gnome-desktop-item-edit.c: (main):
	* launcher.c: (setup_button):
	* main.c: (main):
	* menu.c: (create_submenu_entry):
	* panel-action-button.c:
	* panel-addto.c:
	* panel-context-menu.c: (panel_context_menu_show_about_dialog):
	* panel-ditem-editor.c: (setup_icon_entry):
	* panel-force-quit.c: (display_popup_window):
	* panel-force-quit.h:
	* panel-logout.c: (panel_logout_new):
	* panel-menu-bar.c: (panel_menu_bar_init):
	* panel-menu-bar.h:
	* panel-menu-button.c: (panel_menu_button_get_icon):
	* panel-menu-button.h:
	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks),
	(panel_place_menu_item_create_menu), (panel_place_menu_item_new):
	* panel-run-dialog.c: (panel_run_dialog_set_default_icon):
	* panel-run-dialog.h:
	* panel-separator.h:
	* panel-stock-icons.c:
	* panel.c: (drop_url), (drop_urilist), (panel_receive_dnd_data):
	Update to use the new macros

2007-05-12  Vincent Untz  <vuntz@gnome.org>

	* panel-util.[ch]: (panel_util_key_file_ensure_C_key): new
	* panel-ditem-editor.c: (panel_ditem_editor_save): move code to use
	panel_util_key_file_ensure_C_key()

2007-05-12  Vincent Untz  <vuntz@gnome.org>

	* panel-util.[ch]: (guess_icon_from_exec): new, moved from launcher.c
	* panel-ditem-editor.c: (setup_icon_entry): new, to setup the icon in
	the icon entry
	(panel_ditem_editor_constructor): if we're creating a new file, call
	setup_icon_entry() to get nice default icons
	(panel_ditem_editor_command_changed): guess the icon from the new
	command and update it. It's what the user wants in 99% of the case, to
	get a nice icon.
	(panel_ditem_editor_sync_display): use setup_icon_entry()
	* gnome-desktop-item-edit.c: (find_uri_on_save_directory): kill
	(main): when the file for a .directory file doesn't exist, we don't
	need to register a save_uri function. It was impossible to edit a
	file that was not passed a non-absolute URI
	* launcher.c: (guess_icon_from_exec): moved in another file
	(setup_button): if we can't find an icon, use the launcher icon
	* button-widget.c: (button_widget_reload_pixbuf): add FIXME
	Sideeffect: fix bug #435150

2007-05-07  Vincent Untz  <vuntz@gnome.org>

	* panel-util.[ch]: (panel_util_make_exec_uri_for_desktop): new
	* panel-ditem-editor.c: (command_browse_chooser_response): use the new
	function to add quotes when necessary, since this is how the Exec
	works with spaces. Fixes creating launchers with empty spaces in the
	command.
	(panel_ditem_editor_sync_display): set the filename in the icon entry
	after having looked at the theme directory. Fixes the launcher editor
	to not save a localized Icon key with the whole path when there's only
	a icon name

2007-05-07  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: fix alignment of the run button again, and use
	markup for the label in there

2007-05-01  Vincent Untz  <vuntz@gnome.org>

	* panel-ditem-editor.c: use Location instead of File for the combo box
	Fix bug #394595

2007-05-01  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: (panel_applet_frame_cnx_broken): default the
	dialog response to "reload"
	(panel_applet_frame_loading_failed): default the response to "don't
	delete"
	Fix bug #345156

2007-05-01  Vincent Untz  <vuntz@gnome.org>

	* panel-shell.c: (panel_shell_register_error_dialog): new, show the
	error dialog with a checkbox to let the user force the panel to not
	be restarted by gnome-session
	(panel_shell_register): force the panel to not be restarted if there's
	already one running and don't show an error dialog in this case
	* panel-session.[ch]: (panel_session_do_not_restart): new, to tell the
	session manager to not restart the panel
	Fix bug #309539

2007-04-30  Vincent Untz  <vuntz@gnome.org>

	* panel-util.[ch]: (missing_pixbuf): unused => kill
	* menu.c: remove useless include
	(menus_have_icons_changed): remove useless code

==================== 2.18.1 ====================

2007-04-10  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_lock_screen_action_get_command): if EUID is 0,
	return NULL if the user wants to lock the screen: gnome-screensaver
	and xscreensaver don't support root locking the screen.
	Fix bug #424545.

2007-04-10  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: (panel_run_dialog_destroy): call
	panel_run_dialog_disconnect_pixmap()
	(panel_run_dialog_disconnect_pixmap): new function, to disconnect
	signals
	Fix bug happening because we get a screen_changed signal when the
	widget is destroyed and the data read in the handler has already been
	freed.
	Fix bug #413921. Patch by Ray Strode <rstrode@redhat.com>

2007-04-10  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_error_dialog): don't use the error message as a
	format string.
	Fix bug #418186. Patch by Chris Wilson <chris@chris-wilson.co.uk>

2007-03-15  Vincent Untz  <vuntz@gnome.org>

	* gnome-panel.desktop.in: fix NoDisplay value to be valid

==================== 2.18.0 ====================

2007-03-06  Vincent Untz  <vuntz@gnome.org>

	* Makefile.am: install gnome-panel.desktop for bug-buddy
	* gnome-panel/gnome-panel.desktop.in: new
	Fix bug #382584

2007-03-05  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.glade: fix alignment of a button. This is not a UI
	freeze break since this was wrongly introduced by glade with the
	commit on 2007-02-18.
	Fix bug #414198

2007-02-27  Vincent Untz  <vuntz@gnome.org>

	* menu.c: (setup_menuitem): don't connect to the size request signal
	if the icon size is invalid
	* panel-menu-items.c: (panel_place_menu_item_new),
	(panel_desktop_menu_item_new): use an invalid icon size for
	setup_menuitem() if we don't use icon
	Fix large height of the menubar, which forced the panel size to be at
	least 28.

==================== 2.17.92 ====================

2007-02-19  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: add missing include
	* panel-menu-button.c: ditto
	* launcher.c: remove useless include
	* panel-action-button.c: ditto
	* panel-addto.c: ditto
	* panel-applet-frame.c: (panel_applet_frame_load_from_gconf): check
	that the iid is not an emptry string too
	* applet.c: (setup_an_item): get rid of setup_menuitem() and
	panel_create_menu() usage
	(panel_applet_create_menu): ditto
	* panel-context-menu.c: (panel_context_menu_build_edition): ditto
	(panel_context_menu_create): ditto

2007-02-18  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-bar.c: (panel_menu_bar_enter_applications): call
	panel_menu_bar_update_text_gravity() and connect to the screen-changed
	signal because we need to set the gravity again
	(set_item_text_gravity): new, magic pango stuff
	(panel_menu_bar_update_text_gravity): new
	Fix bug #337443, based on patch by Behdad Esfahbod <behdad@gnome.org>

2007-02-18  Vincent Untz  <vuntz@gnome.org>

	Fix bug #343092: the image is not always 48x48 anymore

	* panel-run-dialog.c: (panel_run_dialog_set_icon): add argument to
	force the reloading of icon, move useless check so that it's useful,
	use GtkSettings to get the size of the icon instead of hardcoding 48
	(panel_run_dialog_find_command_idle): update for
	panel_run_dialog_set_icon() change
	(program_list_selection_changed): ditto
	(panel_run_dialog_style_set): new, reload icon
	(panel_run_dialog_screen_changed): ditto
	(panel_run_dialog_setup_pixmap): connect to style-set and
	screen-changed signal
	* panel-run-dialog.glade: don't force size of the image (and totally
	rewritten by glade3...)

2007-02-17  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: remove useless moving_focus_out field

2007-02-17  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_util_launch_from_key_file): get localized values
	for relevant keys.
	This shows translated names in "Starting %s..."
	Fix bug #351298.

2007-02-17  Vincent Untz  <vuntz@gnome.org>

	Fix error dialogs always popping up when there's an applet that fails
	to load and we move a launcher or add another applet.

	* panel-applet-frame.c: (panel_applet_frame_loading_failed): add the
	applet to a list of applet we don't want to reload
	(panel_applet_frame_loading_failed_response): if the user chooses to
	delete the applet, remove the id from the list of applet we don't want
	to reload, since it can be reused by another applet
	(panel_applet_frame_load): don't load the applet if we already failed
	to load it once

2007-02-17  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_new):
	(panel_desktop_menu_item_new): fix warnings introduced by last commit

2007-02-17  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_new):
	(panel_desktop_menu_item_new): use setup_menuitem() to correctly
	setup the menu items, so that mnemonics work
	Fix bug #402431, patch by Padraig O'Briain <padraig.obriain@sun.com>

2007-02-17  Vincent Untz  <vuntz@gnome.org>

	* panel-background-monitor.c:
	* panel-menu-bar.c:
	* panel-applet-frame.c:
	* panel-menu-items.c:
	* panel-toplevel.c:
	* panel-menu-button.c:
	* panel-widget.c:
	* panel-action-button.c:
	* panel-frame.c:
	* button-widget.c:
	Use G_DEFINE_TYPE. This sometimes implied renaming _instance_init() to
	_init() and changed code using parent_class to use *_parent_class.

2007-02-17  Vincent Untz  <vuntz@gnome.org>

	* menu.c: (image_menuitem_size_request): we shouldn't forget about the
	border width and y thickness.
	Fix initial position of menu that is wrong: bug #321462, bug #331780.

==================== 2.17.91 ====================

2007-02-12  Vincent Untz  <vuntz@gnome.org>

	* panel-toplevel.c: (panel_toplevel_hide_button_clicked): fix for RTL
	* panel-widget.[ch]: (panel_widget_size_allocate): start from the end of
	the panel when placing applets in RTL environments
	(panel_widget_get_cursorloc): get position in coordinates starting
	from the right in RTL environments
	* panel.c: (panel_popup_menu): use panel_widget_get_cursorloc
	Fix bug #149886, patch by yair <yairhr@yahoo.com>

2007-02-12  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_make_unique_desktop_uri): accept NULL arguments
	* launcher.c: (panel_launcher_find_writable_uri): remove useless ;
	* launcher_save_uri: (launcher_save_uri): look at URL key instead of
	Exec key when saving a Link .desktop file, and default to Name in
	other cases
	Should fix bug #402462

2007-02-06  Vincent Untz  <vuntz@gnome.org>

	Revert changes about settings.menu.
	Based on patch by Denis Washington <dwashington@gmx.net>

	* panel-compatibility.[ch]:
	(panel_compatiblity_migrate_settings_menu_button): kill
	* menu.c: (submenu_to_display): fix callback data when appending a
	menu
	* panel-menu-items.c: (panel_desktop_menu_item_append_menu): brought
	back from the deads
	(panel_desktop_menu_item_create_menu): use settings.menu as basis for
	the menu and append data later
	* panel-menu-button.c: don't migrate from settings.menu
	* panel-addto.c: (panel_addto_make_application_model):
	(panel_addto_make_application_model): use settings.menu

2007-02-06  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-button.c: (panel_menu_button_accessible_ref_child): emit
	the "show" signal on the menu so that it's populated
	(panel_menu_button_accessible_get_name): new
	(panel_menu_button_accessible_class_init): set the accessible name
	handler
	Patch by Padraig O'Briain <padraig.obriain@sun.com>
	Fix bug #361363

==================== 2.17.90 ====================

2007-01-15  Vincent Untz  <vuntz@gnome.org>

	Fix main menu not completely reloading when gmenu sends a change
	signal.

	* menu.c: (submenu_to_display): append end of the menu if there's
	a function to append
	(create_fake_menu): we don't need panel-menu-needs-appending anymore
	(handle_gmenu_tree_changed): ditto
	(create_applications_menu): ditto
	(main_menu_append): ditto
	(create_main_menu): don't connect to the show signal to append the end
	of the menu, and instead add what we need to do this as object data

2007-01-15  Vincent Untz  <vuntz@gnome.org>

	* launcher.c: (panel_launcher_delete): get the uri of the file before
	trying to unlink it so that we actually unlink it. And do not try to
	unlink it if it doesn't live in the user's launchers path.

2007-01-15  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_make_unique_desktop_uri): if the basename of
	the source contains -4.desktop, then remove not only .desktop, but
	also -4 since it was probably added by us. Helps avoiding having
	gok-1-1-1-1-1-1.desktop filenames when moving the launcher...

2007-01-15  Vincent Untz  <vuntz@gnome.org>

	* applet.c: (panel_applet_position_menu): correctly position menu in
	RTL environments
	Fix bug #396386

2007-01-15  Vincent Untz  <vuntz@gnome.org>

	* panel-properties-dialog.glade:
	* panel-run-dialog.glade: do not hardcode invisible_char in glade files
	Fix bug #393901, patch by Vitaliy Ischenko <betalb@gmail.com>

2007-01-15  Vincent Untz  <vuntz@gnome.org>

	* panel-widget.c: (panel_widget_applet_button_press_event): do not
	start dragging an applet when it's not possible because a grab is
	active
	Fix bug #381549, patch by Amnon Aaronsohn <amnonaar@gmail.com>

2007-01-15  Vincent Untz  <vuntz@gnome.org>

	* panel-action-button.c: (panel_action_logout): check for the
	/apps/gnome-session/options/logout_prompt key to know whether we
	should show the logout dialog or just log out
	Based on patch by Ray Strode <rstrode@redhat.com>
	Fix bug #343406

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* gnome-desktop-item-edit.c: (main): fix some not-translated strings,
	do not require not --create-new for some actions
	Fix bug #396448

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* main.c: (main): don't accept all unknown options, and instead add
	back a hidden --profile argument that does nothing.

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* panel-background-monitor.c: (panel_background_monitor_setup_pixbuf):
	get the size of the window with gdk_window_get_geometry() instead of
	gdk_drawable_get_size() since the lattest might not give us the latest
	size, and this breaks when resizing the screen.
	Fix bug #353781, patch by <bugreports@nn7.de>

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* launcher.[ch]: (panel_launcher_get_uri): new, get the uri of the
	launcher file
	(drag_data_get_cb): correctly set the uri of the launcher for uri-list
	targets
	(panel_launcher_create_copy): get the uri of the file before copying
	the launcher so that we don't lose the launcher when moving it
	(because of copying a non-existing file and then deleting it), also
	returns whether the copy succeeded or not
	* panel.c: (drop_internal_icon): stop moving the icon if the copy
	didn't succeed

	Fix bug #355513

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* panel-multiscreen.c: define environ for darwin
	Part of bug #394896

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* gnome-desktop-item-edit.c: (main):
	* panel-addto.c: s/launcher-program/gnome-panel-launcher/ (new name
	for this icon)
	Part of bug #351832

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* panel-stock-icons.h: use 22 as default size for menu icons
	* button-widget.c: force size of the icons to be those defined in the
	tango spec (16, 22, 32, 48)
	Fix bug #343437

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* panel-compatibility.[ch]:
	(panel_compatiblity_migrate_settings_menu_button): new, migrates the
	settings menu button objects to a simple launcher
	* panel-menu-button.c: do not use settings.menu anymore, handle
	preferences.menu
	(panel_menu_button_load_from_gconf): migrate the settings menu buttons
	to launchers
	* panel-menu-button.h: remove cruft
	* panel-addto.c: (panel_addto_make_application_model): list capplets
	from preferences.menu instead of settings.menu

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_desktop_menu_item_append_menu): kill
	(panel_desktop_menu_item_create_menu): we don't need to load
	settings.menu anymore and we can just load gnomecc.desktop instead
	(new menu layout), so we load everything there
	(panel_desktop_menu_item_new): use the computer icon for this menu
	item
	Fix bug #395416

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	Patch by Dan Williams <danw@novell.com>
	Fix bug #366429

	* panel-util.c (panel_make_unique_desktop_uri): rename from
	"panel_make_unique_uri" and remove the "suffix" arg, since this is
	only used to create desktop file URIs. Add a "source" arg and base
	the desktop file name on that, so that we end up with names like
	"epiphany.desktop" rather than "hadjaha-00818f1ab6.desktop"

	* launcher.c (launcher_save_uri, panel_launcher_create_from_info) 
	(panel_launcher_create_copy): 
	* menu.c (add_app_to_desktop): 
	* panel-run-dialog.c (panel_run_dialog_create_desktop_file):
	Update for that

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* button-widget.[ch]: (button_widget_reload_pixbuf): use
	GTK_STOCK_MISSING_IMAGE when the icon can't be found, kill the error
	dialog
	(get_missing): kill
	Fix bug #100964, patch by Thomas Wood <thos@gnome.org>

2007-01-14  Vincent Untz  <vuntz@gnome.org>

	* gnome-desktop-item-edit.c: (main): make it possible to create a
	.directory file with a name instead of forcing the name to
	$(dir)/.directory 
	
2007-01-05  Luca Ferretti  <elle.uca@libero.it>

	* panel-action-button.c:
	* panel-menu-items.c:
	Change some UI strings as suggested in 
	http://live.gnome.org/UsabilityTeam/Menu
	Closes bug #384681.

2006-12-04  Kjartan Maraas  <kmaraas@gnome.org>

	* panel-recent.c: (panel_recent_append_documents_menu):
	Remove a warning about a var being used uninitialized.
	Patch from JP Rosevear. Closes bug #363312.

==================== 2.16.2 ====================

2006-11-14  Paolo Borelli  <pborelli@katamail.com>

	* panel-menu-items.c (panel_menu_items_append_lock_logout):
	* gnome-panel/menu.c (main_menu_append):
	plug GList leak.

2006-11-14  Vincent Untz  <vuntz@gnome.org>
	
	* panel-bindings.c: (panel_bindings_initialise): fix order of the
	g_warning arguments
	Patch by Claudio Saavedra <csaavedra@alumnos.utalca.cl>
	Fix bug #365008

2006-11-14  Vincent Untz  <vuntz@gnome.org>

	* panel-compatibility.c: (panel_compatibility_migrate_objects): plug
	leak
	* panel-gdm.c: fix structure
	(gdm_init_protocol_connection): plug leak
	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmar):
	handle case when gnome_vfs_get_local_path_from_uri() returns NULL
	Fix bug #375326
	Based on patch by Kjartan Maraas <kmaraas@gnome.org>.

2006-11-11  Dennis Cranston  <dennis_cranston@yahoo.com>

	* panel-ditem-editor.c: (panel_ditem_editor_make_ui): Dialog 
	spacing fix.  (bug #350691).

==================== 2.16.1 ====================

2006-10-01  Vincent Untz  <vuntz@gnome.org>

	* update-from-egg.sh: kill

2006-10-01  Vincent Untz  <vuntz@gnome.org>

	* launcher.c: (ask_about_launcher): don't do anything if the command
	line is disabled
	* panel-addto.c: do not present the 'new launcher' option if the
	command line is disabled
	Fix bug #356112. Patch by Bastien Nocera <hadess@hadess.net>

2006-09-06  Frederic Crozat  <fcrozat@mandriva.com>

	* panel-util.c: (panel_launch_desktop_file):
	Fix crash when alacarte isn't installed (bug #354637).

==================== 2.16.0 ====================

2006-09-04  Vincent Untz  <vuntz@gnome.org>

	* panel-ditem-editor.c: (type_combo_changed): don't update the key
	file when setting up the combo ui.
	Workaround for bug #353095. A proper fix will go in later.

==================== 2.15.92 ====================

2006-08-18  Vincent Untz  <vuntz@gnome.org>

	* panel-recent.c: (recent_documents_clear_cb): reset
	clear_recent_dialog to NULL when the dialog is destroyed
	Caught by Matthias Clasen <mclasen@redhat.com>

2006-08-18  Vincent Untz  <vuntz@gnome.org>

	Don't throw a critical warning if the icon can't be found in the icon
	theme.
	Patch by Jens Granseuer <jensgr@gmx.net>
	Fix bug #351661.

	* panel-ditem-editor.c: (panel_ditem_editor_sync_display): test if the
	returned filename is NULL

2006-08-15  Vincent Untz  <vuntz@gnome.org>

	* panel-ditem-editor.c: (panel_ditem_editor_connect_signals): change
	order of callbacks, so we update the keyfile data before sending a
	"changed" signal

2006-08-14  Vincent Untz  <vuntz@gnome.org>

	* panel-recent.c: (panel_recent_append_documents_menu): use the size
	of the manager to determine initial sensitivity, instead of using a
	value filled with random data.
	Should fix bug #351326

2006-08-10  Vincent Untz  <vuntz@gnome.org>

	* panel-properties-dialog.c: don't forget properly setting up the
	dialog!
	* panel-properties-dialog.glade: change a name

2006-08-10  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: (panel_applet_frame_finalize): disconnect from
	the connection broken signal before doing anything else.
	Fix crash when quitting and an applet is crashing.

2006-08-09  Vincent Untz  <vuntz@gnome.org>

	* panel-context-menu.c: (panel_context_menu_show_about_dialog): update
	my email address
	(panel_context_menu_remove_panel): renamed to...
	(panel_context_menu_delete_panel): ... and use the toplevel from the
	argument
	(panel_context_menu_setup_remove_panel_item): renamed to...
	(panel_context_menu_setup_delete_panel_item): ... and don't update the
	label since we always use the same
	(make_panel_submenu): renamed to...
	(panel_context_menu_build_edition): updated
	(panel_context_menu_create): updated and added a FIXME
	Fix bug #144475

	* panel-menu-items.c: (panel_place_menu_item_append_volumes): change
	icon for the network places

2006-08-09  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_menu_items_append_from_desktop): pass
	uri and not path to setup_uri_drag
	(panel_place_menu_item_create_menu): for the Desktop menu item, use an
	URI, and not a relative path.

2006-08-09  Vincent Untz  <vuntz@gnome.org>

	* menu.c: (drag_data_get_menu_cb): pass a real uri and not a path as
	drag data
	Should fix bug #343756

	* menu.c: (create_menuitem): remove the extension of the icon if it's
	not an absolute path (for drag icon)
	* panel-ditem-editor.c: (panel_ditem_editor_icon_changed): ditto: we
	don't want to save the extension
	* panel-util.[ch]: (panel_util_icon_remove_extension): new
	(panel_find_icon): use panel_util_icon_remove_extension

2006-08-09  Vincent Untz  <vuntz@gnome.org>

	* panel.c: (drop_nautilus_desktop_uri): new, to handle
	some of the x-nautilus-desktop: URI (trash, home, computer, network)
	(drop_urilist): remove useless variable, use
	drop_nautilus_desktop_uri() when it makes sense
	Fix part of bug #143580

2006-08-09  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-bar.c: (panel_menu_bar_invoke_menu): fix crash when
	alacarte is not found
	(panel_menu_button_invoke_menu): ditto
	Based on patch by Ray Strode <rstrode@redhat.com>
	Fix bug #350298

2006-08-09  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.h: update icon name for run dialog for icon name
	spec

2006-08-08  Vincent Untz  <vuntz@gnome.org>

	* gnome-desktop-item-edit.c: (is_an_uri): kill
	(get_uri): rewrote, with nice gnome_vfs_uri_make_full_from_relative()
	to resolve relative paths
	(main): report correct error if the file exists but --create-new was
	used
	Fix bug #84321

2006-08-08  Vincent Untz  <vuntz@gnome.org>

	* panel-toplevel.c: (panel_toplevel_start_animation): when canceling
	the animation, really cancel it and remember we're not animating!
	Fix bug #171938
	Patch by Зоран Рилак <zoran.rilak@gmail.com>

==================== 2.15.91 ====================

2006-08-08  Vincent Untz  <vuntz@gnome.org>

	* drawer.h: forgot the drawer icon

2006-08-08  Vincent Untz  <vuntz@gnome.org>

	* panel-force-quit.h:
	* panel-menu-bar.h:
	* panel-menu-button.h:
	* panel-separator.h:
	* panel-stock-icons.[ch]: update for icon name changes

2006-08-07  Vincent Untz  <vuntz@gnome.org>

	* button-widget.[ch]: (button_widget_reload_pixbuf): remember the
	error dialog about the icon being not found and don't show a second
	one if we already have one and automatically destroy it if we find an
	icon afterwards
	(button_widget_instance_init): init the dialog

2006-08-07  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_desktop_menu_item_new): use System
	instead of Desktop in the menu bar

2006-08-06  Vincent Untz  <vuntz@gnome.org>

	New dialog to edit the launchers!
	(and my biggest ChangeLog entry ever! awesome!)

	* Makefile.am: add panel-ditem-editor.[ch] and remove menu-ditem.[ch]
	* panel-ditem-editor.[ch]: new, with all the magic :-)
	* menu-ditem.[ch]: killed
	* gnome-desktop-item-edit.c: mark string for translation,
	(validate_for_filename): copied from menu-ditem.c
	(get_unique_name): ditto
	(find_uri_on_save_directory): new, to get the name when creating a
	.directory file
	(find_uri_on_save): new, ditto for .desktop files
	(error_reported): new, to report errors from the editor
	(main): mark string for translation, update with PanelDItemEditor love
	* launcher.[ch]: (panel_launcher_get_filename): updated so that we
	don't consider non-local files as okay
	(panel_launcher_save_ditem): kill
	(launch_url): moved to GKeyFile, updated for panel_error_dialog()
	change
	(launcher_launch): ditto
	(drag_data_received_cb): updated to use
	panel_util_launch_from_key_file(), updated for panel_error_dialog()
	change
	(free_launcher): updated
	(panel_launcher_delete): updated for location change
	(drag_data_get_cb): updated for location change
	(create_launcher): moved to GKeyFile, make sure that if the user edits
	a desktop file from a datadir, the desktop file will get a random name
	(guess_icon_from_exec): moved to GKeyFile
	(setup_button): ditto
	(panel_launcher_hoard): renamed to panel_launcher_find_writable_uri()
	and...
	(panel_launcher_find_writable_uri): ... change the function to only
	get a filename (without saving), also, make it more understandable :-)
	(properties_apply): kill
	(launcher_changed): rewrote, update button look
	(properties_close_callback): kill
	(launcher_command_changed): do what we did in previous
	launcher_changed(), ie: reset StartupNotify
	(launcher_save_uri): function to get uri where the PanelDItemEditor
	will save the file
	(set_revert_insensitive): kill
	(set_revert_sensitive): kill
	(window_response): kill
	(launcher_saved): update location gconf key if we had to change the
	uri of the file
	(create_properties_dialog): kill
	(launcher_error_reported): report error
	(launcher_properties): move to PanelDItemEditor
	(load_launcher_applet): fix leak in case of error
	(launcher_load_from_gconf): update string
	(ensure_item_localefiled): kill
	(launcher_new_saved): add the launcher to the profile
	(really_add_launcher): kill
	(ask_about_launcher): move to PanelDItemEditor
	(panel_launcher_create_from_info): move to panel_util_key_file*
	(panel_launcher_create_with_id): updated since panel_launcher_hoard()
	is killed
	(launcher_save): kill
	(find_launcher): updated
	* panel-util.[ch]: (panel_ditem_launch): make this private
	(panel_util_launch_from_key_file): new, to use gnome-desktop to launch
	a .desktop file in a GKeyFile
	(panel_launch_desktop_file): updated for panel_ditem_launch() change
	(panel_dialog): kill (well, integrated in panel_error_dialog())
	(panel_error_dialog): use GtkMessageDialog API to set the secondary
	text, make it possible to provide a parent window
	(panel_show_help): updated for panel_error_dialog() change
	(panel_lock_screen_action): ditto
	(panel_util_key_file_to_file): handle both URI and paths
	(panel_util_key_file_load_from_uri): new
	(panel_util_key_file_get_boolean): new
	(panel_util_key_file_set_locale_string): new
	(panel_util_key_file_remove_locale_key): new
	(and some other panel_util_key_file* macros): new

	* applet.c: updated for launcher_properties() change
	(panel_applet_register): update string
	* panel-applet-frame.c: (panel_applet_frame_activated): ditto
	* button-widget.c: (button_widget_reload_pixbuf): updated for
	panel_error_dialog() change
	* panel-action-button.c: (panel_action_search): ditto
	(panel_action_connect_server): ditto
	* panel-context-menu.c: (panel_context_menu_remove_panel): ditto
	(panel_context_menu_setup_remove_panel_it...): update string
	* panel-marshal.list: updated, and removed useless stuff
	* panel-menu-bar.c: (panel_menu_bar_invoke_menu): updated for
	panel_error_dialog() change
	* panel-menu-button.c: (panel_menu_button_invoke_menu): ditto
	* panel-menu-items.c: (activate_uri): ditto
	(panel_menu_item_activate_desktop_file): dittp
	(panel_menu_items_append_from_desktop): use panel_key_file* functions
	* panel-properties-dialog.c: (panel_properties_dialog_present):
	updated for panel_error_dialog() change
	* panel-recent.c: (recent_documents_activate_cb): ditto
	* panel-run-dialog.c: (panel_run_dialog_launch_command): ditto
	(panel_run_dialog_show_url): ditto
	(panel_run_dialog_execute): ditto
	(program_list_selection_changed): use panel_key_file* functions
	(panel_run_dialog_create_desktop_file): ditto
	(panel_run_dialog_present): updated for panel_error_dialog() change
	* panel-shell.c: (panel_shell_register): ditto
	* panel-widget.c: (panel_widget_class_init): use glib marshal
	functions

2006-08-05  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: (panel-run-dialog.c):
	(program_list_selection_changed): fix leaks introduced in the last
	commit, don't get useless name

2006-08-05  Vincent Untz  <vuntz@gnome.org>

	Remove usage of GnomeDesktopItem in some places

	* menu.c: remove useless include

	* panel-action-button.c: (panel_action_search): simply call
	panel_launch_desktop_file() instead of duplicating code

	* panel-menu-items.c: (panel_menu_item_activate_desktop_file): call
	panel_launch_desktop_file()

	* panel-run-dialog.c: keep the path to the currently selected desktop
	file in memory
	(panel_run_dialog_destroy): nullify more stuff
	(panel_run_dialog_find_command_idle): remove FIXME that was wrong
	(program_list_selection_changed): yay, GKeyFile love!, also show all
	programs in the program list and remember the path to the desktop file
	(entry_event): unselect the currently selected program in the list
	since the user has typed something
	(entry_changed): updated
	(panel_run_dialog_create_desktop_file): new, with GKeyFile love and
	mostly copied from the old pixmap_drag_data_get()
	(pixmap_drag_data_get): use the uri of the desktop file of the
	currently selected program if available

	* panel-util.[ch]: (panel_launch_desktop_file): load from file (and
	not from basename) if the path is absolute, test if fallback_exec is
	NULL before using it
	(panel_util_key_file_new_desktop): new, to create desktop files from
	GKeyFile
	(panel_util_key_file_to_file): new

2006-07-28  Vincent Untz  <vuntz@gnome.org>

	Port from egg-recent to GtkRecent.

	* Makefile.am: remove egg stuff
	* egg-recent*: kill
	* panel-menu-items.c: keep a GtkRecentManager instead of
	EggRecentViewGtk
	(panel_place_menu_item_create_menu): updated
	(panel_place_menu_item_recreate_menu): updated
	(panel_place_menu_item_finalize): updated
	(panel_place_menu_item_instance_init): get the default recent manager
	* panel-recent.[ch]: (recent_documents_activate_cb): updated for
	GtkRecent
	(panel_recent_model_changed_cb): renamed to...
	(panel_recent_manager_changed_cb): and updated
	(clear_dialog_response): updated
	(recent_documents_clear_cb): updated
	(recent_documents_tooltip_func): kill, GTK+ does this for us
	(panel_recent_append_documents_menu): updated with GtkRecent

2006-07-28  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: (panel_applet_frame_cnx_broken): check whether
	our X connection is still alive before displaying the dialog. (See bug
	#34803 for rationale)
	* xstuff.[ch]: (xstuff_xio_error_handler): new
	(xstuff_is_display_dead): new
	(xstuff_init): new, installs the xio error handler
	* main.c: (main): call xstuff_init()
	Based on patch by Ray Strode <rstrode@redhat.com> and
	Frédéric Crozat <fcrozat@mandriva.com>
	Fix bug #348803

==================== 2.15.90 ====================

2006-07-24  Vincent Untz  <vuntz@gnome.org>

	* Makefile.am: don't use eggaccelerators anymore
	* eggaccelerators.[ch]: kill
	* panel-bindings.c: (panel_binding_set_from_string): directly use
	gtk_accelerator_parse() now

2006-07-24  Vincent Untz  <vuntz@gnome.org>

	Use gnome-power-manager to implement suspend/hibernate.
	Based on patch by Ray Strode <rstrode@redhat.com>
	Fix bug #347970

	* panel-power-manager.[ch]: new files
	* Makefile.am: add new files
	* panel-logout.c: (panel_logout_init) connect to the power manager
	(panel_logout_destroy): unref the power manager
	(panel_logout_response): keep a ref to the power manager since we need
	it for this function, don't use GDM to hibernate since it has the nasty
	side-effect of loggint out the user..., implement suspend
	(panel_logout_new): add buttons to suspend and hibernate

	* panel-enums.h: reindent one line
	* panel-menu-items.h: ditto

2006-07-24  Vincent Untz  <vuntz@gnome.org>

	Use alacarte when available to edit menus.
	Based on patch by Frederic Crozat <fcrozat@mandriva.com>.

	* panel-menu-bar.c: (panel_menu_bar_load): look for alacarte before
	including the Edit menu item
	(panel_menu_bar_invoke_menu): try launching alacarte before
	gmenu-simple-editor
	* panel-menu-button.c: (panel_menu_button_load): look for alacarte
	before including the Edit menu item
	(panel_menu_button_invoke_menu): try launching alacarte before
	gmenu-simple-editor

2006-07-23  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	use gnome_vfs_unescape_string_for_display() instead of
	g_filename_display_basename() to make prettier strings.
	Fix bug #346950

2006-07-23  Vincent Untz  <vuntz@gnome.org>

	Send a changed signal from the background monitor when the screen size
	changes

	* panel-background-monitor.c: (panel_background_monitor_changed): new
	(panel_background_monitor_finalize): disconnect from the size-changed
	signal
	(panel_background_monitor_connect_to_screen): connect to the
	size-changed screen signal
	(panel_background_monitor_xevent_filter): call
	panel_background_monitor_changed() instead of having the code here
	Patch by Benjamin Otte <in7y118@public.uni-hamburg.de>

2006-07-23  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_util_cairo_rgbdata_to_pixbuf): fix endianness
	issue causing corrupted background. Based on patch by Andrew Johnson
	<acjgenius@earthlink.net>. Fix bug #347510.

==================== 2.14.2 ====================

2006-05-29  Vincent Untz  <vuntz@gnome.org>

	* panel-context-menu.c: (panel_context_menu_show_about_dialog):
	destroy the about dialog on response. Fix bug #341517

2006-04-25  Christian Neumair  <chris@gnome-de.org>

	* panel-menu-items.c: (panel_place_menu_item_sort_volume),
	(panel_place_menu_item_append_volumes):
	Get rid of custom volume sorting code, use gnome_vfs_volume_compare.
	Thanks to Xavier Claessens <xclaesse@gmail.com>

==================== 2.14.1 ====================

2006-03-25  Vincent Untz  <vuntz@gnome.org>

	* launcher.c: (launch_url): make a canonical uri before showing it
	Fix bug #328317

2006-03-24  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_desktop_menu_item_append_menu): fix
	compilation
	* main.c: (main): plug GnomeProgram leak
	* gnome-desktop-item-edit.c: (main): ditto
	Fix bug #335748.

2006-03-24  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	special case local files that are not in a file: URI.
	Should fix bug #335456.
	(panel_desktop_menu_item_append_menu): don't leak the list of children
	* main.c: (main): don't free the GOption context: libgnome will do it
	* gnome-desktop-item-edit.c: (main): ditto, s/fprintf/g_printerr/

==================== 2.14.0 ====================

2006-03-07  Vincent Untz  <vuntz@gnome.org>

	Fix underscores not being visible in menu items. Fix bug #332526
	
	* menu.c: (menu_escape_underscores_and_prepend): new function to
	prepend an underscore and escape all underscores in a label
	(setup_menuitem): use menu_escape_underscores_and_prepend

2006-03-06  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-bar.c: (panel_menu_bar_invoke_menu): fix help id
	Fix bug #332422

2006-03-06  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: (panel_applet_frame_paint): fix orientation of
	handles
	* panel-toplevel.c: (panel_toplevel_expose): ditto
	Thanks to Benjamin Berg. Fix bug #329228

2006-03-06  Vincent Untz  <vuntz@gnome.org>

	* main.c: (main): ignore unknown options passed to the panel
	Patch by Ray Strode <rstrode@redhat.com>
	Fix bugs #332486, #331769, #332743
	
2006-02-27  Vincent Untz  <vuntz@gnome.org>
	
	* panel-logout.c: (panel_logout_new): remove the Suspend button for
	2.14. It's not working as expected (it logs the user out) and we
	didn't have it in gnome-session anyway. We'll put it back thanks to
	g-p-m in 2.15.
	Fix bug #329630

==================== 2.13.91 ====================

2006-02-12  Vincent Untz  <vuntz@gnome.org>

	* Makefile.am: put the x libs after the GNOME libs for the links. It
	seems it helps in some cases. Fix bug #328852

2006-02-12  Vincent Untz  <vuntz@gnome.org>

	Use GOption instead of popt
	
	* Makefile.am: don't link with popt
	* gnome-desktop-item-edit.c: (main): use GOption
	* main.c: (main): ditto

2006-02-12  Vincent Untz  <vuntz@gnome.org>

	* menu.c: (create_item_context_menu): add accelerator for items
	
	Fix invisible mnemonics in menu. Based on patch by Matthias Clasen
	<mclasen@redhat.com>. Fix bug #300730

	* menu.[ch]: (setup_mnemonic): kill
	(setup_invisible_mnemonic): kill
	(setup_menuitem): use an GtkAccelLabel for items with invisible
	mnemonics
	(setup_menu_item_with_icon): update the parameter name so that it's
	clear that it creates a mnemonic if used

2006-02-12  Vincent Untz  <vuntz@gnome.org>

	* panel-action-button.c: add "..." at the end of the Shut Down and Log
	Out items
	* panel-menu-items.c: (panel_menu_items_append_lock_logout): ditto
	Fix bug #330548

2006-02-12  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: (entry_changed): don't change a non-existing
	label when the program list is disabled. Fix a critical warning.
	Fix bug #329924

2006-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel-logout.c: (panel_logout_timeout): don't change countdown every
	second, but every 10 seconds when there's more than 30 seconds to wait

2006-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel-action-button.c: (panel_action_shutdown_is_disabled): new,
	check if GDM supports the shutdown action
	use this for the shutdown action button

2006-02-11  Vincent Untz  <vuntz@gnome.org>

	* panel-gdm.c: use SET_SAFE_LOGOUT_ACTION instead of SET_LOGOUT_ACTION
	for now

2006-02-11  Vincent Untz  <vuntz@gnome.org>

	* launcher.c: add a FIXME

	* panel-action-button.c: remove the shut down reference in tooltip
	* panel-menu-items.c: ditto
	Fix bugs #329610 and #330499

	* panel-logout.c: (panel_logout_new): s/Reboot/Restart/
	Fix bug #327580

==================== 2.13.90 ====================

2006-01-27  Vincent Untz  <vuntz@gnome.org>

	* Makefile.am: fix distcheck

2006-01-26  Kjartan Maraas  <kmaraas@gnome.org>

	* panel.c: (drop_internal_applet): Fix a compiler warning.

2006-01-23  Vincent Untz  <vuntz@gnome.org>

	* panel-profile.c: (panel_profile_load_added_ids): don't load the
	object if the id is null, so we're more solid against gconf breakage
	(panel_profile_load_list): same here

	* panel-separator.c: (panel_separator_set_orientation): fix C99-ism
	Patch by Jens Granseuer <jensgr@gmx.net>

2006-01-22  Vincent Untz  <vuntz@gnome.org>

	* Makefile.am: don't remove panel-default-setup.entries in "make
	clean"

2006-01-22  Vincent Untz  <vuntz@gnome.org>

	* GNOME_Panel_Popup.xml: give a verb to the separator so we can
	identify it
	* panel-applet-frame.c: (panel_applet_frame_sync_menu_state): hide
	separator if the panel is locked down
	I don't really understand why it hides both separators (since the code
	should only requests that one of them is hidden), but since it's what
	we want, let's just be happy.
	Fix bug #324444

2006-01-22  Vincent Untz  <vuntz@gnome.org>

	* GNOME_Panel_Popup.xml: change accelerator for Lock To Panel
	* applet.c: (panel_applet_create_menu): ditto
	Fix bug #320839

	* panel-action-button.c: add a comment about strings
	* panel-menu-items[.ch]: (panel_menu_items_create_action_item_full):
	new based on panel_menu_items_create_action_item() but can force a
	label/tooltip
	(panel_menu_items_create_action_item): updated to use
	panel_menu_items_create_action_item_full()
	(panel_menu_items_append_lock_logout): put the username in the
	label/tooltip for Log out
	Fix bug #130663
	
	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	remove warning
	(panel_place_menu_item_sort_volume): remove warning
	(panel_place_menu_item_append_volumes): use an icon for the network
	places submenu

	* panel-addto.c: make the launcher description a bit better
	Fix bug #171829

	* panel-menu-bar.c: (panel_menu_bar_enter_places): simplify the
	tooltip
	Fix bug #326185

	* panel-properties-dialog.c: add context to the orientation strings
	(panel_properties_dialog_setup_orientation): use Q_()
	Fix bug #315305

2006-01-22  Vincent Untz  <vuntz@gnome.org>

	* panel-action-button.c: add back the screenshot action in an array
	(panel_action_get_is_deprecated): new
	(panel_action_get_is_disabled): check if the action is deprecated
	(panel_action_button_set_type): ditto
	(panel_action_button_load_from_gconf): beautify code
	(panel_action_button_load_from_drag): check if the action is deprecated
	Fix bug #328157

2006-01-22  Vincent Untz  <vuntz@gnome.org>

	Remove the screenshot action button and migrates the existing config
	to use gnome-screenshot.desktop

	* panel-action-button.c: remove screenshot stuff
	(panel_action_screenshot): kill
	(panel_action_button_load_from_gconf): if the type of the action is
	screenshot, migrate this object
	* panel-compatibility.[ch]:
	(panel_compatiblity_migrate_screenshot_action): new, migrates the
	screenshot action object to a simple launcher
	* panel-enums.h: mark PANEL_ACTION_SCREENSHOT as deprecated
	* panel-menu-items.c: (panel_desktop_menu_item_append_menu): remove
	useless variable

2006-01-22  Vincent Untz  <vuntz@gnome.org>

	* .cvsignore: remove panel-default-setup.entries from here
	* panel-default-setup.entries.in: kill
	* panel-default-setup.entries: add back, without DATADIR
	* Makefile.am: remove all the stuff related to the generation of
	panel-default-setup.entries
	* launcher.c: (create_launcher): look in the XDG data dirs if the
	.desktop file exists, so we can use epiphany.desktop without telling
	the panel the whole path.

2006-01-22  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_desktop_menu_item_append_menu): don't add
	the gnome-screenshot item. It's now in Applications->Accessories.
	Fix bug #311036.

2006-01-21  Vincent Untz  <vuntz@gnome.org>

	* panel-logout.c: (panel_logout_response): handle cases where the
	dialog is deleted or programmatically destroyed
	Fix bug #327993

2006-01-21  Vincent Untz  <vuntz@gnome.org>

	* egg-recent-view-gtk.c: update from libegg

2006-01-20  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: (panel_applet_frame_load_from_gconf): don't
	load the applet if the bonobo_iid is not set, eg.
	Could fix bug #326942

2006-01-20  Vincent Untz  <vuntz@gnome.org>

	* panel-addto.c: (panel_addto_present_applications): change the search
	entry text after switching models so that it gets refiltered
	(panel_addto_filter_func): if the iter is a root in a tree model, just
	show it
	Fix bug #327612 and bug #327613.

2006-01-20  Elijah Newren  <newren gmail com>

	Revert part of patch from 2006-01-17.  Fixes #327878.

	* panel-run-dialog.c: (panel_run_dialog_new): we do too need the
	activate time here
	(panel_run_dialog_present): update for panel_run_dialog_new()
	change

2006-01-17  Dennis Cranston  <dennis_cranston@yahoo.com>

	* panel-logout.c: (panel_logout_new):  Simplify the logout &
	shut down dialog questions. Fix bug #327429.

2006-01-17  Vincent Untz  <vuntz@gnome.org>

	Fix crash with logout dialogs when esd and sound events are enabled.
	Fix bug #327320.

	* panel-logout.c: (panel_logout_set_property): new
	(panel_logout_get_property): new
	(panel_logout_class_init): override the "message-type" property of
	GtkMessageDialog, so that our code is called when libgnomeui reads
	the property (and not gtk+ code).

2006-01-17  Vincent Untz  <vuntz@gnome.org>

	* panel-action-button.c: (panel_action_logout): update to pass the
	screen and the activate time to panel_logout_new()
	(panel_action_shutdown): ditto
	(panel_action_run_program): indentation love
	* panel-logout.[ch]: (panel_logout_new): put the window on the correct
	screen, present it with the correct time if it already exists
	* panel-run-dialog.c: (panel_run_dialog_new): we don't need the
	activate time here
	(panel_run_dialog_present): use gtk_window_present_with_time(), update
	for panel_run_dialog_new() change

2006-01-17  Vincent Untz  <vuntz@gnome.org>

	* panel-logout.c: (panel_logout_init): put the window above other
	windows and on all workspaces by default

2006-01-17  Vincent Untz  <vuntz@gnome.org>

	* panel-logout.c: (panel_logout_init): init timeout to 0
	(panel_logout_destroy): forget the current dialog
	(panel_logout_set_timeout): new, set the timeout
	(panel_logout_new): if there's already a logout dialog of the same
	type, use it; if it's of another type, destroy it.
	use panel_logout_set_timeout()

2006-01-17  Vincent Untz  <vuntz@gnome.org>

	* panel-logout.c: (panel_logout_timeout): fix timeout label so that
	it really show the number of seconds. Fix bug #327321.

==================== 2.13.5 ====================

2006-01-16  Vincent Untz  <vuntz@gnome.org>

	* panel-logout.c: (panel_logout_new): fix strings

2006-01-16  Vincent Untz  <vuntz@gnome.org>

	* panel-action-button.c: s/Shut down/Shut Down/

2006-01-16  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	fix display for bookmarks on NFS shares. Fix bug #325757

2006-01-16  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	fix display for remote bookmarks. Patch by Bastien Nocera
	<hadess@hadess.net>
	Fix bug #327067.

	* panel-profile.c: fix typo in name of
	panel_profile_remove_commit_timeout

2006-01-16  Vincent Untz  <vuntz@gnome.org>

	Add new logout/shutdown dialogs.

	* Makefile.am: add panel-logout.[ch] and panel-gdm.[ch]
	* panel-logout.[ch]: new, implements a logout dialog
	* panel-gdm.[ch]: new, for communications with gdm
	* panel-action-button.c: add a new shutdown button
	(panel_action_logout): remove the recursion guard from here and use
	the new logout dialog
	(panel_action_shutdown): new
	* panel-enums.h: add the new shutdown action button
	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	fix comment
	(panel_menu_items_append_lock_logout): append the shutdown item
	* panel-session.c: (panel_session_request_logout): add recursion guard
	here, don't tell gnome-session to show its logout dialog

2006-01-14  Vincent Untz  <vuntz@gnome.org>

	Forgot this changelog entry:
	* menu.c: (handle_gmenu_tree_changed): re-load the menu in the idle
	loop.

2006-01-14  Vincent Untz  <vuntz@gnome.org>

	* panel-addto.c: use the separator icon
	* panel-separator.h: define the separator icon
	
2006-01-14  Vincent Untz  <vuntz@gnome.org>
	
	Add a search entry to the "add to panel" dialog.

	* panel-addto.c: (panel_addto_drag_begin_cb): use the child model of
	the filter model
	(panel_addto_make_applet_model): create a filter model, don't return a
	model since this is useless
	(panel_addto_make_application_model): ditto
	(panel_addto_add_item): don't return a useless value
	(panel_addto_dialog_response): use the child model of the filter model
	(panel_addto_present_applications): small update for the filter, focus
	the search entry, save the text from the search entry
	(panel_addto_present_applets): small update for the filter, focus the
	search entry, put the previous search text when there was one
	(panel_addto_dialog_free): free the new stuff
	(panel_addto_name_change): change the string
	(panel_addto_filter_func): new function to know if an item is visible
	(panel_addto_search_entry_changed): new, refilter the model and select
	the first item
	(panel_addto_search_entry_activated): new, do as if the user clicked
	on Add
	(panel_addto_selection_changed): use the child model of the filter
	(panel_addto_dialog_new): add a search entry and connect the signals

	* panel-run-dialog.c: (panel_run_dialog_add_items_idle): add a FIXME
	(program_list_selection_changed): use the child model of the filter

2006-01-13  Vincent Untz  <vuntz@gnome.org>

	Add separator internal applet. Based on patch by Carlos Garcia Campos
	<carlosg@gnome.org>. Fix bug #300593

	* Makefile.am: add new files
	* applet.c: (panel_applet_set_dnd_enabled): handle the separator case
	(applet_callback_callback): ditto
	(panel_applet_load_idle_handler): ditto
	* panel-addto.c: add separator item
	(panel_addto_add_item): handle separator case
	* panel-enums.h: add separator to the list of internal objects
	* panel-profile.c: add separator to the object map list
	* panel-separator.[ch]: new
	* panel.c: (orientation_change): handle separator case,
	(back_change): ditto
	(drop_internal_applet): ditto

2006-01-11  Sebastien Bacher  <seb128@debian.org>

	* panel-menu-items.c: (panel_place_menu_item_create_menu):
	CD recording item for the Places menu (Fixes #308419)

2006-01-11  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: (entry_changed): remove the idle source looking
	for an icon if there's no text in the entry.
	Fix crasher in bug #326360 (caused by a critical warning)

2006-01-11  Vincent Untz  <vuntz@gnome.org>

	* Makefile.am: remove panel-gdk-pixbuf-extensions.[ch]
	* panel-gdk-pixbuf-extensions.[ch]: kill
	* panel-background-monitor.c:
	(panel_background_monitor_tile_background): use cairo and
	panel_util_cairo_rgbdata_to_pixbuf() to tile the image
	* panel-background.c: (composite_image_onto_desktop): use cairo
	(load_background_file): add a FIXME, update alpha so we know if the
	image has alpha
	* panel-util.[ch]: (panel_util_cairo_rgbdata_to_pixbuf): new, to
	convert data created by cairo to a GdkPixbuf
	Fix bug #160926.

2006-01-09  Vincent Untz  <vuntz@gnome.org>

	* panel-background.c: (panel_background_prepare): notify for change
	here instead of... (since we want to notify for change when the size
	of panel changes, eg)
	(panel_background_composite): here
	(panel_background_set_image_background_on_widget): rewrite with cairo
	goodness so that we correctly handle tiles
	Fix part of bug #164349.
	* panel-menu-bar.c: (panel_menu_bar_setup_tooltip): add a FIXME

2006-01-06  William Jon McCann  <mccann@jhu.edu>

	* panel-util.c (panel_lock_screen_action_get_command): 
	* panel-action-button.c (panel_action_lock_setup_menu):
	Remove the screensaver exit and restart commands.  I think
	that was for restarting xscreensaver to activate new prefs.
	Fixes bug #326059

==================== 2.13.4 ====================

2006-01-01  Vincent Untz  <vuntz@gnome.org>

	* panel-addto.c: (panel_addto_dialog_new): register the open dialog so
	that it gets destroyed when the PanelWidget is destroyed. Fix a crash
	when killing the panel with the Add to dialog open.
	* panel-properties-dialog.c: (panel_properties_dialog_new): ditto, but
	there was no crash
	* panel.c: (panel_delete): don't push twice the autohide disabler

2006-01-01  Vincent Untz  <vuntz@gnome.org>

	Fix crash when a toplevel is destroyed before the location changes
	are committed.

	* panel-profile.c: (panel_porfile_remove_commit_timeout): new
	(panel_profile_set_commit_timeout): add a destroy notify

2006-01-01  Vincent Untz  <vuntz@gnome.org>

	Hide panel menu tooltips when a menu is activated. Fixes bug #325094
	Based on path by Christian Kirbach
	<Christian.Kirbach@student.uni-siegen.de>

	* panel-menu-bar.c: (panel_menu_bar_reinit_tooltip): new, reset the
	tooltip
	(panel_menu_bar_hide_tooltips): new, remove tooltip on the menu bar
	(panel_menu_bar_setup_tooltip): new, with code from
	panel_menu_bar_instance_init() and also connects to the correct
	signals so that the tooltip disappear when we open a menu
	(panel_menu_bar_instance_init): just use
	panel_menu_bar_setup_tooltip()

2005-12-31  Vincent Untz  <vuntz@gnome.org>

	* menu.c: (add_menu_to_panel): use gnome-menus functions to get the
	filename of the menu
	(create_item_context_menu): ditto, don't attach the menu filename to
	an object
	(submenu_to_display): make code more readable
	(create_menuitem): add FIXME, fix tooltip for aliased directory
	(create_applications_menu): don't attach the menu filename to an
	object

2005-12-29  Vincent Untz  <vuntz@gnome.org>

	Make applet handles handle transparency. Fix bug #306441.
	Based on patch by Ryan Lortie <desrt@desrt.ca>

	* panel-applet-frame.c: (panel_applet_frame_change_background): change
	the background of the frame if it has handles
	* panel-background.[ch]:
	(panel_background_set_no_background_on_widget): new, moved from
	panel-menu-bar.c
	(panel_background_set_image_background_on_widget): ditto
	(panel_background_set_color_background_on_widget): ditto
	(panel_background_change_background_on_widget): ditto
	* panel-menu-bar.c: (panel_menu_bar_size_allocate): only update the
	background on size changes if it's a pixmap background
	(panel_menu_bar_set_no_background): kill
	(panel_menu_bar_set_image_background): ditto
	(panel_menu_bar_set_color_background): ditto
	(panel_menu_bar_change_background): make it a wrapper for
	panel_background_change_background_on_widget()

2005-12-28  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-bar.c: (panel_menu_bar_enter_desktop): use US english in
	the string. Thanks to Adam Weinberger <adamw@gnome.org>, fix bug
	#325104

2005-12-27  Vincent Untz  <vuntz@gnome.org>

	Don't do something on double/triple clicks for buttons. Fix bugs
	#75796 and #323384.

	* button-widget.c: (button_widget_button_press): only propagate event
	if it's a GDK_BUTTON_PRESS event (to avoid double-click events)

2005-12-27  Vincent Untz  <vuntz@gnome.org>

	* egg-recent-model.c: update from libegg

2005-12-27  Vincent Untz  <vuntz@gnome.org>

	Add tooltips for the menu bar, hacky way.
	Fix bug #317781.

	* panel-menu-bar.c: (panel_menu_bar_enter_applications): new, change
	the tooltip when the cursor is on the Applications item
	(panel_menu_bar_enter_places): ditto for the Places item
	(panel_menu_bar_enter_desktop): ditto for the Desktop item
	(panel_menu_bar_instance_init): connect to the "enter-notify-event"
	event for the menu items, initialize the tooltip for the menubar

2005-12-19  Vincent Untz  <vuntz@gnome.org>

	Use a close button instead of the cancel one. Fix bug #319077. Patch
	by Claudio Saavedra <csaavedra@alumnos.utalca.cl>

	* panel-addto.c: (panel_addto_dialog_response): don't close the dialog
	when an object is added
	(panel_addto_dialog_new): replace the cancel button with a close one

	Make the "add to panel" dialog a bit nicer.

	* panel-addto.c: (panel_addto_make_text): don't make the name larger
	(panel_addto_make_pixbuf): use a smaller icon size, also, we don't
	need to resize the icon since it should already be scaled.
	(panel_addto_append_item): update for panel_addto_make_pixbuf()
	(panel_addto_populate_application_model): ditto

2005-12-18  Vincent Untz  <vuntz@gnome.org>

	Update the known applications list while typing and only show the
	items that match. Fix bug #313808.

	* panel-run-dialog.c: s/_command_icon_idle_id/_command_idle_id/g, add
	some FIXME, add a visible column to the liststore,
	(panel_run_dialog_destroy): reinitialize value of the new changed_id
	handler id
	(panel_run_dialog_make_all_list_visible): new
	(panel_run_dialog_find_command_icon_idle): if the text doesn't match
	the item, look if the text is in the command/name/comment of the item
	and set the items visibility according to this, also make sure that we
	show the beginning of the list since the displayed items change
	(panel_run_dialog_add_items_idle): use a GtkTreeModelFilter
	(entry_event): use g_completion_complete_utf8(), disable the "changed"
	handler when we complete so that it's not called twice but only once
	(entry_changed): move some code around to make it more readable,
	reset the icon and the visibility of the list items if the text is
	void
	(panel_run_dialog_setup_entry): save the handler id for the "changed"
	signal
	* panel-util.[ch]: (panel_util_utf8_strstrcase): new, stolen from
	e-d-s
	(panel_util_unicode_get_utf8): ditto

2005-12-17  Vincent Untz  <vuntz@gnome.org>

	Reword a lot of error dialogs. Based on patch by Luke Worth
	<luke_worth@hotpop.com>. Fix bug #320164.

	* button-widget.c: (button_widget_reload_pixbuf): reword error dialog
	* launcher.c: (panel_launcher_save_ditem): ditto
	(launch_url): verify that url is not a void string + ditto
	(drag_data_received_cb): reword error dialog
	(create_properties_dialog): fix indent
	(really_add_launcher): reword error dialog
	* menu-ditem.c: (ditem_properties_close): ditto
	(really_add_new_menu_item): ditto
	(panel_new_launcher): ditto
	* panel-action-button.c: (panel_action_search): ditto
	(panel_action_screenshot): ditto
	(panel_action_connect_server): ditto
	* panel-context-menu.c: (panel_context_menu_remove_panel): ditto
	* panel-menu-bar.c: (panel_menu_bar_invoke_menu): ditto
	* panel-menu-button.c: (panel_menu_button_invoke_menu): ditto
	* panel-menu-items.c: (activate_uri): ditto
	(panel_menu_item_activate_desktop_file): ditto
	* panel-properties-dialog.c: (panel_properties_dialog_present): ditto
	* panel-recent.c: (show_uri): make errors more useful
	(recent_documents_activate_cb): reword error dialog
	* panel-run-dialog.c: (panel_run_dialog_launch_command): ditto
	(panel_run_dialog_show_url): ditto
	(panel_run_dialog_execute): ditto
	(panel_run_dialog_present): ditto
	* panel-util.c: (panel_show_help): ditto
	(panel_load_icon): make error more useful
	(panel_lock_screen_action): reword error dialog

	* menu.c: (create_menuitem): add a FIXME
	* panel-context-menu.c: (panel_context_menu_setup_remove_panel_item):
	fix sensitivity of item

2005-12-15  Vincent Untz  <vuntz@gnome.org>

	Don't crash with some themes. Thanks to Benjamin Berg for helping.
	Fix bug #320602.

	* panel-background.c: (panel_background_prepare): look if the pixmap
	is GDK_PARENT_RELATIVE and do what is necessary in this case
	(panel_background_set_default_style): don't ref/unref pixmap if it's
	GDK_PARENT_RELATIVE
	(panel_background_free): ditto

2005-12-15  Vincent Untz  <vuntz@gnome.org>

	* panel-util.c: (panel_launch_desktop_file): why is the .desktop
	filename hardcoded here? Someone did some bad paste ;-)

2005-12-15  Vincent Untz  <vuntz@gnome.org>

	Add a preview widget in the image background chooser.
	Fix bug #321155.

	* panel-properties-dialog.c:
	(panel_properties_dialog_chooser_preview_update): new
	(panel_properties_dialog_setup_image_chooser): connect stuff to update
	the preview widget

2005-12-14  Claudio Saavedra  <csaavedra@alumnos.utalca.cl>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	Check if uri is NULL before calling gnome_vfs_uri_unref (uri).
	Fix critical warning, bug #324127.

2005-12-14  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_instance_init): don't
	report useless warning when file monitoring is not supported. Just
	print something so the user knows he needs another library.
	Fix bug #323837.

2005-12-14  Vincent Untz  <vuntz@gnome.org>

	Fix critical warning, bug #323495.

	* menu.c: (setup_uri_drag): don't call gtk_drag_source_set_icon_name()
	if icon is NULL
	(create_menuitem): ditto
	* panel-action-button.c: (panel_action_button_set_dnd_enabled): ditto
	* panel-menu-button.c: (panel_menu_button_set_dnd_enabled): ditto
	* panel-run-dialog.c: (panel_run_dialog_set_default_icon): new
	function, which don't call gtk_drag_source_set_icon_name() when we
	don't request it.
	(panel_run_dialog_set_icon): call panel_run_dialog_set_default_icon()
	(panel_run_dialog_new): ditto
	(program_list_selection_changed): make comment readable

	Don't crash when an applet can't be load. Fix bug #323996.
	Patch by Crispin Flowerday <crispin@gnome.org>.

	* panel-applet-frame.c: (panel_applet_frame_loading_failed): don't
	free frame, but destroy it.

==================== 2.13.3 ====================

2005-11-28  Vincent Untz  <vuntz@gnome.org>

	* egg-recent-model.c:
	* egg-recent-view-gtk.c: update from libegg

2005-11-19  Vincent Untz  <vuntz@gnome.org>

	* applet.c: don't need a bonobo include here
	* panel.c: ditto
	* main.c: remove useless includes,
	(main): call gtk_window_set_default_icon_name() before
	panel_shell_register() in order to have an icon for the error dialog
	:-)
	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks): 
	synchronize the way we display remote bookmarks with nautilus
	* panel-shell.c: (panel_shell_bonobo_activation_register_for_display):
	new, stolen from nautilus
	(panel_shell_register): stop using deprecated functions
	(panel_shell_unregister): ditto

==================== 2.13.2 ====================

2005-11-11  Vincent Untz  <vuntz@gnome.org>

	* egg-recent-*: updated from libegg

2005-11-03  Vincent Untz  <vuntz@gnome.org>

	* panel-applet-frame.c: revert the change I made on 2005-10-24.
	Fixes bug #320559

2005-10-29  Christian Neumair  <chris@gnome-de.org>

	* panel-properties-dialog.c: (panel_properties_dialog_present):
	* panel-run-dialog.c: (panel_run_dialog_present):
	Handle glade errors instead of crashing. Fixes #320160.

2005-10-28  Christian Neumair  <chris@gnome-de.org>

	* panel-menu-items.c: (activate_uri):
	Don't bail if gnome_url_show_on_screen returns
	GNOME_URL_ERROR_CANCELLED.

==================== 2.13.1 ====================

2005-10-24  Vincent Untz  <vuntz@gnome.org>

	* drawer.c: add FIXME
	* launcher.c: (drag_data_get_cb): fix warning
	(panel_launcher_set_dnd_enabled): add FIXME
	* menu.c: (icon_theme_changed): don't use GnomeIconTheme
	* panel-applet-frame.c: (panel_applet_frame_change_orientation): I'm
	not sure why the orientation were inverted, but I think it's a bug.
	So fix it. It might break things, though...
	(panel_applet_frame_get_orient_string): ditto
	* panel-properties-dialog.c: add TODO
	* panel-run-dialog.c: (entry_drag_data_received): use
	g_uri_list_extract_uris() and remove warning
	(pixmap_drag_data_get): remove warning

2005-10-22  Vincent Untz  <vuntz@gnome.org>

	* panel-toplevel.schemas.in: change default panel size to 24.
	Fix bug #167328

2005-10-22  Vincent Untz  <vuntz@gnome.org>

	* panel-run-dialog.c: (panel_run_dialog_add_items_idle): use right
	column for search
	Fix bug #317918

2005-10-22  Vincent Untz  <vuntz@gnome.org>

	* panel-background.c: (get_scaled_and_rotated_pixbuf): load image
	file here
	(panel_background_set_gdk_color_no_update): new
	(panel_background_set_gdk_color): updated
	(panel_background_set_opacity_no_update): new
	(panel_background_set_opacity): updated
	(panel_background_set_color_no_update): new
	(panel_background_set_color): updated
	(panel_background_set_image_no_update): new
	(panel_background_set_image): updated, don't load image here
	(panel_background_set_fit_no_update): new
	(panel_background_set_fit): updated
	(panel_background_set_stretch_no_update): new
	(panel_background_set_stretch): updated
	(panel_background_set_rotate_no_update): new
	(panel_background_set_rotate): updated
	(panel_background_set): don't set the background multiple times here,
	but only once

	* panel-widget.c: (panel_widget_background_changed): update the edges
	of the toplevel: they might not be needed anymore

	* panel-toplevel.c: (panel_toplevel_update_attached_position): fix
	drawers not working after previous patch

2005-10-17  Kjartan Maraas  <kmaraas@gnome.org>

	* panel-run-dialog.c: (entry_event): Plug a leak.
	* drawer.c (panel_drawer_custom_icon_changed): only set the icon if we
	use the custom icon
	* panel-shell.c: (panel_shell_init): cleanup

	* applet.c: (panel_applet_can_freely_move): remove useless code
	(panel_applet_lockable): ditto
	* button-widget.c: (button_widget_unrealize): ditto
	(button_widget_size_allocate): ditto
	* drawer.c: (close_drawer_in_idle): ditto
	(panel_drawer_tooltip_changed): ditto
	* panel-context-menu.c: (panel_context_menu_create): ditto
	* panel-menu-button.c: (panel_menu_button_drag_data_get): ditto
	* panel-profile.c: (panel_profile_background_change_notify): ditto
	(panel_profile_copy_defaults_for_screen): ditto
	* panel-toplevel.c: (panel_toplevel_rotate_to_pointer): ditto
	(panel_toplevel_update_attached_position): ditto
	(panel_toplevel_update_normal_position): ditto
	(panel_toplevel_update_animating_position): ditto
	(panel_toplevel_update_position): ditto
	(panel_toplevel_start_animation): ditto
	(panel_toplevel_set_orientation): ditto
	* panel-widget.c: (panel_widget_size_allocate): ditto
	(panel_widget_nice_move): ditto
	* panel.c: (panel_applet_added): ditto
	(panel_destroy): ditto
	(panel_delete_without_query): ditto

2005-10-08  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	don't unescape URI when it's not needed. Try to synchronize the way
	we display bookmarks with nautilus.
	Fix bug #315322.

==================== 2.12.1 ====================

2005-09-22  James Henstridge  <james@jamesh.id.au>

	* panel-action-button.c: 
	* panel-compatibility.c:
	* panel-profile.c: add a terminator to all the GConfEnumStringPair
	tables to prevent crashes on unknown enum strings.  Fixes bug
	#316933.

2005-09-20  Vincent Untz  <vuntz@gnome.org>

	* panel-force-quit.c: (find_managed_window): kill warning
	(kill_window_response): new, we kill the window here and also
	trap X errors (useful when the client has already quit ;-))
	(kill_window_question): connect to the response signal so that we
	don't block the panel
	(handle_button_press_event): don't kill the window here.
	Fix bug #313006.

2005-09-18  Vincent Untz  <vuntz@gnome.org>

	* applet.c: (panel_applet_position_menu): fix positionning algorithm
	so that we don't take the mouse position into account if it's not in
	the widget (that is the case when the menu is open with the keyboard)
	Fix bug #313813.

2005-09-18  Vincent Untz  <vuntz@gnome.org>

	Workaround persistent tooltip for dnd. Fix bug #311935.

	* menu.c: (drag_begin_menu_cb): new, created only for our workaround
	(drag_data_get_menu_cb): remove workaround from there
	(setup_uri_drag): connect to drag_begin
	(setup_internal_applet_drag): ditto
	(create_menuitem): ditto

2005-09-18  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	previous patches added back the bookmarks to directories that don't
	exist. Fix this.
	Also, make it possible to have multiple bookmarks to the same
	directory but with different names.

2005-09-18  Vincent Untz  <vuntz@gnome.org>

	* panel-recent.c: (panel_recent_append_documents_menu): let the recent
	view handle the separator, correctly initializes the sensitivity of
	the menu item
	Fix bug #314180.

2005-09-18  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_volumes): do as if
	we were loading icons for the items when there's a submenu. Thus,
	items are not smaller than the other ones anymore. Finding good icons
	would be better, though ;-)
	Fix bug #315132.

2005-09-18  Vincent Untz  <vuntz@gnome.org>

	Use icon names for drag and drop. Fix bug #167010.

	* drawer.c: (panel_drawer_set_dnd_enabled): use
	gtk_drag_source_set_icon_name()
	* menu.c: (setup_uri_drag): ditto
	(setup_internal_applet_drag): ditto
	(create_menuitem): ditto
	* panel-action-button.c: (panel_action_button_set_dnd_enabled): ditto
	* panel-menu-button.c: (panel_menu_button_set_dnd_enabled): ditto
	* panel-run-dialog.c: (panel_run_dialog_set_icon): ditto
	(panel_run_dialog_add_items_idle): fix warning

2005-09-17  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	don't check if the URI exists if it's not local
	Fix bug #309135.
	(panel_place_menu_item_sort_volume): new
	(panel_place_menu_item_append_volumes): sort network volumes

2005-09-16  Vincent Untz  <vuntz@gnome.org>

	* panel-properties-dialog.c: (panel_properties_dialog_toplevel_notify):
	(panel_properties_dialog_background_notif): check the value we got
	from panel_gconf_basename()
	* panel-run-dialog.c: (fuzzy_command_match):
	(panel_run_dialog_add_items_idle): add sanity checks before strcmp()

2005-09-16  Vincent Untz  <vuntz@gnome.org>

	* panel-background-monitor.c: (panel_background_monitor_finalize):
	chain to parent class finalize
	(panel_background_monitor_class_init): get parent class
	Fix bug #307553.

2005-09-15  Vincent Untz  <vuntz@gnome.org>

	* panel-menu-items.c: (panel_menu_items_append_from_desktop): add an
	argument to force a name for the item
	(panel_place_menu_item_create_menu): if set, use the name the user has
	set for the home folder and computer
	(panel_place_menu_item_is_home_dir_changed): renamed to
	panel_place_menu_item_key_changed()
	(panel_desktop_menu_item_append_menu): updated
	(panel_place_menu_item_finalize): we now also watch NAMES_DIR
	(panel_place_menu_item_instance_init): ditto, plus we recreate the
	menu if the name of home or computer has changed
	Fix bug #309853

==================== 2.12.0 ====================

2005-08-24  Vincent Untz  <vuntz@gnome.org>

	* panel-default-setup.entries.in: evolution-mail.desktop does not
	exist. Use evolution.desktop instead.

==================== 2.11.92 ====================

2005-08-21  Vincent Untz  <vuntz@gnome.org>

	* panel-default-setup.entries.in: add notification area to the default
	setup

2005-08-18  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c: (panel_applet_frame_sync_menu_state):
	* applet.c: (panel_applet_create_menu):
	If an applet's "locked" key is set to true and its not
	writable, don't allow the applet to be removed.

2005-08-16  Mark McLoughlin  <mark@skynet.ie>

	Pull in fix for recent file list not getting updated
	when using inotify (bug #313520)

	* egg-recent-model.c, egg-recent-item.c: sync with
	libegg.

==================== 2.11.91 ====================

2005-08-09  Mark McLoughlin  <mark@skynet.ie>

	Fix valgrind warning in bug #149151

	* panel-widget.c: (panel_widget_destroy): remove the
	weak pointer to the drawer button from the PanelWidget when
	a drawer is destroyed.

2005-08-04  Mark McLoughlin  <mark@skynet.ie>

	Remove the idle handler for menus if the menu is
	destroyed. Fixes crash in bug #312512

	* menu.c:
	(submenu_to_display_in_idle): unset the idle-id.
	(remove_submenu_to_display_idle): remove the idle
	handler if the menu is destroyed.
	(create_fake_menu), (create_applications_menu):
	attach the idle-id to the menu so we can remove
	it when the menu is destroyed.
	
2005-08-02  Mark McLoughlin  <mark@skynet.ie>

	Based on patch from Dennis Cranston <dennis_cranston@yahoo.com>
	in bug #12118

	* panel-util.[ch]: (panel_launch_desktop_file):
	add function for launching a program using its
	.desktop file basename.

	* panel-menu-bar.c: (panel_menu_bar_invoke_menu),
	   panel-menu-button.c: (panel_menu_button_invoke_menu): use
	panel_launch_desktop_file() to launch gmenu-simple-editor
	so that we're using startup notification.

==================== 2.11.90 ====================

2005-07-26  Mark McLoughlin  <mark@skynet.ie>

	Rotate the menu bar on vertical panels using new
	gtk+ coolness. Fixes bug #141702

	* panel-menu-bar.c:
	(set_item_text_angle_and_alignment),
	(panel_menu_bar_update_orientation): when the
	menu bar is vertical, set its pack direction,
	child pack direction, text angle and alignment
	in order to rotate the thing.

2005-07-26  Mark McLoughlin  <mark@skynet.ie>
	
	* panel-menu-bar.[ch]:
	(panel_menu_bar_get_property),
	(panel_menu_bar_set_property),
	(panel_menu_bar_class_init),
	(panel_menu_bar_set_orientation),
	(panel_menu_bar_get_orientation): add infrastructure
	for an orientation property.

2005-07-26  Mark McLoughlin  <mark@skynet.ie>
	
	* panel-menu-bar.c:
	(panel_menu_bar_set_no_background),
	(panel_menu_bar_set_image_background),
	(panel_menu_bar_set_color_background),
	(panel_menu_bar_change_background): split this code
	out into 3 functions to make it somewhat readable.
	
	* panel.c: (orientation_change): update the 
	orientation of menu bars.
	
2005-07-26  Mark McLoughlin  <mark@skynet.ie>

	Patch from Jaap A. Haitsma <jaap@haitsma.org>
	in bug #309900

	* gnome-desktop-item-edit.c: (main): set the
	default window icon.

2005-07-22  Mark McLoughlin  <mark@skynet.ie>

	Fixes last of the "panel writes to various GConf keys at login"
	problems.

	* panel-profile.c: (panel_profile_queue_toplevel_location_change):
	Only save the panel's co-ordinates in GConf if its an expanded
	panel.

2005-07-22  Mark McLoughlin  <mark@skynet.ie>

	Fix for bug #311197

	* panel-addto.c: (panel_addto_query_applets): don't show
	applets which are included in the
	/apps/panel/global/disabled_applets list.

2005-07-21  Mark McLoughlin  <mark@skynet.ie>

	Fix crasher from the fix for bug #163197
	
	* launcher.c:
	(really_add_launcher): use g_signal_connect_object()
	rather than g_signal_connect_swapped() in order to
	make sure the warning dialog gets destroyed with its
	parent - using the later caused a crash if the error
	dialog had already been destroyed.
	
2005-07-21  Mark McLoughlin  <mark@skynet.ie>

	Re-work the way launcher hoarding works such that
	we don't hoard system launchers until the user
	edits them.

	* launcher.c:
	(panel_launcher_save_ditem): don't report errors if we
	fail during hoarding; set the full path to the hoarded
	.desktop file if it we pass a relative path.
	(panel_launcher_delete): only delete the .desktop file
	if its a hoarded launcher.
	(panel_launcher_hoard): re-name from ensure_hoarded()
	and re-write.
	(properties_apply): hoard the launcher (if neccessary)
	before saving.
	(window_response): ditto before reverting.
	(launcher_load_from_gconf): don't hoard launchers here,
	but do de-sentize the Properties menu item if we won't
	be able hoard in the future.
	(panel_launcher_create_with_id): hoard the .desktop file
	before creating adding a new launcher to the config.

2005-07-21  Mark McLoughlin  <mark@skynet.ie>

	* panel-compatibility.c:
	(panel_compatibility_maybe_copy_old_config): Don't
	set the "profiles_migrated" flag unless we actually
	had to migrate old config.

2005-07-21  Mark McLoughlin  <mark@skynet.ie>

	Fixes bug #302223 - rectangular buttons get
	scaled incorrectly.

	* panel-util.[ch]: (panel_load_icon): add desired_width
	and desired_height arguments to specify the dimensions
	the icon can be scaled to. Passing -1 for either is
	interpreted as "not constrained", so e.g. you'd pass
	-1 for width on a horizontal panel.
	
	* button-widget.c: (button_widget_reload_pixbuf):
	* panel-addto.c: (panel_addto_make_pixbuf):
	* panel-run-dialog.c: (panel_run_dialog_set_icon):
	Update callers for API change above.

2005-07-20  Mark McLoughlin  <mark@skynet.ie>

	* egg-recent-model.c,
	  egg-recent-view-gtk.c: sync with libegg. Contains fixes
	for bugs #165231, #162122, #310721, #111988

2005-07-19  Mark McLoughlin  <mark@skynet.ie>

	* GNOME_Panel.server.in: goodness, how many years
	is it since we renamed the panel binary to "gnome-panel"
	from "panel-2" ?

2005-07-15  Kjartan Maraas  <kmaraas@gnome.org>

	* panel-profile.c: (panel_profile_load_object):
	Free stuff *after* we're finished using it.
	Closes bug #309753.

==================== 2.11.5 ====================

2005-07-02  Vincent Untz  <vuntz@gnome.org>

	* egg*: updated from libegg

==================== 2.11.4 ====================

2005-06-27  Mark McLoughlin  <mark@skynet.ie>

	Fix for:
	  https://bugzilla.redhat.com/160439

	Basically, the WM was restoring the saved window
	position of the panel which we don't want it to do.

	* main.c: (main): call panel_session_init() before
	creating any toplevels.
	
	* panel-session.c: (panel_session_init): unset
	the SM_CLIENT_ID property.

2005-06-26  Sebastien Bacher  <seb128@debian.org>

	* menu-ditem.c: (really_add_new_menu_item): 
	fix the reference to the user guide (Closes: #308807).

2005-06-14  Vincent Untz  <vuntz@gnome.org>

	* panel-default-setup.entries.in: change the default launchers to
	Epiphany & Evolution Mail
	See bug #307626.

2005-06-13  Kjartan Maraas  <kmaraas@gnome.org>

        * gnome-panel/panel-profile.c:
        (panel_profile_delete_toplevel_objects):
        Plug a leak. Closes bug #307492.

2005-06-11  Vincent Untz  <vuntz@gnome.org>

	Avoid getting two error dialogs when an applet crashes.
	Patch by Ryan Lortie <desrt@desrt.ca>. Fix bug #307237

	* panel-applet-frame.c: (panel_applet_frame_activated): only listen
	for brokent connexions once we're sure the applet is loaded.

2005-06-08  Kjartan Maraas  <kmaraas@gnome.org>

	* panel-menu-button.c: (panel_menu_button_create):
	Fix a couple more leaks.

2005-06-08  Vincent Untz  <vuntz@gnome.org>

	* panel-profile.[ch]: (panel_profile_get_enable_autocompletion): rename
	from panel_profile_get_enable_autocomplete() and look for the right
	key
	* panel-run-dialog.c: (entry_event): updated
	Fix stupid bug #306448.

==================== 2.11.3 ====================

2005-06-07  Kjartan Maraas  <kmaraas@gnome.org>

        * gnome-panel/panel-run-dialog.c: (panel_run_dialog_set_icon):
        Unref the pixbuf here. Gtk+ takes it's own reference so we need
        to drop ours it seems. Remove comment that said we didn't need
        to unref also. Closes bug #306748.

2005-06-06  Vincent Untz  <vuntz@gnome.org>

	Add gnome-screensaver support. Fixes bug #302348.
	Patch by William Jon McCann <mccann@jhu.edu>.

	* panel-util.[ch]: (panel_lock_screen_action_get_command)
	(panel_lock_screen_action_available), (panel_lock_screen_action) 
	(panel_lock_screen): Consolidate all the screensaver handling into
	these functions.  Add gnome-screensaver support.  Check if command
	is in the path.

	* panel-menu-items.c: (panel_menu_items_append_lock_logout): look
	if a screensaver command is available before appending the lock
	item.

	* panel-action-button.c: (screensaver_properties_enabled)
	(screensaver_enabled), (panel_action_lock_is_disabled): Only enable
	actions if the command exists.
	(panel_action_lock_setup_menu): add icon to the properties item.
	(panel_action_lock_invoke_menu): Move functionality to utils.

2005-06-06  Vincent Untz  <vuntz@gnome.org>

	* panel-config-global.c: kill useless settings
	(panel_global_config_set_entry): don't read panel_minimized_size,
	panel_show_delay, panel_animation_speed, panel_hide_delay since
	they're not global any more
	* panel-global.schemas.in: deprecate some useless settings
	Fix bug #304031.

2005-06-06  Vincent Untz  <vuntz@gnome.org>

	Preload menu in the idle loop. Fix bug #164574.

	* menu.c: (load_submenu_to_display): new, contains code from the old
	submenu_to_display()
	(submenu_to_display): load the menu
	(create_fake_menu): load the menu in idle loop
	(create_applications_menu): ditto

2005-06-06  Vincent Untz  <vuntz@gnome.org>

	* egg-recent-item.c: synchronize with libegg

2005-06-06  Vincent Untz  <vuntz@gnome.org>

	Patch by Ryan Lortie <desrt@desrt.ca>. Fixes bug #306583.

	* panel-addto.c: (panel_addto_prepend_internal_applets): the
	structures created are not static, and we don't want to leak.
	* panel-profile.c: (panel_profile_delete_toplevel_objects): plug leak

2005-06-06  Vincent Untz  <vuntz@gnome.org>

	Patch by Kjartan Maraas <kmaraas@gnome.org>. Fixes bug #301861

	* gnome-desktop-item-edit.c: some cleanup
	* panel-multiscreen.c: (panel_multiscreen_screens): ditto
	* panel-run-dialog.c: (fill_possible_executables): ditto
	* panel-addto.c: (panel_addto_dialog_response): update link for help
	* panel-context-menu.c: (panel_context_menu_show_help): ditto

2005-05-31  William Jon McCann  <mccann@jhu.edu>

	* panel-recent.c (recent_documents_clear_cb): Don't use a title
	on alert dialogs per HIG.  Fixes #302918.

==================== 2.11.1 ====================

2005-05-18  Mark McLoughlin  <mark@skynet.ie>

	Add an "Edit Menus" menu item to the menu bar
	and menu button context menu. Based on a patch
	from Vijaykumar Patwari <vijaykumar.patwari@wipro.com>
	in bug #129073.

	* panel-menu-bar.c:
	(panel_menu_bar_load): add an "Edit Menus" context
	menu if gmenu-simple-editor is installed.
	(panel_menu_bar_invoke_menu): Run gmenu-simple-editor
	if Edit Menus is clicked.
	
	* panel-menu-button.c:
	(panel_menu_button_load),
	(panel_menu_button_invoke_menu): ditto here.

2005-05-11  Mark McLoughlin  <mark@skynet.ie>

	Fix "dialogs pop up under panel dialogs" issue by
	making each panel be in its own window group and
	the dialogs part of the default group. Bug #303570

	* panel-toplevel.c: (panel_toplevel_realize):
	Just set the group leader to be the panel itself
	rather than making a futile effort to foil gtk.
	
	* xstuff.[ch]: 
	(xstuff_set_no_group): remove.

2005-05-05  Glynn Foster  <glynn.foster@sun.com>

	* panel-widget.c: (bind_top_applet_events): Remove a comment 
	that applied to old code that should have been removed with
	the 2004-07-30  Arvind Samptur  <arvind.samptur@wipro.com>
	commit.
	
2005-05-04  Mark McLoughlin  <mark@skynet.ie>

	Fix crasher with recent items menu - bug #170660

	* egg-recent-model.c:
	(egg_recent_model_changed_timeout): set timeout id
	to zero.
	(egg_recent_model_finalize): remove the timeout if
	it is still around.

2005-05-02  Mark McLoughlin  <mark@skynet.ie>
	
	Change things around so that we don't 1) slave the lifecycle
	of the EggRecentViewGtk to the menu it manages, 2) incorrectly
	unref the menu after creating the view and 3) take a ref on
	the menu in EggRecentViewgtk.

	* panel-recent.[ch]: (panel_recent_append_documents_menu):
	Re-work so that it returns the newly created EggRecentViewGtk
	and allows it to be re-used by passing it back in as a parameter.
	
	* panel-menu-items.c:
	(panel_place_menu_item_create_menu): hold a ref on the
	EggRecentViewGtk and re-user when re-creating the menu.
	(panel_place_menu_item_finalize): unref the view.
	
	* egg-recent-view-gtk.c:
	(egg_recent_view_gtk_clear),
	(egg_recent_view_gtk_set_list): don't barf if view->menu is NULL.
	(egg_recent_view_gtk_finalize): don't unref the menu.
	(egg_recent_view_gtk_set_menu): don't take a ref on the menu.
	There's no point in us updating a menu which has been destroyed.

2005-04-27  Frederic Crozat  <fcrozat@mandriva.com>

	* panel-recent.c: (panel_recent_append_documents_menu):
	Revert reference unref removal, it is causing crash.

2005-04-27  Mark McLoughlin  <mark@skynet.ie>

	Fudge a fix for "moved the panel to the left, now I can't
	move it	back". See:
	  https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=141743

	* button-widget.c: (button_widget_size_allocate): clamp the
	icon size at 48x48.

2005-04-27  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_locked_change_notify):
	Don't crash if the key is unset.
	
	* menu.c: (menus_have_icons_changed): ditto.

2005-04-26  Frederic Crozat  <fcrozat@mandriva.com>

	* panel-recent.c: (panel_recent_append_documents_menu):
	Don't try to unref view when menu is deleted.

2005-04-11  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am, menu.[ch], panel-addto.c, panel-menu-button.c,
	  panel-run-dialog.c: update for libgnome-menu API renaming.

2005-04-07  Mark McLoughlin  <mark@skynet.ie>

	Fix some warnings.

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	Don't lose constness.
	
	* panel.c: include gnome-vfs-utils.h

2005-04-06  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_applications_menu),
	  panel-addto.c: (panel_addto_make_application_model),
	  panel-run-dialog.c: (get_all_applications): update for
	slight change to menu_tree_lookup() API.

2005-04-06  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-force-quit.c: (handle_button_press_event): If the window in
	question is created by us then don't kill it.
	Use gdk_xid_table_lookup_for_display() to determine that as suggested
	by Mark. Fixes #122023

2005-04-03  Vincent Untz  <vincent@vuntz.net>

	* panel-run-dialog.c: (panel_run_dialog_execute): fix usages of
	filenames encoded in UTF-8 and the locale used for the filesystem
	Patch from Takao Fujiwara <Takao.Fujiwara@Sun.COM> (partial fix for
	bug #170268)
	(entry_event): clean up
	(panel_run_dialog_setup_entry): connect to "key-press-event" instead
	of "event"

2005-04-01  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	use g_filename_display_basename/g_filename_display_name to display the
	names of the files
	Fix bug #171886

2005-03-31  Vincent Untz  <vincent@vuntz.net>

	* launcher.c: (setup_button): fix tooltips not appearing when it
	contains a %, without breaking tooltips with escaped uri
	* panel.c: (drop_uri): unescape the name and the comment since there's
	no reason to have them escaped in the launcher
	Fix bug #170516

2005-03-31  Vincent Untz  <vincent@vuntz.net>

	* panel-properties-dialog.glade: only accept numeric values for the
	spinner
	Fix bug #171769, based on patch by Pradeep MN <itsnexgen@gmail.com>

2005-03-30  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-button.c: (panel_menu_button_get_icon): load the menu
	directory for the menu if it's not already loaded so we can have the
	right icon.
	Fix bug #170654

2005-03-30  Vincent Untz  <vincent@vuntz.net>

	* panel-context-menu.c: (make_panel_submenu): move "Properties" above
	"Delete This Panel"
	Fix bug #167133

2005-03-29  Vincent Untz  <vincent@vuntz.net>

	* button-widget.c: (button_widget_realize): load the pixbuf here since
	it's most probably not loaded yet.
	Fix bug #171256.

2005-03-28  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_class_init): remove unused
	variable
	* panel-toplevel.h: panel_toplevel_new does not exist any more

2005-03-28  Vincent Untz  <vincent@vuntz.net>

	Patch by Fernando Villacis Postigo <fvillacis@csnat.unt.edu.ar>
	Add a setting to disable the autocompletion in the Run dialog.
	Fix bug #152025

	* panel-general.schemas.in: add new key:
	/apps/panel/general/enable_autocompletion
	* panel-profile.[ch]: (panel_profile_get_enable_autocomplete): new
	* panel-run-dialog.c: (entry_event): don't autocomplete if
	autocomplete is disabled

2005-03-27  Vincent Untz  <vincent@vuntz.net>

	Remove "Run application" from the menus.
	Fix bug #167090

	* menu.c: (main_menu_append): don't append the run application item
	* panel-menu-bar.c: (panel_menu_bar_recreate_menus): kill
	(panel_menu_bar_append_applications_menu): kill
	(panel_menu_bar_create_applications_menu): kill
	(panel_menu_bar_instance_init): just call create_applications_menu()
	to create the applications menu, we don't need lockdown notifications
	(panel_menu_bar_finalize): kill
	(panel_menu_bar_class_init): we don't have a specific finalize anymore

2005-03-27  Vincent Untz  <vincent@vuntz.net>

	Make the panel more robust when the object/applet/toplevel list
	contains incorrect data.
	Most probably fixes bug #137308.

	* panel-gconf.[ch]: (panel_gconf_value_strcmp): new, to strcmp strings
	in GConfValue
	* panel-profile.c: (panel_profile_save_id_list): make sure there is no
	duplicate element in the list when saving it
	(panel_profile_remove_from_list): remove all occurrence of the id in
	the list (and not only the first one)
	(panel_profile_load_toplevel): stop monitoring the gconf dir if
	there's an error
	(panel_profile_load_object): ditto
	(panel_profile_toplevel_id_list_notify): make sure there is no
	duplicate element in the list we get, so we don't add twice the same
	toplevel
	(panel_profile_object_id_list_notify): ditto, for the objects
	(panel_profile_load_list): ditto
	* panel-util.[ch]: (panel_g_slist_make_unique): new, to remove
	duplicate elements in a list

	* main.c: (main): updated, stop monitoring a gconf dir
	* panel-session.[ch]: (panel_session_init): we don't need the argument
	anymore

2005-03-26  Vincent Untz  <vincent@vuntz.net>

	* panel-properties-dialog.c:
	(panel_properties_dialog_setup_image_chooser),
	(panel_properties_dialog_update_background_image): do not select files
	with an empty name, but unselect all filenames instead.
	Fix panel part of bug #169979.

2005-03-23  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Frederic Crozat in bug #164310

	* menu.c, panel-addto.c, panel-run-dialog.c: adapt to
	libgnome-menu API changes.
	
	* panel-menu-bar.c: (panel_menu_bar_append_applications_menu):
	fix warning.

2005-03-07  Vincent Untz  <vincent@vuntz.net>

	* Makefile.am: small update for generation of *.entries
	* panel-run-dialog.c: (fill_files_from): fix compilation on platforms
	that don't have a d_type field in dirent structures
	Fix bug #169264

==================== 2.10.0 ====================

==================== 2.9.92 ====================

2005-03-01  Vincent Untz  <vincent@vuntz.net>

	* panel-background-monitor.c: (panel_background_monitor_init):
	initialize new fields in the structure
	(panel_background_monitor_connect_to_screen): remove the filter if we
	were already connected to a screen
	(panel_background_monitor_setup_pixmap): assert that the display is
	grabbed, get the pixmap on the right display
	(panel_background_monitor_setup_pixbuf): grab (and ungrab) the display
	so we can do an atomic get of the pixbuf, test if the returned pixbuf
	is NULL
	Should fix bug #128317, and possibly bug #146075

2005-02-26  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-items.c: (panel_place_menu_item_append_gtk_bookmarks):
	support possible new format for GTK+ bookmarks. See bug #136216 for
	more informations.

2005-02-26  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_change_background): don't leak the
	style

2005-02-26  Vincent Untz  <vincent@vuntz.net>

	Fix leak of pixbufs and models in "Add to panel" dialog.

	* panel-addto.c: (panel_addto_append_item): unref the pixbuf
	(panel_addto_populate_application_model): small cleanup
	(panel_addto_dialog_free): unref the models

2005-02-26  Vincent Untz  <vincent@vuntz.net>

	* panel-recent.c: (panel_recent_model_changed_cb): use the right list
	so we don't have a leak.
	Should help for bug #168389

2005-02-25  Vincent Untz  <vincent@vuntz.net>

	* panel-background.c: (panel_background_free): unref the monitor

2005-02-25  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-button.c: (panel_menu_button_set_menu_path): fix leak
	* panel-recent.c: (panel_recent_append_documents_menuà: fix huge leak
	caused by EggRecentViewGtk's ref on the menu...

2005-02-24  Vincent Untz  <vincent@vuntz.net>

	Patch by Vijaykumar Patwari <vijaykumar.patwari@wipro.com>

	* gnome-panel/panel-menu-button.c (panel_menu_button_recreate_menu):
	Use gtk_widget_destroy instead of gtk_menu_detach.
	Fixes bug #150638.

2005-02-20  Vincent Untz  <vincent@vuntz.net>

	* panel-background.c: (panel_background_make_string): use effective
	type of the background to build the string.
	Fix bug #167931

2005-02-19  Vincent Untz  <vincent@vuntz.net>

	Synchronize the main menu layout with the menu bar layout
	Fix bug #163501

	* Makefile.am: add panel-menu-items.[ch]
	* menu.[ch]: (activate_app_def): simple wrapper for
	panel_menu_item_activate_desktop_file()
	(setup_menu_panel): make the menu appear on the right screen when it's
	shown
	(create_empty_menu): intercept all right button clicks
	(menu_create_action_item): moved to panel-menu-items.c
	(main_menu_append): new, append items to the main menu
	(create_main_menu): simplify a lot :-)
	* panel-menu-bar.c: big cleanup
	(activate_uri): moved to panel-menu-items.c
	(activate_app_def): ditto
	(panel_menu_bar_append_from_desktop): ditto
	(panel_menu_bar_show_menu): killed since it's done in menu.c
	(panel_menu_bar_connect_menu_signals): killed, now useless
	(panel_menu_bar_append_place_item): moved to panel-menu-items.c
	(panel_menu_bar_recreate_places_menu): ditto
	(panel_menu_bar_append_applications_menu): updated
	(panel_menu_bar_desktop_is_home_dir_changed): moved to
	panel-menu-items.c
	(panel_menu_bar_gtk_bookmarks_changed): ditto
	(panel_menu_bar_volume_changed): ditto
	(panel_menu_bar_append_gtk_bookmarks): ditto
	(panel_menu_bar_append_volumes): ditto
	(panel_menu_bar_create_places_menu): ditto
	(panel_menu_bar_append_desktop_menu): ditto
	(panel_menu_bar_create_desktop_menu): ditto
	(panel_menu_bar_instance_init): remove all the places/desktop
	initialization code and create Places/Desktop menu item objects
	(panel_menu_bar_parent_set): updated
	(panel_menu_bar_finalize): remove all the places/desktop finalization
	code
	* panel-menu-items.[ch]: new files that contain objects for Places
	and Desktop menu items

2005-02-17  Vincent Untz  <vincent@vuntz.net>

	* panel-util.[ch]: (panel_ditem_launch): the GnomeDesktopItem is now
	modified since we use gnome_desktop_item_set_launch_time(). So remove
	the const.

2005-02-17  Vincent Untz  <vincent@vuntz.net>

	* button-widget.c: (button_widget_reload_pixbuf): don't load a pixbuf
	if we don't have an icon theme yet, don't try to load the "" icon...
	(button_widget_instance_init): correctly initialize all the fields
	Fix bug #167652

	* panel-default-setup.entries.in: fix the path for default launchers
	Thanks to Sébastien Bacher for pointing this out.

2005-02-16  Vincent Untz  <vincent@vuntz.net>

	* panel-util.c: (panel_load_icon): don't set the error message if the
	variable is NULL.
	Fix crash reported as bug #167478

2005-02-09  Vincent Untz  <vincent@vuntz.net>

	* panel-context-menu.c: (panel_context_menu_show_about_dialog):
	simplify.
	Patch by Luca Ferretti <elle.uca@libero.it>
	Fix bug #166766

2005-02-09  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_append_gtk_bookmarks): list
	bookmarks in the right order, not reverse order.
	Fix bug #166870

==================== 2.9.91 ====================

2005-02-07  Vincent Untz  <vincent@vuntz.net>

	* Makefile.am: fix distcheck

2005-02-06  Vincent Untz  <vincent@vuntz.net>

	Don't snap an non-expanded toplevel to a screen edge if the toplevel
	is centered. Keep the bevels if the toplevel is centered too to avoid
	a loop (and it feels consistent because this not an expanded toplevel)
	Fix bug #164259.

	* panel-toplevel.c: (panel_toplevel_update_edges): keep bevels if the
	non-expanded toplevel is centered
	(panel_toplevel_update_normal_position): don't snap to an edge if the
	toplevel is centered
	(panel_toplevel_update_auto_hide_position): ditto
	(panel_toplevel_update_position): ditto, move stuff that shouldn't be
	here to...
	(panel_toplevel_update_geometry): ... this function

2005-02-04  Vincent Untz  <vincent@vuntz.net>

	Recreate the applications menu when the disable_command_line gconf key
	is changed so that "Run application" is shown/hidden.
	Fix bug #166302

	* panel-menu-bar.c: (panel_menu_bar_recreate_menus): new, recreate
	both applications & desktop menus
	(panel_menu_bar_recreate_desktop_menu): removed
	(panel_menu_bar_instance_init): updated
	(panel_menu_bar_finalize): updated

2005-02-04  Vincent Untz  <vincent@vuntz.net>

	Patch by Dennis Cranston <dennis_cranston@yahoo.com>
	Fix bug #166239

	* panel-menu-bar.c: (panel_menu_bar_append_gtk_bookmarks): use
	gnome_vfs_uri_to_string() instead of gnome_vfs_uri_get_path() to get
	non local paths to work

2005-02-04  Vincent Untz  <vincent@vuntz.net>

	Patch by Muktha <muktha.narayan@wipro.com>

	* panel-run-dialog.glade: add an accessible name for the list of known
	applications.

2005-02-03  Vincent Untz  <vincent@vuntz.net>

	Make "Run application" faster.
	Based on patch by Frank Worsley <fworsley@shaw.ca>
	Should fix bug #133243

	* panel-run-dialog.c: (panel_run_dialog_destroy): free new stuff
	(fill_files_from): add a prefix as parameter that tell us what we're
	looking for, and use it, use only g_file_test() if necessary,
	remove the test to see if we already have the items in our completion
	list since it should never happen now
	(fill_possible_executables): new, just find names of possible
	executables
	(fill_executables): find real executables that have a specific prefix
	(panel_run_dialog_ensure_completion): kill
	(panel_run_dialog_update_completion): massive update, create the
	completion stuff if it was not created yet, find the prefix of the
	basename to help us look for completion items, use a hash table to
	know if we already looked for a prefix in a directory
	(entry_event): do not update the completion when it's not necessary,
	remove leading spaces from the command to complete
	(entry_changed): remove leading spaces from the command

2005-02-03  Mark McLoughlin  <mark@skynet.ie>

	* egg-recent-item.[ch]: sync with libegg to get
	fix for bug #160531

2005-02-02  Carlos Garnacho Parro  <carlosg@gnome.org>

	Change the DnD icon to the dragged applet one in the "Add to panel"
	dialog.

	* panel-addto.c (panel_addto_drag_begin_cb): implemented and connected
	to the "drag-begin" signal

2005-02-02  Vincent Untz  <vincent@vuntz.net>

	* panel-applet-frame.c: (panel_applet_frame_loading_failed): fix the
	screen setting for the dialog

2005-02-01  Vincent Untz  <vincent@vuntz.net>

	* menu.c: (create_item_context_menu): don't assert that entry != NULL
	since this can happen on item other than Entry items
	(show_item_menu): return FALSE if no menu was created
	(panel_menu_key_press_handler): return the value returned by
	show_item_menu
	Fix bug #161639

2005-02-01  Vincent Untz  <vincent@vuntz.net>

	* panel-properties-dialog.c:
	(panel_properties_dialog_setup_size_spin): set minimum for the spin to
	the minimum we calculate in panel-toplevel.c
	* panel-toplevel.[ch]: (panel_toplevel_get_minimum_size): new
	Fix bug #164341

2005-02-01  Vincent Untz  <vincent@vuntz.net>

	* panel-run-dialog.c: (panel_run_dialog_set_icon): clean up, don't
	change the icon if the new one is the same as the old one

2005-02-01  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_append_from_desktop): plug leak
	found by Elijah

2005-02-01  Vincent Untz  <vincent@vuntz.net>

	* menu.c: (add_menu_to_panel): get the filename corresponding to the
	MenuTree and use it to create the menu button
	(create_item_context_menu): look for the filename corresponding to the
	MenuTree and set it on the context menu so we can find ot in
	add_menu_to_panel()
	(create_applications_menu): set filename corresponding to the MenuTree
	on the menu
	* panel-addto.c: (panel_addto_make_application_list): add a filename
	parameter so we can add it to the item info
	(panel_addto_make_application_model): updated
	(panel_menu_button_create): updated
	(panel_addto_dialog_free_item_info): updated
	(panel_addto_selection_changed): add the filename to the iid for
	PANEL_ADDTO_MENU
	* panel-menu-button.[ch]: add structures so we can make the
	correspondance between a menu scheme and a filename for the menu
	(panel_menu_path_root_to_filename): new
	(panel_menu_filename_to_scheme): new
	(panel_menu_scheme_to_path_root): new
	(panel_menu_button_instance_init): updated
	(panel_menu_button_create_menu): find the filename needed to create
	the menu instead of always using applications.menu
	(panel_menu_button_set_menu_path): don't ignore the scheme and remove
	useless test
	(panel_menu_button_create): add a filename parameter and use it to
	find the scheme, return a boolean telling if we could create the menu
	button
	* panel.c: (drop_menu): add a filename parameter and return the value
	returned by panel_menu_button_create()
	(drop_internal_applet): updated to use the filename specified in the
	iid

2005-01-31  Vincent Untz  <vincent@vuntz.net>

	Allow use of the whole screen when hiding a panel
	Fix bug #142317. Credits go to Mark.

	* panel-struts.c: (panel_struts_set_window_hint): call
	panel_struts_unset_window_hint() when necessary
	(panel_struts_unset_window_hint): new
	* panel-toplevel.c: (panel_toplevel_update_struts): if the window is
	not hidden and not in a hide animation, then set the strut, else
	unset it
	(panel_toplevel_start_animation): set the animating bit earlier so
	it can be used in panel_toplevel_update_struts()

2005-01-30  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_update_hidden_position): better
	fix for bug #156711, without breaking Fitt's law.

2005-01-30  Vincent Untz  <vincent@vuntz.net>

	* applet.c: (panel_applet_position_menu): fix positionning algorithm
	so that the all menu is always on screen (no need to scroll)
	Fix bug #144213

2005-01-29  Vincent Untz  <vincent@vuntz.net>

	Try to get rid of most of our stock icons.

	* button-widget.[ch]: (button_widget_load_and_scale_stock_icon):
	(button_widget_gtk_theme_changed):
	(button_widget_new_from_stock):
	(button_widget_set_stock_id):
	(button_widget_get_stock_id): killed these functions
	(button_widget_reload_pixbuf): remove code that blocked the "missing"
	icon from being used, remove stock icon code
	(button_widget_finalize): remove stock icon code
	(button_widget_get_property): ditto
	(button_widget_set_property): ditto
	(button_widget_instance_init): ditto
	(button_widget_class_init): ditto
	* drawer.[ch]: (create_drawer_applet): stop using stock icons
	(panel_drawer_set_dnd_enabled): add a comment for drag icon by name
	* menu.c: (setup_internal_applet_drag): stop using stock icons
	(menu_create_action_item): ditto
	* panel-action-button.[ch]: remove stock icons
	(panel_action_get_stock_icon): kill
	(panel_action_button_set_type): remove stock icon code
	(panel_action_button_style_set): ditto
	(panel_action_button_set_dnd_enabled): ditto
	* panel-addto.c: stop using stock icons
	(panel_addto_prepend_internal_applets): remove stock icon code
	(panel_addto_make_pixbuf): safety check that the pixbuf is not NULL
	(panel_addto_append_item): remove stock icon code
	* panel-applet-frame.c: (register_stock_item): move this code to
	panel-stock-icons.c
	(panel_applet_frame_loading_failed): updated
	* panel-force-quit.[ch]: (display_popup_window): stop using stock icon
	* panel-menu-bar.[ch]: (panel_menu_bar_instance_init): ditto
	* panel-menu-button.[ch]: (panel_menu_button_instance_init): remove
	stock icon code
	(panel_menu_button_get_icon): return the icon for the menu button, and
	not the icon of the menu path
	(panel_menu_button_set_icon): updated
	(panel_menu_button_set_dnd_enabled): stop using stock icons
	* panel-run-dialog.[ch]: (set_window_icon_from_stock): kill
	(panel_run_dialog_set_icon): stop using stock icons
	(panel_run_dialog_setup_pixmap): don't set the image here...
	(panel_run_dialog_new): ... but here, and we don't need to set the
	window icon
	* panel-stock-icons.[ch]: (panel_button_icon_get_size): kill
	remove PANEL_STOCK_RUN, PANEL_STOCK_GNOME_LOGO, PANEL_STOCK_MAIN_MENU,
	PANEL_STOCK_DRAWER, add PANEL_STOCK_DONT_DELETE
	(panel_init_stock_icons_and_items): do not register
	panel_button_icon_size since it's useless

2005-01-29  Vincent Untz  <vincent@vuntz.net>

	Move away from GnomeIconTheme. Still some work to do to use
	the icon theme of the right screen...

	* button-widget.[ch]: (button_widget_realize): get the icon theme of
	the screen here and connect to the changed signal
	(button_widget_reload_pixbuf): update and use panel_load_icon()
	(get_missing): update to use GtkIconTheme functions
	(load_pixbuf): kill
	(button_load_pixbuf): kill
	(button_widget_instance_init): don't connect to the changed signal
	of the icon theme here
	* launcher.c: (guess_icon_from_exec): simplified thanks to
	panel_find_icon()
	(setup_button): updated
	* main.c: (main): no more panel_icon_theme
	* panel-globals.h: ditto
	* menu.[ch]: (panel_create_menu): use gtk_icon_theme_get_default ()
	instead of panel_icon_theme (for now)
	(panel_make_menu_icon): use panel_find_icon() instead of
	gnome_desktop_item_find_icon()
	(load_icons_handler_again): updated
	(image_menu_shown): get the icon theme for the image menu item
	* panel-addto.c: (panel_addto_make_pixbuf): use panel_load_icon()
	to simplify
	* panel-properties-dialog.c: use panel_find_icon() instead of
	gnome_desktop_item_find_icon()
	* panel-run-dialog.c: (panel_run_dialog_set_icon): use
	panel_find_icon() instead of gnome_desktop_item_find_icon()
	(panel_run_dialog_add_icon_idle): updated
	* panel-util.[ch]: (panel_find_icon): new, with some code from
	gnome-desktop
	(panel_load_icon): new
	* panel.c: (drop_url): remove .png from icon name
	(drop_urilist): use gtk_icon_theme_get_default ()
	instead of panel_icon_theme (for now), remove .png from icon names
	(panel_receive_dnd_data): remove .png from icon name

2005-01-29  Vincent Untz  <vincent@vuntz.net>

	* .cvsignore: add panel-default-setup.entries

2005-01-29  Vincent Untz  <vincent@vuntz.net>

	* Makefile.am: build panel-default-setup.entries with
	${datadir}/applications/ instead of applications:///
	* panel-default-setup.entries: killed
	* panel-default-setup.entries.in: new
	* panel-object.schemas.in: replace the default menu_path with
	applications:/ (it's just because the old default was
	applications:///). applications:/ has a meaning now (it's just the
	root of applications.menu)
	Fix bug #160524

2005-01-28  Vincent Untz  <vincent@vuntz.net>

	* launcher.c: (launcher_load_from_gconf): try to migrate the launcher
	from the applications: scheme when we load it
	* panel-compatibility.[ch]:
	(panel_compatibility_migrate_applications_scheme): actual migration
	work is done here
	Fix bug #165293

2005-01-26  Vincent Untz  <vincent@vuntz.net>

	* eggaccelerators.[ch]: updated from libegg
	* panel-bindings.c: (panel_binding_set_from_string): updated because
	of API change in eggaccelerators
	* panel-widget.c: (panel_widget_applet_button_release_event): fix
	warning

2005-01-25  Vincent Untz  <vincent@vuntz.net>

	* egg-recent*: updated from libegg

==================== 2.9.90 ====================

2005-01-25  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_create_places_menu): update the
	Desktop tooltip and change string for "Desktop" so that it can be
	correctly translated
	(panel_menu_bar_instance_init): change string for "Desktop" so that it
	can be correctly translated
	Fix bug #164901

	* panel-recent.c: (recent_documents_clear_cb): Actions menu is dead.
	Now, the recent documents list is in the places menu. Update string
	accordingly.

2005-01-23  Vincent Untz  <vincent@vuntz.net>

	* menu.c: (panel_make_menu_icon): only scale the icon if the height
	*and* (and not *or*) the width don't have the expected size and keep
	the aspect ratio when we scale the icon.
	Fix bug #164874.

2005-01-23  Vincent Untz  <vincent@vuntz.net>

	* GNOME_Panel_Popup.xml: move "Lock To Panel" at the bottom
	* applet.c: (panel_applet_create_menu): ditto
	Fix bug #164903

2005-01-14  Vincent Untz  <vincent@vuntz.net>

	Add "Connect to Server" item to the Places menu.

	* panel-action-button.c: add definition for the new action
	(panel_action_connect_server): new
	* panel-enums.h: add enum for the new action
	* panel-menu-bar.c: (panel_menu_bar_create_places_menu): add the
	"Connect to Server" item if it's available

2005-01-14  Vincent Untz  <vincent@vuntz.net>

	Add a help button when creating a new .desktop file on the desktop.
	Fix bug #163895
	Original patch from Takao Fujiwara <Takao.Fujiwara@Sun.COM>

	* menu-ditem.c: (ditem_properties_clicked): update the help we show
	(really_add_new_menu_item): handle help
	(panel_new_launcher): add a help button
	
2005-01-14  Vincent Untz  <vincent@vuntz.net>
	
	* panel-recent.c: (panel_recent_append_documents_menu): connect to the
	"changed" signal only while the model is alive.
	Fix crash #150809.

2005-01-14  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_append_gtk_bookmarks): unescape
	the uri before creating the GnomeVFSURI
	Fix bug #163996

2005-01-13  Vincent Untz  <vincent@vuntz.net>

	Patch from Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-widget.c: (panel_widget_applet_motion_notify_event): If
	the pointer moves to a screen other than where the object is, don't
	continue with the action. Fixes #110890

2005-01-13  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_append_gtk_bookmarks):
	(panel_menu_bar_append_volumes): explicitly show the submenu item.
	Fix item not showing after an update.

2005-01-12  Vincent Untz  <vincent@vuntz.net>

	* launcher.c: (launcher_changed): unset StartupNotify in the .desktop
	file when editing the command of the launcher.
	Fix bug #142060.

2005-01-12  Vincent Untz  <vincent@vuntz.net>

	Try to make the menu position algorithm better.
	Fix bug #116028

	* applet.c: (panel_applet_position_menu): position the menu
	left-aligned at the left of the applet if the mouse pointer can reach
	it without moving or right-aligned at the right of the applet (if the
	mouse...) or aligned with the mouse pointer. Sounds complex but try it
	and you'll understand :-)

2005-01-12  Vincent Untz  <vincent@vuntz.net>

	 Use gtk dnd threshold value for snap tolerance
	 Fix bug #107776.

	* panel-toplevel.c: (panel_toplevel_move_to): updated to use the
	snap_tolerance in the private structure
	(panel_toplevel_rotate_to_pointer): ditto
	(panel_toplevel_calc_floating): ditto
	(panel_toplevel_update_normal_position): ditto
	(panel_toplevel_update_auto_hide_position): ditto
	(panel_toplevel_drag_threshold_changed): new, update the
	snap_tolerance when gtk-dnd-drag-threshold has been changed
	(panel_toplevel_update_gtk_settings): new, update the GtkSettings we
	watch and disconnect from the previous one
	(panel_toplevel_screen_changed): call
	panel_toplevel_update_gtk_settings()
	(panel_toplevel_finalize): disconnect the handler for
	gtk-dnd-drag-threshold changes
	(panel_toplevel_instance_init): initialize the new fields and the
	GtkSettings we watch

2005-01-12  Vincent Untz  <vincent@vuntz.net>

	* panel-gconf.c: (panel_gconf_copy_dir): don't set a key if there's no
	value. Fix crasher #146768.

2005-01-12  Vincent Untz  <vincent@vuntz.net>

	* panel-addto.c: (panel_addto_dialog_new): fix spacing/border sizes.
	Fix bug #163317 again.

2005-01-12  Arvind Samptur  <arvind.samptur@wipro.com>

	* applet.[ch]: (panel_applet_get_by_type): Add GdkScreen
	as parameter.
	* panel-action-protocol.c: (panel_action_protocol_main_menu):
	Pass the GdkScreen to get the right applet object.
	Fixes #119825

2005-01-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-run-dialog.c:
	(panel_run_dialog_find_command_icon_idle): don't open the
	.desktop file to get the exec while matching.
	(panel_run_dialog_add_items_idle): pull the exec for matching
	with menu_tree_entry_get_exec().

2005-01-11  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-toplevel.c: (panel_toplevel_attach_to_widget): Get
	the screen right for the attached toplevel widget.
	Fixes #114842

==================== 2.9.4 ====================

2005-01-10  Mark McLoughlin  <mark@skynet.ie>

	Remove Shutdown/Reboot menu items again - we couldn't
	figure out how to make it work in time in bug #92277

	* Makefile.am:
	* menu.c, panel-action-button.c, panel-enums.h,
	  panel-lockdown.[ch], panel-menu-bar.c: remove
	shutdown/reboot menu items.

	* gdm-logout-action.[ch]: remove.

2005-01-10  Vincent Untz  <vincent@vuntz.net>

	* main.c: (main): call gnome_authentication_manager_init() because the
	user might need the authentication dialogs.

2005-01-10  Vincent Untz  <vincent@vuntz.net>

	* launcher.c: (really_add_launcher): don't try to remove the busy
	cursor when an error dialog is closed, destroy the error dialog when
	the launcher editor dialog is closed
	Fix bug #163197

2005-01-10  Vincent Untz  <vincent@vuntz.net>

	* drawer.c: (set_tooltip_and_name): don't set toplevel name to Drawer
	if the tooltip is not set
	* panel-toplevel.c: (panel_toplevel_construct_description):
	description should be Drawer if the toplevel is attached (drawers
	don't have default names anymore)
	The previous commit and this one should fix bug #152480.

2005-01-09  Vincent Untz  <vincent@vuntz.net>

	HIG work on the "Add to Panel" dialog. Fix bug #163317
	Original patch from Luca Ferretti <elle.uca@libero.it>

	* panel-addto.c: (panel_addto_name_change): Use "Add to Panel" (or
	Drawer) title, don't use bold for the list header label
	(panel_addto_dialog_new): invert CANCEL and RESPONSE_BACK buttons
	order, fix spacing/border sizes.

2005-01-09  Vincent Untz  <vincent@vuntz.net>

	Don't draw handles for drawers. Fix bug #142656.

	* panel-toplevel.c: (panel_toplevel_update_size): we don't need
	handles if the toplevel is attached
	(panel_toplevel_size_allocate): ditto
	(panel_toplevel_expose): don't draw handles if the toplevel is
	attached

2005-01-09  Vincent Untz  <vincent@vuntz.net>

	New menu layout. See bug #161613

	* menu.[ch]: (setup_uri_drag): new
	(create_fake_menu): add panel-menu-needs-appending data to the menu so
	we can append items after desktop files
	(handle_menu_tree_changed): ditto
	(create_applications_menu): ditto
	(panel-addto.c): (panel_addto_append_internal_applets): renamed to...
	(panel_addto_prepend_internal_applets): new function
	(panel_addto_query_applets): prepend instead of appending (small
	optimization)
	(panel_addto_make_applet_model): updated
	(panel_addto_make_application_list): prepend instead of appending, and
	reverse the list at the end
	(panel_addto_make_application_model): append items from the settings
	menu
	(panel_addto_dialog_free): free settings item list
	* panel-context-menu.c: (panel_context_menu_show_about_gnome): killed
	(panel_context_menu_create): do not add "About GNOME" menu item here
	since it's in the menu bar now
	* panel-menu-bar.c: (activate_uri), (activate_app_def),
	(panel_menu_bar_append_from_desktop),
	(panel_menu_bar_append_place_item),
	(panel_menu_bar_recreate_places_menu),
	(panel_menu_bar_recreate_desktop_menu),
	(panel_menu_bar_append_applications_menu),
	(panel_menu_bar_create_applications_menu),
	(panel_menu_bar_desktop_is_home_dir_changed),
	(panel_menu_bar_gtk_bookmarks_changed),
	(panel_menu_bar_volume_changed),
	(panel_menu_bar_append_gtk_bookmarks),
	(panel_menu_bar_append_volumes), (panel_menu_bar_create_places_menu),
	(panel_menu_bar_append_desktop_menu),
	(panel_menu_bar_create_desktop_menu): new
	(panel_menu_bar_recreate_actions_menu),
	(panel_menu_bar_create_actions_menu): killed
	(panel_menu_bar_instance_init): connect to the desktop_is_home_dir
	key, monitor the ~/.gtk-bookmarks file, monitor the (un)mounted
	volumes, create the three menus here
	(panel_menu_bar_parent_set): updated
	(panel_menu_bar_finalize): new, clean up things we created in
	instance_init
	(panel_menu_bar_class_init): add the finalize handler

2005-01-07  Dennis Cranston <dennis_cranston@yahoo.com>

	* drawer.c: (load_drawer_applet): Use header capitalization,
	"Add to Drawer...".
	
2005-01-07  Mark McLoughlin  <mark@skynet.ie>

	Fix crasher when moving a menu button between panels.
	Bug #163097

	* panel-menu-button.c: (panel_menu_button_get_icon):
	Don't unref the MenuTreeDirectory.

2005-01-07  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (add_menu_to_panel): unref the return value
	from menu_tree_entry_unref(). add_menudrawer_to_panel()
	already does it.

2005-01-07  Vincent Untz  <vincent@vuntz.net>

	* launcher.c: (drag_data_received_cb): draw animation when dropping
	files on a launcher
	Fix bug #163171.

2005-01-06  Mark McLoughlin  <mark@skynet.ie>

	Noted by Eugene O'Connor in bug #92277

	* panel-action-button.c: s/Lock screen/Lock Screen/

2005-01-06  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch by Raffaele Sandrini <rasa@gmx.ch>

	Add Shut Down/Restart menu items to the actions menu and
	the main menu. Works by using GDM's SET_LOGOUT_ACTION
	protocol.
	
	gnome-session implications still being discussed in
	bug #92277

	* Makefile.am: add gdm-logout-action.[ch].
	
	* gdm-logout-action.[ch]: logout action protocol
	implementation.
	
	* menu.c: (create_main_menu):
	  panel-menu-bar.c: (panel_menu_bar_create_actions_menu):
	 add Shut Down/Restart menu items.
	
	* panel-action-button.c:
	(panel_action_shutdown), (panel_action_reboot): hook
	up the action buttons.
	
	* panel-enums.h: add shutdown/reboot actions.
	
	* panel-lockdown.[ch]:
	(panel_lockdown_get_disable_shutdown),
	(panel_lockdown_get_disable_reboot): check to see if
	logout is disabled and whether GDM supports the logout
	action.

2005-01-04  Vincent Noel  <vnoel@cox.net>

	* panel-menu-bar.c: (panel_menu_bar_on_expose),
	(panel_menu_bar_load): Add a focus line around the menu bar applet
	when navigating with keyboard. Patch discussed in bug #160450.

2005-01-02  Vincent Untz  <vincent@vuntz.net>

	Fix applet handles in RTL environment.
	Partial fix for bug #154320.

	* panel-applet-frame.c: (panel_applet_frame_get_background_string):
	don't forget the direction when we build the string
	(panel_applet_frame_size_allocate): get correct positions if we're in
	a RTL environment.

2005-01-02  Vincent Untz  <vincent@vuntz.net>

	* panel-default-setup.entries: remove default panel names since we now
	have sane wording for nameless panels.
	Based on patch from Christian Neumair.
	Fix bug #138621.

2005-01-02  Vincent Untz  <vincent@vuntz.net>

	Update the Lock check menu item when the gconf key changes
	Based on a patch from Leena Gunda <leena.gunda@wipro.com>
	Fix bug #156827.

	* applet.c: (panel_applet_locked_change_notify): new, update the
	object context menu when the lock gconf key changes
	(panel_applet_create_menu): add mnemonic for "Lock To Panel"
	(panel_applet_destroy): only remove the lockdown notify if the object
	is not a bonobo object
	(panel_applet_register): only add the lockdown notify if the object is
	not a bonobo object, connect to the "locked" gconf key
	* panel-applet-frame.c: (panel_applet_frame_sync_menu_state): make
	this non static

2005-01-02  Vincent Untz  <vincent@vuntz.net>

	Make Lock menu item HIG compliant.
	Based on patch from Madhan Raj M <raj_madan@rediffmail.com>
	Fix bug #114055

	* GNOME_Panel_Popup.xml: use a check menu item for the lock item and
	rename the item
	* applet.c: (panel_applet_lock): updated to toggle the check menu item
	(panel_applet_create_menu): updated to create a check menu item. Don't
	create useless GtkImages.
	* panel-applet-frame.c: (panel_applet_frame_sync_menu_state): set the
	state of the check menu item
	(popup_handle_lock): killed
	(listener_popup_handle_lock): new function to toggle the locked state
	(panel_applet_frame_activated): listen for check menu item changes

2005-01-01  Vincent Untz  <vincent@vuntz.net>

	Port the GnomeFileEntry in the property dialog to
	GtkFileChooserButton.

	* panel-properties-dialog.c: (panel_properties_dialog_image_changed):
	updated
	(panel_properties_dialog_setup_image_entry): renamed to...
	(panel_properties_dialog_setup_image_chooser): new function, add a
	filter so only images are shown in the file chooser. Fix bug #129724.
	(panel_properties_dialog_update_background_image): updated
	(panel_properties_dialog_new): updated
	* panel-properties-dialog.glade: updated

2005-01-01  Vincent Untz  <vincent@vuntz.net>

	* panel-addto.c: (panel_addto_selection_changed): use
	gtk_button_set_use_stock() only once.

2005-01-01  Vincent Untz  <vincent@vuntz.net>

	* panel-addto.c: (panel_addto_make_text): small update
	(panel_addto_name_change): fix displayed strings when panel name is
	empty.
	Fix bug #162258, thanks to Christian Neumair.

2004-12-30  Vincent Untz  <vincent@vuntz.net>

	* panel-applet-frame.c: (panel_applet_frame_activated): fix invalid
	read of size 4. Thanks to Kjartan for finding this.
	Fix bug #162388

2004-12-22  Vincent Untz  <vincent@vuntz.net>

	* panel-background.c: (load_background_file): only open background
	images from regular files. Based on patch by Vasista sarma
	<svasista@novell.com>. Fix bug #152127.

2004-12-22  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_auto_hide_timeout_handler):
	reset the hide timeout id. Fix autohiding not always working.

2004-12-22  Vincent Untz  <vincent@vuntz.net>

	* panel-struts.c: (get_toplevel_depth): new function to know the depth
	of a toplevel (useful for drawers)
	(panel_struts_compare): panel with biggest depth should be at the top
	Fix bug #125336

	* panel-toplevel.c: (panel_toplevel_destroy): nullify some fields

2004-12-22  Vincent Untz  <vincent@vuntz.net>

	* panel-multiscreen.c: (panel_multiscreen_reinit): disconnect the
	size-changed signal handlers if they exist because they will be added
	again in panel_multiscreen_init(). The panel should not take 100% CPU
	when changing monitor resolution...
	Fix bug #160097

2004-12-21  Vincent Untz  <vincent@vuntz.net>

	* launcher.c: (launcher_launch): close parent drawers of a drawer when
	a launcher is launched.
	Fix bug #117112

==================== 2.9.3 ====================

2004-12-21  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_move_to): make it easier to center
	a toplevel by using SNAP_TOLERANCE in the tests and better tests
	(panel_toplevel_update_normal_position): when snapping a toplevel to
	an edge, update its x/y settings. It makes sense and we can avoid loops
	like the one in bug #156522.
	(panel_toplevel_update_auto_hide_position): ditto
	(panel_toplevel_update_position): upgraded my brain again. And fix
	probable multiscreen brokenness I introduced yesterday.

2004-12-20  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_update_position): I've bought a
	brain. Now the code looks better. Even if it might still be just a
	workaround (I could not afford a better brain, I'm sorry).

2004-12-20  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_update_position): brown paper fix

2004-12-20  Vincent Untz  <vincent@vuntz.net>

	Fix 100% CPU usage when closing drawers. I'm not sure this is an
	optimal fix, and maybe that's just a workaround, so I'm adding a
	FIXME.
	Fix bug #160748.

	* panel-toplevel.c: (panel_toplevel_update_position): don't forget to
	count the frame bevels when updating the position.

2004-12-19  Vincent Untz  <vincent@vuntz.net>

	* panel-widget.c: (panel_widget_applet_destroy): do not forget to
	remove the pointer to PANEL_APPLET_DATA. Fix invalid read/write in
	panel_widget_set_applet_size_hints ().

2004-12-19  Vincent Untz  <vincent@vuntz.net>

	Fix pixmap background when moving the menu bar.

	* panel-menu-bar.c: (panel_menu_bar_realized): killed
	(panel_menu_bar_size_allocate): new size allocation function, update
	the background if the allocation has changed
	(panel_menu_bar_class_init): declare the size allocation function
	(panel_menu_bar_load): remove hack :-)

2004-12-19  Vincent Untz  <vincent@vuntz.net>

	* panel-applet-frame.c: (panel_applet_frame_get_background_string):
	better fix.

2004-12-19  Vincent Untz  <vincent@vuntz.net>

	* panel-applet-frame.c: (panel_applet_frame_get_background_string):
	get the right pixmap background when the applet has an handle.

2004-12-19  Vincent Untz  <vincent@vuntz.net>

	* panel-background-monitor.c: (panel_background_monitor_get_region):
	copy the area at the right place, so we get the expected pixbuf when
	the panel is autohidden at the top or the left of the screen.
	Fix bug #110701. And kill a FIXME.

2004-12-19  Vincent Untz  <vincent@vuntz.net>

	Fix removal of the last applet/object that could not get removed,
	which could cause a crash if the user tried to remove it again.

	* panel-profile.c: (panel_profile_save_id_list): add a resave
	parameter so we know if we want to save again the same id_list or if
	we want to save the new one passed as paramater
	(panel_profile_save_other_id_lists): updated
	(panel_profile_add_to_list): updated
	(panel_profile_remove_from_list): updated

2004-12-19  Vincent Untz  <vincent@vuntz.net>

	Add a "Launch" menu item to the launcher context menu

	* applet.c: (applet_callback_callback): handle the "Launch" menu item
	for launchers
	* launcher.[ch]: (launch_cb): renamed to...
	(launcher_launch): new function, arguments are now swapped
	(create_launcher): updated
	(load_launcher_applet): add "Launch" menu item to the context menu

2004-12-19  Vincent Untz  <vincent@vuntz.net>

	The drawer context menu is now the same if you click on the drawer
	toplevel or on the drawer button widget. This should be more
	consistent.

	* applet.[ch]: (panel_applet_create_menu): we don't need the second
	argument, connect to the "show" signal of the menu so we can push
	the auto-hide disabler. Doing it in a signal callback is better
	since drawer menus are not always shown through applet_show_menu ()
	(panel_applet_recreate_menu): updated
	(applet_callback_callback): handle the "Add to drawer..." menu item
	for drawers
	(applet_menu_show): new function, to push the autohide disabler
	(applet_show_menu): updated, and do not push auto-hide disabler here
	* drawer.c: (drawer_properties_enabled): renamed to...
	(drawer_changes_enabled): new function
	(load_drawer_applet): add a "Add to drawer..." menu item to the
	context menu
	* panel-context-menu.c: (panel_context_menu_create): for drawers,
	create the applet context menu
	* panel.c: (menu_deactivate): renamed to...
	(context_menu_deactivate): new function
	(context_menu_show): new function, to push the auto-hide disabler
	(panel_menu_get): connect to the "show" signal of the menu so we can
	push the auto-hide disabler (same rationale as before), handle the
	fact that the menu can be NULL
	(panel_popup_menu): do not push auto-hide disabler here, handle the
	fact that the menu can be NULL

2004-12-18  Vincent Untz  <vincent@vuntz.net>

	* panel.c: (drag_motion_cb): don't queue auto-hide here
	(drag_leave_cb): queue it here
	Fix bug #145266

2004-12-16  Dennis Cranston <dennis_cranston at yahoo com>

	* panel.c:  HIGify the "Delete this Panel..." dialog.
	
2004-12-18  Vincent Untz  <vincent@vuntz.net>

	Don't use only the 48x48 icons for button widgets.

	* button-widget.[ch]: (button_widget_unset_pixbufs): the scaled pixbuf
	was removed
	(button_widget_load_and_scale_stock_icon): new function, to load and
	scale a stock icon
	(button_widget_load_pixbuf_and_scale): killed
	(button_widget_reload_pixbuf): move the code of
	button_widget_load_pixbuf_and_scale () here. It was simplified a lot
	since we don't need to scale the pixbuf any more.
	(button_load_pixbuf): add a preferred_size parameter
	(button_widget_expose): the scaled pixbuf was removed
	(button_widget_size_allocate): reload the pixbuf if the size has
	changed
	(button_widget_instance_init): the scaled pixbuf was removed

2004-12-16  Dennis Cranston <dennis_cranston@yahoo.com>

	* panel-action-button.c: (panel_action_search):  Use 
	startup notification when launching gnome-search-tool.

	* panel-utils.[ch]: add panel_lookup_in_data_dirs ().

2004-12-16  Vincent Untz  <vincent@vuntz.net>

	* panel-recent.c: (panel_recent_append_documents_menu): use
	add_menu_separator (). Sometimes the separator disappeared: the widget
	needs to be shown.

2004-12-16  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_connect_menu_signals): fix memory
	corruption (the callback data for gtk_widget_destroyed should never be
	a pointer to a GtkWidget * that is a function parameter!)
	(panel_menu_bar_recreate_actions_menu): updated
	(panel_menu_bar_instance_init): updated

2004-12-15  Vincent Untz  <vincent@vuntz.net>

	* panel-addto.c: (panel_addto_append_internal_applets): data is static
	(panel_addto_query_applets): free the data we get from bonobo
	(panel_addto_make_application_list): data is not static
	(panel_addto_dialog_free_item_info): new
	(panel_addto_dialog_free_application_list): free items
	(panel_addto_dialog_free): ditto
	Should fix bug #151197

2004-12-15  Vincent Untz  <vincent@vuntz.net>

	* menu.[ch]: (create_menuitem): add FIXME so we don't forget to add
	the right icon for drag and drop when the GTK+ API will be available
	(menu_create_action_item): new function
	(append_lock_screen): killed
	(append_log_out): killed
	(create_main_menu): use menu_create_action_item ()
	* panel-action-button.[ch]: (panel_action_get_invoke): new
	(panel_action_lock_screen), (panel_action_logout),
	(panel_action_run_program), (panel_action_search),
	(panel_action_screenshot): make them static since other modules use
	panel_action_get_invoke () now
	* panel-menu-bar.c: (panel_menu_bar_append_action_item): killed
	(panel_menu_bar_recreate_actions_menu): updated with
	menu_create_action_item () and add_menu_separator ()

2004-12-12  Vincent Untz  <vincent@vuntz.net>

	First step in trying to make menu.c cleaner: move the panel context
	menu in a new file

	* Makefile.am: add new files
	* menu.[ch]: (menu_get_panel), (menuitem_to_screen),
	(add_menu_separator): these functions are no longer static
	(check_for_screen), (show_about_dialog), (about_gnome_cb),
	(create_new_panel), (remove_panel), (setup_remove_this_panel),
	(make_panel_submenu), (show_panel_help), (create_panel_context_menu):
	move these functions...
	* panel-context-menu.[ch]: ... here (new files)
	* panel.c: (panel_menu_get): updated

2004-12-05  Mark McLoughlin  <mark@skynet.ie>

	Don't actually reload the the menu tree until the menu
	is to be shown as was originally intended.
	
	* menu.c:
	(submenu_to_display): if there's no menu directory
	associated with the widget, lookup the directory
	using the menu path.
	(handle_menu_tree_changed): don't reload the menu, just
	unset the root menu directory.
	(create_applications_menu): just set the root menu path
	on the widget.
	
2004-12-05  Mark McLoughlin  <mark@skynet.ie>

	Patch from Frederic Crozat <fcrozat@mandrakesoft.com>

	* menu.c: (add_menudrawer_to_panel): don't leak the
	menu directory.

2004-12-04  Vincent Untz  <vincent@vuntz.net>

	* menu.[ch]: (setup_internal_applet_drag): setup the drag icon too.
	It's waaaaaayyyy nicer :-)
	(append_lock_screen): updated
	(append_log_out): updated
	(create_main_menu): updated
	* panel-menu-bar.c: (panel_menu_bar_append_action_item): updated

2004-12-04  Vincent Untz  <vincent@vuntz.net>

	Remove some stock icons and directly use the icon names instead.
	I only left stock icons that are references more than once, so we
	can change all the references at once. But it might be better to
	provide a #define...

	* menu.[ch]: (setup_stock_menu_item): renamed to...
	(setup_menu_item_with_icon): new function, so we can use a stock icon
	or an icon name
	(append_lock_screen): updated
	(append_log_out): updated
	(create_main_menu): updated
	* panel-action-button.[ch]: add icon names for most of the actions
	(panel_action_get_icon_name): new function
	(panel_action_button_set_type): updated to use the right icon
	(panel_action_button_style_set): ditto
	(panel_action_button_set_dnd_enabled): ditto
	* panel-addto.c: (panel_addto_append_internal_applets): updated
	* panel-menu-bar.c: (panel_menu_bar_append_action_item): updated
	* panel-recent.c: (panel_recent_append_documents_menu): updated
	* panel-stock-icons.[ch]: removed 6 stock icons. 5 to go!

2004-12-04  Vincent Untz  <vincent@vuntz.net>

	The menu bar now uses the panel background too.
	Fix bug #152901

	* panel-background.[ch]: (panel_background_get_type):
	(panel_background_get_color):
	(panel_background_get_pixmap): new functions to handle background
	changes in internal applets
	* panel-menu-bar.[ch]: (panel_menu_bar_realized):
	(panel_menu_bar_load): hack so we get the right background when
	the menu bar is added
	(panel_menu_bar_change_background): new function
	* panel.c: (back_change): update background for the menu bar

2004-12-03  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_show_applications_menu): renamed
	to...
	(panel_menu_bar_show_menu): new function
	(panel_menu_bar_connect_menu_signals): new function
	(panel_menu_bar_append_action_item): add argument so we can attach
	items to any menu
	(panel_menu_bar_recreate_actions_menu): updated
	(panel_menu_bar_append_actions_menu): renamed to...
	(panel_menu_bar_create_actions_menu): new function. This creates a
	menu. And that's all. Also, don't make it possible to have two
	consecutive separators
	(panel_menu_bar_instance_init): updated to use the new functions.

	* panel-run-dialog.c: (entry_changed): use new GTK+ function to set
	the drag targets
	(entry_drag_data_received): make sure the data we get is text and
	securize it
	(panel_run_dialog_setup_entry): use new GTK+ function to set the drag
	targets, don't let GTK+ handle the drop signal
	Fix bug #157173

	* panel-toplevel.c: (panel_toplevel_update_hidden_position): correctly
	update the position of the panel when hidden and we change the use
	of arrows. Fix bug #156711
	Also, don't use the auto_hide_size setting here since it's not
	relevant.
	(panel_toplevel_set_orientation): update the state of the panel if
	it's hidden. Fix bug #156713

2004-12-01  Mark McLoughlin  <mark@skynet.ie>

	* menu-ditem.c: (panel_new_launcher): more warnings -
	@auto_destroy is the third arg, not the fourth.

2004-12-01  Mark McLoughlin  <mark@skynet.ie>

	* panel-util.c:
	(panel_show_help), (panel_lock_screen): update for addition
	of new arg to panel_error_dialog. Fixes more warnings.

2004-12-01  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (drop_urilist): fix warning.

2004-11-30  Vincent Untz  <vincent@vuntz.net>

	* panel.c: (drop_urilist): don't leak the icon

2004-11-30  Vincent Untz  <vincent@vuntz.net>

	* panel.c: (drop_urilist): use gnome_icon_lookup() to find the icon
	for the dropped URI. Fix bug #159174.

2004-11-30  Vincent Untz  <vincent@vuntz.net>

	* panel-util.[ch]: (panel_error_dialog): add an argument to specify
	if the dialog should be automatically destroyed when closed
	(panel_dialog): ditto
	* button-widget.c: (button_widget_load_pixbuf_and_scale): updated
	panel_error_dialog call
	* launcher.c: (panel_launcher_save_ditem), (launch_url),
	(drag_data_received_cb), (really_add_launcher): ditto
	* menu-ditem.c: (ditem_properties_close), (really_add_new_menu_item),
	(panel_new_launcher): ditto
	* menu.c: (about_gnome_cb), (activate_app_def), (remove_panel): ditto
	* panel-action-button.c: (panel_action_search),
	(panel_action_screenshot): ditto
	* panel-recent.c: (recent_documents_activate_cb): ditto
	* panel-run-dialog.c: (panel_run_dialog_launch_command),
	(panel_run_dialog_show_url), (panel_run_dialog_execute): ditto
	* panel-shell.c: (panel_shell_register): ditto and remove an horrible
	hack :-)

2004-11-29  Vincent Untz  <vincent@vuntz.net>

	Fix gnome-panel part of bug #148171, and rework the code

	* panel-applet-frame.[ch]: (panel_applet_frame_new): killed
	(panel_applet_frame_construct): killed
	(panel_applet_frame_load): move some code of the old
	panel_applet_frame_new() and panel_applet_frame_construct() here, use
	bonobo_get_object_async instead of bonobo_get_object so we don't block
	during the creation of the bonobo object (that's the fix for bug
	#148171)
	(panel_applet_frame_set_info): killed
	(panel_applet_frame_loading_failed_response): new function, to handle
	the response of the dialog
	(panel_applet_frame_loading_failed): simplified, don't block with
	gtk_dialog_run, make the error dialog more HIG compliant
	(panel_applet_frame_activated): new, with code from the old
	panel_applet_frame_construct()
	(panel_applet_frame_get_panel): killed
	(panel_applet_frame_get_size_hints): remove from header since it does
	not exist any more

2004-11-29  Vincent Untz  <vincent@vuntz.net>

	I don't like FIXMEs. Let's try to fix most of them.

	* panel-addto.c: (panel_addto_selection_changed): remove FIXME I added
	for a reason I forgot a long time ago...

	* panel-background-monitor.[ch]: (panel_background_monitor_get): kill,
	it's not used any more since we have the better
	panel_background_monitor_get_for_screen()

	* panel-run-dialog.c: (panel_run_dialog_new): use
	gdk_x11_window_set_user_time instead of
	panel_gdk_x11_window_set_user_time
	(panel_run_dialog_present): ditto
	* panel-xutils.[ch]: (panel_gdk_x11_window_set_user_time): kill, we
	now depend on GTK+ >= 2.5

==================== 2.9.2 ====================

2004-11-29  Vincent Untz  <vincent@vuntz.net>

	* Makefile.am: fix distcheck

2004-11-28  Vincent Untz  <vincent@vuntz.net>

	Patch from Romain Baffet <rbaffert0-pub@yahoo.fr> in bug #152098.

	* panel.c: (drop_url): split the dropped data in URL and name so we
	can have a launcher that works, use a nice Name for the launcher if
	possible

2004-11-28  Vincent Untz  <vincent@vuntz.net>

	Why create launcher that call nautilus? Fix bug #159535.

	* panel.c: (drop_nautilus_uri): killed
	(drop_uri): new, create a link .desktop file
	(drop_directory): killed
	(drop_urilist): use drop_uri() instead of drop_nautilus_uri() and
	don't make a special case for directories
	(panel_receive_dnd_data): use drop_uri() instead of drop_nautilus_uri()

2004-11-26  Mark McLoughlin  <mark@skynet.ie>

	Patch from Matthias Clasen <mclasen@redhat.com> in
	bug #156162

	* xstuff.c: (draw_zoom_animation): round the integer
	co-ords only once since we seem to sometimes get
	different results.

2004-11-25  Marco Pesenti Gritti  <marco@gnome.org>

	* panel-recent.c:

	Include mime-handlers, not application-registry

2004-11-24  Mark McLoughlin  <mark@skynet.ie>

	Patch from Alex Larsson.

	* panel-menu-button.c: (split_menu_uri): don't crash if
	menu_uri is NULL.

2004-11-23  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (drop_directory): fix brokeness.

2004-11-23  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (drop_urilist): don't use gnome-vfs-module
	API anymore.
	
	* panel-addto.c: (panel_addto_query_applets),
	  panel-applet-frame.c: (panel_applet_frame_get_name):
	fix warnings.

2004-11-22  Marco Pesenti Gritti  <marco@gnome.org>

	reviewed by: Mark McLoughlin  <mark@skynet.ie>

	* panel-recent.c: (show_uri):

	Reimplement using gnome vfs launch api.
	Fix bug #159045.

2004-11-21  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_instance_init): ignore the delete
	event. Patch from Sebastian Kapfer <sebastian_kapfer web de>
	Fix bug #139633.

2004-11-19  Vincent Untz  <vincent@vuntz.net>

	* panel-properties-dialog.c: (get_name):
	(panel_properties_dialog_name_changed):
	(panel_properties_dialog_setup_name_entry):
	(panel_properties_dialog_update_name): remove these functions
	(panel_properties_dialog_toplevel_notify):
	(panel_properties_dialog_new): updated because we don't have the name
	entry any more
	* panel-properties-dialog.glade: remove the panel name entry
	Fix bug #107611 (original patch by Christian Neumair)

2004-11-16  William Jon McCann  <mccann@jhu.edu>

	* panel-recent.c (recent_documents_clear_cb): 
	* panel-applet-frame.c (panel_applet_frame_cnx_broken):
	Use new GTK+ HIG message dialog API.

2004-11-13  Vincent Untz  <vincent@vuntz.net>

	* Makefile.am: gnome-panel doesn't need menu-ditem.[ch] and
	gnome_desktop_item_edit doesn't need panel-a11y.c
	* panel-addto.c: remove useless menu-ditem.h include
	(panel_addto_query_applets): kill one warning
	* panel-applet-frame.c: (panel_applet_frame_get_name): kill one
	warning
	* screenshot-utils.h: remove

2004-11-13  Vincent Untz  <vincent@vuntz.net>

	* panel-addto.c: (panel_addto_query_applets)
	* panel-applet-frame.c: (panel_applet_frame_get_name)
	Stop using deprecated gnome_i18n_get_language_list().

2004-11-12  Mark McLoughlin  <mark@skynet.ie>

	Back in 2.4, we messed up by not realising that the new
	configuration format didn't in fact co-exist at all well
	with the 2.2 configuration. Which means if you share a
	homedir between a GNOME 2.2 (or before) login and a
	GNOME 2.4 (or later) login, you're panel is screwed
	terribly.

	This change belatedly fixes the problem by storing the
	panel configuration in a different location from where
	we stored it in GNOME 2.2. It also removes the broken
	concept of panel profiles. The new layout is the same
	as before except its store in /apps/panel now - e.g. the
	list of panels is now /apps/panel/general/toplevel_id_list

	* Makefile.am: install the default setup in /apps/panel.

	* main.c: (main): remove the --profile command line argument.
	
	* panel-session.c: (panel_session_init): don't save --profile
	in the RestartCommand.
	
	* panel-gconf.h: set new config location.
	
	* panel-compatibility.c:
	(get_homedir_source): split this out. Yes, it does have
	xml:readonly:$(HOME)/.gconf hardcoded. No I don't have any
	better ideas.
	(panel_compatibility_maybe_copy_old_config): copy the old
	configuration to /apps/panel if /apps/panel/general/profiles_migrated
	is not set.
	
	* panel-general.schemas.in: add /apps/panel/general/profiles_migrated
	and apply schemas.
	
	* panel-default-setup.entries: don't apply the schemas for
	general keys - we do that in panel-general.schemas now.
	
	* applet.c, drawer.c, launcher.c, panel-action-button.c,
	  panel-applet-frame.c, panel-gconf.c, panel-menu-button.c,
	  panel-profile.[ch], panel-run-dialog.c: update for the
	fact that we don't have profiles anymore.

2004-11-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-background-monitor.c:
	(panel_background_monitor_setup_pixbuf): trap X errors.
	Partial fix for bug #128317.

2004-11-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-xutils.c: (panel_xutils_set_window_type): fix typo.

2004-11-11  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (drop_nautilus_uri): fix quoting issue that
	prevented some dropped folders from working. Fix from
	Matthias Clasen in bug #155725.

2004-11-11  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (drop_urilist): re-work a little to make adding
	support for URIs which gnome-vfs doesn't recognise - e.g.
	see bug #143580.

2004-11-09  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: remove -DGTK_MENU_INTERNALS, we don't use
	crackpot gtk+ internals anymore. Woo!

2004-11-09  Mark McLoughlin  <mark@skynet.ie>

	Use libgnome-menu to generate menus so that we now use the
	freekdestop.org Desktop Menu Specification.

	* menu.[ch]: major hackfest to make it use libgnome-menu and
	clean things up in the process.

	* panel-addto.c: generate the launcher list using libgnome-menu.
	
	* panel-run-dialog.c: generate the launcher list using libgnome-menu.

	* panel-menu-bar.c,
	panel-menu-button.c: update for menu.[ch] changes

	* panel.c: update drag and drop stuff for menu changes.

	* panel-util.[ch]: cull a bunch of crap which was only
	used by quick-desktop-reader.[ch].

	* applet.[ch]:
	(panel_applet_position_menu): move here from menu-util.[ch].
	
	* Makefile.am: remove menu-util.[ch], menu-fentry.[ch]
	and quick-desktop-reader.[ch] from the build.
	
	* menu-fentry.[ch], menu-util.[ch],
	quick-desktop-reader.[ch]: remove.

==================== 2.9.1 ====================

2004-11-08  Vincent Untz  <vincent@vuntz.net>

	* panel-run-dialog.c: (panel_run_dialog_append_file_utf8): don't do
	anything if the filename is void
	(entry_drag_data_received): ditto

2004-11-08  James Henstridge  <james@jamesh.id.au>

	* panel-background.c (panel_background_prepare): call
	gdk_display_sync() after drawing the panel background.  Since
	applets will be looking up the background pixmap using a different
	display connection, we need to make sure all drawing has occurred
	first.  Fixes bug #157303.

2004-11-06  Vincent Untz  <vincent@vuntz.net>

	* menu.c: (create_root_menu):
	* panel-action-button.c: (panel_action_screenshot):
	* panel-menu-bar.c: (panel_menu_bar_append_actions_menu):
	gnome-panel-screenshot was renamed to gnome-screenshot
	* panel-addto.c: (panel_addto_make_text): use g_markup_printf_escaped
	* panel-util.c: (panel_dialog): don't remove separator since it's
	causing a GTK+ warning and it's useless now

Wed Nov  3 12:00:20 2004  Jonathan Blandford  <jrb@redhat.com>

	* gnome-panel-screenshot: Migrated to gnome-utils.  All code is
	there now.

Mon Nov  1 18:49:47 2004  Jonathan Blandford  <jrb@redhat.com>

	* Makefile.am (glade_DATA): remove extraneous glade file.

Mon Nov  1 15:52:04 2004  Jonathan Blandford  <jrb@redhat.com>

	* gnome-panel-screenshot:
	* gnome-panel-screenshot.c:
	* gnome-panel-screenshot.glade:
	* gnome-panel-screenshot.schemas.in:
	* screenshot-dialog.c:
	* screenshot-dialog.h:
	* screenshot-save.c:
	* screenshot-save.h:
	* screenshot-xfer.c:
	* screenshot-xfer.h: Pretty big rewrite.  Start of gnome_vfs
	support.  It's not complete, and the dialog is fully stubbed, but
	you can now save to remote URI's.  Additionally, it now has a file
	chooser embedded in it.

2004-11-01  Vincent Untz  <vincent@vuntz.net>

	* panel-properties-dialog.c: remove a useless comma
	* panel-properties-dialog.glade: don't use GtkColorButton alpha
	support for now

2004-11-01  Marco Pesenti Gritti  <mpg@redhat.com>

	reviewed by: Vincent Untz  <vincent@vuntz.net> 

	* gnome-panel/menu-util.c: (get_default_menu_flags):
	* gnome-panel/menu.c: (create_root_menu):
	* gnome-panel/menu.h:
	* gnome-panel/panel-stock-icons.c: (panel_init_stock_icons):

	Use icon theme for the stock icons so that they are themed
	correctly. Fix #156817.

2004-11-01  Vincent Untz  <vincent@vuntz.net>

	* *.[ch]: stop including everything from libgnome and libgnomeui, use
	glib/gi18n.h

	* menu.c: (create_panel_context_menu): use GTK_STOCK_ABOUT instead of
	GNOME_STOCK_ABOUT
	* panel-background.[ch]: (panel_background_set_pango_color): killed
	(panel_background_set_gdk_color): new
	(panel_background_set_color): update for panel_background_set_gdk_color
	* panel-profile.[ch]: (panel_profile_set_background_color): update
	for panel_profile_set_background_gdk_color
	(panel_profile_get_background_color): update for
	panel_profile_get_background_gdk_color
	(panel_profile_{set,get}_background_pango_color: kill
	(panel_profile_{set,get}_background_gdk_color): new
	(get_background_color): use GdkColor instead of PangoColor
	(panel_profile_background_change_notify): ditto
	* panel-properties-dialog.c: port to GtkComboBox and GtkColorButton
	(orientation_to_history):
	(history_to_orientation):
	(panel_properties_dialog_setup_orientation_menu):
	(panel_properties_dialog_remove_orientation_menu): kill
	(panel_properties_dialog_setup_orientation_combo):
	(panel_properties_dialog_remove_orientation_combo): new
	(panel_properties_dialog_orientation_changed):
	(panel_properties_dialog_update_orientation):
	(panel_properties_dialog_update_for_attach): update for the combo box
	(panel_properties_dialog_color_changed):
	(panel_properties_dialog_update_background_color): update for the
	color button
	(panel_properties_dialog_setup_color_picker): kill
	(panel_properties_dialog_setup_color_button): new
	(panel_properties_dialog_new): updated
	* panel-properties-dialog.glade: port to GtkComboBox and GtkColorButton
	* panel-recent.c: (panel_recent_append_documents_menu): use
	gtk_menu_shell_append() instead of deprecated gtk_menu_append()
	* panel-run-dialog.c: (panel_run_dialog_find_command_icon_idle): use
	gtk_tree_path_new_first() instead of deprecated
	gtk_tree_path_new_root()

2004-10-31  Vincent Untz  <vincent@vuntz.net>

	* Makefile.am: seems like ALLOW_CRACKPOT_MENU_CODE was useful...

2004-10-30  Vincent Untz  <vincent@vuntz.net>

	* Makefile.am: install stuff in $(datadir)/gnome/panel/{glade,pixmaps},
	remove ALLOW_CRACKPOT_MENU_CODE

2004-10-30  Vincent Untz  <vincent@vuntz.net>

	* panel-addto.c: (panel_addto_dialog_new): ellipsize description of
	the applets

2004-10-28  Vincent Untz  <vincent@vuntz.net>

	* gnome-panel-screenshot.c: (update_window_icon): kill
	(icon_theme_changed): kill
	(set_window_icon): kill
	(do_screenshot): don't set icon here
	(main): set default icon here so that all dialogs will have the icon

	* panel-stock-icons.[ch]: remove useless stock definitions

2004-10-27  Vincent Untz  <vincent@vuntz.net>

	* panel-stock-icons.c: use drawer.png from gnome-icon-theme for the
	drawer icon

2004-10-27  Vincent Untz  <vincent@vuntz.net>

	* main.c: (main): set the default icon directly insted of calling
	panel_register_window_icon()
	* menu.c: (show_about_dialog): port to GtkAboutDialog, and move to
	translator-credits
	* panel-stock-icons.c: remove gnome-panel-type*
	* panel-toplevel.c: (panel_toplevel_class_init): we don't need to set
	an icon here since we set a default icon in main.c
	* panel-util.[ch]: (panel_pixmap_discovery): kill
	* panel.[ch]: (panel_register_window_icon): kill

2004-10-27  Christian Neumair  <chris@gnome-de.org>

	Fix bug #113801: "'Reload applet?' dialog does not accord to HIG".

	* panel-menu-frame.c: (panel_applet_frame_cnx_broken): HIGify "Reload
	Applet" dialog.

2004-10-27  Christian Neumair  <chris@gnome-de.org>

	Fix bug #143963: "Remove Distro Menu".

	* distribution.[ch]: Delete.

	* Makefile.am:
	* menu.[ch]:
	* menu-util.[ch]:
	* panel.c:
	* panel-menu-bar.c:
	Remove all distribution menu-related code.


2004-10-27  Vincent Untz  <vincent@vuntz.net>

	* panel-properties-dialog.c: (panel_properties_dialog_response): show
	the help for drawer properties if the user is editing the properties of
	a drawer. Fix bug #143034
	* panel.c: (panel_deletion_dialog): fix the text of the deletion dialog
	in the case of a drawer deletion. Fix bug #145563

Sat Oct 23 20:59:24 2004  Jonathan Blandford  <jrb@redhat.com>

	* gnome-panel-screenshot.c: escape '/' in file names.

	* screenshot-save.c (screenshot_sanitize_filename): New function

	* screenshot-utils.c: Rewrite Window walking code to be correct.
	We now find both the window manager window and the app toplevel.

Fri Oct 22 15:32:15 2004  Jonathan Blandford  <jrb@redhat.com>

	* gnome-panel-screenshot.c: Big refactor of the code.  Split out
	various functions into other files to get gnome-panel-screenshot.c
	down from 1700 lines.  Additionally:
	- Removed cut-n-paste of gdk_pixbuf_save(), #148369
	- Added tentative drop-shadow support.  It's slow so it's off by
	default, #148367
	- Better async support.  We shouldn't leak temporary files
	anymore.

2004-10-21  Anders Carlsson  <andersca@gnome.org>

	* gnome-panel-screenshot.c: (add_file_to_path),
	(text_property_to_utf8), (get_text_property), (get_utf8_property),
	(get_window_title), (take_window_shot), (main):
	Fix window title handling. Should fix the 100% cpu bug.

2004-10-21  Christian Neumair  <chris@gnome-de.org>

	Fixes bug #154072.

	* gnome-panel-screenshot.c (display_help): New function.
	(on_toplevel_key_press_event): Handle F1 keypress.
	* gnome-panel-screenshot.glade: Connect to
	key-press-event signal to on_toplevel_key_press_event.

2004-10-18  William Jon McCann  <mccann@jhu.edu>

	Fixes bug #150661.

	* panel-recent.c (recent_documents_tooltip_func): New function
	to set tooltips for recent files menu items.
	(panel_recent_append_documents_menu): Add tooltips to recent
	files menu items and "Clear Recent Documents" menu item.

2004-10-12  Mark McLoughlin  <mark@skynet.ie>

	When saving any of toplevel_id_list, applet_id_list or
	object_id_list, always save the other two id lists two.
	Prevents the situation where when you change the default
	setup, people may see bits of the new configuration leaking
	through even though they've changed some of their panel
	configuratoin.

	* panel-profile.[ch]:
	(panel_profile_save_id_list),
	(panel_profile_save_other_id_lists),
	(panel_profile_add_to_list),
	(panel_profile_remove_from_list): when saving a list,
	save the other lists too.
	(panel_profile_id_list_is_writable),
	(panel_profile_id_lists_are_writable): no longer check
	whether an individual list is writable but whether all
	lists are writable.

	* applet.c, menu.c, panel-addto.c, panel-applet-frame.c,
	  panel.c: use id_lists_are_writable() rather than
	list_is_writable().
	
2004-10-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-addto.c: add back vnoel's patch now that we've branched.

2004-10-11  Vincent Untz  <vincent@vuntz.net>

	* panel-addto.c: revert the "2004-10-04  Vincent Noel  <vnoel@cox.net>"
	change: we did not branch for 2.10 and so we can't depend on GTK+ 2.5.

2004-09-30  Vincent Noel  <vnoel@cox.net>

	* panel-addto.c (panel_addto_selection_changed): In the "Add to
	panel" dialog, make the "add" button unsensitive when nothing is selected.

2004-10-04  Vincent Noel  <vnoel@cox.net>

	* panel-addto.c: Split the "application launcher" items out of
	internal_addto_items into their own array.
	(panel_addto_append_item): extracted from panel_addto_make_applet_model.
	(panel_addto_append_special_applets): new.
	(panel_addto_make_applet_model): Move the "application launchers"
	at the top of the list. Add a separator before the other applets.

2004-09-29  Vincent Noel  <vnoel@cox.net>

	* panel-run-dialog.c (panel_run_dialog_set_icon): scale down the
	app icon in the "Run application" dialog. Fixes bug #153564.

==================== 2.8.0.1 ====================

2004-09-28  James Henstridge  <james@jamesh.id.au>

	Fixes bug #153619 and Ubuntu bug #1587.

	* menu.c (panel_make_menu_icon): same here.

	* button-widget.c (get_missing): use
	gdk_pixbuf_new_from_file_at_size() to load image, so that backends
	such as the SVG one can render the image at an appropriate size.
	(load_pixbuf): same here.

2004-09-27  Mark McLoughlin  <mark@skynet.ie>

	Contains fix for icon scaling code from jamesh.

	* egg-recent-util.c: sync with libegg.

2004-09-24  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Kjartan Maraas in bug #153450

	* panel-compatibility.c:
	(panel_compatibility_detect_needs_migration): don't
	leak source path.

2004-09-21  James Henstridge  <james@jamesh.id.au>

	* panel-addto.c (panel_addto_make_pixbuf): use
	gdk_pixbuf_new_from_file_at_size() to give the loader a hint about
	the size we want to load the image at.  If the image is still too
	large, scale it down to fit.
	(panel_addto_make_applet_model): update to pass in the desired
	GtkIconSize for the icon rather than a pixel size.
	(panel_addto_make_application_model_r): same here.
	Fixes bug #153135.

2004-09-16  Mark McLoughlin  <mark@skynet.ie>

	Sync with libegg:

	* libegg/recent-files/egg-recent-model.c:
	(egg_recent_model_monitor): don't pass a local
	path as a URI - otherwise we crash when people
	use $HOME=/ and we pass "//.recently-used" to
	gnome-vfs. Bug 152832

2004-09-16  Mark McLoughlin  <mark@skynet.ie>

	Fixes to make 2.2 -> 2.4/6/8 migration work again - it broken
	when I installed the default setup into /apps/panel/profiles/default
	as well as /apps/panel/default_setup

	* panel-compatibility.c:
	(panel_compatibility_migrate_panel_id): migrate toplevel_id
	whether its already set or not.
	(panel_compatibility_detect_needs_migration): nice bug ugly
	hack to check if toplevel_id_list is set in the user's
	source.

2004-09-15  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Padraig O'Briain <padraig.obriain@sun.com>
	in bug #138535
	
	* panel-menu-button.c:
	(panel_menu_button_menu_detacher): remove workaround for bug #113112
	(panel_menu_button_create_menu): re-create the menu here if needs be.
	(panel_menu_button_accessible_*): add an AtkObject implementation
	so we can create the menu when get_n_children() is called.
	
	* panel-a11y.[ch]:
	(panel_a11y_get_is_a11y_enabled): rename from is_gail_loaded()
	and make public.
	(panel_a11y_query_accessible_parent_type): implement standard
	ugly hack to inherit from an object in gail without linking
	against	gail.
	
2004-09-14  Mark McLoughlin  <mark@skynet.ie>

	Fix for https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=131868
	where trying to drag a locked applet caused autohide to stop working.

	* panel-widget.c: (panel_widget_applet_drag_start): pop the autohide
	disabler if we fail to start the drag. 

2004-09-14  Mark McLoughlin  <mark@skynet.ie>

	Fix for bug #148672 - freakiness with auto-hide and snap-to.

	* panel-toplevel.c: (panel_toplevel_update_auto_hide_position):
	When auto-hidden, snap to the screen edge too.

2004-09-14  Mark McLoughlin  <mark@skynet.ie>

	Fix for bug #144281 - auto-hide panel sometimes not hiding
	when a drawer closes. Based on a patch from Arvind.

	* panel-toplevel.c:
	(panel_toplevel_push_autohide_disabler): queue an unhide if this
	is the first one pushed.
	(panel_toplevel_pop_autohide_disabler): queue a hide if this is
	the last one popped.
	
2004-09-14  Mark McLoughlin  <mark@skynet.ie>

	Consolidate some code - we don't need two ways to temporarily
	disable auto-hiding.
	
	* panel-toplevel.[ch]:
	(panel_toplevel_unblock_auto_hide),
	(panel_toplevel_unblock_auto_hide): remove this and use the disabler
	stack for everything.
	(panel_toplevel_auto_hide_timeout_handler):
	(panel_toplevel_queue_auto_hide),
	(panel_toplevel_instance_init): update to use the disabler stack.
	
	* applet.c, panel-action-protocol.c, panel-addto.c,
	  panel-menu-button.c, panel-properties-dialog.c, panel-widget.c,
	  panel.c: update to use the disabler stack.

2004-09-14  Mark McLoughlin  <mark@skynet.ie>

	Fix for bug #136074 - weird autohiding behaviour when
	you change the orientation of an unexpanded panel.

	* panel-toplevel.c: (panel_toplevel_set_orientation): un-snap
	from the center of the screen if we rotate the panel.

2004-09-14  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Arvind in bug #128412.

	* panel-toplevel.c:
	(panel_toplevel_auto_hide_timeout_handler),
	(panel_toplevel_auto_unhide_timeout_handler): clear the source
	ids when running the handler for the last time.

==================== 2.8.0 ====================

==================== 2.7.92.1 ====================

==================== 2.7.92 ====================

2004-08-30  Vincent Untz  <vincent@vuntz.net>

	* panel-run-dialog.[ch]: (panel_run_dialog_present_with_text) killed
	since it's not used anymore

2004-08-26  Kjartan Maraas  <kmaraas@gnome.org>

	* menu.c: (append_log_out): NULL vs 0.
	* nothing.cP: Same here.
	* panel-profile.c: (panel_profile_toplevel_screen_changed):
	Same here.
	* panel-widget.c: (panel_applet_is_in_drag): ANSIfication.
	* panel-widget.h: Use guint in single value bitfield
	* panel.c: (drag_drop_cb): NULL vs. 0

2004-08-25  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: (panel_toplevel_contains_pointer): Fix
	multiscreen issue where we were incorrectly returning TRUE
	under some circumstances when the pointer was actually on
	a different screen from the panel. bug #148703

2004-08-23  Kjartan Maraas  <kmaraas@gnome.org>

	* panel-profile.c: (panel_profile_load_object): Plug a leak.
	Closes bug #150685.

==================== 2.7.91.1 ====================

2004-08-18  Elijah Newren  <newren@math.utah.edu>

	Make sure "Run Application" dialog gets focused when invoked via
	the window manager keybinding.  Fixes #150271.

	* gnome-panel/panel-action-button.c (panel_action_run_program):
	pass a timestamp to panel_run_dialog_present

	* gnome-panel/panel-action-protocol.c
	(panel_action_protocol_run_dialog): make this function take a
	timestamp and pass it to panel_run_dialog_present,
	(panel_action_protocol_filter): get the timestamp passed by
	Metacity and pass it to panel_action_protocol_run_dialog

	* gnome-panel/panel-run-dialog.[ch] (panel_run_dialog_new): make this
	function take a timestamp, and set the _NET_WM_USER_TIME of the
	dialog to the value of this timestamp, (panel_run_dialog_present):
	make this function take a timestamp, and either set the
	_NET_WM_USER_TIME of the dialog to the value of this timestamp or
	pass the timestamp to panel_run_dialog_new,
	(panel_run_dialog_present_with_text): make this function take a
	timestamp and pass it to panel_run_dialog_present

	# gnome-panel/panel-xutils.[ch]
	(panel_gdk_x11_window_set_user_time): Add this temporary function
	which updates the _NET_WM_USER_TIME field, since
	gdk_x11_window_set_user_time doesn't exist in gtk+-2.4.x.

2004-08-17  Mark McLoughlin  <mark@skynet.ie>

	* egg-recent-item.c, egg-recent-view-gtk.c: Sync to
	latest libegg.

==================== 2.7.91 ====================

2004-08-16  Mark McLoughlin  <mark@skynet.ie>

	Hopefully fix bug #149244 - root cause identified through
	debugging from virgo@teleportsv.net and Vincent Untz.

	* panel-applet-frame.c:
	(panel_applet_frame_finalize): disconnect from the broken
	signal and release the control.
	(panel_applet_frame_construct): use ORBit_small_listen_for_broken()
	instead of manually connecting to signal and inevitably screwing
	it up by naively using g_signal_connect_object().

2004-08-11  Mark McLoughlin  <mark@skynet.ie>

	Fix for nested drawer craziness reported at:
	https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=127488

	* panel-toplevel.c:
	(panel_toplevel_focus_in_event): only unhide if its autohidden.

2004-08-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-addto.c: (panel_addto_append_internal_applets): set the
	action type before appending.

2004-08-11  Mark McLoughlin  <mark@skynet.ie>

	Partly based on a patch from Vinay M R <vinay.mandyakoppal@wipro.com>
	in bug #143554. Original bug was that some strings were out of sync,
	but hopefully this re-work simplifies the code and prevents stuff
	getting out of sync in future.

	* panel-action-button.[ch]:
	(panel_action_get_is_disabled),	(panel_action_get_stock_icon),
	(panel_action_get_text), (panel_action_get_tooltip),
	(panel_action_get_drag_id): add the tooltip and drag id to
	the actions table. Add various accessor functions to the table.
	
	* menu.c: (append_lock_screen), (append_log_out),
	(create_root_menu): get the text, tooltip, drag id and stock
	icon from the actions table.
	
	* panel-addto.c:
	(panel_addto_append_internal_applets): construct the list of
	action buttons by iterating over the actions table.

	* panel-menu-bar.c:
	(panel_menu_bar_append_action_item): obtain various bits
	for the menu item from the actions table.

2004-08-11  Kjartan Maraas  <kmaraas@gnome.org>

	* drawer.c: (drag_drop_cb): Fix NULL vs 0 confusion.
	* launcher.c: (launcher_get_screen), (drag_drop_cb): Same
	Closes bug #149833. Yay for sparse.

2004-08-10  Christian Neumair  <chris@gnome-de.org>

	* Makefile.am: Remove panel preferences dialog, cleanup LIBS/CFLAGS
	naming for screenshot dialog.

	* gnome-panel-preferences.c:
	* gnome-panel-preferences.desktop.in:
	* gnome-panel-preferences.glade: Delete.

	Fixes #98911.

2004-08-10  Mark McLoughlin  <mark@skynet.ie>

	* egg-recent-model.c: (egg_recent_model_open_file): sync
	with libegg.

==================== 2.7.90 ====================

2004-08-09  Mark McLoughlin  <mark@skynet.ie>

	* panel-recent.c: (recent_documents_clear_cb): fix silly type-punned
	pointer warning.

2004-08-09  Mark McLoughlin  <mark@skynet.ie>

	Patch from Sagar Rastogi <rastogi@students.iiit.net> bug #143700

	* menu.c: (panel_menu_key_press_handler): make the menu key popup
	the panel context menu.

2004-08-08  Bryan Clark  <clarkbw@cvs.gnome.org>

	* gnome-panel-screenshot.c (take_window_shot): use window title
	name for screenshot file instead of window class name.  
	see bug 149353

2004-08-04  Vincent Untz  <vincent@vuntz.net>

	* menu.c: (create_panel_context_menu): change the mnemonic for
	"About Panels" so it doesn't conflict with "Add to panel..."

2004-08-04  Christian Neumair  <chris@gnome-de.org>

	* menu-fentry.h:
	* menu.c:
	* menu.h:
	* panel-menu-button.c: Remove remaining bits of add launcher menu.
	Fixes #145014.

2004-08-03  William Jon McCann  <mccann@jhu.edu>

	* panel-recent.c (recent_documents_clear_cb):
	Revise the confirmation dialog text.  Fixes #148754.

2004-08-03  Kjartan Maraas  <kmaraas@gnome.org>

	* egg-recent-item.c: (egg_recent_item_new),
	(egg_recent_item_get_short_name), (egg_recent_item_set_private),
	(egg_recent_item_get_private):
	* egg-recent-item.h:
	* egg-recent-model.c: (egg_recent_model_lock_file),
	(egg_recent_model_unlock_file):
	* egg-recent-util.c: (egg_recent_util_get_icon):
	* egg-recent-view.h: Update from libegg.

2004-08-03  Kjartan Maraas  <kmaraas@gnome.org>

	* drawer.c: (create_drawer_toplevel): Don't free stuff
	before use. Partial fix for bug #149151. There's more to do there.

2004-07-30  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-widget.c: (bind_top_applet_events): For the
	button-press-event do a g_signal_connect () 
	instead of a g_signal_connect_after ().
	This event was not going through PanelWidget 
	because of which the actual widgets were getting 
	the events. Thus exhibiting strange behaviours.
	Fixes #147623, #143908,#145288 etc

==================== 2.7.4.1 ====================

2004-07-20  Mark McLoughlin  <mark@skynet.ie>

	Patch from William Jon McCann <mccann@jhu.edu> in bug #105639.

	* panel-recent.c (clear_dialog_response): 
	(clear_dialog_destroy): 
	(recent_documents_clear_cb):
	(panel_recent_append_documents_menu): 
	Add item to Recent Documents menu to clear the history.
	(panel_recent_model_changed_cb): Make the menu insensitive
	if no recent items are available.
	
	* panel-stock-icons.[ch]: add a new "clear" stock icon just so
	we can have a different mnemonic from GTK_STOCK_CLEAR. Suck.

==================== 2.7.4 ====================

==================== 2.7.3 ====================

2004-07-06  Mark McLoughlin  <mark@skynet.ie>

	Fixes "Invalid read of size 1" thrown up by valgrind.
	Report from Kjartan Maraas in bug #144460.

	* panel-profile.[ch]:
	(panel_profile_set_toplevel_id),
	(panel_profile_add_to_list),
	(panel_profile_load_toplevel),
	(panel_profile_load_and_show_toplevel),
	(panel_profile_load_object): make memory ownership easier
	to understand by making all these functions take a
	const string id.
	(panel_profile_create_toplevel),
	(panel_profile_load_added_ids),
	(panel_profile_delete_removed_ids),
	(panel_profile_load_list): free the ids in all the right
	places.
	
	* applet.[ch]: (panel_applet_queue_applet_to_load): similarily,
	make this take const sting ids and make a copy of them.

	* drawer.c, launcher.c, panel-action-button.c,
	  panel-applet-frame.c, panel-compatibility.c, panel-menu-bar.c:
	free the ids in all the right places.

2004-06-23  Dennis Cranston <dennis_cranston at yahoo com>

	* panel-addto.c: (panel_addto_dialog_new): Use HIG border spacing.
	
2004-06-23  Leena Gunda  <leena.gunda@wipro.com>

	* panel-toplevel.c: (panel_toplevel_is_last_unattached):
	Return FALSE if the panel is attached to a widget.
	Fixes bug #143423.
	
2004-06-22  Vincent Untz  <vincent@vuntz.net>

	New add to dialog!
	The original work was done by Iain Holmes <iain@prettypeople.org>.

	* Makefile.am: add panel-addto.c to panel_sources and panel-addto.h to
	panel_headers
	* menu.c:
	(add_bonobo_applet), (make_add_submenu), (setup_applet_drag),
	(add_drawer_to_panel), (add_action_button_to_panel),
	(add_menu_bar_to_panel), (applet_menu_get_category_icon),
	(applet_menu_append), (applet_menu_append_category),
	(Bonobo_ServerInfoList_equals), (recheck_applet_list),
	(menu_item_destroyed), (instrument_add_submenu_for_reload),
	(applet_info_sort_func), (append_internal_applets),
	(create_applets_menu), (ask_about_launcher_cb), (make_add_submenu):
	removed all the code concerning the 'addto' stuff. Some code is moved
	to panel-addto.c
	(make_panel_submenu): add an ellipse to the "Add to Panel" since this
	now opens a dialog, just connect the menu item to the right function
	instead of building a submenu. Yeah!
	* panel-addto.[ch]: A new 'addto' dialog !!!

	* panel-menu-button.c: (panel_menu_button_create): small fix to avoid
	a GConf warning if there's no tooltip provided

2004-06-09  Christian Neumair  <chris@gnome-de.org>

	* menu-fentry.c: (get_presorted_from), (fr_fill_dir), (fr_read_dir),
	(fr_check_and_reread):
	* menu.c: (add_drawers_from_dir):
	* panel-menu-button.c: (panel_menu_button_get_icon_for_menu_path):
	* quick-desktop-reader.[ch]: Remove expected_type parameter from
	quick_desktop_item_load_uri. All calls pass NULL. Fixes #143965.

==================== 2.7.1 ====================

2004-06-02  Christian Neumair  <chris@gnome-de.org>

	* menu.c: Remove add to run dialog from launcher context menu.
	Partially fixes #140201.

2004-06-02  Mark McLoughlin  <mark@skynet.ie>

	* applet.[ch]:
	(panel_applet_lock), (panel_applet_create_menu),
	(panel_applet_register): Allow all other panel objects to be
	removed even when locked.

2004-06-02  Mark McLoughlin  <mark@skynet.ie>

	Patch from  Christian Neumair <chris@gnome-de.org> in bug #142605.
	
	* panel-applet-frame.c: (panel_applet_frame_sync_menu_state): Allow
	applets to be removed even when locked.

2004-06-02  Mark McLoughlin  <mark@skynet.ie>

	Patch from Chris Lahey <clahey@ximian.com> in bug #138720
	to fix a crash while menu editing.

	* menu-fentry.c: (fr_free), (fr_fill_dir), (fr_replace):
	Fixup to make sure FileRec::parent is updated correctly. 

2004-05-28  Mark McLoughlin  <mark@skynet.ie>

	* panel-recent.c: (show_uri),
	  panel-run-dialog.c: (panel_run_dialog_append_file_utf8),
	  panel.c: (drop_nautilus_uri): fix some problems with
	filename quoting.

2004-05-18  Frank Worsley  <frank@neatstep.com>

	reviewed by: Mark McLoughlin

	* panel-run-dialog.c: Add tab-completion for files and 
	directories with absolute paths	or relative to the home directory.

2004-05-14  Padraig O'Briain  <padraig.obriain@sun.com>

	* gnome-panel-screenshot.c: Use idle handler instead of sleep to 
	implement delay. This prevents the desktop freezing when delay
	option is used when accessibility is enabled. Fixes bug #142397.

2004-05-13  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Vinay M R <vinay.mandyakoppal@wipro.com>
	in bug #141796.

	* drawer.c:
	(set_tooltip_and_name): split out tooltip setting to here
	and unset the tooltip correctly if empty.
	(create_drawer_applet),	(panel_drawer_tooltip_changed): upd.

2004-05-13  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.c: (update_window_icon): remove
	assertion. Fixes bug #140921.

2004-04-21  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Shakti Sen <shprasad@novell.com>
	in bug #139465.

	* panel-toplevel.c (panel_toplevel_update_attached_position):
	Do not allow the panel to move offscreen - fixes problem where
	a drawer could be half offscreen.

2004-05-13  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Vincent Berger <vincent.berger@ext.bull.net>
	in bug #137380.
	
	* panel-util.[ch]: (panel_make_unique_uri): return a uri rather than
	a path.

	* launcher.c:
	(panel_launcher_save_ditem),
	(panel_launcher_create_copy): update.
	
	* panel-run-dialog.c: (pixmap_drag_data_get): update.

2004-05-13  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch by Mariano Suárez-Alvarez <msuarezalvarez@arnet.com.ar>
	in bug #135885.

	* gnome-panel-screenshot.c: (escape_underscores), (main):
	Translate the "Save screenshot in web page" string, being careful
	to escaped underscores in the path of the web dir.

2004-05-13  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Satvik Upadhyaya <satvik@students.iiit.net>
	in bug #107968.

	* launcher.c: (guess_icon_from_exec), (setup_button): if no icon
	is set, try and guess a sensible icon from the command name.

2004-05-13  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c: (calc_arrow), (button_widget_expose): use
	gtk_paint_arrow() to draw the little triangle on menu buttons
	rather than drawing a rectangle manually. Fixes bug #103342.

2004-04-21  Kaushal Kumar  <kaushal.kumar@wipro.com>

	* menu.c (show_panel_help): Set the help link id for
	menu.

2004-04-20  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.desktop.in: remove the
	.png suffix - bug #140190.

==================== 2.6.1 ====================

2004-04-08  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.schemas.in: make mostly transparent
	white the default background color (when you change
	to a color background). Solid black is sooo last week.

2004-04-07  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_load_idle_handler): fix issue
	with previous patch on expanded panels.

2004-04-07  Mark McLoughlin  <mark@skynet.ie>

	Fix to make things load in the correct order on
	non-expanded panels. Bug #122513.

	* applet.c:
	(panel_applet_load_idle_handler): if its a right stuck
	applet on a non-expanded panel, just load it at the
	end of the panel - we load them in the correct order.
	(panel_applet_compare): sort right stuck applets to
	the end.

2004-04-07  Frederic Crozat  <fcrozat@mandrakesoft.com>
                                                                                
	* gnome-panel/Makefile.am:
        Fix parallel build.

2004-04-05  Vijaykumar Patwari <vijaykumar.patwari@wipro.com>

	* launcher.h: Add a GSList to the Launcher struct to
	hold all the error dialogs.
	* launcher.c (launcher_register_error_dialog): populate
	the error dialog list and connect the dialog to the destroy
	signal.
	(launcher_widget_open_dialog_destroyed): on destroying an
	error dialog, remove it from the error dialog list.
	(launcher_widget_destroy_open_dialogs): on destroying
	the launcher, destroy any open error dialogs.
	Fixes bug #132272.

2004-04-02  Mark McLoughlin  <mark@skynet.ie>

	Some work on making things relatively sane for people trying
	to deply/lockdown the panel.

	* Makefile.am: install the default setup in
	/apps/panel/profiles/default as well as
	/apps/panel/default_setup.
	
	* panel-default-setup.entries: apply schemas to the keys
	we don't set as well as the ones we do.
	
	* panel-gconf.c: (panel_gconf_copy_dir): copy schema names as
	well as values.
	
	* panel-profile.c:
	(panel_profile_apply_schemas),
	(panel_profile_copy_defaults): kill these.
	(panel_profile_copy_defaults_for_screen),
	(panel_profile_load): no need to associate schemas when copying
	default_setup now, since we do that at install time.

2004-03-24  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.c,
	  panel-properties-dialog.c,
	  panel-run-dialog.c: don't try and load the glade
	file to from the current dir first. Was a useful hack
	for testing glade edits, but not the safest thing
	in the world to leave around long term. Bug #132286.

==================== 2.6.0 ====================

==================== 2.5.93 ====================

2004-03-12  Mark McLoughlin  <mark@skynet.ie>

	Make the file entry use a save mode file chooser. Fix
	for bug #136675 with help from Fernando Herrera.

	* gnome-panel-screenshot.glade: set the file entries
	"filechooser-action" property to "save".

==================== 2.5.92 ====================

2004-03-09  Alexander Larsson  <alexl@redhat.com>

	* panel-run-dialog.c (command_is_executable):
	Make sure the command to be launched is a regular file.
	This makes executable directories typed into the run dialog
	now work correctly.

2004-03-09  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-force-quit.c (display_popup_window): Set role to 
	ATK_ROLE_ALERT. Fixes bug #135571.

==================== 2.5.91 ====================

2004-03-01  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: (panel_toplevel_begin_grab_op): don't allow
	moving the panel when its hidden. Fixes uber weirdness when you
	do move hidden panel - bug #135876.

2004-02-28  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: (panel_toplevel_update_struts): remove some
	unused variables.

2004-02-28  Mark McLoughlin  <mark@skynet.ie>

	Makes moving launchers with button2 work again. Bug #134006.

	* button-widget.c: (button_widget_button_press): Don't assume
	GtkButton returns false if button != 1. Why? Because it doesn't,
	that's why.

2004-02-28  Rob Adams  <readams@readams.net>

	Some fixes for xinerama positioning and collision detection code.
	Fixes #112566.
	
	* panel-struts.c (panel_struts_set_window_hint): don't set the
	strut at all if not at a visible extreme.

	* panel-toplevel.c (panel_toplevel_calc_new_orientation): support
	xinerama properly.
	(panel_toplevel_update_struts): keep the struts updated even for
	internal edges; this way collision detection will work on these
	edges.
	(panel_toplevel_update_expanded_position): add the appropriate
	xinerama monitor offsets.

2004-02-28  Vincent Untz  <vincent@vuntz.net>

	* menu.c: (append_log_out): remove the username from the log out menu
	item
	* panel-menu-bar.c: (panel_menu_bar_append_actions_menu): ditto
	Fix bugs #131875, #134828. Reopen bug 130663.

2004-02-27  Mark McLoughlin  <mark@skynet.ie>

	Patch from Bart Martens in bug #127758 to stop the panel
	resizing slightly during autohide which caused some pretty
	icky visual problems.

	* panel-toplevel.c: (panel_toplevel_update_edges): Don't draw
	bevels on edges of the panel which aren't visible on screen
	instead of just edges which are flush against the screen edge.

==================== 2.5.90 ====================

2004-02-23  Mark McLoughlin  <mark@skynet.ie>

	* menu-fentry.c: (fr_check_and_reread): remove unused variable
	and fixup code that was correctly using it.

2004-02-22  Gustavo Giráldez  <gustavo.giraldez@gmx.net>

	* panel-menu-bar.c (panel_menu_bar_show_applications_menu): Set
	the panel widget when re-creating the applications menu because of
	a needed desktop entries reread (bug #133754).

2004-02-22  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Leena Gunda in bug #110939 to
	allow the size of the hide buttons to be themed, mainly
	to allow LargePrint themes to make the buttons bigger.

	* panel-toplevel.c:
	(panel_toplevel_add_hide_button),
	(panel_toplevel_update_hide_buttons): set the size request
	according the style's "arrow-size" value.
	(panel_toplevel_style_set): update the hide buttons when
	the theme changes.
	(panel_toplevel_class_init): register the "arrow-size"
	style property.

2004-02-20  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Bart Martens <info@bartmartens.be>

	* panel-toplevel.c: (panel_toplevel_queue_auto_hide): unqueue
	the unhide, even if the panel is already hidden. The actual
	bug that this fix was for was masked by a change which makes
	us refuse to unhide unless the panel contains the pointer.
	This is a better way of handling this particular case, though.

==================== 2.5.5 ====================

2004-02-16  Mark McLoughlin  <mark@skynet.ie>

	Fixup more modifier testing code to use
	gtk_accelerator_get_default_mod_mask() as Federico points
	out in bug #134134.

	* drawer.c: (key_press_drawer), (key_press_drawer_widget):
	* menu.c: (panel_menu_key_press_handler):
	* panel-toplevel.c: (panel_toplevel_move_keyboard_floating),
	(panel_toplevel_handle_grab_op_motion_event):
	* panel.c: (panel_key_press_event):
	Use gtk_accelerator_get_default_mod_mask() when testing
	modifiers.

2004-02-16  Mark McLoughlin  <mark@skynet.ie>

	Resolve the mystery of the disappearing applets. Fix for
	bug #128567 based on a patch from Leena gunda.

	* applet.c: (panel_applet_register): if adding at the
	saved position fails, try adding at the beginning of the
	panel.

2004-02-16  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (panel_key_press_event): correctly fix bug #134134
	so as to trigger *only* with Ctrl-F10.

2004-02-16  Mark McLoughlin  <mark@skynet.ie>

	Fix a couple of occurrences where menu items were disabled when
	they should have been enabled. Based on a patch from Srinivasa
	Ragavan in bug #132971.

	* drawer.c:
	(drawer_properties_enabled): impl.
	(load_drawer_applet): use this instead of get_locked_down()
	
	* panel-action-button.c:
	(screensaver_enabled): impl.
	(panel_action_lock_setup_menu): use this instead of get_disable_lock_screen().

2004-02-16  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c: (button_widget_class_init):
	* panel-action-button.c: (panel_action_button_class_init):
	* panel-frame.c: (panel_frame_class_init):
	* panel-menu-button.c: (panel_menu_button_class_init):
	* panel-toplevel.c: (panel_toplevel_class_init): Don't mark
	property descriptions for translation as discussed on d-d-l.

2004-02-16  Srinivasa Ragavan <sragavan@novell.com>
	* panel.c: (panel_key_press_event): Follow the guidelines for robust application, in www.gnome.org site.
	Fix for the bug #134134

2004-02-14  Vincent Untz  <vincent@vuntz.net>

	* panel-widget.c: fix applet moving, so that it doesn't break Fitt's
	law.
	Temporary fix for bug #123763.

2004-02-12  Mark McLoughlin  <mark@skynet.ie>

	Patch from Shaun McCance <shaunm@gnome.org>

	* applet.c: (applet_callback_callback):
	* gnome-panel-preferences.c: (preferences_response):
	* gnome-panel-screenshot.c: (on_help_button_clicked):
	* launcher.c: (window_response), (really_add_launcher):
	* menu-ditem.c: (ditem_properties_clicked):
	* menu.c: (show_panel_help):
	* panel-action-button.c: (panel_action_button_invoke_menu):
	* panel-menu-bar.c: (panel_menu_bar_invoke_menu):
	* panel-menu-button.c: (panel_menu_button_invoke_menu):
	* panel-properties-dialog.c: (panel_properties_dialog_response):
	* panel-run-dialog.c: (panel_run_dialog_response): Update the
	help links to the new user-guide locations.

2004-02-11  Fernando Herrera  <fherrera@onirica.com>

	* panel-properties-dialog.glade: Use new FileChooser in
	GnomeFileEntry. Fix bug #134118

2004-02-06  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: revert a broken change committed
	without	discussion and without a ChangeLog entry.

==================== 2.5.4 ====================

2004-02-04  Mark McLoughlin  <mark@skynet.ie>

	Patch from Glynn in bug #130664 to change the
	Applications menu item to not use the non-descriptive
	GNOME foot. New icon designed by Jimmac.

	* panel-stock-icons.[ch]: register new "applications"
	stock icon.
	
	* menu.c: (create_root_menu): use it.

2004-02-04  Mark McLoughlin  <mark@skynet.ie>

	* egg-recent-item.[ch],
	  egg-recent-model.[ch],
	  egg-recent-view.[ch]: sync with libegg. Hopefull fixes
	bug #133257.

	* panel-recent.c: (panel_recent_append_documents_menu):
	Update for API changes.

2004-02-04  Padraig O'Briain  <padraig.obriain@sun.com>

	* drawer.c (create_drawer_applet): Set name to "Drawer".

	* panel-toplevel.c (panel_toplevel_add_hide_button): Set accessible
	name to "Hide Panel".

	Fix for bug #132854.

2004-02-04  Mark McLoughlin  <mark@skynet.ie>

	Don't use a mnemonic for the log out menu item lest we create
	a mnemonic with users that have underscode in their username.
	Fix for #133350 by Jordy Potman.

	* menu.c: (setup_full_menuitem): don't use new_with_mnemonic
	if use_invisible_mnemonic is TRUE.
	
2004-02-04  Mark McLoughlin  <mark@skynet.ie>
	
	* menu.c: 
	(append_lock_screen),
	(append_log_out): split out these
	(create_desktop_menu): from here ... to make things readable.
	(create_root_menu): upd.

2004-01-27  Mark McLoughlin  <mark@skynet.ie>

	* panel-util.[ch]: (panel_signal_connect_object_while_alive):
	Kill this, g_signal_connect_object() does the same thing.
	
	* button-widget.c: (button_widget_instance_init):
	* drawer.c: (drawer_query_deletion):
	* panel-widget.c: (panel_widget_register_open_dialog):
	* panel.c: (panel_query_deletion):
	Update to use g_signal_connect_object().

2004-01-27  Mark McLoughlin  <mark@skynet.ie>

	Based on patch from Fernando Herrera in bug #128375.

	* gnome-panel-screenshot.c: (update_window_icon),
	(icon_theme_changed), (set_window_icon), (main):
	Respect the icon theme for the window icon.

2004-01-27  Mark McLoughlin  <mark@skynet.ie>

	Fix for bug #129855 from Kristian Rietveld.

	* panel-background.c: (free_prepared_resources):
	Free background pixmap when we have a translucent
	colour background.

2004-01-27  Mark McLoughlin  <mark@skynet.ie>

	* panel-run-dialog.c: (panel_run_dialog_present):
	Revert unapproved commit.

2004-01-27  Jason Leach  <leach@wam.umd.edu>

	* menu.c (setup_remove_this_panel): Fix a bug that would
	desensitize the "Delete this panel" option for panels that were
	not actually locked down.
	(#132608, Malcolm Tredinnick)

2004-01-26  Jason Leach  <leach@wam.umd.edu>

	* panel-run-dialog.c (panel_run_dialog_present): Make sure the
	local copy of panel-run-dialog.glade (which the panel attempts to
	use before the installed copy) is a valid .glade file to prevent a
	crash. (#132286, Gavin Brown)

2004-01-23  Arvind Samptur <arvind.samptur@wipro.com>

	Patch from Leena Gunda <leena.gunda@wipro.com>

	* panel-run-dialog.c: (panel_run_dialog_update_content):
	Make the run dialog resizable only if both 
	enable_program_list and show_program_list are TRUE.
	Fixes bug #131211

2004-01-21  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c: (button_widget_expose): don't ref
	non-existant pixbufs.
	
	* panel-toplevel.c:
	(panel_toplevel_attach_to_widget),
	(panel_toplevel_detach): only push/pop an autohide
	disabler when the drawer isn't hidden.

2004-01-19  Mark McLoughlin  <mark@skynet.ie>

	Based on a patch from Matt Keenan <matt.keenan@sun.com>

	Add some more lockdown keys:
	
	  /desktop/gnome/lockdown/disable_command_line
	  /apps/panel/global/disable_log_out
	  /apps/panel/global/disable_lock_screen
	  /apps/panel/globak/disable_force_quit

	Also, consolidate the per-profile and per-panel "locked_down"
	keys into a single key:

	  /apps/panel/global/locked_down

	* Makefile.am: add panel-lockdown.[ch]

	* panel-lockdown.[ch]: utilities for reading and monitoring
	the lockdown keys.
	
	* applet.[ch]:
	(panel_applet_toggle_locked): don't handle lock toggling
	lockdown conditions - the toggle isn't visible when locked
	down.
	(panel_applet_recreate_menu): impl. re-creating the context
	menu.
	(panel_applet_add_callback): add an "is_enabled" callback
	so we can implement this in the applets themselves.
	(panel_applet_remove_callback): kill, unused.
	(panel_applet_create_menu): check if the item is enabled.
	Don't add remove/move/lock items if locked down.
	(panel_applet_destroy): remove the lockdown notification.
	(panel_applet_register): add the lockdown notification.

	* button-widget.[ch]: implement an "activatable" property
	and grey out the button if its not activatable.

	* drawer.c: (load_drawer_applet): only have propertis menu
	item if not locked down.
	
	* launcher.c:
	(launcher_properties): shouldn't be reached if locked down.
	(lancher_properties_enabled), (load_launcher_applet): don't
	enable launcher properties if not locked down and
	disable_command_line isn't set.
	
	* menu.c:
	(show_item_menu): don't show the menu's context menu if
	locked down.
	(setup_full_menuitem), (setup_applet_drag),
	(setup_internal_applet_drag): disable dnd if locked down.
	(append_internal_applets): decide which action buttons to
	have in the menu depending on disable_command_line etc.
	(create_applets_menu): only add if the applet isn't in
	the disabled_applets list.
	(create_desktop_menu): respect disable_log_out etc.
	
	* panel-action-button.c: grey out any action button that should
	be disabled.

	* panel-applet-frame.c: respect changes in the lockdown keys.

	* panel-global.schemas.in: add new lockdown keys.
	
	* panel-menu-bar.c: respect the lockdown keys when creating
	the menus.

	* panel-menu-button.c: ditto.

	* panel-profile.[ch]: remove per-profile and per-toplevel
	locked_down keys.

	* panel-run-dialog.c: (panel_run_dialog_present): don't show
	the run dialog if locked down.
	
	* panel-toplevel.c: (panel_toplevel_begin_grab_op): don't
	allow moving the panel if locked down.
	
	* panel-toplevel.schemas.in: remove per-panel locked_down
	key.
	
	* panel.c: respect the locked_down key when creating the
	panel context menu.

2004-01-16  Mark McLoughlin  <mark@skynet.ie>

	Patch from The Written Word in bug #131609.
	
	* gnome-panel-screenshot.c: (main): don't initialize
	with a non-constant address.
	
	* button-widget.c, panel-applet-frame.c,
	  panel-compatibility.c, panel-enums.h,
	  panel-toplevel.c, panel-xutils.h,
	  panel.c: remove trailing commas from enums.
	
	* panel-menu-bar.c: remove unsused enum.
	
	* panel-profile.c: (panel_profile_get_commit_timeout),
	  quick-desktop-reader.c: (guess_encoding):
	don't return const ints.

==================== 2.5.3.1 ====================

==================== 2.5.3 ====================

2004-01-13  Ross Burton  <ross@burtonini.com>

	* panel-run-dialog.glade: Inset the application list.

2004-01-07  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-run-dialog.glade: Set accessible name on GnomeEntry instead of
	its GtkEntry. Fixes bug #126254.

2004-01-07  Balamurali Viswanathan <balamurali.viswanathan@wipro.com>

	* launcher.c: (really_add_launcher): Don't allow creation of empty 
	launcher. Fixes bug #126969

2004-01-06  Vincent Untz  <vincent@vuntz.net>

	* panel-default-setup.entries: panel size in the default setup should
	be 24px.
	Fix bug #120214.

2004-01-06  Vincent Untz  <vincent@vuntz.net>

	* menu.c: (create_desktop_menu): add the username to the log out menu
	item (and its tooltip).
	* panel-menu-bar.c: (panel_menu_bar_append_actions_menu): ditto
	Fix bug #130663.

2003-12-16  Mark McLoughlin  <mark@skynet.ie>

	Fix occassional problem where button 2 clicking on an applet
	caused both the applet and the panel to be moved.
	See bug #123819.

	* panel-widget.c:
	(panel_widget_applet_button_press_event),
	(panel_widget_applet_button_release_event),
	(panel_widget_applet_motion_notify_event),
	(panel_widget_applet_key_press_event): split these out from
	panel_widget_applet_event().
	(bind_top_applet_events): make the button_press handler the
	last in the chain so we stop the propogation of the event.

2003-12-15  Glynn Foster  <glynn.foster@sun.com>

	* panel-stock-icons.c: Use gnome-other.png for the panel context
	menu 'Actions' submenu, at least until a better one is found.

2003-12-15  Glynn Foster  <glynn.foster@sun.com>

	* menu.c: Mark a string for translation. No brainer.

2003-12-13  Vincent Untz  <vincent@vuntz.net>

	* egg-recent-item.[ch]:
	* egg-recent-model.[ch]:
	* egg-recent-view.[ch]: sync with libegg.
	* panel-recent.c: (panel_recent_append_documents_menu): update to use
	new API

2003-12-12  Mark McLoughlin  <mark@skynet.ie>

	* panel-default-setup.entries: Fix a minor typo:
	s/bonobo_iid_type/bonobo_iid/

2003-12-11  Vincent Untz  <vincent@vuntz.net>

	Based on a patch from Jan Arne Petersen  <jpetersen@uni-bonn.de>
	Fix bug #128636

	* panel-run-dialog.c: (panel_run_dialog_destroy),
	(file_button_browse_response), (file_button_clicked): replace
	GtkFileSelection with GtkFileChooser
	(file_button_browse_ok), (file_button_browse_cancel): kill

2003-12-11  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c:
	* panel-util.c: kill gnome-help.h and gnome-url.h includes.

2003-12-10  Vincent Untz  <vincent@vuntz.net>

	* panel-run-dialog.c: (panel_run_dialog_fill_executables_from): don't
	add subdirectories of $PATH in the list used for command
	autocompletion.
	Fix bug #128876.

2003-12-10  Mark McLoughlin  <mark@skynet.ie>

	Use the new multiscreen support for application launching
	in libgnomeui and gdk instead of the egg-screen stuff.

	* Makefile.am: don't build the egg-screen stuff
	anymore.
	* egg-screen-exec.[ch], egg-screen-help.[ch],
	  egg-screen-url.[ch]: kill.
	
	* panel-multiscreen.[ch]: (panel_make_environment_for_screen):
	Add this - its not public in GDK.
	
	* launcher.c, menu.c, panel-action-button.c, panel-action-protocol.c,
	  panel-recent.c, panel-run-dialog.c, panel-toplevel.c, panel-util.c:
	Replace egg-screen stuff with the functions that ended up in
	libgnomeui and gdk.

2003-12-10  Vincent Untz  <vincent@vuntz.net>

	Patch from Thomas Benson <tbenson@cs.utk.edu>
	Fix bug #128130.

	* panel-run-dialog.c: (panel_run_dialog_execute): check that the
	command was successfully converted from UTF-8.

==================== 2.5.2 ====================

2003-12-09  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: distcheck fixes.

2003-12-04  Vincent Untz  <vincent@vuntz.net>

	* panel-util.c: (create_icon_entry), (create_text_entry), (updated):
	kill these functions because they're not used anywhere anymore
	* panel-util.h: remove create_icon_entry and create_text_entry here too

2003-12-03  Mark McLoughlin  <mark@skynet.ie>

	Be a bit more paranoid about removing directories from
	the GConfClient cache - especially directories we want
	to get deleted.

	* panel-profile.c: (panel_profile_delete_dir): remove all the
	added dirs from the client.

	* panel-menu-button.c: Don't keep a pointer to the AppletInfo
	when all we need from it is the applet id.
	(panel_menu_button_disconnect_from_gconf): implement a function
	to remove the notify and the dir from the client.
	
	
	* main.c: (main): use gconf_client_add_dir() instead of
	panel_gconf_add_dir().
	
	* panel-gconf.[ch]: (panel_gconf_add_dir): kill this. Its only
	useful if we want a pointless extra stack frame.

2003-12-03  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-properties-dialog.glade: Add labelled-by relation for size_spin.
	Fixes bug #128439.

2003-12-02  Vincent Untz  <vincent@vuntz.net>

	* gnome-panel-screenshot.c: (add_file_to_path) build some strings with
	g_strdup_printf() to help translators.
	(add_file_to_path), (gimme_file), (on_ok_button_clicked): move the
	expand tilde stuff from gimme_file() to add_file_to_path() and
	on_ok_button_clicked() to avoid a small bug where ~ was used in the
	web_dir key, e.g.
	(main): simplify a bit the web_dir stuff.

2003-12-01  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-button.c: (panel_menu_button_handle_event): kill
	(panel_menu_button_clicked): don't call
	panel_menu_button_handle_event() and call directly
	panel_menu_button_popup_menu() instead.
	(panel_menu_button_pressed): ditto, and don't pretend this is a mouse
	click that created the menu popup.
	Fix bug #108645.

2003-12-01  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_block_auto_hide),
	(panel_toplevel_unblock_auto_hide), (panel_toplevel_instance_init):
	use a counter instead of a boolean to know if the auto-hiding stuff is
	blocked. This fixes a misbehaviour when there are multiple concurrent
	reasons to block the auto-hide.
	Fix bug #128126.

2003-12-01  Vincent Untz  <vincent@vuntz.net>

	* panel-recent.c: (panel_recent_append_documents_menu):
	s/Open Recent/Recent Documents/
	Fix bug #98905.

2003-11-28  Vincent Untz  <vincent@vuntz.net>

	Use gdk_screen_get_monitor_at_point() instead of
	panel_multiscreen_locate_coords()
	Thanks to Chuan-kai Lin <linchuan@cse.ogi.edu> for the idea.
	Fix bug #127328.
	
	* panel-multiscreen.[ch]: (panel_multiscreen_locate_coords) kill
	* menu-util.c: (panel_standard_menu_pos)
	* menu.c: (menu_on_screen)
	* panel-toplevel.c: (panel_toplevel_calc_new_orientation),
	(panel_toplevel_move_to), (panel_toplevel_update_expanded_position):
	s/panel_multiscreen_locate_coords/gdk_screen_get_monitor_at_point/

2003-11-27  Vincent Untz  <vincent@vuntz.net>

	* panel-applet-frame.c: (panel_applet_frame_cnx_broken),
	(panel_applet_frame_loading_failed): build some strings to ease
	translators' work.
	Fix bug #124960.

	* gnome-panel-screenshot.c: remove a useless #ifdef HAVE_PAPER_WIDTH

2003-11-23  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.glade,
	  gnome-panel-screenshot.c: (on_ok_button_clicked), (main):
	Remove old crufty print support.

2003-11-23  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.c: include gnome-vfs-utils.h.
	(gimme_file): don't take a const char*.

2003-11-23  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (applet_info_sort_func): use g_utf8_collate instead
	of strcmp() for sorting so we respect the locale's collation
	order.

2003-11-20  Vincent Untz  <vincent@vuntz.net>

	* gnome-panel-screenshot.c: (gimme_file) expand filenames with a tilde
	when saving the screenshot.
	Fix bug #110404.

2003-11-20  Vincent Untz  <vincent@vuntz.net>

	* gnome-panel-screenshot.c: (take_window_shot) don't call
	gdk_pixbuf_get_has_alpha() in the loop but before the loop.

2003-11-20  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_auto_unhide_timeout_handler): do
	not stop unhiding the panel if the cursor is not in the panel but the
	auto_hide property is FALSE. Fix behaviour when you changed the
	auto_hide key in GConf and the panel did not unhide.
	(panel_toplevel_hide), (panel_toplevel_unhide): if the animation is
	disabled, do gtk_widget_hide/show only if the toplevel is a drawer.
	This fix a bug where a panel was totally hidden and the user could not
	bring it back to the screen.
	Fix bug #127439

2003-11-19  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.schemas.in: make short descriptions for screen and
	monitor keys a bit more explicit. Hopefully fix bug #114426.

2003-11-19  Vincent Untz  <vincent@vuntz.net>

	* gnome-panel-screenshot.c: (take_window_shot): don't crash when using
	the Shape extension and a window is out of screen.
	Fix bug #110008.

2003-11-19  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_focus_in_event): revert a
	change that I committed by accident.

2003-11-19  Vincent Untz  <vincent@vuntz.net>

	Patch from <linchuan@cse.ogi.edu>.
	Fix bug #125852.

	* panel-multiscreen.c: (panel_multiscreen_is_at_visible_extreme)
	* panel-toplevel.c: (panel_toplevel_update_expanded_position) use the
	monitor size and not the screen size to position the toplevel.

2003-11-19  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel.c: (panel_popup_menu): Pass the PanelToplevel
	instead of PanelWidget to gtk_menu_popup()
	Fixes #126904

2003-11-18  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-properties-dialog.glade: Add labelled-by relation for slider.
	Fixes bug #127301.

2003-11-14  Vincent Untz  <vincent@vuntz.net>

	* gnome-panel-preferences.c: (check_lockdown), (main): the locked_down
	key is "locked_down" and not "lock-down". We should get rid of
	this pref dialog before 2.6.

2003-11-14  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: (panel_toplevel_set_auto_hide_size):
	Remove invalid assertion.

2003-11-13  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-button.c: (panel_menu_button_set_tooltip) don't set the
	tooltip if the tooltip string is void.

2003-11-13  Padraig O'Briain  <padraig.obriain@sun.com>

	* drawer.c (create_drawer_applet): Add accessible name for drawer.
	Fixes bug #126724.

2003-11-13  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: (panel_toplevel_realize): Make
	sure PPosition WM_NORMAL_HINT is set to keep some
	WMs happy. Patch from olivier.chapuis@free.fr in
	bug #121987.

2003-11-13  Mark McLoughlin  <mark@skynet.ie>

	* panel-run-dialog.glade: make the expander label
	use the mnemonic. Fixes #126283.

2003-11-13  Mark McLoughlin  <mark@skynet.ie>

	* panel-action-button.c, panel-applet-frame.c,
	  panel-menu-bar.c, panel-toplevel.c,
	  panel-menu-button.c: use GObject instance
	private data.
	
	* panel-shell.[ch]: cut out a lot of unused crap.

2003-11-13  Mark McLoughlin  <mark@skynet.ie>
	
	* panel-profile.c: (panel_profile_delete_dir):
	Use gconf_client_recursive_unset() instead of
	panel_gconf_clean_dir(). It seems to work better
	anyway.
	
	* panel-gconf.[ch]: (panel_gconf_clean_dir): kill.
	
2003-11-13  Vincent Untz  <vincent@vuntz.net>

	* panel-menu-bar.c: (panel_menu_bar_invoke_menu): show the help
	speaking about menus instead of the help index

2003-11-13  Vincent Untz  <vincent@vuntz.net>

	Add a configurable tooltip to the menu buttons.
	Fixes bug #122303.
	* panel-menu-button.c: (panel_menu_button_instance_init),
	(panel_menu_button_finalize), (panel_menu_button_get_property),
	(panel_menu_button_set_property), (panel_menu_button_class_init),
	(panel_menu_button_gconf_notify),
	(panel_menu_button_connect_to_gconf), (panel_menu_button_set_tooltip),
	(panel_menu_button_load_from_gconf): we now have a tooltip property,
	so do all the stuff we need for a property.
	(panel_menu_button_instance_init): don't set a constant tooltip.
	(panel_menu_button_create): add a tooltip argument to specify the
	tooltip for the menu button.
	* panel-menu-button.h: reflected above changes here.
	* panel-object.schemas.in: updated the description for the tooltip key
	so it specifies the key is valid for drawer and menus.
	* menu.c: (add_menu_to_panel): updated to use the tooltip when calling
	panel_menu_button_create.
	(show_item_menu): updated the call to add_menu_to_panel
	* panel.c: (drop_menu) updated to use the tooltip when calling
	panel_menu_button_create.

	* panel-background.c: removed useless space in a string.

==================== 2.5.1 ====================

2003-11-11  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: use $(DISABLE_DEPRECATED_CFLAGS).

2003-11-07  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-properties-dialog.c: (panel_properties_dialog_new) :
	Block autohiding when the properites dialog is open.
	(panel_properties_dialog_destroy) : Unblock the autohiding when
	destroying the dialog.

	* panel.c: (panel_delete) : Block autohiding
	(panel_deletion_destroy_dialog): Unblock autohiding

	* panel-toplevel.c: (panel_toplevel_auto_unhide_timeout_handler):
	Don't unhide if we are not in the vicinity of the panel.
	Fix bug #122589

2003-11-06  Vincent Untz  <vincent@vuntz.net>

	* applet.c: (applet_callback_callback)
	* launcher.c: (setup_button), (launcher_show_help)
	* launcher.h:
	* menu.c: (show_help_on), (show_item_menu)
	* panel-util.c: (panel_show_gnome_help), (panel_show_kde_help),
	(panel_show_gnome_kde_help), (panel_help_error_quark), (panel_is_url)
	* panel-util.h:
	Remove old useless and dead code which was used for the "Show help on"
	stuff. Fix bug #124818.

2003-11-06  Vincent Untz  <vincent@vuntz.net>

	* panel-properties-dialog.glade: remove the bold label for the icon of
	the drawer.

2003-11-04  Mark McLoughlin  <mark@skynet.ie>

	* panel-multiscreen.c: (panel_multiscreen_init): remove the
	PANEL_FAKE_XINERAMA debugging thingy - gtk+ has the equivalent
	now with GDK_DEBUG=xinerama.

2003-11-03  Vincent Untz  <vincent@vuntz.net>

	Make the change background notification work for applets. Now there is
	one problem left: applets don't keep the new background and come back
	to a plain colour background.
	This fixes bugs #107617, #123092, #107146.
	Some parts of the patch are based on a patch from John Ellis
	<johne@bellatlantic.net>.

	* applet.c: (panel_applet_register): remove #ifdef FIXME_FOR_NEW_CONFIG
	to initialize the applet background.
	* panel-applet-frame.c:
	(panel_applet_frame_update_background_size): new function which updates
	the background pixmap if the size of the applet has changed.
	(panel_applet_frame_size_request): use above function.
	* panel-background.h: add a PanelBackgroundChangedNotify type and two
	variables to the PanelBackground structure so we can notify the panel
	of a background change.
	* panel-background.c: (panel_background_composite): notify the panel
	when the background changes.
	(panel_background_init): initialize some new PanelBackground variables
	with the new parameters.
	(panel_background_make_string): don't tell the background is a pixmap
	if the type is PANEL_BACK_NONE and use the pixmap xid instead of the
	window xid.
	* panel-widget.h: add back_change to PanelWidgetClass.
	* panel-widget.c: (panel_widget_class_init): add BACK_CHANGE_SIGNAL.
	(panel_widget_instance_init): add new parameters to
	panel_background_init.
	(panel_widget_background_changed): new function which is called when
	the background changes and emits BACK_CHANGE_SIGNAL.
	* panel.c: (back_change), (back_change_foreach), (panel_back_change):
	uncommented these functions.
	(panel_applet_added): remove FIXME_FOR_NEW_CONFIG so we call
	back_change.
	(panel_widget_setup): connect to the back_change signal.

2003-10-31  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-toplevel.c: (panel_toplevel_auto_unhide_timeout_handler):
	Reverting the changes done for 122589. It's breaking some things.

2003-10-31  Arvind Samptur  <arvind.samptur@wipro.com>

	* menu.c: (show_about_dialog): Adding Vincent and myself 
	to the list.

2003-10-31  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-toplevel.c: (panel_toplevel_auto_unhide_timeout_handler):
	Don't unhide if we are not in the vicinity of the panel.
	Fix bug #122589
	
2003-10-30  Vijaykumar Patwari <vijaykumar.patwari@wipro.com>

	* panel-widget.c: (panel_widget_applet_drag_start): block the 
	autohide when dragging objects on the panel.
	(panel_widget_applet_drag_end): enable autohide when dragging
	is done. Fix bug #122863
 
2003-10-28  Mark McLoughlin  <mark@skynet.ie>

	* panel-run-dialog.c, panel-run-dialog.glade: update to
	use GtkExpander.

2003-10-28  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: (panel_toplevel_attach_toplevel_hiding):
	Don't unhide drawers if they were originally hidden. Fixes
	bug #121382.

2003-10-28  Muktha  <muktha.narayan@wipro.com>

	* panel-properties-dialog.glade: Remove the bold labels.
	Fixes bug #110889.

2003-10-23  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: remove disclosure-widget.[ch] and remove
	the deprecated defines.
	
	* disclosure-widget.[ch]: kill.

2003-10-21  Vincent Untz  <vincent@vuntz.net>

	* menu-ditem.c: (ditem_properties_clicked), (ditem_properties_changed)
	(set_ditem_sensitive), (panel_edit_dentry), (panel_edit_direntry):
	set the Revert button insensitive when there is no revert action
	possible.

2003-10-20  Vincent Untz  <vincent@vuntz.net>

	* panel-properties-dialog.c: (panel_properties_dialog_opacity_changed):
	Set opacity to 0% or 100% when the value from the scale is something
	between 0% and 2% or between 98% and 100%. Thus we can really reach
	100%.
	Fix bug #123095.

2003-10-20  Vincent Untz  <vincent@vuntz.net>

	* panel-background-monitor.c: (panel_background_monitor_setup_pixmap):
	Don't assume gdk_property_get always works. Fix a crash.

2003-10-15  Vincent Untz  <vincent@vuntz.net>

	* button-widget.c: (button_widget_class_init)
	* panel-action-button.c:  (panel_action_button_class_init)
	* panel-menu-button.c: (panel_menu_button_class_init)
	s/Drag N' Drop/Drag and drop/ as discussed in bug #119067.

2003-10-14  Vincent Untz  <vincent@vuntz.net>

	* menu.c: (make_panel_submenu): use GTK_STOCK_DELETE instead of
	GTK_STOCK_REMOVE for "Delete This Panel" item.
	Fix bug #92288.

2003-10-14  Vincent Untz  <vincent@vuntz.net>

	* panel-action-button.c: there is help available for the run,
	search, screenshot and force quit buttons. So we should use it.
	Fix bug #118303.

2003-10-14  Vincent Untz  <vincent@vuntz.net>

	* panel-toplevel.c: (panel_toplevel_move_to): never have a
	vertically centered horizontal panel nor a horizontally centered
	vertical panel.
	Fix bug #108471.

2003-10-14  Vincent Untz  <vincent@vuntz.net>

	* button-widget.c: (button_widget_class_init) s/DnD/Drag N' Drop/.
	Fix bug #119067.

2003-10-13 Owen Taylor <otaylor@redhat.com>

	* gnome-panel/panel-stock-icons.c (panel_init_stock_icons):
	Look up default images for stock icons at an arbitrary large 
	size, so that we always scale down, from the biggest image
	we have available, instead of sometimes scaling up. (#124230)
	
2003-10-13  Padraig O'Briain  <padraig.obriain@sun.com>

        * panel-action-button.c (panel_action_button_set_type): Set
        accessible name and descriptions (bug #124218)

2003-10-13  Vincent Untz  <vincent@vuntz.net>

	* menu.c: (create_menuitem) use the themed folder icon instead of a
	non-themed folder icon.
	Fix bug #122796.

	* panel.c: (drop_directory) same here.

2003-10-09  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-toplevel.c : (panel_toplevel_push_autohide_disabler)
	(panel_toplevel_pop_autohide_disabler) : Use them to increment and 
	decrement the open drawers  count attached to a toplevel panel.
	(panel_toplevel_get_autohide_disabled): Returns True if panel has 
	open drawers.
	(panel_toplevel_unhide) panel_toplevel_hide) : Use the above methods.
	(bug #124016)

2003-10-06  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-widget.[ch] : (panel_widget_register_open_dialog):
	Register the open dialog in to the list of open dialogs.
	(panel_widget_destroy_open_dialogs) : On destroying the panel,
	destroy all the open dialogs
	(panel_widget_open_dialog_destroyed) : Update the open dialogs
	list when the dialog is destroyed

	* launcher.c,  menu.c, panel-applet-frame.c :
	Use panel_widget_register_open_dialog() to register all the dialogs
	created.

	* panel.c: (panel_remove_open_create_launcher_dialogs),
	(panel_remove_applets): Remove it, no longer required.  Fix #122922

2003-10-03  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-widget.c (panel_widget_real_focus): Prevent PanelWidget
	getting focus after applet has focus (bug #123697)

2003-09-29  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-widget.[ch] : (panel_widget_register_open_dialog):
	Register the open dialog in to the list of open dialogs.
	(panel_widget_destroy_open_dialogs) : On destroying the panel,
	destroy all the open dialogs
	(panel_widget_open_dialog_destroyed) : Update the open dialogs
	list when the dialog is destroyed

	* launcher.c,  menu.c, panel-applet-frame.c : 
	Use panel_widget_register_open_dialog() to register all the dialogs 
	created.

	* panel.c: (panel_remove_open_create_launcher_dialogs), 
	(panel_remove_applets): Remove it, no longer required.  Fix #122922

2003-09-20  Kjartan Maraas  <kmaraas@gnome.org>

	* gnome-panel-screenshot.c: (find_toplevel_window):
	* panel-action-button.c: (panel_action_button_load_from_drag):
	* panel-background-monitor.c:
	(panel_background_monitor_setup_pixmap):
	* panel-background.c: (panel_background_prepare):
	* panel-force-quit.c: (wm_state_set):
	* panel-toplevel.c: (panel_toplevel_button_press_event):
	* xstuff.c: (xstuff_get_current_workspace): Merge warning fix
	from branch. bug #122779

2003-09-19  Christian Neumair  <chris@gnome-de.org>

	* menu.c: Fix sn i18n (#122564).

2003-09-19  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* gnome-desktop-item-edit.c (main): call gettext functions
	to bind gnome-panel message catalog. Fix bug #121407.

2003-09-18  Vincent Untz  <vincent@vuntz.net>

	* panel-run-dialog.c: (program_list_selection_changed) show the
	  localized comment instead of the english one when choosing an
	  application in the list. Fix bug #122169.

2003-09-18  Arvind Samptur <arvind.samptur@wipro.com>

	* drawer.[ch]:(drawer_deletion_response) (drawer_query_deletion):
	Query user before  deleting a "loaded" drawer.

	* applet.c: (applet_remove_callback) Use drawer_deletion_query()
	if the applet is a drawer.

	* panel.[ch]: Isolate the "Delete Panel" dialog creation
	so that we can re-use the same code.
	Fix bug #122604

2003-09-18  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c: (button_load_pixbuf): fix loading of
	icons with a relative path. Based on a patch from Bala
	in bug #121360.

2003-09-17  Rob Adams <readams@readams.net>

	* panel-struts.c: Fix an off-by-one error in computing start and
	end values for partial width struts.  Fix for #122405.

Wed Sep 17 17:09:22 2003  George Lebl <jirka@5z.com>

	* panel-global.schemas.in: add /apps/panel/global/disabled_applets
	  lists that lists disabled applet iids (lockdown removed stuff)

	* menu.c, panel-applet-frame.c, panel-profile.[ch]:  Implement the
	  disabled applets list.  Don't show in list and don't allow 
	  activating.

2003-09-17  Vincent Untz  <vincent@vuntz.net>

	* main.c: don't show the help flags twice in 'gnome-panel --help'.
	Fix bug #107878.

Tue Sep 16 14:22:28 2003  George Lebl <jirka@5z.com>

	* applet.c, launcher.c, panel-applet-frame.c, menu.c: In per-panel
	  lockdown mode, do the same thing as the full lockdown, that is,
	  hide the widgets rather then deselect them.  This is both easier
	  and likely more correct.  Insensitive really kind of means that
	  the actions may be possible.  But we want to convey the message
	  that there are no such actions possible.

	* menu.c: catch further instances of possibility of running programs
	  when inhibit command line was on by editing properties of random
	  menu entries.

Tue Sep 16 09:49:01 2003  George Lebl <jirka@5z.com>

	* button-widget.c: Fix #121072.  The overlay window was needlessly on
	  the toplevel rather then the button parent (panel-widget) and the
	  geometry may have been messed up.  I made it work precisely like
	  the GtkButton code in this sense (it was half there already
	  actually)

Mon Sep 15 15:05:27 2003  George Lebl <jirka@5z.com>

	* panel-global.schemas.in, panel-toplevel.schemas.in:
	  Add per panel locked_down item and a global locked_down
	  item.

	* applet.c, drawer.c, launcher.c, main.c, menu.c,
	  panel-action-button.c, panel-applet-frame.c,
	  panel-globals.h, panel-menu-bar.c, panel-profile.[ch],
	  panel-run-dialog.c, panel-toplevel.[ch], panel-widget.c,
	  panel.c:  Add toplevel panel locked_down flag and follow
	  it everywhere appropriate and also add a global locked_down
	  flag replacing any remaints of the commie_mode of 1.4.
	  In addition support reading two keys (which don't have
	  schemas yet since this is all kind of tenative and such
	  schemas wouldn't belong to gnome-panel anyway) 
	  /desktop/gnome/lockdown/inhibit_command_line and
	  /desktop/gnome/lockdown/inhibit_force_quit.  Also set
	  the lockdown flag appropriately for external applets so
	  that they can load and behave approperiately.  All this
	  currently requires a panel restart and no effort has been
	  done to support on the fly updating, but I doubt it's
	  worth the extra code baggage.  I suppose this should
	  be followed by some mail to d-d-l about lockdown especially
	  about the "need to be sorted out" bits.

2003-09-12  Arvind Samptur  <arvind.samptur@wipro.com>

	* menu.c (add_drawers_from_dir) : Don't load desktop files
	in the drawer if TryExec fails.

==================== 2.4.0 ====================

==================== 2.3.91 ====================

2003-09-05  Mark McLoughlin  <mark@skynet.ie>

	Fixes problem with drawers where they are always open on
	login. Make them closed at login instead.

	* drawer.c: (load_drawer_applet): hide the drawer on startup.
	
	* panel-toplevel.c:
	(panel_toplevel_hide), (panel_toplevel_unhide): show/hide
	drawers when not animating.

2003-09-05  Mark McLoughlin  <mark@skynet.ie>

	Patch from George to fix bug #120107 and some other
	stuff.

	* applet.c: (panel_applet_queue_applet_to_load):
	fix leak.
	
	* menu-ditem.c: (get_unique_name): use g_random_int()
	instead of rand().
	
	* panel-util.c: (panel_make_unique_path): ditto.
	
	* panel-profile.c: (panel_profile_load_object): fix leak.
	
	* panel-widget.[ch]:
	(allocate_dirty_child): kill this ugly hack and just resize
	the entire panel when moving an applet.
	(panel_widget_jump_applet_right),
	(panel_widget_switch_applet_right),
	(panel_widget_jump_applet_left), (panel_widget_switch_applet_left),
	(panel_widget_switch_move), (panel_widget_push_applet_right),
	(panel_widget_push_applet_left), (panel_widget_push_move):
	Update all these to resize the entire panel.
	(panel_widget_size_allocate): first normalize the positions
	based on minimum sizes of the applets/objects, basically
	shifting them right such that they need not ever be shifted
	right again. Then allocate sizes to applets (starting from the
	right corner) and finally shift	everything right in case we
	overshot.

2003-09-05  Mark McLoughlin  <mark@skynet.ie>

	Schemas to maintain compatibility with the 2.0/2.2
	configurations. 
	
	The problem being addressed here is that because the
	2.0/2.2 panel applies schemas to keys at runtime,
	existing user configurations will end up with
	dangling references to the old schemas unless we
	install these old schemas.
	
	For example, a 2.0/2.2 panel will apply the
	medium/general/panel_id_list schema to
	profiles/default/general/panel_id_list. This
	association is in the user's configuration, not in
	the system GConf database. If the user never changes
	panel_id_list and logs into a machine without this
	schema, then panel_id_list will be empty. 

	* panel-compatibility.schemas: re-add the old
	default config schemas.
	
	* Makefile.am: install the schemas.

==================== 2.3.90 ====================

Thu Aug 28 22:02:41 2003  George Lebl <jirka@5z.com>

	* panel-profile.c: initialize color to black when getting it from
	  gconf fails

Thu Aug 28 10:07:02 2003  George Lebl <jirka@5z.com>

	* panel.c: Fix a leak and be safe in destroying the
	  open_dialogs list.  The destruction of dialogs could
	  perhaps have side effects (though I'm not aware of any)
	  so steal the list so that no one modifies it.

	* panel-applet-frame.c: The open_dialogs are GSList's not
	  GList, so avoid crashes by using the correct function.

Thu Aug 28 08:59:58 2003  George Lebl <jirka@5z.com>

	* panel-util.c: don't free the format if we didn't allocate
	  it in the error dialog code.  Was OKed by the release-team

2003-08-27  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-widget.[ch] : Re-name create_launcher_dialog_list
	with open_dialogs to reflect a wider range of
	cleanup that we are upto.

	*launcher.c,panel-applet-frame.c,panel.c: Use it

	Fixes the dialogs being left on the screen when 
	the panel is destroyed and the crashes thereafter. #120812

==================== 2.3.7 ====================

Fri Aug 22 14:59:01 2003  George Lebl <jirka@5z.com>

	* launcher.c:  after a launcher is created, ensure that the Name,
	  GenericName and Comment fields have a C locale entry (using the
	  current locale one if the user added something).  This should
	  fix #120427, when people create a launcher then log in with
	  different language.

Fri Aug 22 14:28:42 2003  George Lebl <jirka@5z.com>

	* panel-properties-dialog.c: Fix warning when a drawer doesn't
	  have a tooltip set.  Also destroy the dialog when closed
	  (there is absolutely no point in keeping it in memory,
	  that's a waste), and handle closing the dialog with the
	  close WM button without causing crashes/warnings on next
	  use of properties

	* panel-run-dialog.c: When destroying the dialog, destroy
	  the file selection if it exists otherwise closing the
	  dialog without closing the fileselection causes a crash.

Fri Aug 22 09:50:19 2003  George Lebl <jirka@5z.com>

	* panel-applet-frame.c: fix a couple of possible
	  warnings about strings being NULL since the
	  background string can possibly be NULL.  While
	  investigating #120372

	* panel-background.c: the background->desktop can possibly
	  be NULL, so catch that gracefully.  Also add a few
	  preconditions.

Thu Aug 21 13:54:17 2003  George Lebl <jirka@5z.com>

	* panel-compatibility.c: fixing RH #102790, "panel gnomes stole my
	  drawers".  No longer will such gnomes profit from stealing ones
	  drawers.  Issue was that we were setting "toplevel_id" instead
	  of "attached_toplevel_id".  Also the menu setting migration code
	  was migrating main menus into just menus with "applications:"
	  path set.  main_menu=TRUE means use_menu_path must be FALSE.

Thu Aug 21 12:56:48 2003  George Lebl <jirka@5z.com>

	* panel-run-dialog.c: don't complete if the pointer is not on the
	  end of the input, and fix a leak when new prefix is not found.

2003-08-20  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-background-monitor.c: (panel_background_monitor_setup_pixmap):
	Pass the right type of Atom to gdk_property_get()
	Fixes bug #119898

Tue Aug 19 14:20:17 2003  George Lebl <jirka@5z.com>

	* panel-widget.c: Fixing #120107 where a non-expanded panel would
	  always use the biggest hint of the expaned applets.  Check if
	  allocation didn't give us all the space we needed and compress
	  expanded applets within possibilities.  Don't clamp the upper
	  size of the size request, it is not necessary and in fact
	  just makes trouble since then we wouldn't know how much space
	  we were denied.

Tue Aug 19 13:18:20 2003  George Lebl <jirka@5z.com>

	* panel-toplevel.c: Fix #119984 and RH #102631 by properly
	  calculating the "floating" flag of non-expanded panels.  The
	  floating flag needs to take into account the SNAP_TOLERANCE
	  otherwise it will in fact be wrong.

Mon Aug 18 17:04:39 2003  Brian Cameron <Brian.Cameron@Sun.Com>

	* menu.c:  Changed restore_grabs to use a technique similar to
	  drag_end_menu_cb (also in menu.c) to grab the keyboard as
	  well as the pointer.

Wed Aug 13 17:26:20 2003  George Lebl <jirka@5z.com>

	* panel-toplevel.[ch]: Add an accessor to the floating flag,
	  panel_toplevel_get_is_floating

	* panel-profile.c: when creating a new panel, try to find an
	  empty orientation/monitor (free from other non-floating
	  panels).  If no such place is found, will just use the
	  default values.  Fixes #107620

2003-08-13  Christian Neumair  <chris@gnome-de.org>

	* panel-toplevel.c: Localize panel description by adding a few gettext
	calls.

Tue Aug 12 16:34:38 2003  George Lebl <jirka@5z.com>

	* gnome-panel-screenshot.c: convert filenames to utf8 before
	  displaying them in the dialogs.

Tue Aug 12 16:05:34 2003  George Lebl <jirka@5z.com>

	* quick-desktop-reader.c: A "fix" for #119623.  If the encoding is
	  set explicitly to UTF-8 ignore the encoding from the language just
	  in case there was any (there isn't supposed to be any!)  This way
	  we read things that were converted wrongly.

Tue Aug 12 12:52:33 2003  George Lebl <jirka@5z.com>

	* panel-struts.c: Allow passing NULL width/height
	  int pointers and just don't update them then

	* panel-toplevel.c:  The update functions want to
	  work with width/height of what it was after
	  the update_size call, so store those values,
	  the strut update function can now update struts
	  based on the final position of animation to get the
	  final position correctly, struts can't really extend
	  beyond screen edges which would make hidden panels
	  whacked out.  The "math" function to compute the
	  "sin" wave is now a much simpler (but almost the
	  same) ninth degree polynomial p(p(x)) where p(x)
	  is a simple cubic.  The animating position is now
	  updated separately short circuiting the position
	  update instead of doing all the position dance as
	  normally.  Fix things in case we ever do animation
	  where we change the width/height which is not currently
	  done.  Don't update the size for hidden panels to avoid
	  completely squishing them and setting them to negative
	  sizes and all such fun.

	  Note: This fixes the struts for panels that hide at
	  least in all the cases which I could find.  Animations
	  are kind of off in some cases, but it would require
	  lots of whacky code to get that right and it's not
	  worth it.  Things it fixes include squishing panels
	  (thus whacking your applet layout), panels not hiding
	  at all, panels animating wrongly, panels jumping around
	  while other panels are hiding and gtk warnings about
	  negative sizes when panels are hidden.  Most of these
	  problems especially for vertical panels being hidden
	  down or up.

Mon Aug 11 11:40:00 2003  George Lebl <jirka@5z.com>

	* panel-toplevel.c: when queing unhide, first check if the panel
	  contains the pointer before whacking the unhide delay, this fixes
	  bugs where panel sometimes would never pop up.

Mon Aug 11 11:22:24 2003  George Lebl <jirka@5z.com>

	* panel-toplevel.c: Fix #119380 by ignoring motion event coming
	  from a different screen then the panel is on.

2003-08-11  Arvind Samptur <arvind.samptur@wipro.com>

	* panel-run-dialog.c: (panel_run_dialog_response): Reset the 
	completion_started flag.
	(event_key): Use the completion_started flag in the right way.  
	Fixes bug #115259

2003-08-11  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-menu-bar.c (panel_menu_bar_popup_menu): Activate menu bar when
	popping up menu. This fixes bug #118491.

==================== 2.3.6.2 ====================

2003-08-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: (panel_toplevel_update_struts): fix
	syntax error which breaks compile with gcc 2.95.
	Patch from Jens Granseuer in bug #119508.

==================== 2.3.6.1 ====================

2003-08-08  Mark McLoughlin  <mark@skynet.ie>

	Fixes multihead breakage in bug #119379.

	* panel-struts.c:
	(panel_struts_allocate_struts): add screen and monitor
	args and only do an allocation run for toplevels on that
	screen/monitor.
	(panel_struts_register_strut),
	(panel_struts_unregister_strut): upd.

2003-08-08  Mark McLoughlin  <mark@skynet.ie>

	* panel-struts.[ch]:
	(panel_struts_intersect),
	(panel_struts_allocation_overlapped),
	(panel_struts_allocate_struts),
	(panel_struts_register_strut): keep track of the original
	geometry so that we can apply deltas to the toplevel
	position rather than changing the position explicitly.
	(panel_struts_update_toplevel_geometry): apply the deltas
	here.
	
	* panel-toplevel.c:
	(panel_toplevel_update_position): updating the geometry
	accoring to the struts makes sense in all cases now.
	(panel_toplevel_start_animation): ditto here.

Thu Aug 07 14:34:37 2003  George Lebl <jirka@5z.com>

	* panel-toplevel.c: Fixing bug #115494.  Apparently if some applet
	  opens a menu, we'll never get a leave event.  However we will
	  get focus in/out events, so queue auto hide when those happen.

Thu Aug 07 14:09:56 2003  George Lebl <jirka@5z.com>

	* panel-toplevel.c: don't update struts until we have gotten initial
	  position/size stuff.  Fixes autohide panels from jumping to the
	  other side of the screen on startup.

	* panel-struts.c: correctly position panels in their strut according
	  to the orientation, fixes expanded autohide panels.  All
	  hidden/animating panels are still broken if around other struts.

==================== 2.3.6 ====================

2003-08-07  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-background.c: (panel_background_set_image):
	Get the panel to upadate to the new image selected
	by the user. Fixes bug #119320

2003-08-07  Frederic Crozat  <fcrozat@mandrakesoft.com>

	* panel-menu-bar.c: (panel_menu_bar_instance_init):
	Use semicolon at end of line, not colon.

2003-08-06  Mark McLoughlin  <mark@skynet.ie>

	Patch from Glynn Foster.

	* applet.[ch]:
	(panel_applet_lock): make the remove item insensitive if
	locked.
	(panel_applet_create_menu),
	(panel_applet_register): keep track of the remove item.
	
	* panel-applet-frame.c: (panel_applet_frame_sync_menu_state):
	make the remove item insensitive if locked.

2003-08-06  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add panel-struts.[ch].
	
	* panel-struts.[ch]: re-implement some degree of "collision
	avoidance" - i.e. keep panels from overlapping.

	* panel-toplevel.c:
	(panel_toplevel_update_struts): use it here and also fix
	struts on non-rectangular Xinerama.
	(panel_toplevel_update_position), (panel_toplevel_realize),
	(panel_toplevel_finalize), (panel_toplevel_set_auto_hide_size),
	(panel_toplevel_set_auto_hide): use the collision avoidance
	stuff here too.

Tue Aug 05 15:28:14 2003  George Lebl <jirka@5z.com>

	* launcher.[ch]: the theme icon stuff is now fixed in gnome-desktop
	  in a slightly nicer way anyway, so revert most of the changes from
	  here.

	* panel-properties-dialog.c: Fixup the code a bit according to mark,
	  and refer to bug #119209 in the code.  Also handle the case where
	  no icon is set at first (in this case normally we also want to
	  theme).

Mon Aug 04 16:52:07 2003  George Lebl <jirka@5z.com>

	* panel-background.c: fix image rotation to be 64bit safe, do
	  rotation for non-alpha images as well, fix for pixbufs with
	  rowstride != width.  Don't do the whole transformation
	  thing unless needed, don't do compositing onto the
	  desktop unless needed.  Fixes really REALLY slow moving if
	  using a background image on non-expanded panels.

	* panel-profile.c: fix the notify for "rotate" key

Fri Aug 01 18:00:51 2003  George Lebl <jirka@5z.com>

	Changes to fix bugs: rh #101304, gnome #116586

	* button-widget.[ch], drawer.c, launcher.c, panel-menu-button.c:
	  The button-widget now can have both stock id and a filename set,
	  using the stock id in case the filename is not found, makes the
	  missing icon logic much simpler and don't need to look up icons
	  everywhere.

	* button-widget.c, drawer.c, launcher.c, panel-menu-button.c:
	  don't resolve the icon names if not needed (and it's not needed
	  for button-widget).  Only lookup the icon in the theme by
	  basename if the icon is not an absolute pathname (or as a backup).

	* panel-properties-dialog.c, launcher.[ch]: When letting the user
	  change the icon resolve the icon name against the current theme,
	  then if the user picked an icon in the same directory as the 
	  resolved icon, assume that we really want the themed icon so only
	  store the basename, otherwise store the full path.

	* panel-profile.c: make sure not to call a gconf set_string with
	  a NULL argument as gconf would complain

	* panel-menu-button.c: fix minor memleak

Fri Aug 01 15:37:02 2003  George Lebl <jirka@5z.com>

	* panel-menu-bar.c: catch and intercept all button_press_events on
	  the two toplevel menus to avoid them going all the way to the
	  menubar.  Fixes #111313 where right clicking on dead space in
	  the menus could bring up confusingly the applet menu.  Very
	  important bugfix indeed, but I think I have a fever, so I'm
	  allowed to fix just simple stuff.

2003-08-01  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-recent.c: (recent_documents_activate_cb):
	Determine the screen after the widget has been realized
	else you land up with a wrong screen number.
	Fixes bug #118697

	Patch from Leena Gunda (leena.gunda@wipro.com)

2003-07-31  Mark McLoughlin  <mark@skynet.ie>

	* panel-menu-button.c: (panel_menu_button_instance_init):
	Add back the tooltip.

2003-07-31  Mark McLoughlin  <mark@skynet.ie>

	* panel-menu-button.c: (panel_menu_button_load): re-enable
	that pesky little arrow.

2003-07-31  Mark McLoughlin  <mark@skynet.ie>

	Evil duplication of effort happening here. This reverts George's
	fix for #117710 (add entire menu as drawer) and uses a nicer fix
	I happened to be working on at the same time. No, I'm not a nice
	person.

	* drawer.[ch]:
	(panel_drawer_prepare): split out from panel_drawer_create()
	and allow preparing the attached toplevel before loading.
	(panel_drawer_create): upd.
	(panel_drawer_create_with_id): impl loading onto a toplevel
	with only the toplevels id.
	
	* launcher.[ch]:
	(panel_launcher_create_with_id): allow loading onto a toplevel
	with only its id.
	(panel_launcher_create): use with_id().
	
	* menu.c:
	(vfs_text_uri_exists): impl.
	(add_drawers_from_dir),
	(add_menudrawer_to_panel): re-implement to allow prepare the
	drawer, launchers and all sub-drawers and then load them all
	in one go.
	
	* panel.c: (drop_internal_applet): upd.
	
	* applet.c: (panel_applet_register): g_strdup is NULL tolerant.

2003-07-31  Mark McLoughlin  <mark@skynet.ie>

	* panel-profile.[ch]: (panel_profile_create_toplevel):
	Add a GdkScreen * argument and create the toplevel on
	that screen.
	
	* menu.c: (create_new_panel): create the toplevel on
	the correct screen.

Wed Jul 30 16:58:56 2003  George Lebl <jirka@5z.com>

	* launcher.c: fix #117130.  When icon is empty pass ""
	  as the icon.  This will force the button-widget code to
	  load the missing icon.

Wed Jul 30 15:14:20 2003  George Lebl <jirka@5z.com>

	* panel-widget.h, panel-toplevel.[ch]: make the get_panel_widget
	  method typesafe by including the PanelWidget typedef in the
	  header unless it has been typedeffed before.

	* menu.c, drawer.c, applet.c, panel.c: fix the add drawers from
	  menu thingie which should fix #117710 (all the other things
	  seem fixed already).

Wed Jul 30 12:50:28 2003  George Lebl <jirka@5z.com>

	* panel-util.c: in bug #117877 we saw 'foo' displayed since that
	  was the temporary text in the error dialog before the real
	  text was set.  Change that to be more meaningful (even though
	  not translated, since it's a really bad bug if it ever happens)

	* panel-menu-button.c: Don't ref/sink the menu when we make it,
	  since we attach it to the button the button will own a ref.
	  Also don't just unref to kill the menu, detach it, that will
	  take care of the reference as well.  Also disconnect the
	  signal handler in the detacher just in case something held
	  onto a reference of the menu somewhere.

	* panel-toplevel.c: Fixing bug #118368, where a vertical panel
	  that was floating (or stuck to the right side) and wasn't
	  expanded would gradually move to the top/left corner on
	  each restart.  Add geometry_updated_initial flag to the
	  private structure and don't do the position_centered
	  stuff if geometry was not yet updated since we're still
	  just setting initial values.

Tue Jul 29 18:27:48 2003  George Lebl <jirka@5z.com>

	* button-widget.c, launcher.c, menu.c, menu-ditem.c, panel-action-button.c,
	  panel-recent.c, panel-run-dialog.c, panel-shell.c, panel-util.c:
	  Fixed crashes on two panel_error_dialog invocations that weren't
	  quite converted.  Also never NEVER use an error message we got
	  from somewhere else as a format, that way lie crashes and security
	  problems.

2003-07-24  Alex Duggan  <aldug@astrolinux.com>

	* panel-toplevel.schemas.in: s/indentify/identify/
	Fixes #117993

==================== 2.3.4.1 ====================

2003-07-24  Mark McLoughlin  <mark@skynet.ie>

	Remove visible mnemonics from the Actions menu and Add to Panel
	menus. Based on patch from Glynn.

	* menu-util.[ch]: (stock_menu_item_new): huh ? Why on earth
	is there a function that looks like setup_stock_menu_item,
	but isn't. Dammit, we don't need code duplication.
	
	* menu.[ch]:
	(applet_menu_append), (applet_menu_append_category),
	(make_add_submenu): remove visible mnemonics.
	(setup_stock_menu_item): make public

	* panel-menu-bar.c:
	(panel_menu_bar_append_action_item): use setup_stock_menu_item().
	(panel_menu_bar_append_actions_menu): remove visible mnemonics.
	
	* panel-recent.c:
	(panel_recent_append_documents_menu): use setup_stock_menu_item()
	and remove the visible mnemonic.

2003-07-24  Mark McLoughlin  <mark@skynet.ie>

	Fix problem where the context menu for the menu bar pops
	up in the wrong place. Based on a patch from Glynn in
	bug #111313.

	* menu-util.c: (panel_position_applet_menu): only position
	the menu relative to the panel for NO_WINDOW widgets.

	(panel_menu_bar_parent_set): replace stupid warning with
	an assertion.
	
2003-07-24  Mark McLoughlin  <mark@skynet.ie>

	Fixes weirdness where sometimes the drawer panel, when
	it is hidden, is above the drawer button.
	
	* panel-toplevel.c:
	(panel_toplevel_update_animating_position): unmap the
	attached toplevel at the end of the animation.
	(panel_toplevel_start_animation): re-map it here before
	starting the animation.
	(panel_toplevel_hide): move raising the parent toplevel
	to just after re-mapping the attached toplevel.

2003-07-24  Mark McLoughlin  <mark@skynet.ie>

	Fixes drawers getting destroyed when you create
	a new panel.
	
	* panel-profile.c:
	(panel_profile_load_added_ids): s/toplevel_id/id/
	(panel_profile_toplevel_id_list_notify): don't pass 
	attached toplevels as being part of the existing
	toplevel_id_list.
	
2003-07-24  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c:
	(button_widget_set_orientation): force a re-scale of the button.
	Fixes rectangular buttons not re-scaling on vertical panels.
	
2003-07-24  Mark McLoughlin  <mark@skynet.ie>

	Fix launchers and action buttons not re-sizing when you move
	them onto a vertical panel.
	
	* panel.c: (orientation_change): change the orientation
	on launchers and action buttons too.

	* drawer.[ch]: (panel_drawer_use_custom_icon_changed),
	(panel_drawer_custom_icon_changed): upd.
	(set_drawer_applet_orientation): kill.
	
	* panel-menu-button.[ch]:
	(panel_menu_button_set_icon): upd.
	(panel_menu_button_change_orientation): kill.

	* launcher.c: (setup_button): upd.
	
	* button-widget.[ch]:
	(button_widget_get_property),
	(button_widget_set_property), (button_widget_class_init),
	(button_widget_new), (button_widget_new_from_stock),
	(button_widget_set_icon_name), (button_widget_get_icon_name),
	(button_widget_set_stock_id), (button_widget_get_stock_id),
	(button_widget_set_orientation), (button_widget_get_orientation),
	(button_widget_set_has_arrow), (button_widget_get_has_arrow),
	(button_widget_set_dnd_highlight),
	(button_widget_get_dnd_highlight): re-implement properties for
	ButtonWidget to make it much more sane. Say bye-bye to cruft
	like button_widget_change_params().
	
2003-07-23  Mark McLoughlin  <mark@skynet.ie>

	Implement a properties dialog for drawers based on the
	standard panel properties dialog. Fixes bug #107606.

	* applet.[ch]:
	(applet_callback_callback): present the panel properties
	dialog.
	(panel_applet_get_id_by_widget): impl.
	* applet.h:
	
	* drawer.[ch]:
	(add_drawer_properties_page): remove old #ifdefed out drawer
	properties cruft.
	(destroy_drawer): remove the GConf listeners.
	(free_drawer): kill.
	(create_drawer_applet): pass in the use_custom_icon flag. Also
	set the toplevel name to be the same as the tooltip.
	(panel_drawer_use_custom_icon_changed),
	(panel_drawer_custom_icon_changed),
	(panel_drawer_tooltip_changed),
	(panel_drawer_connect_to_gconf): impl monitoring for changes
	in config.
	(load_drawer_applet): pass the parcel.
	(drawer_load_from_gconf): read use_custom_icon.
	
	* panel-profile.[ch]:
	(panel_profile_get_attached_object_key),
	(panel_profile_set_attached_custom_icon),
	(panel_profile_get_attached_custom_icon),
	(panel_profile_is_writable_attached_custom_icon),
	(panel_profile_set_attached_tooltip),
	(panel_profile_get_attached_tooltip),
	(panel_profile_is_writable_attached_tooltip): implement.

	* panel-properties-dialog.c: (get_name),
	(panel_properties_dialog_name_changed),
	(panel_properties_dialog_setup_name_entry): handle
	setting the tooltip and name on drawers.
	(panel_properties_dialog_setup_size_spin),
	(panel_properties_dialog_icon_changed),
	(panel_properties_dialog_setup_icon_entry): impl. then
	icon entry.
	(panel_properties_dialog_remove_orientation_menu),
	(panel_properties_dialog_remove_icon_entry),
	(panel_properties_dialog_remove_toggles),
	(panel_properties_dialog_update_for_attached): impl. removing
	bits when they aren't relevant. Kinda sucky.
	(panel_properties_dialog_new): upd.
	
	* panel-properties-dialog.glade: add an icon entry and name
	a few widgets.
	
	* panel-toplevel.[ch]:
	(panel_toplevel_get_attach_toplevel),
	(panel_toplevel_get_attach_widget): impl.

2003-07-22  Mark McLoughlin  <mark@skynet.ie>

	Remove auto-hiding into the corner again. It seems the
	only people who like it are people who don't use
	autohide panels :-) The main fault with it seems to
	be that you have to do a lot of tricky manoevouring
	to put you mouse into the corner and then bring it
	back to whatever you wanted on the panel. See #81843.

	* panel-toplevel.c:
	(panel_toplevel_update_struts): fix struts weirdness
	with autohide panels.
	(panel_toplevel_update_auto_hide_position): don't
	hide into corners any more.
	(panel_toplevel_start_animation): hmm,
	MAX (func (x), func (y)) isn't very efficient is it
	now ? Also, don't take into account the end width and
	height when they are -1 - fixes slowness in hiding.
	(panel_toplevel_enter_notify_event),
	(panel_toplevel_leave_notify_event),
	(panel_toplevel_instance_init): kill code to figure out
	which corner to hide to based on the last leave notify.

2003-07-22  Arvind Samptur  <arvind.samptur@wipro.com>

	* panel-run-dialog.c : Get rid of panel_run_dialog_free() 
	as it is not adding any value.  Fixes crash #114799

2003-07-21  Mark McLoughlin  <mark@skynet.ie>

	* panel-menu-button.c: (panel_menu_button_create): fix typo
	when creating a panel menu. Patch from Mohamed El Ayouty in
	bug #117766.

2003-07-17  Dennis Cranston <dennis_cranston at yahoo com>

	* gnome-panel-preferences.glade:  Fix the window icon.

2003-07-16  Dennis Cranston <dennis_cranston at yahoo com>

	* gnome-panel-preferences.glade:  Make close the default button.
	
2003-07-16  Dennis Cranston <dennis_cranston at yahoo com>

	* gnome-panel-preferences.glade:  Adjust widget padding 
	according to the HIG.
	
Wed Jul 16 10:25:42 2003  George Lebl <jirka@5z.com>

	* main.c, menu-util.[ch], menu.[ch], panel-globals.h, panel-menu-bar.c,
	  panel-stock-icons.[ch]:  whack the KDE menus.  These are the old
	  style menus anyway and KDE menus should be merged by the vfolder
	  stuff anyway.

Wed Jul 16 10:01:21 2003  George Lebl <jirka@5z.com>

	* panel-stock-icons.c: if the stock icon is "go" and we don't find
	  it, don't warn.  This is a KDE icon, so it is normal that it is
	  not installed.  And if KDE is not installed we won't have the
	  KDE menu anyway so it won't be used either.  Just ignore this
	  just like we ignore PANEL_STOCK_ACTION now.

2003-07-16  Mark McLoughlin  <mark@skynet.ie>

	* panel-stock-icons.c:
	* panel-stock-icons.h: remove PANEL_STOCK_ARROW definitions.
	Fixes "panel-stock-arrow-right" not found warnings.

2003-07-15  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c:
	(panel_applet_frame_construct): no need to ref the connection
	here. Removes dependancy on ORBit 2.7.x.

==================== 2.3.4 ====================

2003-07-15  Mark McLoughlin  <mark@skynet.ie>

	Make the items in the Main Menu have invisible mnemonics too.
	Fixes bug #117457.

	* menu.[ch]:
	(setup_full_menuitem): add an extra "invisible_mnemonic"
	arg and if true make the first character of the menu item
	a hidden accelerator.
	(create_root_menu): use it here for the Main Menu.

	* applet.c: upd.

Mon Jul 14 10:22:39 2003  George Lebl <jirka@5z.com>

	* panel-properties-dialog.(c|glade): Add warning label if some of the
	  properties are locked down so that the user isn't just baffled that
	  they are insensitive, also change the g_asserts that I added into
	  g_return_if_fails which are less anal

	* applet.c: if say the background property is not locked down, the
	  panel_right_stick and position properties of an applet can still
	  change, so check for writability of those before writing them

2003-07-14  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c: (panel_applet_frame_change_size):
	normalise the applet size to the values defined in the
	IDL so we don't break some applets. What a mess.
	
	* panel-util.h: remove the G_GNUC_PRINTF stuff for 
	panel_error_dialog since we've obfuscated the function
	enough now that the compiler can't have a hope of
	knowing what we're at.

2003-07-14  Mark McLoughlin  <mark@skynet.ie>

	* panel-run-dialog.c:
	(set_window_icon_from_stock): impl.
	(panel_run_dialog_set_icon),
	(panel_run_dialog_setup_pixmap): use PANEL_STOCK_RUN
	instead of GTK_STOCK_EXECUTE.
	(panel_run_dialog_new): set the window icon appropriately.
	
	* panel-run-dialog.glade: don't set the stock icon here.

2003-07-13  Christian Neumair  <chris@gnome-de.org>

	* panel-toplevel.schemas.in: Third and hopefully last string adaption.
	Menthos rocks.

2003-07-12  Christian Neumair  <chris@gnome-de.org>

	* panel-toplevel.schemas.in: Fixed string I borked during the last
	cleanup round (#116897).

	* menu-ditem.c: My last patch (#113433) destroyed a string semantically.
	Fix this.

2003-07-11  Christian Neumair  <chris@gnome-de.org>

	* launcher.c:
	* menu-ditem.c:
	* menu.c:
	* panel-action-button.c:
	* panel-recent.c:
	* panel-run-dialog.c:
	* panel-util.[ch]: (panel_error_dialog): Revamp error dialog
	construction. Now we have a primary and a secondary format message and
	set the appropriate pango attributes (#113433).

2003-07-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-stock-icons.h: change the default icon
	size to 24x24. See bug #114920.

2003-07-08  Mark McLoughlin  <mark@skynet.ie>

	Modified version of excellant patch from
	Rob Adams <robadams@ucla.edu> in bug #116025.

	* panel-xutils.[ch]: (panel_xutils_set_strut): support
	new EWMH hint _NET_WM_STRUT_PARTIAL.

	* panel-multiscreen.[ch]:
	(panel_multiscreen_is_at_visible_extreme): new function
	determines whether a given monitor is along the visible
	edge of the logical screen.
	
	* panel-toplevel.c (panel_toplevel_update_struts):
	support new panel_xutils_set_strut().
	(panel_toplevel_get_monitor_geometry): Change function to
	also get origin of monitor so we can do a more accurate
	heuristic for "on the edge"

2003-07-09  Christian Neumair  <chris@gnome-de.org>

	* panel-general.schemas.in:
	* panel-object.schemas.in:
	* panel-toplevel.schemas.in: Fixed scattered typo bugs filed by
	Christian Rose: #116878, #116883, #116884, 116897, #116899, #116924.

Tue Jul 08 16:44:02 2003  George Lebl <jirka@5z.com>

	* panel-applet-frame.c: Handle more errors in the constructor.  Still
	  ORBit/Bonobo is broken and crashes, I have a workaround in mind if,
	  they don't get fixed.  When the applet whacks out during the
	  construct we now handle it in the same way as if we can't activate
	  the applet with a gui dialog.  Don't connect to the broken signal
	  until we're all done with init.

	* panel-widget.c: detach attached toplevel on remove and attach it on
	  add.  Fixes moving of drawers from one panel to another.

Tue Jul 08 10:35:41 2003  George Lebl <jirka@5z.com>

	* menu.c: when hierarchy changed, remove old mnemonic before adding
	  it to the new window avoids warning on exit and likely bad
	  behaviour when reparenting things.

	* panel-applet-frame.c: avoid crash/warning by only checking the
	  locked flag while the widget and info structure still exists,
	  for the reload-if-applet-crashes code.

Tue Jul 08 09:50:24 2003  George Lebl <jirka@5z.com>

	* panel-gconf.c: when cleaning a directory don't clean keys we can't
	  write

2003-07-07  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.schemas.in:
	* panel-general.schemas.in:
	* panel-global.schemas.in:
	* panel-object.schemas.in:
	* panel-toplevel.schemas.in: much work on keys
	documentation to make it more consitent, fix
	typos and use correct terminology. Patch from
	Christian Neumair in bug #112527.

2003-07-07  Mark McLoughlin  <mark@skynet.ie>

	Add mnemonics to the Applications, Actions and "Add to Panel"
	menus, but make the ones in Applications invisible. Based 
	on a patch from Muktha in bug #72008.
	
	* menu.c:
	(setup_mnemonic), (setup_invisible_mnemonic): implement
	setting a mnemonic for a menu item without actually
	underlining the appropriate character.
	(create_menuitem): set an invisible mnemonic.
	(applet_menu_append), (applet_menu_append_category),
	(make_add_submenu): use visible mnemonics here.
	
	* menu-util.c: (stock_menu_item_new): allow mnemonics.
	
	* panel-menu-bar.c: (panel_menu_bar_append_actions_menu):
	add mnemonics to the Actions menu.
	
	* panel-recent.c: (panel_recent_append_documents_menu):
	add mnemonic.
	
2003-07-07  Mark McLoughlin  <mark@skynet.ie>

	Pre-load some directories that weren't previously being
	loaded. Should improve startup time significantly.
	
	* panel-profile.c:
	(panel_profile_load_toplevel): preload the background
	directory explicitly. Recursive preloading never worked.
	(panel_profile_load_object): preload the applet's
	directories too.

2003-07-05  Dennis Cranston <dennis_cranston at yahoo com>

	* menu-ditem.c: (panel_new_launcher)  Adjust padding of 
	the 'Create Launcher' dialog used by nautilus.  This 
	should cover all the launcher dialogs.
	
2003-07-05  Dennis Cranston <dennis_cranston at yahoo com>

	* menu-ditem.c: (panel_edit_dentry, panel_edit_direntry)  
	Adjust padding of two more 'Launcher Properties' dialogs.

2003-07-03  Rajkumar Sivasamy  <rajkumar.siva@wipro.com>

	* button-widget.c: Make panel-buttons that use stock icons 
	to respect theme changes.
	Fixes bug: 116452

2003-07-03  Mark McLoughlin  <mark@skynet.ie>
	
	* menu.[ch]:
	(panel_create_menu): rename from panel_menu_new().
	(menu_new): upd.

	* applet.c: (setup_an_item), (add_to_submenus),
	(panel_applet_create_menu):
	* panel-menu-bar.c: (panel_menu_bar_append_actions_menu):
	* panel-recent.c: (panel_recent_append_documents_menu):
	update.

	* panel-frame.c: fix comment.

Wed Jul 02 16:08:23 2003  George Lebl <jirka@5z.com>

	* panel-widget.c: when panel is destroyed make sure that the
	  master's widget associated key is wiped so that we don't
	  try to access freed data and crash (fixes crash and/or warning
	  on exit when drawers are present)

	* drawer.c: when our toplevel is destroyed, set the
	  toplevel member to NULL and whack the button.  Fixes
	  crash and/or warning on exit when drawers are present.

Wed Jul 02 11:43:26 2003  George Lebl <jirka@5z.com>

	* panel-applet-frame.c: when creating new applets be more careful
	  about errors and null returns if they can possibly happen, and
	  fix a leak when this happens

	* panel-widget.c: the time on events with send_event (hand generated
	  events) seems to be bogus for the drag start and so just
	  use GDK_CURRENT_TIME in this case.  This fixes dragging applets
	  like fish and window-list for me.

2003-07-02  Mark McLoughlin  <mark@skynet.ie>
	
	* panel-stock-icons.[ch]: add a new stock id "panel-main-menu"
	pointing to the gnome-main-menu icon to allow the main menu
	icon to be themed seperately from the GNOME logo.

	* menu.c: (make_add_submenu):
	* panel-menu-button.c: (panel_menu_button_instance_init),
	(panel_menu_button_set_icon), (panel_menu_button_set_dnd_enabled):
	Use PANEL_STOCK_MAIN_MENU.

==================== 2.3.3.3 ====================

2003-07-02  Mark McLoughlin  <mark@skynet.ie>

	Patch from Daniel Baeyens in bug #114603.

	* panel-toplevel.schemas.in: consistently use "three" instead
	of "3".

2003-07-02  Mark McLoughlin  <mark@skynet.ie>

	Patch from Fernando Herrera in bug #115572.

	* gnome-panel-screenshot.c: (take_window_shot): fix problem
	with taking a window screenshot when the window is overlapped
	by showing the window before taking the shot.

2003-07-02  Mark McLoughlin  <mark@skynet.ie>

	Patch from Christophe Fergeau in bug #113238.

	* gnome-desktop-item-edit.c:
	* menu-ditem.c:
	* menu-fentry.c:
	* panel-util.c: remove unnecessary gnome-vfs includes.

2003-07-02  Mark McLoughlin  <mark@skynet.ie>

	Based on patch from Kaushal Kumar in bug #114565.

	* panel-shell.c: (panel_shell_register): register the
	panel shell as per display, not per screen.

2003-07-02  Mark McLoughlin  <mark@skynet.ie>

	 Based on patch from Mark Finlay in bug #114056.

	* menu.c: (show_about_dialog): make the about dialog much more
	sane (or boring from George's POV :-). no "End World Hunger"
	link, no picture of a goat, no talk about random X crashes,
	no Monty Python reference and make the credits list alphabetically
	sorted.

2003-07-02  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: make panel_applet_have_load_idle static.
	
2003-07-01  Mark McLoughlin  <mark@skynet.ie>

	Fix bug #109374. When no panel's are found in the default
	configuration, show a fallback panel so we don't end up
	with a running panel process and no panels.

	This seems to be getting reported a fair bit, so I reckon
	packagers mustn't yet have twigged about installing the
	default configuration using gconftool-2 --load. Your post
	install magic should be something like this:

	gconftool-2 --direct
	            --config-source=$GCONF_CONFIG_SOURCE
	            --load %{_sysconfdir}/gconf/schemas/panel-default-setup.entries

	* panel-profile.c:
	(panel_profile_find_new_id): assert that we always return
	an id.
	(panel_profile_copy_defaults_for_screen): fix using the
	wrong key for the schemas location.
	(panel_profile_create_fallback_toplevel_list): impl returning
	a list of fallback toplevels. Currently just a single toplevel
	according to the schemas defaults with no objects.
	(panel_profile_load_defaults_on_screen): if we can't find any
	toplevels in the default configuration, load a fallback panel.
	(panel_profile_ensure_toplevel_per_screen): kill FIXME.
	
2003-07-01  Mark McLoughlin  <mark@skynet.ie>

	Fix issue with drawer panels not getting deleted when
	you delete the drawer button.

	* drawer.[ch]:
	(destroy_drawer): actually destroy the toplevel instead
	of just detaching it.
	(panel_drawer_delete): kill.

	* applet.c:
	(panel_applet_clean): don't call panel_drawer_delete().
	
Tue Jul 01 16:54:53 2003  George Lebl <jirka@5z.com>

	* panel-applet-frame.c: only delete the applet from config (when we
	  can't load) if we can actually write to the applets list

Tue Jul 01 16:00:06 2003  George Lebl <jirka@5z.com>

	* applet.[ch], panel-profile.c: kill reentrancy issues on the
	  applet loading idle.  When we get a notify for new applets to load,
	  don't add the ones already on the load queue.  This should fix
	  issues when dealing with applets that don't want to load for
	  some reason.

2003-07-01  Mark McLoughlin  <mark@skynet.ie>

	Fix location of arrow on non-rectangular menu buttons and
	fix problem where you can't make the panel smaller because
	launchers etc. refuse to get smaller.

	* button-widget.c:
	(draw_arrow), (button_widget_expose): redo the calculation
	of arrow co-ordinates to not assume the icon is square.
	
	* panel-widget.[ch]:
	(panel_widget_size_request): if an applet has its size
	constrained don't increase the panel's requisition if the
	applet's requisition is larger.
	(panel_widget_add): initialize size_constrained.
	(panel_widget_set_applet_size_constrained): add per-applet
	flag to specify whether the panel should expand when an
	applet is larger than the panel.
	
	* panel-applet-frame.c:
	(panel_applet_frame_load): set size_constrained.
	(panel_applet_frame_size_constrain),
	(panel_applet_frame_size_request): don't constrain the
	applet's size here.
	
	* drawer.c: (load_drawer_applet):
	* launcher.c: (load_launcher_applet):
	* panel-action-button.c: (panel_action_button_load):
	* panel-menu-button.c: (panel_menu_button_load): set
	size_constrained.

==================== 2.3.3.2 ====================

2003-07-01  Mark McLoughlin  <mark@skynet.ie>

	* panel-default-setup.entries: make the default panel's
	be 32 pixels wide instead of 24. Turns out we were
	unwittingly adding an extra 6 pixels before anyway so ...

2003-07-01  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.[ch]:
	(button_widget_load_pixbuf_and_scale),
	(button_widget_reload_pixbuf), (button_widget_expose),
	(button_widget_size_request), (button_widget_size_allocate),
	(button_widget_instance_init): allow rectangular buttons and
	make the button fully occupy the panel height.
	
	* panel-frame.c: (panel_frame_size_request): only request
	room to draw bevels for the edges on which we are actually
	going to draw the bevels.
	
	* panel-toplevel.c:
	(panel_toplevel_update_size): only request room to draw bevels
	for the edges on which we are actually going to draw the bevels.
	(panel_toplevel_size_request): don't chain up to GtkWindow's
	size_request, just ask the child for its requisition.
	
	* drawer.c: (load_drawer_applet):
	* launcher.c: (load_launcher_applet):
	* panel-menu-button.c: (panel_menu_button_load):
	* panel-action-button.c: (panel_action_button_load): set the
	expand_minor flag.

2003-07-01  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.[ch]: remove the size property and args to
	the constructors. We weren't using it anywhere.

	* drawer.c: (create_drawer_applet):
	* launcher.c: (create_launcher): upd.

2003-07-01  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c: (panel_applet_frame_event_listener):
	kill debug spew.

Mon Jun 30 14:56:23 2003  George Lebl <jirka@5z.com>

	* panel-profile.[ch], panel-run-dialog.c: if we can't set the
	  show_program_list thing, make the checkbox insensitive

Mon Jun 30 14:17:22 2003  George Lebl <jirka@5z.com>

	* menu.c: only setup internal dragging of applets/objects if the
	  relevant gconf lists are actually writable.

	* panel.c: on drop check if we can actually do the action requested,
	  and if not run the gdk_drag_finish with FALSE for success.  It
	  would be nicer to just not allow the drop in the first place but
	  this would likely have a performance hit unless we did lots of
	  work on caching the writability info which is probably an overkill.

Mon Jun 30 11:25:29 2003  George Lebl <jirka@5z.com>

	* applet.[ch], panel-applet-frame.c: add
	  panel_applet_can_move_freely and panel_applet_lockable, which
	  tests the writability of the keys needed for such actions.
	  The bonobo applets now make use of this and the objects now
	  also grey out respective menuitems.

	* panel-widget.c: Check for freely being movable before starting
	  a move.  (act as locked if we can't write any of the keys, needed
	  for moving)

	* menu.c: the menu rightclick options now respect key-writability

	* launcher.[ch]: When we can't hoard a launcher (when the location
	  key is non-writable), make the whole entry non-writable.  Doesn't
	  affect already hoarded launchers, but if you set the location to
	  somewhere else and make it mandatory, that prevents the properties
	  from coming up (since we couldn't edit it anyway).

	* panel-util.c: in the help showing code there was some error
	  badness.  Now only show the first error set if nothing succeeded,
	  as not to have GError complain, and also clear error if a 
	  failover succeeded.

2003-06-30  Padraig O'Briain  <padraig.obriain@sun.com>

	* menu.c (panel_make_sure_menu_within_screen): Omit call to
        our_gtk_menu_position as it is being called twice.

Fri Jun 27 17:19:04 2003  George Lebl <jirka@5z.com>

	* applet.c: (panel_applet_save_position) Only set things which are
	  different.  This helps out if some of these are not writable,
	  and some are.  Though we should have a dirty flag to handle this.

	* menu.c, panel-profile.[ch]:  Add panel_profile_list_is_writable
	  to check writability of one of the lists, When the applets and
	  the object lists are not writable don't allow removing or adding
	  of things.

	* panel-applet-frame.c: for bonobo applets check the keys
	  related to moving/removing/locking and disable those commands
	  if those are not possible.  When applet dies and the user
	  wants to not-reload it, but we can't write to the applets
	  list, don't remove it, but don't reload it either.

	* panel-toplevel.c, panel-profile.[ch]: add
	  panel_profile_can_be_moved_freely which checks a bunch of
	  keys for a toplevel to be able to move with the cursor.
	  We could do this more finegrained, but for now this should
	  at least work right without gconf errors from mandatory
	  settings.

Fri Jun 27 12:47:58 2003  George Lebl <jirka@5z.com>

	* panel-toplevel.c: if orientation is not writable, then don't allow
	  moving as that would change orientation, same with size and
	  resizing.  So panels themselves should now be pretty much
	  lockdownable by mandatory settings.

Fri Jun 27 12:11:30 2003  George Lebl <jirka@5z.com>

	* panel-profile.[ch], panel-properties-dialog.(c|glade):  Finish
	  "key-writability", that is, if keys are not writable, then don't
	  let the gui elements that change those keys be sensitive.

Thu Jun 26 18:43:38 2003  George Lebl <jirka@5z.com>

	* panel-profile.[ch], panel-properties-dialog.c: key-writability
	  changes for a few toggles.  I think I got the properties setup of
	  panel figured out now.

Thu Jun 26 11:17:59 2003  George Lebl <jirka@5z.com>

	* gnome-panel-preferences.c: When keys become non-writable (when this
	  changes), then also (de)sensitize things.  And listen for the lock-down
	  key changes (this key should be renamed and mentioned in a scheme
	  I would say)

	* gnome-panel-preferences.c: If we can't load the .glade file, exit
	  after displaying the error instead of crashing.

Wed Jun 25 17:09:09 2003  George Lebl <jirka@5z.com>

	* gnome-panel-preferences.c: when a key is not writable make that gui
	  element insensitive.  Also don't compare bools with a '=' since
	  that may not always work, so be anal and do the right thing.

2003-06-24  Rajkumar Sivasamy  <rajkumar.siva@wipro.com>

	* button-widget.c: Draw button-widget focus line with
	state GTK_STATE_NORMAL.
	Fixes Bug: 109887	

2003-06-23  Mark McLoughlin  <mark@skynet.ie>

	Fix #114962 by delaying reading the size hints and flags
	properties and by monitoring for changes on the property
	bag. Also remove the many synchronous reads on the property
	bag, which should speed up startup.

	* panel-applet-frame.c:
	(panel_applet_frame_set_flags_from_any),
	(panel_applet_frame_set_size_hints_from_any),
	(panel_applet_frame_init_properties): impl reading the
	properties and setting them on the PanelWidget.
	(panel_applet_frame_load): read the properties after
	adding to the PanelWidget.
	(panel_applet_frame_get_flags),
	(panel_applet_frame_update_expand_flags),
	(panel_applet_frame_get_size_hints): kill.
	(panel_applet_frame_change_orientation),
	(panel_applet_frame_change_size),
	(panel_applet_frame_change_background): use macros for
	property names.
	(panel_applet_frame_paint): don't do a sync read on
	the property.
	(panel_applet_frame_constrain_size): don't update the
	expand flags.
	(panel_applet_frame_size_request),
	(panel_applet_frame_size_allocate),
	(panel_applet_frame_button_changed): no more sync reads.
	(panel_applet_frame_instance_init),
	(panel_applet_frame_event_listener),
	(panel_applet_frame_construct): monitor for changes on
	properties.
	
	* panel-widget.[ch]:
	(panel_widget_size_request): don't read the size hints
	here.
	(panel_widget_set_applet_expandable): nomalize the bools.
	(panel_widget_set_applet_size_hints): implement.
	
2003-06-19  Dennis Cranston <dennis_cranston at yahoo com>

	* launcher.c: (ask_about_launcher)  Adjust padding
	and remove separator of the create launcher dialog.

2003-06-19  Dennis Cranston <dennis_cranston at yahoo com>
	
	* panel-properties-dialog.glade:  Minor HIG fixes
	to widget padding.

2003-06-18  Dennis Cranston <dennis_cranston at yahoo com>

	* launcher.c: (create_properties_dialog)  Adjust padding 
	and remove separator of the launcher properties dialog.
	
	* panel-util.c: (panel_dialog)  Remove the separator.
	
2003-06-19  Mark McLoughlin  <mark@skynet.ie>

	Remove panel help from launcher's context menus.
	Fixes bug #96350.

	* applet.c: (applet_callback_callback): don't
	add help callback.
	
	* launcher.c: (load_launcher_applet): don't handle
	help callback.

2003-06-18  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_root_menu):
	* panel-menu-bar.c: (panel_menu_bar_append_actions_menu):
	s/Screenshot.../Take Screenshot.../ bug #98904.

2003-06-17  Dennis Cranston <dennis_cranston at yahoo com>

	* gnome-panel-screenshot.glade:  Adjust widget padding
	according to the HIG and fix mnemonic conflict.

2003-06-12  Mark McLoughlin  <mark@skynet.ie>

	* panel-background-monitor.c:
	(panel_background_monitor_tile_background): special case
	tiling a 1x1 pixmap to increase speed greatly.
	
2003-06-12  Mark McLoughlin  <mark@skynet.ie>

	* main.c (main): enable svgs on the icon theme. Fix for
	bug #114706.
	
==================== 2.3.3.1 ====================

2003-06-12  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: install panel-default-setup.entries into
	%{sysconfdir}/gconf/schemas for want of a better place.
	They need to be installed for packages post install
	scripts.

2003-06-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c:
	(panel_toplevel_attach_widget_destroyed): detach if the
	parent toplevel is destroyed.
	(panel_toplevel_disconnect_attached): guard against being
	invoked twice.
	(panel_toplevel_connect_attached)
	(panel_toplevel_attach_to_widget),
	(panel_toplevel_detach): move arrows reversal to here.
	(panel_toplevel_destroy): disconnect signals. Hopefully
	should fix crash in #113215.

2003-06-11  Mark McLoughlin  <mark@skynet.ie>

	Makes the minimum panel size relative to the font size.
	See bug #94026 and probably a few others.

	Also, with autohide panels, hide into the corner nearest
	the location where the mouse pointer left the panel.

	* panel-toplevel.c:
	(panel_toplevel_construct_description): fix warning.
	(panel_toplevel_update_auto_hide_position): calculate the
	autohide position taking into account the last leave
	notify co-ordinates.
	(calculate_minimum_height), (panel_toplevel_update_size):
	Calculate the minimum panel size based on the font size.
	(panel_toplevel_enter_notify_event),
	(panel_toplevel_leave_notify_event),
	(panel_toplevel_instance_init): store the leave notify
	co-ordinates.
	
	* panel-enums.h: move the orientation mask definitions to
	beside the orientation enum for clarity.

2003-06-10  Mark McLoughlin  <mark@skynet.ie>

	Re-order message construction throughout the panel so
	that Pango markup is not marked for translation. Patch
	from Thomas Benson <tbenson@cs.utk.edu> in #113433.

	* launcher.c: (launch_cb), (launcher_show_help):
	* menu-ditem.c: (ditem_properties_close),
	(really_add_new_menu_item):
	* menu.c: (about_gnome_cb), (activate_app_def), (remove_menuitem),
	(add_to_run_dialog), (show_help_on):
	* panel-run-dialog.c: (panel_run_dialog_launch_command),
	(panel_run_dialog_show_url):
	* panel-util.c: (panel_show_help), (panel_lock_screen):
	Don't translate pango markup.

2003-06-06  Ray Strode  <halfline@hawaii.rr.com>

	* panel-profile.c: 
	(panel_toplevel_update_description): Remove code that 
	constructs description piecewise, and instead call 
	panel_toplevel_construct_description to pull the description 
	from a static array, which is better for i18n (Bug #113383).
	(panel_toplevel_construct_description): New helper function.

==================== 2.3.3 ====================

2003-06-05 Mark Finlay <sisob@eircom.net>

	* panel-stock-icons.c: Use gnome-logout as
	the logout icon. bug #114061

2003-06-05  Ray Strode  <halfline@hawaii.rr.com>

	* applet.c: (panel_applet_set_dnd_enabled):
	Add legacy object types to switch statement (bug #113961).

2003-05-30  Ray Strode  <halfline@hawaii.rr.com>

	* panel-profile.c: (panel_profile_copy_defaults_for_screen):
	Use g_strdup_printf instead of panel_gconf_sprintf. Fixes 
	problem where schemas weren't always being associated with
	new toplevels (bug #113831).

2003-05-29  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: (panel_toplevel_class_init):
	s/miliseconds/milliseconds/. Actually do it this
	time. bug #113406.

2003-05-27  Mark McLoughlin  <mark@skynet.ie>

	* panel-widget.c: (panel_widget_reparent): if we can't
	find and empty spot, put it at the start. Fix for
	bug #11843 based on patch from Ray Strode.

2003-05-27  Ray Strode  <halfline@hawaii.rr.com>

	* panel-properties.c: 
	(panel_properties_dialog_new): Add return statement.
	
2003-05-26  Mark McLoughlin  <mark@skynet.ie>

	When adding with the keyboard, try and find a free
	spot rather than sticking it at the start of the
	panel.

	* applet.c: (panel_applet_register): don't set pos to 0.
	
	* panel-widget.c:
	(panel_widget_find_empty_pos),
	(panel_widget_add): allow -1.
	
	* panel.c: (panel_popup_menu): set insertion_pos to
	-1 if the current event isn't a button press.

2003-05-26  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: (load_launcher_applet): get the args to
	panel_applet_register() the right way around so adding
	launchers works properly again.

2003-05-26  Mark McLoughlin  <mark@skynet.ie>

	* panel-menu-button.c: (panel_menu_button_parent_set):
	Chain up to the parent so ButtonWidget's overlay window gets
	re-parented.

2003-05-26  Mark McLoughlin  <mark@skynet.ie>
	
	* panel-action-protocol.c: (panel_action_protocol_main_menu):
	Try to popup the applications menu or the main menu and only
	failing that popup a menu at the pointer location. bug #10733.
	
	* panel-menu-bar.[ch]:
	(panel_menu_bar_instance_init): deselect the menu item when
	the menu is hidden. Dunno why that needed the hack.
	(panel_menu_bar_popup_menu): impl.
	
	* panel-menu-button.[ch]:
	(panel_menu_button_popup_menu): make public.
	(panel_menu_button_get_use_menu_path): impl.
	
	* applet.[ch]: (panel_applet_get_by_type): impl finding the first
	applet of a given type.

2003-05-26  Mark McLoughlin  <mark@skynet.ie>

	* panel-properties-dialog.c: (panel_properties_dialog_update_name):
	don't g_free the return value of gconf_value_get_string.

2003-05-26  Mark McLoughlin  <mark@skynet.ie>

	Implement a "Lock" flag on applets so you can disable moving them
	about. Fixes bug #74997.

	* GNOME_Panel_Popup.xml: add a "Lock" menu item to the
	applets context menu.
	
	* applet.[ch]:
	(panel_applet_set_dnd_enabled): enable/disable dnd depending
	on whether or not an applet is locked.
	(panel_applet_toggle_locked), (panel_applet_lock),
	(panel_applet_create_menu), (applet_show_menu): implement the
	"Lock" menu item.
	(panel_applet_load_idle_handler),
	(panel_applet_queue_applet_to_load),
	(panel_applet_save_position): impl saving the flag to GConf.
	(panel_applet_register): pass the parcel.
	
	* panel-applet-frame.[ch]:
	(panel_applet_frame_sync_menu_state),
	(popup_handle_lock), (popup_handle_move): implement the "Lock"
	menu item.
	(panel_applet_frame_load),
	(panel_applet_frame_load_from_gconf),
	(panel_applet_frame_reload_response): pass the parcel.
	
	* panel-default-setup.entries: make all default applets locked.
	
	* panel-object.schemas.in: add the "locked" schema.
	
	* panel-profile.c: (panel_profile_load_object): read the locked
	flag from GConf.
	
	* panel-util.[ch]:
	(panel_g_list_insert_before),
	(panel_g_list_insert_after): impl.
	
	* panel-widget.[ch]:
	(panel_widget_cadd): add applets unlocked by default.
	(panel_widget_jump_applet_right),
	(panel_widget_switch_applet_right),
	(panel_widget_jump_applet_left),
	(panel_widget_switch_applet_left),
	(panel_widget_try_push_right),
	(panel_widget_get_right_jump_pos),
	(panel_widget_get_right_switch_pos),
	(panel_widget_try_push_left),
	(panel_widget_get_left_jump_pos),
	(panel_widget_get_left_switch_pos),
	(panel_widget_switch_move): modify the "switch mode" algorithm
	to take into account locked applets that might be allowed. Now
	its the "try switch, then jump, then push, then jump, then ..."
	mode.
	(panel_widget_push_applet_right), (panel_widget_push_applet_left):
	allow pushing an arbitrary amount.
	(panel_widget_push_move): don't push locked applets.
	(panel_widget_applet_drag_start_no_grab),
	(panel_widget_applet_drag_start): you can't move locked applets
	dammit.
	(panel_widget_nice_move): call get_free_spot() and kill the silly
	comment.
	(panel_widget_add): add locked flag.
	(panel_widget_reparent): when re-parenting look for the first free
	spot and queue a resize.
	(panel_widget_set_applet_locked),
	(panel_widget_get_applet_locked),
	(panel_widget_toggle_applet_locked): implement accessors.
	
	* drawer.[ch]: (create_drawer_applet), (load_drawer_applet),
	(drawer_load_from_gconf), (panel_drawer_set_dnd_enabled):
	Impl enabling/disabling dnd.
	
	* launcher.[ch]: (create_launcher), (load_launcher_applet),
	(launcher_load_from_gconf), (launcher_show_help),
	(panel_launcher_set_dnd_enabled): ditto.
	
	* panel-action-button.[ch]: (panel_action_button_get_property),
	(panel_action_button_set_property),
	(panel_action_button_class_init),
	(panel_action_button_instance_init), (panel_action_button_load),
	(panel_action_button_load_compatible),
	(panel_action_button_load_from_gconf),
	(panel_action_button_load_from_drag),
	(panel_action_button_set_dnd_enabled): ditto.
	
	* panel-menu-button.[ch]: (panel_menu_button_instance_init),
	(panel_menu_button_get_property), (panel_menu_button_set_property),
	(panel_menu_button_class_init), (panel_menu_button_load),
	(panel_menu_button_load_from_gconf),
	(panel_menu_button_change_orientation),
	(panel_menu_button_set_dnd_enabled): ditto.
	
	* panel-menu-bar.[ch]: (panel_menu_bar_load),
	(panel_menu_bar_load_from_gconf): pass the parcel.
	
2003-05-26  Mark McLoughlin  <mark@skynet.ie>

	* panel-util.[ch]: remove heaps and heaps of unused code.
	
	* gnome-desktop-item-edit.c: (main): use g_str_has_suffix and
	not our own home grown crack.
	
	* menu-ditem.c: (is_item_writable):
	* menu-fentry.c: (fr_fill_dir):
	* menu.c: (add_drawers_from_dir): ditto.
	
	* menu.h: upd.
	
2003-05-26  Ray Strode  <halfline@hawaii.rr.com>

        * panel-properties-dialog.c: 
	(panel_properties_dialog_setup_image_entry): Don't send NULL
	to gtk_entry_set_text. 
	(panel_properties_dialog_update_name): Don't send NULL to
	gtk_entry_set_text and plug a leak.

2003-05-26  Mark McLoughlin  <mark@skynet.ie>

	* drawer.c: (create_drawer_applet): use the drawer stock
	icon rather than the filename.

2003-05-26  Ray Strode  <halfline@hawaii.rr.com>

	* panel-toplevel.schemas.in: fix typo. 

2003-05-26  Mark McLoughlin  <mark@skynet.ie>

	* panel-xutils.c: (panel_xutils_set_strut): Use an array of
	longs not guint32s for a property change with format 32. Doh.
	Might well fix #113475.

2003-05-26  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.c: (main): save in ~/Desktop,
	not ~/.gnome-desktop.

2003-05-26  Ray Strode  <halfline@hawaii.rr.com>

	* panel-profile.c: (panel_profile_get_toplevel_orientation):
	Plug a leak I introduced when I fixed #112122 (Oops!). 

2003-05-25  Mark McLoughlin  <mark@skynet.ie>

	Patch from Ray Strode in bug #113663 to fix weirdness when
	deleting panels and creating new ones.

	* panel-profile.c:
	(panel_profile_queue_toplevel_location_change): fix typo.
	(panel_profile_delete_dir): stop monitoring the dir for
	changes.

2003-05-23  Mark McLoughlin  <mark@skynet.ie>

	Patch from Ray Strode in bug #112122 to fix a crash with the
	panel properties dialog.

	* panel-profile.c: (panel_profile_get_toplevel_orientation):
	Check we didn't get a duff orientation from GConf.

2003-05-22  Mark McLoughlin  <mark@skynet.ie>

	* panel-run-dialog.c:
	(get_url_from_input): kill. Turns out this ended up
	in gnome-vfs. Thanks Frank :-)
	(panel_run_dialog_execute),
	(pixmap_drag_data_get):
	use gnome_vfs_make_uri_from_input_with_dirs.

2003-05-21  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* menu.c (create_root_menu): change "Run Application" to
	"Run Application... " in a menu bar (#112337)

2003-05-21  Mark McLoughlin  <mark@skynet.ie>

	More typos reported by Christian Rose.

	* panel-bindings.c: (panel_bindings_initialise):
	s/dir/directory/. Bug #113380.
	s/error/Error/. Bug #113381.
	
	* panel-general.schemas.in:
	s/Ids/IDs/. Bug #113382.

2003-05-21  Mark McLoughlin  <mark@skynet.ie>

	Fix a couple of typos reported by Christian Rose.
	
	* panel-toplevel.c: (panel_toplevel_class_init):
	s/miliseconds/milliseconds/. Bug #113406.
	
	* panel-toplevel.schemas.in: s/opactity/opacity/.
	Bug #113398.

2003-05-20  Arvind Samptur <arvind.samptur@wipro.com>
	
	* panel-applet-frame.c: (panel_applet_frame_set_panel):
	When moving applets between panels, update
	PanelAppletFrame->priv->panel.
	(panel_applet_frame_get_panel): Gets the PanelWidget
	for the PanelApplerFrame. Added it now, could be useful
	in future.
	(panel_widget_reparent): If the applet is of type
	PANEL_OBJECT_BONOBO call panel_applet_frame_set_panel()
	with the new panel.

2003-05-20  Dennis Cranston <dennis_cranston at yahoo com>

	* panel-run-dialog.glade:  HIGify the dialog:  adjust widget 
	padding and remove separator.  Fix regression of bug #98908, 
	the application description should be left aligned.

2003-05-20  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: fix srcdir != builddir.

2003-05-20  Duarte Loreto <happyguy_pt@hotmail.com>

        * panel-toplevel.c: Fix typo (vertivcal).

2003-05-19  Mark McLoughlin  <mark@skynet.ie>

	* panel-run-dialog.[ch]:
	Random re-formatting foo and:
	(get_url_from_input): add from Frank's original libgnome
	patch. Seems it never got in.
	
2003-05-19  Frank Worsley <fworsley@shaw.ca>

	* panel-run-dialog.c
	* panel-run-dialog.h
	* panel-run-dialog.glade
	the sweet new run program dialog

	* Makefile.am:
	added in the new files

	* menu.c: (add_to_run_dialog):
	* panel-action-button.c: (panel_action_run_program):
	* panel-action-protocol.c: (panel_action_protocol_run_dialog):
	moved to new run dialog function names

	* panel-util.c: (panel_get_unique_uri):
	copied from launcher.c, a function to get a unique uri
	for a given location and file suffix
	 
	* launcher.c: (launcher_location), (panel_launcher_save_ditem):
	now uses new util function to get unique uri
	
	* panel-util.h:
	updated for new function
	
	* panel.c:
	don't include gnome-run.h

2003-05-19  Mark McLoughlin  <mark@skynet.ie>

	* gnome-run.c: (unset_selected): Remove bogus unsetting
	of the pixmap. Fixes jitterines while typing - patch from
	nix@go-nix.ca.

2003-05-16  Padraig O'Briain  <padraig.obriain@sun.com>

	* gnome-panel-button (panel_menu_button_menu_popup_menu):
	Call gtk_menu_attach_to_widget() to attach menu to widget.
	Set "gtk-attached-menu" on button to the menu pending fix for
	bug #113112. This fixes bug #111573.

2003-05-14  Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* gnome-panel-screenshot.c (main): convert filename to utf-8 when
	it is set to gtk entry (#111064).

2003-05-13  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (panel_delete_without_query): remove FIXME.

2003-01-24  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add panel-force-quit.[ch] to the build.

	* panel-force-quit.[ch]: impl a safer more GNOMEish version
	of xkill.

	* menu.c: (create_button_menu): add the force quit button.

	* panel-action-button.[ch]: (panel_action_force_quit): ditto.

	* panel-stock-icons.[ch]: (panel_init_stock_icons_and_items):
	add the panel-force-quit stock icon.

2003-05-13  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: (panel_toplevel_update_attached_position),
	(panel_toplevel_update_normal_position),
	(panel_toplevel_update_auto_hide_position),
	(panel_toplevel_update_hidden_position), (get_delta),
	(panel_toplevel_update_animating_position),
	(panel_toplevel_update_position), (panel_toplevel_update_size),
	(panel_toplevel_animation_timeout),
	(panel_toplevel_start_animation), (panel_toplevel_instance_init):
	Add support for animated resizing and use it for drawers.

2003-05-12  Mark McLoughlin  <mark@skynet.ie>

	Fix loads of drawer bugs. Redo launcher hoarding. Don't
	save the absolute path of launchers.
	
	* applet.[ch]:
	(panel_applet_clean): unlink the .desktop file for
	launchers and delete the toplevel for drawers.
	(free_applet_to_load),
	(panel_applet_load_idle_handler),
	(panel_applet_queue_applet_to_load), (panel_applet_compare):
	re-factor so as to defer looking up the toplevel associated
	with an object so that objects on drawers load successfully
	after the drawer toplevel is loaded.
	
	* button-widget.c: (button_widget_expose):
	s/gdk_pixbuf_render_to_drawable_alpha/gdk_draw_pixbuf/
	
	* drawer.[ch]:
	(destroy_drawer): detach from the toplevel.
	(create_drawer_toplevel): load_toplevel now returns the
	toplevel. Also s/attached_panel_id/attach_toplevel_id/
	(panel_drawer_delete): impl deleting the associated toplevel.
	(drawer_load_from_gconf): don't free the toplevel_id. load_toplevel()
	takes ownership of it.
	
	* gnome-panel-screenshot.c: (on_preview_expose_event):
	s/gdk_pixbuf_render_to_drawable_alpha/gdk_draw_pixbuf/
	
	* launcher.[ch]: fix launcher hoarding and don't save the
	absolute path of the .desktop file.
	
	* panel-profile.[ch]:
	(panel_profile_load_toplevel): return the toplevel and
	free the toplevel_id if we fail. Also, don't actually
	show the toplevel - drawers shouldn't be shown until
	the button is shown.
	(panel_profile_load_and_show_toplevel): impl wrapper
	which loads and shows the toplevel.
	(panel_profile_load_object): upd.
	(panel_profile_toplevel_id_list_notify), (panel_profile_load):
	use load_and_show().

	* panel-toplevel.c:
	(panel_toplevel_update_attached_position): if the attached
	widget hasn't been allocated place the toplevel off-screen.
	(panel_toplevel_disconnect_attached): zero out the signal ids.
	(panel_toplevel_connect_attached): connect to the attached
	widget's hide/shown and hide/show the toplevel as appropriate.
	(panel_toplevel_attach_to_widget): update the hide buttons.
	
	* panel.c: (drop_internal_icon): create a copy of the .desktop
	file when dnd-ing launchers.

2003-05-09  Mark McLoughlin  <mark@skynet.ie>

	* install-defaults.sh: remove.
	
	* panel-default-setup.entries: add a gconf entries file
	to replace the install-defaults script.

	* Makefile.am: gconftool-2 --load panel-default-setup.entries.

2003-05-09  Mark McLoughlin  <mark@skynet.ie>

	Some fixes for migrating from 2.2.x.
	
	* panel-profile.[ch]:
	(panel_profile_prepare_object_with_id),
	(panel_profile_prepare_object): add an extra "right_stick"
	arg so we can set that if needs be.
	(panel_profile_load): migrate settings before monitoring
	for gconf changes so we don't get duplicate launchers and
	things.

	* drawer.c:
	(panel_drawer_create): upd.
	(drawer_load_from_gconf): fix FIXME typo.
	
	* launcher.c: (panel_launcher_create):
	* panel-action-button.c: (panel_action_button_create):
	* panel-applet-frame.c: (panel_applet_frame_create):
	* panel-menu-bar.c: (panel_menu_bar_create):
	* panel-menu-button.c: (panel_menu_button_create):
	upd for prepare_object() change.
	
	* panel-compatibility.c:
	(panel_compatibility_migrate_menu_panel_settings): when migrating
	an edge panel, set it to expand. Make the window menu right
	stuck and add it to the "applets" list and not the "objects" 
	list.
	(panel_compatibility_migrate_menu_button_settings): set the menu
	path with the menu's path not the icon path. Doh.
		
2003-05-07  Miloslav Trmac  <mitr@volny.cz>

	* panel-toplevel.schemas.in: Fixed some typos.

	* panel-general.schemas.in: Fixed pasto.

2003-04-19  Arvind Samptur <arvind.samptur@wipro.com>
	* gnome-run.c : (update_contents) (show_run_dialog) :
	Grab the focus on the run dialog entry when none of
	the applications have been selected in the list.
	Fixes bug #107095

2003-04-16  Rajkumar Sivasamy  <rajkumar.siva@wipro.com>

	* launcher.c: Place launcher's 	'Create Launcher' dialog
	center on the screen.
	Fixes Bug 110849

2003-04-15  Mark McLoughlin  <mark@skynet.ie>

	* panel-menu-bar.c: (panel_menu_bar_load): make the menu
	bar expand to fill the panel so clicking on the screen
	edge activates the menu. Fixes #104134.

2003-04-10  Dennis Cranston <dennis_cranston at yahoo.com>

	* gnome-run.c:  UI review changes for bug #98908.
	  - application description should be left aligned
	  - s/Append File.../Run with File...
	  - the entry at the top changes its dimension when the
	    icon dimension changes.
	  - s/Run Program.../Run Application...
	   
	* menu.c, panel-action-button.c, panel-general.schemas.in,
	  panel-menu-bar.c:  UI review changes for bug #98908.
	  - s/Run Program.../Run Application...
	   
2003-04-09  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (panel_applet_added): don't unhide the panel
	when applets are added. Fixes panel unhiding on login,
	bug #109604.

2003-04-09  Mark McLoughlin  <mark@skynet.ie>

	Update the sensitivity of the image/color configuration
	widgets as appropriate to the selected background type.
	Fixes #107609.

	* panel-properties-dialog.c:
	(panel_properties_dialog_upd_sensitivity): impl. making
	the color/image configuration widgets insentive as
	appropriate.
	(panel_properties_dialog_background_toggled),
	(panel_properties_dialog_setup_background_radios),
	(panel_properties_dialog_update_background_type): use it.
	Also remove all references to the transparency radio
	button. It doesn't exist anymore.

	* panel-properties-dialog.glade: name the containers of
	the image/color widgets sensibly so we can get a handle
	to them.

2003-04-09  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (panel_key_press_event): only activate the
	binding if its Ctrl-F10. Fixes #109791, Shift-F10 was
	popping up the panel's context menu not the applet's
	menu.

2003-04-08  Mark McLoughlin  <mark@skynet.ie>

	* panel-properties-dialog.glade: Commit patch from
	Luca Ferretti <elle.uca@libero.it> to make things a
	bit better.

2003-04-04  Padraig O'Briain  <padraig.obriain@sun.com>

	* gnome-run.c (browse_ok): Give focus to the entry field after a
	file has been appended using Append File. Fixes #86610.

	* drawer.c (key_press_drawer): Make left and right arrow keys move
	focus from drawer in horizontal panel to next item in panel. Up and
	down arrow keys move focus from open drawer into the drawer and have
	no effect for closed drawer. Similar behavior for vertical panels.
	Fixes bug #99176.

2003-04-01  Mark McLoughlin  <mark@skynet.ie>

	Fix long standing bug where size changes affected applet
	positions. E.g. make the panel bigger then smaller and
	there used to be gaps between all your launchers, changing
	the font size used to move the clock applet, adding an
	icon to the notification area and then removing it caused
	it to change position etc.

	* panel-widget.h: add another member to AppletData
	which tracks the actual position as it currently
	appears on the panel. AppletData:pos now corresponds
	to the user specified position as opposed to the
	constrained position.

	* panel-widget.c:
	(emit_applet_moved): impl.
	(panel_widget_cremove): fixup.
	(panel_widget_is_applet_stuck): re-write for clarity.
	(get_size_from_hints): respect the min_cells hint here.
	(allocate_dirty_child): use the constrained applet position
	and don't do any actual moving.
	(panel_widget_switch_applet_right),
	(panel_widget_switch_applet_left),
	(panel_widget_get_right_switch_pos),
	(panel_widget_get_left_switch_pos), (panel_widget_switch_move),
	(push_applet_right), (push_applet_left), (panel_widget_push_move),
	(panel_widget_right_stick): use the constrained position when
	figuring out where to move things and emit the moved signal at
	when applets have been moved.
	(panel_widget_size_allocate): don't make size changes affect
	the user specified position. Also don't saze the constrained
	position.
	(panel_widget_applet_drag_start_no_grab), (walk_up_to),
	(is_in_applet), (panel_widget_get_free_spot): upd. to use the
	constrained position as appropriate.
	(panel_widget_nice_move): emit the moved signal.
	(panel_widget_applet_move_to_cursor),
	(panel_widget_add): use the constrained positionl.
	(panel_widget_reparent): emit the moved signal.

2003-03-17  Alex Duggan  <aldug@astrolinux.com>

	* panel-menu-bar.c: string change in run dialog.  Fixes
	bug #100630

2003-03-14  Arvind Samptur  <arvind.samptur@wipro.com>
	* menu.[ch]: (menu_dummy_button_press_event) :
	On a right click on a menuitem, stop the propogation
	of the button_press_event to the Menu Bar applet.
	(create_menuitem) : Use menu_dummy_button_press_event().

	* panel-menu-bar.c : (panel_menu_bar_append_action_item) :
	* panel-recent.c : (panel_recent_append_documents_menu) :
	Use menu_dummy_button_press_event().

	Fixes bug #107737

2003-03-14  Matthias Clasen  <maclas@gmx.de>

	* main.c (main): Move session registration after profile loading
	to avoid setting an incomplete restart command.

2003-03-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-background.c: (background_changed): don't unref
	the desktop pixbuf if its NULL. Might fix bug #108062.

2003-03-10  Mark McLoughlin  <mark@skynet.ie>

	* panel-profile.c:
	(panel_profile_load_added_ids):
	(panel_profile_delete_removed_ids): both of these
	should return void. Thanks to Arvind for pointing
	it out.

2003-03-10  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c:
	(button_widget_theme_changed): reload the icon when the
	icon theme changes.
	(load_pixbuf), split out from button_load_pixbuf().
	(button_load_pixbuf): try loading with the icon basename
	first and if that fails use the full path. This will ensure
	that launchers with absolute paths for icons will theme
	correctly, #106649.
	(button_widget_instance_init): connect to the icon theme's
	'changed' signal.

	* launcher.[ch]: (free_launcher), (setup_button): remove handling
	the icon theme's "changed" signal here.

2003-03-07  Arvind Samptur <arvind.samptur@wipro.com>
	* panel-toplevel.c : (panel_toplevel_realize) : Remove the
	panel window from the window group. Else the WM will stack
	all the child windows of the panel above all apps.

	* xstuff.c : (xstuff_set_no_group) Remove the part 
	of disabling input.

	* panel-properties-dialog.c : (panel_properties_dialog_new):
	Revert the changes made on 2003-03-05 of setting the transient 
	parent for the dialog. It's no longer required.

	Fixes #107616

2003-03-07  Mark McLoughlin  <mark@skynet.ie>

	Fix #107775 - panel "forgets" it on the top and goes back
	to the bottom.

	* panel-toplevel.c: (panel_toplevel_update_expanded_position):
	Set toplevel->priv->x/y to the location the panel should be
	in when not hidden. These co-ordinates are not transient
	location of the panel.

2003-03-07  Mark McLoughlin  <mark@skynet.ie>

	* panel-profile.c: (panel_profile_add_to_list): fix bug with
	"New Panel". Another bug caused by my stupid "sprintf to
	static buffer" function.

2003-03-06  Arvind Samptur <arvind.samptur@wipro.com>
	* panel-properties-dialog.c : 
	(panel_properties_dialog_update_background_opacity) : When 
	recalculating the percentage, cast it to double. Else you always
	land up with one value less because of integer division and 
	that spins off the continuous scale setting. Fixes #107608
	Thanks to Satyajit for fighting this one.

2003-03-06  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.c: (nibble_on_file): destroy the dialog
	even if we are overwriting the file. Based on patch from Bala
	to fix #107112.

2003-03-06  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: (setup_button): unescape the tooltip. Patch
	from Bala to fix #107669.

2003-03-06  Mark McLoughlin  <mark@skynet.ie>

	* panel-background.c: (free_composited_resources): another leak
	fix from Kjartan which never got committed to HEAD.

2003-03-06  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (Bonobo_ServerInfoList_equals), (recheck_applet_list):
	re-enable the re-loading of the applet menu. It crashes for
	some people but we need to fix that.

2003-03-06  Mark McLoughlin  <mark@skynet.ie>

	* gnome-run.c: (find_icon_timeout), (add_icon_idle),
	(selection_changed): fix leaks - patch from Kjartan Maraas.
	#105911.

2003-03-05  Arvind Samptur  <arvind.samptur@wipro.com>
	* panel-properties-dialog.c : (panel_properties_dialog_new) :
	Set the tranisent parent for the properties dialog.
	Fixes #107616.

2003-03-05  Mark McLoughlin  <mark@skynet.ie>

	* AUTHORS: remove - authors are listed in the toplevel
	AUTHORS file.

	* TODO, TODO.old, new-toplevel-todo: kill - everythings
	in bugzilla now.

	* panel-toplevel.c: kill TODO list.

	* panel.c: (panel_size_change): don't update the size
	int the properties dialog here.

2003-03-05  Mark McLoughlin  <mark@skynet.ie>

	* panel-global-config.schemas.in: remove - has been renamed.

	* panel-per-panel-config.schemas.in: removed - default setup
	now install by install-defaults.sh.

2003-03-05  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-add-launcher.c: kill. Very old bit of
	cruft.

2003-03-05  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am, eggaccelerators.[ch]: re-instate
	eggaccelerators.[ch].

	* panel.c, panel_widget.c: remove the delete_dialog
	PanelWidget member and just use object data instead.
	Adapt the delete dialog code for PanelToplevel.

	* gnome-panel-screenshot.c: fix warning.

2003-03-05  Mark McLoughlin  <mark@skynet.ie>

	Implement migrating background settings and fix drawers.

	* new-toplevel-todo: upd.

	* drawer.c:
	(create_drawer_toplevel): create the drawer toplevel using
	GConf.
	(load_drawer_applet): refactor a little.

	* panel-compatibility.c:
	(panel_compatibility_map_orient_string),
	(panel_compatibility_map_orientation_string),
	(panel_compatibility_map_edge_string),
	(panel_compatibility_map_panel_type_string),
	(panel_compatibility_map_panel_size_string): fix assertions.
	(panel_compatibility_map_background_type_string),
	(panel_compatibility_migrate_background_settings): implement.

	* panel-profile.[ch]:
	(panel_profile_map_background_type): impl.
	(panel_profile_get_toplevel_by_id): return if the id is an
	empty string.
	(panel_profile_set_background_type): upd.
	(panel_profile_add_to_list): don't create a new if if we're
	passed a valid id.
	(panel_profile_load_toplevel): don't attempt to load if the
	id is an empty string.

2003-03-04  Mark McLoughlin  <mark@skynet.ie>

	Don't include drawer toplevels in the toplevel_id_list
	anymore. We just use the id from the drawer settings.
	This will prevent loading "orphaned" toplevels.

	* drawer.c:
	(create_empty_drawer_applet): add FIXME.
	(drawer_load_from_gconf): load the drawer toplevel from
	here.

	* panel-applet-frame.c: (panel_applet_frame_load): kill bogus
	creation of new ids.

	* panel-compatibility.c:
	(panel_compatibility_migrate_panel_type): set a flag if the
	panel is a drawer panel.
	(panel_compatibility_migrate_panel_settings): upd.
	(panel_compatibility_migrate_panel_id_list): remove drawer
	panels from the panel_id_list - drawer toplevels aren't on
	the toplevel_id_list now.

	* panel-profile.[ch]:
	(panel_profile_find_new_id): make sure new ids are unique
	within the directories, not only the id_lists. Requires
	ix just committed to GConf.

2003-03-04  Mark McLoughlin  <mark@skynet.ie>

	* install-defaults.sh: install the config into /apps/panel
	instead of /apps/new_panel.

	* menu.c: (remove_panel_query): prompt the user for confirmation
	when deleting panels. Delete the panel through GConf rather than
	just destroying the widget.

	* new-toplevel-todo: upd.

	* panel-applet-frame.c: (panel_applet_frame_construct_moniker):
	s/new_panel/panel/.

	* panel-compatibility.c:
	(panel_compatibility_migrate_panel_settings): auto_hide setting
	is a bool not an int.

	* panel-gconf.h, panel-general.schemas.in, panel-object.schemas.in,
	  panel-toplevel.schemas.in: s/new_panel/panel/.

	* panel-profile.c: (panel_profile_map_orientation_string),
	(panel_profile_map_speed_string),
	(panel_profile_map_background_type_string),
	(panel_profile_map_object_type_string): don't assert that the
	string argument is not NULL.
	(panel_profile_queue_toplevel_location_change),
	(panel_profile_toplevel_change_notify): kill debug.
	(panel_profile_delete_toplevel_objects): remove all the objects
	on the panel before deleteing it.
	(panel_profile_delete_toplevel): delete object.
	(panel_profile_load_toplevel): fix bogosity.

2003-03-04  Mark McLoughlin  <mark@skynet.ie>

	More or less finish of the compatibility code.

	* panel-compatibility.[ch]:
	(panel_compatibility_migrate_menu_panel_settings): mimic
	a menu panel by adding the menu bar and window menu applets
	to the configuration here rather than creating them after
	all other applets have been loaded.
	(panel_compatibility_migrate_panel_id): split out from
	migrate_panel_id_list().
	(panel_compatibility_migrate_drawer_settings),
	(panel_compatibility_migrate_menu_button_settings),
	(panel_compatibility_migrate_objects):impl
	(panel_compatibility_migrate_panel_id_list): upd.
	(panel_compatibility_warn),
	(panel_compatibility_load_menu_panel),
	(panel_compatibility_load_applets): kill.

	* panel-object.schemas.in: s/attached_panel_id/attached_toplevel_id/.

	* panel-profile.[ch]:
	(panel_profile_prepare_object_with_id): split out from prepare_object()
	so we can create applets for a toplevel that doesn't yet exist.
	(panel_profile_prepare_object): upd.

	* applet.c: (panel_applet_load_idle_handler): don't load menu
	panel applets from here.

2003-03-03  Mark McLoughlin  <mark@skynet.ie>

	* panel-compatibility.c:
	(panel_compatibility_migrate_edge_panel_settings),
	(panel_compatibility_migrate_drawer_panel_settings),
	(panel_compatibility_migrate_corner_panel_settings),
	(panel_compatibility_migrate_sliding_panel_settings),
	(panel_compatibility_migrate_floating_panel_settings),
	(panel_compatibility_migrate_menu_panel_settings): set whether
	or not the toplevel is expanded.
	(panel_compatibility_migrate_panel_settings): copy across the
	auto hide setting. I never even knew that the old setting was
	an enum stored as an int. Bork.
	(panel_compatibility_migrate_panel_ids): iterate across the
	objects list changing the panel_ids to new toplevel_ids.
	(panel_compatibility_migrate_panel_id_list): retain a map
	of our panel_id -> toplevel_id renaming and pass it into
	migrate_panel_ids().

2003-03-03  Mark McLoughlin  <mark@skynet.ie>

	* applet.c, drawer.c, install-defaults.sh,
	  panel-object.schemas.in, panel-profile.c:
	s/panel_id/toplevel_id/ gconf setting for objects. Needed to
	rename the key as we rename the panels when migrating
	panel_id_list.

	* panel-compatibility.[ch]:
	(panel_compatibility_migrate_panel_id_list): rename.

2003-03-03  Mark McLoughlin  <mark@skynet.ie>

	* panel-compatibility.[ch]:
	(panel_compatibility_map_orient_string),
	(panel_compatibility_map_orientation_string),
	(panel_compatibility_map_edge_string),
	(panel_compatibility_map_panel_type_string),
	(panel_compatibility_map_panel_size_string),
	(panel_compatibility_migrate_background_settings),
	(panel_compatibility_migrate_edge_panel_settings),
	(panel_compatibility_migrate_drawer_panel_settings),
	(panel_compatibility_migrate_corner_panel_settings),
	(panel_compatibility_migrate_sliding_panel_settings),
	(panel_compatibility_migrate_floating_panel_settings),
	(panel_compatibility_migrate_menu_panel_settings),
	(panel_compatibility_migrate_panel_types),
	(panel_compatibility_migrate_panel_settings),
	(panel_compatibility_load_panel_id_list): begin implementing
	backwards compat with the old settings format.

	* panel-profile.[ch]:
	(panel_profile_map_orientation): impl.
	(panel_profile_set_toplevel_orientation): upd.
	(panel_profile_load): load the old panel_id_list if toplevel_id_list
	isn't set.

	* panel-toplevel.c: add a TODO item.

2003-03-03  Mark McLoughlin  <mark@skynet.ie>

	Only register the toplevel keybindings once, remove the toplevel
	pointer resizing feature, fix applets getting added to the panel
	in the wrong place and make toplevel bindings work when focus
	is on an out-of-proc applet.

	* panel-bindings.[ch]:
	(get_binding_set), (panel_binding_clear_entry),
	(panel_binding_set_entry), (panel_binding_changed),
	(panel_bindings_set_entries): set the bindings on PanelToplevel's
	GtkBindingSet once, rather than for each toplevel.

	* panel-toplevel.[ch]:
	(panel_toplevel_begin_grab_op): make the assert a normal condition.
	(panel_toplevel_handle_grab_op_motion_event): upd.
	(panel_toplevel_get_resize_op): kill.
	(panel_toplevel_button_press_event): kill the resize code.
	(panel_toplevel_update_cursor_for_resize): don't change the cursor
	at the edge of the panel.
	(panel_toplevel_motion_notify_event): kill the resize code.
	(panel_toplevel_class_init): set the bindings here.
	(panel_toplevel_instance_init): don't register the toplevel with
	the bindings code.
	(panel_toplevel_set_binding), (panel_toplevel_unset_binding): kill.

	* panel.c:
	(panel_popup_menu): retain the correct axis offset for object
	insertion.
	(panel_key_press_event): activate all keybindings when focus is
	on out-of-proc applets, not just the shift-F10 binding.

2003-03-03  Mark McLoughlin  <mark@skynet.ie>

	Fix bugs with yesterdays commit - it wasn't as broken as I
	thought it was.

	* panel-profile.c:
	(panel_profile_prepare_object): get the directory for applets
	correct.
	(panel_profile_object_id_list_notify): split the objects list
	into a sublist of either applets or objects when searching for
	removed ids. Also load queued objects.

	* panel-toplevel.c: (panel_toplevel_begin_grab_op): don't warp
	the pointer if its a pointer based drag.

	* drawer.c: (panel_drawer_create):
	* launcher.c: (panel_launcher_create):
	* panel-action-button.c: (panel_action_button_create):
	* panel-applet-frame.c: (panel_applet_frame_create):
	* panel-menu-bar.c: (panel_menu_bar_create):
	* panel-menu-button.c: (panel_menu_button_create): the first
	arg for panel_profile_prepare_object() is PanelObjectType not
	PanelGConfKeyType.

2003-03-02  Mark McLoughlin  <mark@skynet.ie>

	Pretty broken patch - just a safety sync. Makes the panel object
	gconf code a lot more sane and also share code with (and behave
	similarily to) the toplevel code.

	* new-toplevel-todo: update

	* Makefile.am: don't gen enums from panel-widget.h,
	panel-action-button.h and panel-toplevel.h.

	* applet.[ch]:
	(panel_applet_clean_gconf): kill.
	(panel_applet_clean): do not do any gconf related stuff here.
	(applet_idle_remove): kill the remove in idle stuff.
	(applet_remove_callback): delete the object via gconf.
	(applet_callback_callback), (applet_do_popup_menu),
	(panel_applet_destroy), (panel_applet_load_idle_handler): various
	random updates.
	(panel_applet_queue_applet_to_load): split out the code that
	reads the object's config into panel-profile.o
	(panel_applet_load_queued_applets): rename and remove the gconf
	loading code.
	(panel_applet_save_position): upd.
	(panel_applet_get_id), (panel_applet_get_by_id),
	(panel_applet_list_applets): impl so we don't have to use global
	variables and poke in structures everywhere.
	(panel_applet_register): kill the applet count/id thing - unused.
	
	* drawer.[ch]:
	(properties_apply_callback): disable saving change for now.
	(drag_data_get_cb): upd.
	(load_drawer_applet): make static, don't return anything.
	(panel_drawer_create): new function for creating new drawers.

	* gnome-desktop-item-edit.c: (panel_applet_list_applets): hack
	so that this thing links.

	* launcher.[ch]: 
	(panel_launcher_save_ditem): split out from launcher_save() so we
	can save a ditem before loading a launcher.
	(free_launcher): upd.
	(create_launcher): don't allow a ditem to be passed in.
	(properties_apply): disable saving prefs changes for now.
	(load_launcher_applet): don't return anything, kill _full() variant.
	(launcher_load_from_gconf): don't hoard all launchers - may want to
	change this back again, we'll see.
	(really_add_launcher): save the ditem before creating the launcher.
	(panel_launcher_create_from_info), (panel_launcher_create): new
	functions for creating a new launcher object.
	(launcher_save), (find_launcher): upd.

	* main.c: kill the applets global list - its static in applet.c now.

	* menu.c: (add_app_to_panel), (add_drawers_from_dir),
	(add_menu_to_panel), (add_drawer_to_panel),
	(add_action_button_to_panel), (add_menu_bar_to_panel),
	(add_launcher), (add_bonobo_applet): use the new object creation
	functions instead of the old loading ones.
	(remove_panel_accept): delete the object via gconf.

	* panel-action-button.[ch]:
	(panel_action_button_load): don't return anything.
	(panel_action_button_create): new function for creating new action
	buttons.
	(panel_action_button_load_compatible): impl.
	(panel_action_button_load_from_gconf): don't return anything.
	(panel_actoin_button_save_to_gconf): kill.
	(panel_action_button_load_from_drag): upd.

	* panel-applet-frame.[ch]:
	(popup_handle_remove): delete the applet via gconf.
	(panel_applet_frame_load): make static, don't return anything.
	(panel_applet_frame_create): implement.
	(panel_applet_frame_reload_response),
	(panel_applet_frame_loading_failed): update.

	* panel-compatibility.c: (panel_compatibility_load_applets): use
	new applet creation functions.

	* panel-enums.h: move some enums into here.

	* panel-gconf.[ch]: (panel_gconf_key_type_to_id_list): impl.

	* panel-globals.h: kill the applets list.

	* panel-menu-bar.[ch]:
	(panel_menu_bar_load): make static, don't return anything.
	(panel_menu_bar_create): implement.

	* panel-menu-button.[ch]: ditto.

	* panel-profile.[ch]:
	(panel_profile_map_object_type_string): impl object type mapping
	utility method.
	(panel_profile_add_to_list), (panel_profile_remove_from_list),
	(panel_profile_create_toplevel), (panel_profile_delete_toplevel),
	(panel_profile_destroy_toplevel), (panel_profile_prepare_object),
	(panel_profile_delete_object), (panel_profile_load_object),
	(panel_profile_destroy_object), (panel_profile_delete_dir),
	(panel_profile_object_exists), (panel_profile_id_exists),
	(panel_profile_load_added_ids), (panel_profile_delete_removed_ids),
	(panel_profile_toplevel_id_list_notify),
	(panel_profile_object_id_list_notify), (panel_profile_load_list),
	(panel_profile_copy_default_objects_for_screen): move all the
	applets loading code into here, merge it with the toplevel loading
	and notification handling code ... make it all perfect :)

	* panel-toplevel.c: (panel_toplevel_update_attach_orientation),
	(panel_toplevel_attach_widget_parent_set): move some code around
	to fix warning.

	* panel-util.c: (panel_find_applet_index): rename.

	* panel.[ch]: (orientation_change), (size_change), (back_change),
	(panel_applet_removed), (panel_remove_applets), (drop_url),
	(drop_menu), (drop_nautilus_uri), (drop_directory), (drop_urilist),
	(drop_internal_icon), (move_applet), (drop_internal_applet),
	(panel_receive_dnd_data), (panel_screen_from_panel_widget): various
	update for the changes above.

2003-02-28  Mark McLoughlin  <mark@skynet.ie>

	* panel-profile.c: (panel_profile_copy_defaults): rename from
	panel_configuration_copy_defaults.
	(panel_profile_copy_defaults_for_screen),
	(panel_profile_append_new_ids),
	(panel_profile_load_defaults_on_screen),
	(panel_profile_ensure_toplevel_per_screen),
	(panel_profile_load): implement loading the default toplevels
	on the non-default screens on multiscreen setups.

2003-02-27  Mark McLoughlin  <mark@skynet.ie>

	Allow drawers to be moved by moving the toplevel.

	* new-toplevel-todo: upd.

	(panel_applet_frame_button_changed): use the event time.
	* panel-widget.[ch]: (panel_widget_applet_drag_start): accept the
	event time as an argument.
	(panel_widget_applet_move_to_cursor): pass in CurrentTime
	(panel_widget_applet_event): use the event time.

	* panel-toplevel.c:
	(panel_toplevel_begin_attached_move): when attached, move by
	initiating a move on the drawer button.
	(panel_toplevel_begin_grab_op): use it here.
	(panel_toplevel_update_buttons_showing): shuffle.
	(panel_toplevel_attach_widget_parent_set): impl handling
	when the drawer button is moved to another panel.
	(panel_toplevel_connect_attached): hook it up.

	* applet.c: (move_applet_callback): use CurrentTime for
	drag event time.

	* panel-applet-frame.c: (popup_handle_move), use CurrentTime.

2003-02-27  Mark McLoughlin  <mark@skynet.ie>

	Don't draw a bevel around the panel when we've got a color
	or image background.

	* new-toplevel-todo: upd.

	* panel-background.[ch]: (panel_background_prepare): split out
	figuring out what type of background we're rendering to
	(panel_background_effective_type): here.

	* panel-profile.c: (panel_profile_background_change_notify):
	update the toplevel edges.

	* panel-toplevel.c: (panel_toplevel_update_edges): don't draw
	any edges if we've got a color or image background.

2003-02-27  Mark McLoughlin  <mark@skynet.ie>

	* new-toplevel-todo: add todo list of what needs to be done
	before merging back to HEAD.

2003-02-27  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: kill global-keys.[ch]

	* throughout: use panel_gconf_get_client() - gconf_client_get_default
	isn't a lightweight accessor.

	* panel-config-global.[ch]:
	(panel_global_config_get_highlight_when_over),
	(panel_global_config_get_enable_animations),
	(panel_global_config_get_drawer_auto_close),
	(panel_global_config_get_tooltips_enabled),
	(panel_global_config_get_confirm_panel_remove): impl these accessors so
	we don't have to use a global variable.
	(panel_global_config_set_entry): actually directly handle changes so we can
	kill panel_apply_global_config() - also make the function statis.
	(panel_global_config_notify): make static.
	(panel_global_config_load): move initialisation from main() to here.

	* panel-session.[ch]:
	(panel_session_request_logout): don't require passing in a client.
	(panel_session_handle_die_request): make static.
	(panel_session_init): move initialisation here from main ().

	* button-widget.c: (button_widget_expose),
	(button_widget_leave_notify): upd for global_config changes.

	* drawer.c:
	(load_drawer_applet): add the drawer button to the parent toplevel,
	not the drawer toplevel - oops :-)

	* launcher.c: (launch_cb): upd for global_config changes.

	* main.c: (main): upd for global_config and session changes.

	* menu.c: (drag_end_menu_cb),
	(remove_panel_query), (setup_remove_this_panel): global_config changes.
	(make_panel_submenu): remove the "Toplevel testing" menu.

	* panel-action-button.c:
	(panel_action_logout),
	(panel_action_button_clicked):  upd for global_config and session changes.

	* panel-gconf.c:
	(panel_gconf_all_global_entries), (panel_gconf_get_int),
	(panel_gconf_get_string), (panel_gconf_get_bool),
	(panel_gconf_set_int), (panel_gconf_set_string),
	(panel_gconf_set_bool): kill cruft.

	* panel-globals.h: kill global_config.

	* panel-profile.c:
	(panel_profile_set_queued_changes),
	(panel_profile_set_commit_timeout): take a toplevel as the first
	arg rather than a GObject.

	* panel-util.[ch]: kill accelerator parsing code.

	* panel.c:
	(panel_destroy): don't kill the properties dialog here - it gets
	destroyed automagically when the toplevel is destroyed.
	(panel_load_global_config): move to panel-config-global.c
	(panel_save_global_config): wtf ? we never change the global
	configuration anywhere in the panel - why on earth were we saving
	it ?

	* xstuff.[ch]: kill xstuff_init.

2003-02-25  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_register): disable the initial
	applet background change for now.

	* panel-background.[ch]: re-work this substantially so we
	can change individual elements of the background configuration
	seperately. Also remove the "loading" phase.

	* panel-gconf.[c]: (panel_gconf_dirname): impl.

	* panel-profile.[ch]: implement support for the background
	configuration.

	* panel-properties-dialog.c: add an initial implementation of
	the background page of the dialog. Still needs a bit of fixage
	but its mostly done.

	* panel-properties-dialog.glade: re-work the background page,
	ripping of gnome-terminal's background page.

	* panel-widget.[ch]: (panel_widget_class_init): kill the "back_change"
	signal.
	(panel_widget_size_allocate): kill the "inhibit_draw" stuff. Unused.
	(panel_widget_set_back_pixmap), (panel_widget_set_back_color): kill.
	(panel_widget_new): remove all 6 background related arguments from
	this.
	(panel_widget_change_params): kill. Wohoo.
	(panel_widget_set_orientation),
	(panel_widget_set_size): don't use panel_widget_change_params. Do
	each change individually.

	* panel-toplevel.c: (panel_toplevel_setup_widgets): update for
	panel-widget changes.

	* panel.c:
	(panel_applet_added): disable the background change stuff for the
	moment.
	(set_background_image_from_uri),
	(set_background_color): impl these a bit more sanely.
	(drop_urilist), (panel_receive_dnd_data): upd.

2003-02-21  Mark McLoughlin  <mark@skynet.ie>

	* panel-config.c, panel-config.h: kill.

	* panel-properties-dialog.[ch], panel-properties-dialog.glade:
	first cut at a new properties dialog. The background settings
	haven't been implemented yet.

	* panel-profile.[ch]: (panel_profile_map_orientation_string),
	(panel_profile_map_speed_string),
	(panel_profile_map_background_type_string): impl helpers for
	mapping enums.
	(panel_profile_set_toplevel_name),
	(panel_profile_get_toplevel_name),
	(panel_profile_set_toplevel_orientation),
	(panel_profile_get_toplevel_orientation), (get_background_type),
	(set_orientation_from_string), (set_animation_speed_from_string):
	Impl reading/writing various toplevel properties through gconf.
	(panel_profile_toplevel_notify_add): helper for adding a notify
	for a given panel.
	(panel_profile_load_toplevel): use it.

	* Makefile.am: build panel-properties-dialog.[ch] instead of
	panel-config.[ch] and install panel-properties-dialog.glade.

	* applet.c, drawer.h: don't include panel-config.h.

	* menu.c: (create_toplevel_testing_menu), (make_panel_submenu):
	kill the "Toggle Animations" item and add back the properties
	item.

	* panel-applet-frame.c: (panel_applet_frame_get_size_string):
	fix.

	* panel-background.h: include panel-enums.h.

	* panel-types.h: move PanelBackground Type to panel-enums.h.

	* panel-toplevel.[ch]:
	(panel_toplevel_setup_widgets): upd.
	(panel_toplevel_get_description): impl.

	* panel-widget.[ch]: (panel_widget_class_init), kill the orient-changed
	signal - we use the toplevel's orientation now.
	(panel_widget_finalize), (panel_widget_instance_init),
	(panel_widget_new), (panel_widget_change_params): kill the panel_id
	stuff from this widget - the panel id is associated with the toplevel
	now.

	* panel.c: (panel_data_by_id): kill.

2003-02-20  Mark McLoughlin  <mark@skynet.ie>

	Some fairly extensive, but random, hacking - got the applets
	gconf code going again, re-implemented the menu applet ...

	* Makefile.am: remove session.[ch] and panel-main.h. Add
	panel-menu-button.[ch], panel-session.[ch] and panel-globals.h.

	* install-defaults.sh: add the default applets.

	* applet.[ch]: re-enable the old applets loading/saving code
	with various fixes.

	* panel-menu-button.[ch]: re-implement the menu applet a bit
	more sanely.

	* panel-session.[ch]: new files - basically session.[ch] minus
	all the old config syncing crap.

	* panel-globals.h: lets keep track of all the globals in the
	one place. 'Course, preferably they shouldn't exist.

	* button-widget.c: include panel-globals.h.

	* drawer.[ch]:
	(create_empty_drawer_applet): take a toplevel for the parent
	panel rather than a PanelWidget.
	(load_drawer_applet): re-factor this.
	(drawer_save_to_gconf),
	(drawer_load_from_gconf): impl support for the new schemas.

	* global-keys.c: include panel-globals.h.

	* gnome-run.c: ditto.

	* launcher.[ch]: re-enable the gconf code. Fixup a fair bit of stuff.

	* main.c: (main): remove the menu aging crap, define all globals
	here and don't bother connecting to "save-yourself".

	* menu-fentry.c: include panel-globals.h.

	* menu-util.[ch]: (get_real_menu_path), (get_pixmap): kill.

	* menu.[ch]: (add_drawers_from_dir): upd.
	remove the menu applet code.

	* panel-action-button.c: re-enable and fixup the gconf code.

	* panel-applet-frame.[ch]: ditto.

	* panel-compatibility.c: include panel-globals.h.

	* panel-config-global.[ch]: (panel_global_config_set_entry): dump
	the "keep_menus_in_memory" key.

	* panel-global-config.schemas.in, panel-config.c: ditto.

	* panel-enums.h: move the PanelGConfKeyType enum to here.

	* panel-gconf.h: move the various base dir definitions to here.

	* panel-gconf.c: (panel_gconf_general_key), (panel_gconf_full_key):
	use them here.

	* panel-profile.[ch]:
	(panel_profile_get_toplevel_by_id): impl locating a toplevel by its id.
	(panel_profile_find_new_id): impl finding a sane key for new panels/
	objects instead of using gconf_unique_key().
	(panel_profile_get_toplevel_key),
	(panel_profile_load_toplevel), (panel_profile_delete_toplevel_dir),
	(panel_profile_create_added_toplevels),
	(panel_profile_create_toplevel), (panel_profile_delete_toplevel),
	(panel_configuration_copy_defaults): upd.
	(panel_profile_load): load applets.
	(get_program_listing_setting),
	(panel_profile_set_show_program_list): fix brokeness.

	* panel-stock-icons.c: include panel-globals.h.

	* panel-toplevel.[ch]: (panel_toplevel_is_last_unattached): impl.
	finding out is a given panel the last non-drawer one - i.e. can
	whether or not we delete it.

	* panel-util.c, panel-widget.c: include panel-globals.h

	* panel.[ch]: killall the gconf code and update for the varius
	menu changes.

2003-02-18  Mark McLoughlin  <mark@skynet.ie>

	* panel-object.schemas.in: fix some typos. Thanks G.

2003-02-18  Mark McLoughlin  <mark@skynet.ie>

	* panel-object.schemas.in: add a set of schemas for
	applets/launchers etc. Wow, I'd forgotten how big a mess
	it was before.

	* panel-compatibility.c: list where the new schemas are
	incompatible from the old keys.

	* Makefile.am: build and install panel-object.schemas.

2003-02-18  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_new_panel), (remove_panel_accept):
	use panel_profile_(create|delete)_toplevel().

	* panel-gconf.c: (panel_gconf_clean_dir): also unassociate
	schemas as you go.

	* panel-profile.[ch]:
	(panel_profile_load_toplevel): if the toplevel doesn't exist,
	setup the directory.
	(panel_profile_delete_toplevel_dir), (panel_profile_id_exists),
	(panel_profile_create_added_toplevels),
	(panel_profile_toplevel_exists),
	(panel_profile_delete_removed_toplevels),
	(panel_profile_toplevel_id_list_notify),
	(panel_profile_load_toplevel_list): Impl creating and deleting
	toplevels as the toplevel_id_list is modified.
	(panel_profile_find_new_id),
	(panel_profile_create_toplevel), (panel_profile_delete_toplevel):
	create and delete toplevels by modifying the toplevel_id_list.
	(panel_profile_load): add the "general" dir for notifications.

	* panel-toplevel.[ch]: (panel_toplevel_list_toplevels),
	(panel_toplevel_finalize), (panel_toplevel_instance_init):
	Impl. keeping a track of a list of all toplevels.

2003-02-14  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: make the binary gnome-new-panel for the
	moment. Build panel-profile.[ch] and use install-defaults.sh
	to install the default setup.

	* panel-profile.[ch]: start of the new GConf implementation. Loading
	toplevels, changing toplevels configuration, responding to changes in
	toplevels setttings work. Need to impl support for applets, objects and
	the panel background.

	* panel-toplevel.c:
	(panel_toplevel_move_resize_window): split this out from size_request.
	(panel_toplevel_realize): use it here.
	(panel_toplevel_size_request): upd.
	(panel_toplevel_button_press_event): initialise the grab offsets from
	the event rather than the current pointer location.

	* install-defaults.sh: gconftool script to install the default
	panel setup. Will be replaced by a gconftool-2 --load < defaults.xml
	thing when I get a chance.

	* panel-toplevel.schemas.in: change where these are installed and
	also split out the opacity from the background color the way it was
	previously.

	* panel-global.schemas.in: rename from panel-global-config.schemas.in.

	* panel-general.schemas.in: add.

	* panel-gconf.[ch]:
	(panel_gconf_get_profile): kill.
	(panel_gconf_basename): basically g_basename(), but hardcodes
	"/" instead of G_DIR_SEPERATOR.
	(panel_gconf_copy_dir): impl copying a directory full of entries.
	(panel_gconf_associate_schemas_in_dir): don't use GError.
	(panel_gconf_setup_profile): kill.
	(panel_gconf_load_default_config_for_screen): don't use GError.

	* main.c: (main): use panel_profile_load() instead of session_load().

	* panel.c: (panel_load_panels_from_gconf): kill.

	* session.[ch]: (panel_session_set_restart_command): upd.
	(session_load): kill.

	* menu.c: (init_menus): um, don't read all the .desktop files for
	applets on startup - um ... .desktop files for applets ? I think
	we might have missed some thing while porting :-)
	(toggle_expand), (toggle_auto_hide),
	(toggle_animations), (toggle_buttons), (toggle_arrows): make
	all these changes through GConf instead of to the widget directly.

	* gnome-run.c: (sync_entry_to_list), (toggle_contents),
	(create_disclosure_widget), (create_simple_contents),
	(update_contents), (show_run_dialog): use
	panel_profile_get_(show|enable)_program_list().

	* panel-applet-frame.c: (panel_applet_frame_construct_moniker): the
	configuration is stored in /apps/new_panel temporarily while this stuff
	is being worked on.

	* panel-bindings.c: (panel_bindings_register_toplevel): actually set
	initialise to TRUE. Pointed out by Arvind ... dunno why he didn't
	commit it.

	* applet.c, drawer.c, launcher.c, panel-action-button.c: disable
	more gconf related stuff.

2003-02-07  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.schemas.in: add some schemas.

	* panel-toplevel.c: change the default hide/unhide delays/

2003-02-06  Mark McLoughlin  <mark@skynet.ie>

	* panel-toplevel.c: implement keybindings for move/resize
	etc. Merge with the pointer move/resize code. Fix many
	little glitches.

	* panel-bindings.c: (panel_bindings_initialise): kill debug.

	* panel-frame.c: (panel_frame_size_request): always request
	enough room to draw the frame on all edges so we don't get
	weird resizing glitches.

	* panel-xutils.[ch]: (panel_warp_pointer): impl.

2003-01-31  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add panel-bindings.[ch].

	* panel-bindings.[ch]: read and monitor metacity's
	window binding preferences to use for keybindings
	on the toplevel. But metacity grabs these keys even
	on DOCK windows, so hmm ...

	* panel-toplevel.[ch]:
	(panel_toplevel_toggle_expand), (panel_toplevel_expand),
	(panel_toplevel_unexpand), (panel_toplevel_toggle_hidden),
	(panel_toplevel_begin_move), (panel_toplevel_begin_resize):
	Add stubs for the keybindings. Don't implement until I figure
	what to do about the metacity problem.
	(panel_toplevel_class_init): add signals for all these bindings.
	(panel_toplevel_instance_init): load the bindings.
	(panel_toplevel_set_binding), (panel_toplevel_unset_binding):
	methods to set/unset the binding - use by panel-bindings.c.

2003-01-31  Mark McLoughlin  <mark@skynet.ie>

	Make drawers work more or less and implement resizing the
	panel using the pointer.

	* button-widget.c: (draw_arrow): hmm, I think the semantics
	of the orientation has been reversed. Fix this bug, but there
	is probably more.

	* drawer.c:
	(create_empty_drawer_applet): actually create the toplevel.
	(set_drawer_applet_orientation): don't set the toplevel
	orienation.

	* panel-toplevel.c:
	(panel_toplevel_update_buttons_showing): if this is a drawer,
	then hide one of the buttons.
	(panel_toplevel_update_attached_position): snap to the edge
	of the attach toplevel, not the attach widget.
	(panel_toplevel_reverse_arrow), (panel_toplevel_reverse_arrows),
	(panel_toplevel_disconnect_attached),
	(panel_toplevel_connect_attached): reverse the arrows on the
	buttons when attached.
	(panel_toplevel_get_resize_edge): function to get the edge, if
	any, which we would resize on from this position.
	(panel_toplevel_edge_to_cursor): return the resize cursor type
	for a given edge.
	(panel_toplevel_button_press_event): if we're within a few pixels
	from the panel edge start a resize drag.
	(panel_toplevel_button_release_event): unset all drag flags.
	(panel_toplevel_update_cursor_for_resize): set the resize cursor.
	(panel_toplevel_resize_to_pointer): resize based on pointer
	location.
	(panel_toplevel_motion_notify_event): handle resizing and setting
	the resize cursor from here.
	(panel_toplevel_set_size): don't try and maintain the current
	position on a resize here. We do that in resize_to_pointer().

	* panel.c:
	(panel_widget_setup): don't connect to the PanelWidget orientation
	change signal - that only notifies of changes between horiz/vert.
	(panel_setup): connect to notify::orientation on the toplevel
	instead.

2003-01-29  Mark McLoughlin  <mark@skynet.ie>

	Replace BasePWidget and co. with a single widget written
	from scratch. Basically, this means there are is no
	such thing as panel types any more - you can easily
	swicth between what was an edge panel to what was a
	corner/floating/sliding panel. Switching between corner/
	floating/sliding is just a matter of moving the panel.

	Some other improvements in the widget like auto hiding
	into corners, stock gtk arrows for the hide buttons,
	no shadow at the screen edge, simpler (and hopefully
	smoother) animations.

	This patch isn't finished. Loading/saving Configuration
	doesn't work, drawers don't work (implemented but crashing),
	propert keynav for the widget has to be implemented etc.
	See the TODO in panel-toplevel.c

	* Makefile.am: remove loads of files, add a good few
	files. Generate enums from panel-enums.h. Only ever
	generate enum types, not flags types.

	* aligned-widget.[ch], basep-widget.[ch], border-widget.[ch],
	  drawer-widget.[ch], edge-widget.[ch], floating-widget.[ch],
	  sliding-widget.[ch]: remove these.

	* panel-toplevel.[ch]: add a new toplevel panel widget.
	A complete rewrite BasePWidget and co., and consolidates
	them all into a single widget.

	* panel-frame.[ch]: new widget which doesn't draw the shadow
	at the screen edge. Should help us with our Fitt worshipping.

	* applet.c: comment out all gconf/configuration code
	for the moment and update everything to use PanelToplevel
	instead of BasePWidget and co.

	* button-widget.[ch]:
	(calculate_overlay_geometry): remove some overlaying which
	isn't needed anymore.
	(button_widget_realize), (button_widget_parent_set),
	(button_widget_get_property), (button_widget_set_property),
	(draw_arrow), (button_widget_expose),
	(button_widget_size_allocate), (button_widget_instance_init),
	(button_widget_class_init), (button_widget_new),
	(button_widget_new_from_stock), (button_widget_set_params):
	Update for toplevel changes plus use PanelOrientation everywhere
	instead of PanelOrient.

	* drawer.[ch]: re-write big chunks of this to use PanelToplevel.
	None of this is really tested, though, and is broken atm.

	* global-keys.c: (panel_global_keys_filter): update for new
	autohide blocking mechanism.

	* gnome-run.c: update for multiscreen/a11y function renaming.

	* launcher.c: update to use PanelToplevel.

	* main.c: (main): various updates and kill initial state change
	crack.

	* menu-util.c: upd for multiscreen renaming.

	* menu.c: (menuitem_to_screen), (menu_on_screen),
	(add_app_to_panel), (add_drawers_from_dir),
	(add_menudrawer_to_panel), (add_menu_to_panel), (show_item_menu),
	(add_drawer_to_panel), (add_action_button_to_panel),
	(add_menu_bar_to_panel), (add_launcher), (menu_deactivate),
	(add_bonobo_applet): various unexciting updates.
	(find_empty_pos_array), (find_empty_pos),
	(find_empty_edge), (find_empty_border_and_anchor): disable all
	this initial panel position code until I figure out how to
	replace it.
	(create_new_panel): no more different panel types - this is a
	tiny function now.
	(create_add_panel_submenu): no "New Panel" submenu anymore.
	(remove_panel_accept): upd.
	(remove_panel_query): disable the "you can't remove your last
	panel" code for the moment.
	(setup_remove_this_panel): ditto.
	(current_panel_config): disable configuration dialog for the
	moment.
	(toggle_expand), (toggle_auto_hide), (rotate_clockwise),
	(rotate_counter_clockwise), (increase_size), (decrease_size),
	(toggle_animations), (toggle_buttons), (toggle_arrows),
	(create_toplevel_testing_menu), (make_panel_submenu): replace
	with a submenu for testing the new toplevel widget.
	(create_panel_context_menu), (ask_about_launcher_cb),
	(menu_button_menu_popup), (create_panel_menu),
	(create_menu_applet), (set_menu_applet_orientation),
	(load_menu_applet): more unexciting updates.

	* multiscreen-stuff.[ch]: rename to panel-multiscreen.[ch] (wow)
	and use GdkScreen instead of the screen number everywhere.

	* panel-access.c: rename to panel-a11y.[ch].

	* panel-action-button.c: more unexciting updates.

	* panel-applet-frame.[ch]:
	(panel_applet_frame_change_orientation): give up trying to keep
	the internal orientation enum in sync with the IDL definition,
	just map between the two when setting the property.
	(panel_applet_frame_paint), (panel_applet_frame_constrain_size),
	(panel_applet_frame_size_request),
	(panel_applet_frame_size_allocate),
	(panel_applet_frame_loading_failed),
	(panel_applet_frame_instance_init),
	(panel_applet_frame_get_orient_string),
	(panel_applet_frame_construct): upd for above.

	* panel-compatibility.c:
	(panel_compatibility_load_menu_panel): disable for the moment.

	* panel-config.[ch]: disable all this too.

	* panel-types.h: remove some enums.

	* panel-util.c: upd.

	* panel-widget.[ch]: (add_all_move_bindings),
	(panel_widget_size_allocate), (panel_widget_realize),
	(panel_widget_unrealize), (panel_widget_new),
	(panel_widget_reparent),(panel_widget_change_params): nothing
	exciting here.
	(panel_widget_set_packed), (panel_widget_set_orientation),
	(panel_widget_set_size): new functions so you don't have to
	call change_params passing in a multitude of params that you
	don't want to set.
	(panel_widget_focus), (panel_widget_get_applet_orientation):
	upd.

	* panel-xutils.[ch]: some new x utility methods.

	* panel.[ch]: (orientation_change), (panel_orient_change),
	(panel_size_change), (panel_back_change), (panel_applet_added),
	(panel_applet_removed), (menu_deactivate), (panel_destroy),
	(panel_applet_move): updates and remove loads of code. e.g.
	moving panels with the mouse is handled in panel-toplevel now.
	(make_popup_panel_menu), (panel_popup_menu),
	(panel_popup_menu_signal), (panel_button_press_event),
	(panel_key_press_event): simplify popup menu code and event
	handling.
	(drop_background_reset), (drop_bgimage), (drop_color):
	don't update the frame.
	(panel_check_dnd_target_data), (do_highlight),
	(drag_motion_cb), (drag_drop_cb), (drag_data_recieved_cb): more
	boring stuff.
	(panel_setup): remove a good bit of code - we're hooked up to
	a hell off a lot less signals now.
	(panel_data_by_id),
	(panel_screen_from_panel_widget),
	(panel_monitor_from_panel_widget), (panel_is_applet_right_stick),
	(panel_apply_global_config): boring.
	(panel_get_string), (panel_get_int), (panel_get_bool),
	(panel_set_string), (panel_set_int), (panel_set_bool),
	(panel_load_drawer_panel_from_gconf), (panel_load_panel_from_gconf),
	(panel_load_fallback_default_panel), (panel_load_panels_from_gconf):
	disable all the gconf code for now.

	* session.c: (panel_session_do_save), (panel_session_die),
	(session_load): disable some stuff temporarily.

2003-03-04 Hidetoshi Tajima  <hidetoshi.tajima@sun.com>

	* gnome-panel-screenshot.c (on_ok_button_clicked): Fix #107578 by
	  converting from utf8 when getting text from the text entry.

2003-03-03  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (panel_load_panel_from_gconf): load the background
	color when there is one set. Doh. Patch from Greg Hudson,
	ghudson@mit.edu - #107401.

2003-03-01  Arvind Samptur <arvind.samptur@wipro.com>

	Based on fix from Sunil Mohan Adapa (sunilmohanadapa@postmark.net)

	* panel-widget.c: (panel_widget_switch_move) : Modify the conditon
	to break the loop. Fixes panel hang when moving applets. #106832

2003-03-01  Arvind Samptur <arvind.samptur@wipro.com>
	* menu.c (panel_delete_query) : Make the delete dialog
	modal. Avoids deleting of all the panels by accident.
	Fixes #107099

2003-02-26  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (button_style_event_cb): fix warning.

2003-02-26  Mark McLoughlin  <mark@skynet.ie>

	* panel-action-protocol.c: (panel_action_protocol_main_menu):
	don't popup the menu in idle - fixed the keyboard grab
	problem.

2003-02-25  Mark McLoughlin  <mark@skynet.ie>

	* xstuff.c: (xstuff_zoom_animate): fix typo pointed out
	by Paul Gammans <paul@computer-surgery.co.uk>

2003-02-24  Mark McLoughlin  <mark@skynet.ie>

	* panel-action-protocol.c: (popup_menu_in_idle),
	(panel_action_protocol_main_menu), (panel_action_protocol_filter):
	popup the menu in a timeout. For some reason (which I can't track
	down) the keyboard grab on the popup is failing with AlreadyGrabbed.

2003-02-24  Mark McLoughlin  <mark@skynet.ie>

	* panel-stock-icons.c: (panel_init_stock_icons): don't give
	a warning when we stock_icons[i].icon is NULL - i.e. with
	PANEL_STOCK_ACTION stock icon.

2003-02-24  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am:
	* eggaccelerators.c:
	* eggaccelerators.h: kill eggaccelerators.[ch]. Not used
	anymore.

	* panel-config-global.c: (panel_global_config_set_entry):
	* panel-config-global.h:
	* panel-global-config.schemas.in:
	* panel.c: (panel_save_global_config): kill support for
	the keybindings related global keys.

	* panel-util.[ch]: kill a couple of accelerator related
	utility methods.

2003-02-24  Mark McLoughlin  <mark@skynet.ie>

	Move responsibility for the various global keybindings
	from the panel to the winow manager. Window managers can
	invoke the keybindings using the _GNOME_PANEL_ACTION
	ClientMessage protocol.

	* Makefile.am: add panel-action-protocol.[ch] and remove
	global-keys.[ch].

	* panel-action-protocol.[ch]: implement the protocol.

	* global-keys.[ch]: kill.

	* main.c: (main): upd.

	* panel.c: (panel_apply_global_config): upd.

	* xstuff.[ch]: (xstuff_init): kill.

2003-02-22  Arvind Samptur <arvind.samptur@wipro.com>

	Do not popup a 'Delete Panel" query if there are
	no objects in the panel.

	Based on patch from  Heeten (azari.geo@yahoo.com)
	Fixes #105723

	* panel.[ch] : (panel_delete) (panel_delete_query)
	(panel_delete_without_query) :
	Re-organize the panel deletion methods for deleting 
	the panel without user interaction when they have no 
	objects on them.

	* drawer.[ch] : (create_drawer_applet) : Get hold
	of the handler for focus_out event of the drawer button.
	Disconnect while deleting the drawer.

	* applet.c : (applet_idle_remove) Use panel_delete().

	* menu.c : (remove_panel) Use panel_delete().

2003-02-17  Frank Worsley  <fworsley@shaw.ca>

	Unify how applets and internal buttons are added to the applets
	menu. Also added a new 'Actions' category.

	* menu.c: (applet_menu_get_category_icon), (applet_menu_append),
	(applet_menu_append_category), (applet_info_sort_func),
	(append_internal_applets), (create_applets_menu),
	(create_add_launcher_menu), (make_add_submenu): see above.
	
	* panel-stock-icons.c:
	* panel-stock-icons.h: added PANEL_STOCK_ACTION which is null for 
	now until someone makes a nice icon for it

2003-02-17  Arvind Samptur <arvind.samptur@wipro.com>
	* panel.c: (panel_delete_query): Centered the delete query dialog.

2003-02-17  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add support for the GCONF_SCHEMAS_INSTALL
	conditional and the GCONF_SCHEMA_FILE_DIR variable. Patch
	from Julio Merino.

2003-02-14  Arvind Samptur <arvind.samptur@wipro.com>
	* applet.c: (applet_idle_remove) Deleting the drawer panel
	using the drawer button queries the user.

	* panel.[ch]: (panel_delete_query) (remove_panel_accept):
	When deleting the panel, clean up drawers if they exist.

	*panel-widget.[ch]: (panel_widget_remove_drawers): Cleanup the gconf of
	the drawers recursively, if they each drawer holds another drawer.

2003-02-12  Rajkumar Sivasamy  <rajkumar.siva@wipro.com>

	* panel-action-button.c: Listen to "style-set" signal for 
	theme changes and update LockScreen and LogOut buttons 
	with new stock images supplied.
	Fixes bug 105948

2003-02-11  Rajkumar Sivasamy  <rajkumar.siva@wipro.com>

	* menu.c: Use stock icon for GNOME Foot menu.
	Fixes bug 95317

2003-01-30  Arvind Samptur <arvind.samptur@wipro.com>
	* panel-widget.[ch]: Add a GSList to the PanelWidget struct
	to keep track of all the open 'Create Launcher' dialogs.
	
	* panel.c: (panel_remove_open_create_launcher_dialogs) : Destroy
	all the open 'Create Launcher' dialogs while deleting the panel.

	* menu.c (remove_panel_query) ( remove_panel_accept) : Store the
	'Delete Panel' dialog. Avoid creating multiple instances of it.
	
2003-01-22  Mark McLoughlin  <mark@skynet.ie>

	* egg-recent-model.c:
	* egg-recent-util.c:
	* egg-recent-view-gtk.c: sync with libegg.

2003-01-21  Mark McLoughlin  <mark@skynet.ie>

	Makes keybindings work on multi-screen setups.
	Fixes #93757 - based on a patch from Erwann.

	* xstuff.[ch]: (xstuff_grab_key_on_all_screens):
	Grab/Ungrab the key on all screens.

	* global-keys.c: (do_grab_key), (do_ungrab_key):
	use it here.

2003-01-20  Mark McLoughlin  <mark@skynet.ie>

	* panel-compatibility.c:
	(panel_compatibility_warn),
	(panel_compatibility_load_menu_panel): display a lovely
	big warning dialog that I'm lame because I didn't maintain
	backwards compatibility when loading menu panels. Will
	need to be properly fixed soon.

2003-01-20  Mark McLoughlin  <mark@skynet.ie>

	Do not migrate old logout/lock buttons to the action
	button configuration - this broke backwards compatibility
	with gnome-panel 2.0.x. Fixes #103927.

	* panel-action-button.[ch]:
	(panel_action_button_load): add compatibility flag to 
	indicate a logout/lock action button should be loaded
	and saved as an old style logout/lock button.
	(panel_action_button_load_from_gconf),
	(panel_action_button_load_from_drag): upd.

	* applet.c:
	(applet_callback_callback): handle old style lock
	and logout buttons.
	(panel_applet_load_idle_handler): fix bug with compatible
	loading.
	(panel_applet_save_to_gconf): handle old style lock/logout
	buttons.

	* menu.c: (add_action_button_to_panel): upd.

2003-01-14  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panelrc: add a comment to say this is
	intentionally left empty. #103274.

2003-01-12  Christian Neumair  <chris@gnome-de.org>

	* panel-menu-bar.c: Marked "Run Program..." for translation.

2003-01-12  Mark McLoughlin  <mark@skynet.ie>

	* panel-menu-bar.c:
	(panel_menu_bar_append_actions_menu): only add a
	seperator after the screenshot item if we actually
	have a screenshot item.

2003-01-12  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: remove foobar-widget.[ch].

	* panel-compatibility.[ch]:
	(panel_compatibility_load_menu_panel): rename from
	foobar_widget_new().

	* panel-stock-icons.[ch]:
	(panel_menu_bar_icon_get_size): rename from
	panel_foobat_icon_get_size() but keep the icon size
	name as "foobar-menu" for compatibility.
	(panel_init_stock_icons_and_items): upd.

	* panel-types.h: s/FOOBAR_PANEL/MENU_PANEL/

	* aligned-widget.c, applet.c, basep-widget.c, button-widget.c,
	  drawer-widget.c, drawer.c, edge-widget.c, floating-widget.c,
	  global-keys.c, menu-util.c, menu.[ch], multiscreen-stuff.c,
	  panel-menu-bar.c, panel-util.c, panel-widget.c, panel.[ch],
	  sliding-widget.c: remove all special case handling of the
	foobar. We only have BasePWidget based panels now.

	* foobar-widget.[ch]: kill.

2003-01-10  Mark McLoughlin  <mark@skynet.ie>

	* panel-per-panel-config.schemas.in: make the default
	top panel an edge panel.

2003-01-10  Mark McLoughlin  <mark@skynet.ie>

	* menu.c:
	(create_new_panel): remove the menu panel case.
	(create_add_panel_submenu): remove the menu panel
	item.

2003-01-10  Mark McLoughlin  <mark@skynet.ie>

	Screw this for a game of soldiers. Load the compatibility
	applets after all other applets have been loaded so we can
	guarantee their position.

	* panel-compatibility.[ch]:
	(foobar_widget_new): don't load the compat applets
	here, set a flag and they'll be loaded later.
	(panel_compatibility_load_applets): impl iterating
	through all panels and loading compat applets where
	the flag is set.

	* applet.c:
	(panel_applet_load_idle_handler): load compat applets
	from here.
	(panel_applet_loaded): kill this.
	(panel_applet_load_from_unique_id):  update.

2003-01-10  Mark McLoughlin  <mark@skynet.ie>

	Hmm, that was loading two copies of the menu bar
	and window menu. Fixed that but I'm still having
	trouble getting the window menu on the far right
	of a compat foobar.

	* applet.c:
	(panel_applet_loaded): impl checking to see if an
	applet was already loaded.
	(panel_applet_load_from_unique_id): use it here.
	Don't load an already loaded applet.

	* panel-compatibility.c: (foobar_widget_new): kill
	debug.

2003-01-10  Mark McLoughlin  <mark@skynet.ie>

	Add the code to make old configurations work. I'll
	get rid of FoobarWidget properly soon.

	* Makefile.am: add panel-compatibility.[ch] to
	the build.

	* foobar-widget.[ch]: (foobar_widget_new_dud):
	rename from foobar_widget_new().

	* menu.c: (create_new_panel): don't cast to
	a foobar, its a basep now.

	* panel-compatibility.[ch]: (foobar_widget_new):
	impl loading an edge panel with a menu bar and
	window menu instead of a menu panel.

	* panel.c: include panel-compatibility.h.

2003-01-10  Mark McLoughlin  <mark@skynet.ie>

	Move the menu bar out of foobar-widget as a seperate
	internal applet. The default panel configuration looks
	identical to before, but if you have a menu panel in
	your saved configuration its going to be missing the
	menu bar and the window menu. I'll be removing the
	menu panel completely and adding some compatibility
	code to load an edge panel set up like a menu panel
	when it sees a menu panel in your configuration.

	* panel-menu-bar.[ch]: new internal applet identical
	to the menu bar formerly on the left of menu panel.

	* Makefile.am: add panel-menu-bar.[ch] to the build.

	* applet.[ch]:
	(applet_callback_callback), (panel_applet_load_idle_handler),
	(panel_applet_save_to_gconf): handle loading/saving the
	menu bar.

	* foobar-widget.c: (foobar_widget_class_init),
	(foobar_widget_instance_init), (foobar_widget_exists):
	Remove the old menu bar.

	* menu.c: (add_menu_bar_to_panel), (make_add_submenu):
	Add it to the menus.

	* panel-per-panel-config.schemas.in: add the menu bar
	to the left hand side of the menu panel in the default
	configuration.

	* panel.c: (drop_internal_applet): handle dnd-ing the
	menu bar.

2003-01-10  Mark McLoughlin  <mark@skynet.ie>

	Fix a race with applets that use expand flags. Applet
	filling happens asynchronously, so you can never be sure
	that the flags have been set by the time you add it to
	the PanelWidget.

	* applet.c: (panel_applet_register): don't set expand flags
	from here.

	* panel-applet-frame.[ch]:
	(panel_applet_frame_update_expand_flags): rename this function
	and make it private. It now sets the expand flags (as used
	by PanelWidget) itself.
	(panel_applet_frame_constrain_size): use it here.

	* panel-widget.[ch]:
	(panel_widget_cadd): update.
	(panel_widget_add): don't accept expand flags as args.
	(panel_widget_set_applet_expandable): impl setting the
	expand flags here.

2003-01-10  Mark McLoughlin  <mark@skynet.ie>

	Remove the remaining dependancy on libwnck.

	* Makefile.am: link gnome-desktop-item-edit with xstuff.c
	'cause it uses panel-util.c.

	* main.c: (main): pass the global_keys_filter to xstuff_init.

	* panel-util.c: (panel_ditem_launch): use
	xstuff_get_current_workspace instead of libwnck.

	* xstuff.[ch]:
	(xstuff_init): take a filter handler as an argument.
	(xstuff_get_current_workspace): impl.

Thu Jan 09 16:39:25 2003  George Lebl <jirka@5z.com>

	* gnome-panel-screenshot.c: actually fix the permission problem
	  in the case when we don't do a temporary.  Fixes #94974

2003-01-10  Mark McLoughlin  <mark@skynet.ie>

	* foobar-widget.[ch]: (foobar_widget_realize),
	(foobar_widget_instance_init), (foobar_widget_destroy),
	(foobar_widget_popup_panel_menu): remove the old
	window menu.

	* menu-util.c: include panel-stock-icons.h to fix warning.

	* panel-per-panel-config.schemas.in: add a window menu
	applet to the default menu panel.

2003-01-07  Mark McLoughlin  <mark@skynet.ie>

	* panel-util.c: (set_color_back): don't try to set the
	background colour on the hide buttons if the colour
	contains an alpha channel. Fixes hide buttons being
	a weird colour with transparent panels.

	* panel-widget.c:
	(panel_widget_set_background_region): impl correctly
	setting the desktop background to use. Fixes mis-aligned
	background when using hide-buttons.
	(panel_widget_size_allocate),
	(toplevel_configure_event): use it here.

2003-01-07  Mark McLoughlin  <mark@skynet.ie>

	* panel-per-panel-config.schemas.in: make the bottom
	panel opaque again.

2003-01-07  Mark McLoughlin  <mark@skynet.ie>

	* panel-per-panel-config.schemas.in: add the
	"Show Desktop Button" applet to the left of the tasklist
	on the bottom panel and make the bottom panel fully
	transparent.

2003-01-06  Mark McLoughlin  <mark@skynet.ie>

	* egg-recent-util.c: (load_icon_file): sync with libegg.

2003-01-06  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: remove egg-recent-vfs-utils.[ch].

	* egg-recent-item.c:
	* egg-recent-model.c:
	* egg-recent-util.[ch]:
	* egg-recent-view-gtk.[ch]: sync with libegg.

	* egg-recent-vfs-utils.[ch]: remove

	* panel-recent.c: (panel_recent_append_documents_menu):
	Use the new RecentView icon size API to make sure we use
	the same icon size as the panel menu.

2003-01-06  Mark McLoughlin  <mark@skynet.ie>

	Fix #95995 by making only the applications/actions menu use
	"panel-menu" icon size and the rest use the "gtk-menu" size.
	I swear, this icon size crap will be death of me yet ...

	* menu.[ch]: (icon_to_load_copy): add a GtkIconSize member to
	IconToLoad and IconToAdd.
	(menu_item_style_set): pass the icon size as the signal data
	and use it instead of "panel-menu".
	(setup_full_menuitem), (panel_load_menu_image_deferred),
	(setup_stock_menu_item): add a GtkIconSize param to these.
	(do_icons_to_add), (load_icons_handler),
	(image_menuitem_size_request), (setup_menuitem),
	(create_menuitem): pass the icon size up the chain.
	(show_item_menu), (applet_menu_append),
	(create_add_panel_submenu), (create_button_menu),
	(make_panel_submenu), (create_panel_context_menu),
	(make_add_submenu): use "gtk-menu" for all these.
	(create_desktop_menu), (add_distribution_submenu),
	(add_kde_submenu), (create_root_menu):
	use "panel-menu" here.

	* applet.c: (setup_an_item), (panel_applet_create_menu):
	Use "gtk-menu" icon size for these menus.

	* menu-util.c: (stock_menu_item_new): use "panel-menu" icon
	size for this one.

2003-01-05  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: use @ENUMSHORT@ mkenums substitution pattern
	instead of @ENUMNAME@. Gives nicer looking names.

	* aligned-widget.c: (aligned_pos_class_init):
	* basep-widget.c: (basep_widget_class_init):
	* border-widget.c: (border_pos_class_init):
	* button-widget.c: (button_widget_class_init):
	* panel-action-button.c: (panel_action_button_class_init):
	Update.

2003-01-02  Padraig O'Briain  <padraig.obriain@sun.com>

	* button-widget.c (button_widget_leave_notify): Call GtkButton's
	leave_notify_event to cause the button's state to be reset from 
	PRELIGHT.

	This fixes bug #101546.

2003-01-02  Mark McLoughlin  <mark@skynet.ie>

	Impl periodically re-running the applet menu bonobo
	query and re-generating the menu if it has changed.

	* menu.c:
	(Bonobo_ServerInfoList_equals): impl comparing server
	lists.
	(recheck_applet_list), (menu_item_destroyed),
	(instrument_add_submenu_for_reload): impl periodically
	re-running the bonobo-activation query to see if there
	has been any change in the available applets.
	(create_applets_menu): take a server list as an argument.
	(create_button_menu), (current_panel_config),
	(make_panel_submenu), (show_panel_help),
	(create_panel_context_menu), (ask_about_launcher_cb):
	(make_add_submenu), (create_root_menu):
	lots of cleanups to make it clear there is only one place
	the "Add to Panel" submenu appears these days.

	* menu.h: remove some menu flags. Add big flashing sign
	in neon lights to warn against assuming that the panel
	is not on crack.

2002-12-23  Padraig O'Briain  <padraig.obriain@sun.com>

	* menu.c
	(load_icon_handler): Get icon height when about to load icon
	(image_menu_shown): Remove getting icon height; we do it in
	load_icon_handler() as it may change by the time the icon is loaded.

2002-12-22  Frank Worsley <fworsley@shaw.ca>

	* gnome-run.c: (show_run_dialog): fix #77089, focus program
	list if list expanded, otherwise focus entry in run dialog	

2002-12-23  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (about_cb): remove translations marks from around
	the copyright notices for the about dialogs. The container
	non-ascii characters and no longer need to be translated
	 anyhow. Fixes #101796.

2002-12-20  Arvind Samptur <arvind.samptur@wipro.com>
	* drawer-widget.c (drawer_pos_hidebutton_click):
	guess a small typo by mark while checking in the #93541.
	fixes the crash while closing the drawer panel.

2002-12-20  Mark McLoughlin  <mark@skynet.ie>

	/me shovels more crap onto the dung heap that is the panel.

	More precisely, fix #93177 by loading the default panel
	configuration on all screens, instead of just loading
	a foobar on the non-default screens.

	* applet.h: kill APPLET_EMPTY and all the string
	ids which haven't been used since 1.4.

	* applet.c:
	(panel_applet_get_full_gconf_key): kill. dead. good bye.
	(panel_applet_load_from_unique_id),
	(panel_applet_load_list): use PanelGConfKeyType to
	distinguish between "applets" and "objects" instead of
	using the APPLET_EMPTY hack.
	(panel_applet_load_default_applet_for_screen),
	(panel_applet_load_defaults_for_screen): impl loading the
	configuration for the default set of applets onto a
	particular screen.
	(panel_applet_save_position), (panel_applet_save_to_gconf):
	use panel_gconf_full_key instead of panel_applet_get_full_gconf_key;

	* panel-gconf.[ch]:
	(panel_gconf_load_default_config_for_screen): impl method
	for applying the schemas for a default panel or applet
	to a new panel or applet on a given screen.

	* panel.c:
	(panel_load_fallback_default_panel): the worst case scenario.
	Just load a foobar.
	(panel_load_default_panel_for_screen),
	(panel_load_default_panels_for_screen): impl loading the
	configuration for the default set of panels onto a
        particular screen.
	(panel_ensure_panel_per_screen): load the default panels
	if no other panels are on that screen.
	(panel_load_panels_from_gconf): upd.

2002-12-20  Mark McLoughlin  <mark@skynet.ie>

	Fixes #93541, panel hogging the CPU when hide_delay
	and show_delay are zero.

	* basep-widget.c:
	(find_non_drawer_parent_panel): recurse up through the
	drawers to find the topmost panel.
	(basep_leave_notify): don't queue an autohide on a drawer,
	queue it on the topmost non-drawer parent panel instead.
	(basep_widget_queue_autoshow): use show_delay not hide_delay.
	Also, queue an idle instead of a timeout if the delay is
	<= 0.
	(basep_widget_autohide): don't return TRUE at silly times
	where the autohide will be re-queued anyway.
	(basep_widget_queue_autohide): Queue an idle instead of
	a timeout if the delay is <= 0.

	* drawer-widget.[ch]:
	(drawer_pos_hidebutton_click): use drawer_widget_get_drawer().
	(drawer_widget_set_drawer), (drawer_widget_get_drawer): impl.
	small wrapper for the g_object_get/set_data so its in the
	one location.

	* drawer.c: (create_drawer_applet):
	use drawer_widget_set_drawer().

	* drawer.h: kill DRAWER_PANEL_KEY.

2002-12-20  Dennis Cranston <dennis_cranston@yahoo.com>

	* menu.c: (about_cb): Fix previous commit so build
	doesn't fail.
	
2002-12-20  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (about_cb): Fixup reference to the
	FSF. Fixes #101593.

2002-12-19  Mark McLoughlin  <mark@skynet.ie>

	No, this isn't purely random re-factoring. Its
	needed to fix something else.

	* panel.c:
	(panel_load_panels_from_gconf): split this gigantic
	function into several smaller ones.
	(panel_load_edge_panel_from_gconf),
	(panel_load_aligned_panel_from_gconf),
	(panel_load_sliding_panel_from_gconf),
	(panel_load_drawer_panel_from_gconf),
	(panel_load_floating_panel_from_gconf),
	(panel_load_panel_from_gconf): split our from
	load_panels_from_gconf().

	* aligned-widget.[ch], basep-widget.[ch],
	  border-widget.[ch], drawer-widget.[ch],
	  edge-widget.[ch], floating-widget.[ch]
	  panel-widget.[ch], sliding-widget.[ch]:
	s/char */const char */ for couple of params.

2002-12-19  Mark McLoughlin  <mark@skynet.ie>

	* help/*: remove these files.

2002-12-18  Mark McLoughlin  <mark@skynet.ie>

	Fixes menu items not resizing when icon size changes.

	* menu.c:
	(reload_image_menu_items), (icon_theme_changed),
	(panel_menu_new): re-indent the icon theme change
	handling stuff.
	(menu_item_style_set), (do_icons_to_add): connect
	to the "style_set" signal and reload the image
	if the icon size changes.

2002-12-18  Mark McLoughlin  <mark@skynet.ie>

	Implement support for tiled background images. #100952.

	* panel-background-monitor.c:
	(panel_background_monitor_tile_background): impl.
	(panel_background_monitor_setup_pixbuf): if the
	background pixmap is smaller than the actual
	root window size, then tile it onto our pixbuf.

2002-12-17  Mark McLoughlin  <mark@skynet.ie>

	Make PanelBackgroundMonitor multiscreen aware.

	* panel-background-monitor.[ch]:
	(panel_background_monitor_init): factor out the
	screen specific stuff to
	(panel_background_monitor_connect_to_screen): here.
	(panel_background_monitor_new): take a GdkScreen arg.
	(panel_background_monitor_get_for_screen): keep a
	list of monitors, one for each screen, instead of
	a single one.
	(panel_background_monitor_get): get the monitor for
	the default screen.

	* panel-background.c: (get_desktop_pixbuf): use
	panel_background_monitor_get_for_screen().

2002-12-17  Mark McLoughlin  <mark@skynet.ie>

	* panel-stock-icons.h: add panel_button_icon_get_size()
	to fix warning.

2002-12-17  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.c: (bool_value_changed_notify),
	(load_checkboxes), (enum_value_changed_notify),
	(load_animation_menu), (load_config_into_gui): receive
	gconf notifications and update the GUI accordingly.
	Fixes #101064.

2002-12-13  Rajkumar Sivasamy  <rajkumar.siva@wipro.com>

	* panel-stock-icons.[ch],
	  basep-widget.c:  Register images used by panel show/hide button
	  as stock images, so that they can be themed.
	  Fixes bug #99208.

2002-12-17  Mark McLoughlin  <mark@skynet.ie>

	* egg-recent-model.c:
	* egg-recent-util.c:
	* egg-recent-view-gtk.c:
	* egg-recent-view-gtk.h:
	* egg-recent-view.h:
	* egg-screen-exec.c: sync with libegg. Fixes #101108.

2002-12-16  Mark McLoughlin  <mark@skynet.ie>

	Make it possible to perform all relevant drops
	for a panel on the drawer button. Fixes #100965.

	* drawer.[ch]:
	(destroy_drawer): remove close timeout.
	(drag_data_received_cb),
	(drag_motion_cb), (close_drawer_in_idle),
	(queue_drawer_close_for_drag), (drag_leave_cb),
	(drag_drop_cb): impl.
	(create_drawer_applet): hook up dnd signals.

	* panel.[ch]:
	(panel_check_dnd_target_data),
	(panel_check_drop_forbidden),
	(panel_receive_dnd_data): split out parts of the
	panel dnd implementation so that the drawer can
	use it.
	(drag_data_recieved_cb), (drag_motion_cb),
	(drag_drop_cb): use it here also.

2002-12-16  Arvind Samptur <arvind.samptur@wipro.com>
	* disclosure-widget.c (class_init): attach a 
	destroy handler. 
	(cddb_disclosure_destroy): remove the timer on
	a destroy. Fixes #100992.
	(get_x_y),(expand_collapse_timeout): remove the unused 
	variables. Get rid of warnings.
	(do_animation): replace gtk_timeout_remove() with
	g_source_remove().
	
2002-12-16  Mark McLoughlin  <mark@skynet.ie>

	Fixes a crash when moving between panels #98265.

	* applet.c: (panel_applet_get_panel_id): return NULL
	if we're in the middle of being re-parented.
	(panel_applet_save_position): don't save our position
	if we get a NULL panel_id.

	* applet.h: don't export panel_applet_get_panel_id().

2002-12-16  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (do_icons_to_add), (load_icons_handler),
	add a ref/unref pair for the GtkImage to make
	the crash in #99378 impossible.

2002-12-16  Mark McLoughlin  <mark@skynet.ie>

	* panel-background.c: (panel_background_prepare):
	fix warning.

2002-12-16  Mark McLoughlin  <mark@skynet.ie>

	Be more robust in the face of applet crashes
	during loading. Should fix #99205.

	* panel-applet-frame.c: Keep a ref to the PanelWidget
	so that we can reload an applet even when it hasn't
	been fully loaded.
	(popup_handle_move),
	(panel_applet_frame_constrain_size),
	(panel_applet_frame_button_changed): use that ref here.
	(panel_applet_frame_reload_response): fix up to work even
	when an applet hasn't fully loaded.
	(panel_applet_frame_cnx_broken): don't require the applet
	to have been registered.
	(panel_applet_frame_construct): check for failure of
	vairious remote bonobo operations.

2002-12-10  Arvind Samptur <arvind.samptur@wipro.com>
	* panel-background.c: (panel_background_prepare): re-draw
	the panel after setting the background. Fixes #100401

2002-12-10  Dennis Cranston <dennis_cranston@yahoo.com>

	* gnome-panel-preferences.desktop.in:  Add support 
	for startup notification.
	
2002-12-10  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (about_cb): revert copyright changes
	until we decide on a format.

2002-12-10  Mark McLoughlin  <mark@skynet.ie>

	Fixes #100650, based on a patch from Arvind.

	* applet.[ch]:
	(panel_applet_remove_in_idle): new function.
	(applet_remove_callback): use it.

	* panel.c: (drop_internal_icon): remove the
	applet permanently rather than just destroying
	the widget.

2002-12-06  Frederic Crozat  <fcrozat@mandrakesoft.com>

	* panel-background-monitor.c:
	(panel_background_monitor_xevent_filter):
	Don't leak pixbuf and pixmap.

2002-12-08  Mark McLoughlin  <mark@skynet.ie>

	* menu.c, panel-config-global.c, panel-config-global.h,
	panel-global-config.schemas.in, panel.c: Revert unapproved
	commit.

2002-12-06  Christian Neumair  <chris@gnome-de.org>

	* menu.c, panel-config-global.c, panel-config-global.h,
	panel-global-config.schemas.in, panel.c: Changed tooltips_enabled to
	enable_tooltips for consistency.

2002-12-06  Glynn Foster  <glynn.foster@sun.com>

	* menu.c: (applet_menu_get_category_icon): Add support for 
	'Accessories' in the panel context menu.
	* panel-stock-icons.[ch]: Add new icon. Woo.

2002-12-04  Dennis Cranston <dennis_cranston@yahoo.com>

	* gnome-panel-screenshot.c:  Fixed an old bug where 
	clicking the 'Ok' button in the browse dialog would 
	activate the 'Save' button.
	
	* gnome-panel-screenshot.[c|glade]: More fixes for
	bug report #98912. 
	  - 'save to file' option doesn't remember the last 
	  directory you saved to.  [The history id of the
	  gnome entry was not hooked up.]  
	
2002-12-04  Padraig O'Briain  <padraig.obriain@sun.com>

	* drawer.c: (key_press_drawer) (key_press_drawer_widget): Allow
	keystroke modified by something other that accelerator mod (i.e. Alt).
	This fixes bug #98772.	

2002-12-04  Mark McLoughlin  <mark@skynet.ie>

	* panel-config.c: (background_type_changed):
	when changing from "Color" to "Transparent",
	reset the opacity to 0.

2002-12-04  Mark McLoughlin  <mark@skynet.ie>

	Fix ui-review issues raised in #98914.

	* panel-config.c:
	(make_misc_widget):
	use "new HIG borderless/bold label style" frame.
	(floating_notebook_page): ditto and change strings
	to be a little less confusing. Still a horrible
	dialog though.
	(sliding_notebook_page):
	s/Screen edge offset/Distance from edge/
	(make_size_widget): remove pixel sizes from the
	labels.
	(background_page):
	use "new HIG borderless/bold label style" frame.
	"Verbalise" the image transformation options.
	Remove redundant "Background" strings.
	s/Rotate image for vertical panels/
	  Rotate image when panel is vertical/

2002-12-04  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.glade:
	s/_Animation/Drawer and Panel _Animation/.
	Fixes ui-review bug #98911.

2002-12-04  Mark McLoughlin  <mark@skynet.ie>

	Fix ui-review issues in #98909.

	* menu.c:
	(create_panel_submenu): add seperater between
	'about' menu items.
	(make_add_submenu), (add_menu_widget),
	(create_panel_menu): s/GNOME Menu/Main Menu/g

2002-12-04  Dennis Cranston <dennis_cranston@yahoo.com>

	* gnome-panel-screenshot.[c|glade]:  UI-review changes for bug
	report #98912.  
	  - Frames should follow new HIG borderless/bold label style
	  - Replace 'Ok' with 'Save' and appropriate icon
	  - Preview thumbnail should be left aligned
	  - Dialog should be called 'Save Screenshot' instead of 'Screenshot'
	
2002-12-04  Mark McLoughlin  <mark@skynet.ie>

	Add a "Transparent" pseudo backround type so
	people don't have to fiddle with the opacity
	value in the colour picker.

	* panel-config.c:
	(background_type_changed): if set to transparent,
	just pretend its a color with 0 alpha value.
	(background_page): add "Transparent" option.

2002-12-04  Mark McLoughlin  <mark@skynet.ie>

	* panel-background.c: (panel_background_set):
	don't unset loaded flag when color hasn't changed.

2002-12-04  Mark McLoughlin  <mark@skynet.ie>

	Re-write the background rendering code to be
	less buggy and to be less resource hungry for
	opaque backgrounds. Code is a lot clearer now.

	* Makefile.am: add panel-background.[ch] to the
	build.

	* panel-background.[ch]: re-written implementation
	of the background rendering. Less resource hungry
	for non-alpha backgrounds and colours. And a lot,
	lot less buggy.

	* launcher.c: include egg-screen-exec.h to fix
	warning.

	* menu.c: (create_new_panel): initialise colour
	correctly.

	* panel-applet-frame.c:
	(panel_applet_frame_get_background_string): move the
	implementation of this to panel-background.c.
	(panel_applet_frame_change_background),
	(panel_applet_frame_construct_moniker): upd.

	* panel-background-monitor.[ch]:
	(panel_background_monitor_finalize): don't unref
	NULL references.
	(panel_background_monitor_get): ref the return
	value so we can destroy it when not needed.
	(panel_background_monitor_setup_pixmap): don't leak
	the property data.
	(panel_background_monitor_get_widget_background): kill.

	* panel-types.h: rename PanelBackType to PanelBackgroundType
	and PANEL_BACK_PIXMAP to PANEL_BACK_IMAGE.

	* panel-widget.[ch]: Kill all the old background code and:
	(panel_widget_style_set), (panel_widget_state_changed):
	set the theme defaults on the PanelBackground when they change.
	(toplevel_configure_event): change the desktop background
	region when the toplevel is moved or resized.
	(panel_widget_realize), (panel_widget_unrealize): impl

	* aligned-widget.[ch], basep-widget.[ch], border-widget.[ch],
	  drawer-widget.[ch], edge-widget.[ch], floating-widget.[ch],
	  panel-config.[ch], panel-util.c, panel.c, sliding-widget.[ch]:
	Mucho minor and boring updates for changes in the various
	background structs and enums.

2002-12-04  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (about_cb): no whitespace before punctuation marks.

2002-11-18  Fernando Herrera <fherrera@onirica.com>

	* gnome-panel-preferences.desktop.in: add X-GNOME-BUGZILLA stuff

2003-12-03  Arvind Samptur <arvind.samptur@wipro.com>
	* menu.c (menu_button_menu_popup)
	* panel.c (panel_do_popup_menu): use basep_widget_queue_autohide
	instead of basep_widget_autohide. Fixes #97182

2002-12-03  Arvind Samptur <arvind.samptur@wipro.com>
	* launcher.[ch]: add a destroy_handler to the 
	launcher structure. Helps in the destroying the
	properties dialog when launchers are dragged and
	dropped.
	* panel.c (drop_internal_icon) disconnect the 
	destroy handler on the properties dialog and
	explicitly destroy it. Fixes #97112.

2002-12-02  Christian Neumair  <chris@gnome-de.org>

	* menu.c: Changed copyright string, made "Delete Panel" translatable.

2002-11-24  Iain <iain@prettypeople.org>

	* menu.c (setup_stock_menu_item): Check if the stock_is is NULL.
	(create_button_menu): Create a submenu for the buttons.
	(make_add_submenu): Create a buttons submenu and move all the buttons
	into it.

2002-10-10  Satyajit Kanungo  <satyajit.kanungo@wipro.com>

	Fixes the Issue of drag and drop to the panel always launches the
	application in primary screen.Bug #94258 .

	* launcher.c : drag_data_received_cb(). Changed to call the new API
	  of gnome-desktop gnome_desktop_item_drop_uri_list_with_env and
	  passed the environment to it. So that gnome-desktop can launch the
	  application in appropriate screen.

2002-11-28  Mark McLoughlin  <mark@skynet.ie>

	* panel-util.[ch]: (panel_ditem_launch):
	use gnome_desktop_item_launch_on_screen so
	that startup notification can work correctly.
	Also change the order of the arguments to
	reflect libgnome-desktop

	* gnome-run.c: (launch_selected):
	* launcher.c: (launch_cb):
	* menu.c: (activate_app_def): upd.

2002-11-27  Stanislav Brabec  <sbrabec@suse.cz>

	* distribution.c: Updated path to SuSE distribution menu.

2002-11-17  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (panel_load_panels_from_gconf):
	s/no_background/no-background/. Fixes #98565.

	* applet.c: (panel_applet_load_from_unique_id):
	* gnome-panel-preferences.c: (load_animation_menu):
	* panel-config-global.c: (panel_global_config_set_entry):
	* panel.c: (panel_load_panels_from_gconf): Learn from that
	lesson and audit all usage of gconf_string_to_enum to
	not rely on the enum value being initialised.

	* panel-gconf.[ch]: kill panel_gconf_string_to_enum().

2002-11-15  Mark McLoughlin  <mark@skynet.ie>

	* disclosure-widget.c: (finalize), (get_x_y),
	(expand_collapse_timeout), (do_animation), (class_init):
	Port over the patches from jaiserca@inf.upv.es and Gman
	to gsearchtools copy of this widget. Should fix #98213.
	This widget should be in libegg.

2002-11-15  Mark McLoughlin  <mark@skynet.ie>

	* gnome-run.c: (run_dialog_response): patch from
	putte_xvi@tunedal.nu to not crash when passed a
	symbolic link. Fixes #97534.

2002-11-12  Andrew Sobala  <andrew@sobala.net>

	* menu.c (image_menu_shown): Update icon height as theme may have
	changed required height (bug #92852)
	
2002-11-06  Andrew Sobala  <andrew@sobala.net>

	* panel-applet-frame.c: string change for localisation

2002-11-04  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: install gnome-panel-screenshot.schemas.

	* gnome-panel-screenshot.c: (main): don't pretend to
	use GError, don't use hypens in gconf keys and don't
	crash.

	* gnome-panel-screenshot.schemas.in: new file.

2002-11-01  Mark McLoughlin  <mark@skynet.ie>

	Add support for translucent panels. Based on a patch
	from Ian McKellar <yakk@yakk.net>. This is still
	quite buggy but its a step forward.

	* Makefile.am: remove rgb-stuff.[ch] from the build
	and add panel-gdk-pixbuf-extensions.[ch] and
	panel-background-monitor.[ch].

	* aligned-widget.[ch], basep-widget.[ch], border-widget.[ch],
	  drawer-widget.[ch], edge-widget.[ch], floating-widget.[ch],
	  sliding-widget.[ch]: all the _new() and change_params()
	functions take a PanelColor instead of a GdkColor now.

	* basep-widget.c: (basep_update_frame): remove the frame
	if its a colour background also.

	* menu.c: (about_cb): Add Ian.

	* panel-applet-frame.c: (panel_applet_frame_get_background_string):
	pass the xid of the background pixmap, not the panel window, to
	the applet. Doh.

	* panel-background-monitor.[ch]: New object to monitor changes
	on the desktop background.

	* panel-config.[ch]: (update_config_back), (color_set_cb),
	(background_page): Add support for configuring the alpha channel
	in the background colour.

	* panel-gdk-pixbuf-extensions.[ch]: copy from eel-gdk-pixbuf-extensions
	for eel_gdk_pixbuf_draw_to_pixbuf_tiled(), but remove all other
	extensions, reduce dependancies and remove the abstraction to allow
	rendering into either a drawable or a pixbuf.

	* panel-types.h: add PanelColor.

	* panel-util.c: (set_color_back): upd for use of PanelColor.

	* panel-widget.[ch]: More or less completely re-write the background
	rendering code. Both image and color backgrounds are not composited
	onto the desktop background image. This still needs work - bugs
	abound.

	* panel.c:
	(panel_load_panels_from_gconf),
	(panel_save_to_gconf): save the alpha channel of the color background.

	* rgb-stuff.[ch]: remove. We no longer use libart to scale and rotate
	pixbufs. We just use gdk-pixbuf directly.

2002-10-27  Anders Carlsson  <andersca@gnu.org>

	* gnome-panel-screenshot.c: Fix a bug with alpha, fix the
	permission problems, and add a feature.

2002-10-18  Rajkumar Sivasamy  <rajkumar.siva@wipro.com>

	* button-widget.c: Fix the problem of launcher's icon not 
	getting	updated in the case of icon-theme changes.
	Fixes #92598

2002-10-18  Mark McLoughlin  <mark@skynet.ie>

	Fixes #91686. Based on a patch from Glynn.

	* foobar-widget.c:
	(foobar_widget_class_init): hook up size_request.
	(foobar_widget_screen_size_changed): don't set width
	request here.
	(foobar_widget_size_allocate): don't set the size hints
	here.
	(foobar_widget_size_request): size size hints here and resize
	the window if neccessary
	(foobar_widget_new): don't set width request here.

2002-10-17  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c:
	(panel_applet_frame_constrain_size): impl to constrain
	an applets position to not be larger than the the panel
	width.
	(panel_applet_frame_size_request): use it.

2002-10-16  Mark McLoughlin  <mark@skynet.ie>

	* egg-screen-help.[ch], egg-screen-url.[ch]: sync
	with libegg.

	* gnome-run.c, launcher.c, panel-util.c: use new
	multiscreen help functions.

Tue Oct 15 19:54:28 2002  HideToshi Tajima  <hidetoshi.tajima@sun.com>

	* gnome-run.c: Additinal fix #91766 - use g_locale_from_utf8()
	instead of g_filename_from_utf8() to get locale text,
	and try to run command with utf8 name when it failes with
	locale name.

2002-10-15  Brian Cameron <Brian.Cameron@sun.com>

	* gnome-panel/panel.c, gnome-panel/session.c,
	 gnome-panel/applet.c:  Removeved calls to
	gconf_client_suggest_sync since this synching is
	not necessary.  Performance analysis highlighted
	that gnome-panel was causing >100 syncs to happen
	(with ~10 items in the panel).

2002-10-11  Arvind Samptur <arvind.samptur@wipro.com>
	* gnome-run.c: (show_run_dialog_with_text)
	Remove the parameters from the exec field when putting a menu
	item in to run dialog. Fixes #94366 

2002-10-10  James Willcox  <jwillcox@gnome.org>

	* Makefile.am:  Add the egg-recent stuff, and panel-recent.[ch]
	* panel-recent.[ch]:  stuff for adding recent documents menus
	* foobar-widget.c: (append_actions_menu):  Add a recent docs menu
	* menu.c: (create_root_menu):  same

2002-10-10  Yanko Kaneti  <yaneti@declera.com>

	* eggaccelerators.c (is_hyper, is_meta, is_super): resync with libegg.
	Fix typos in array indexing, fix from Ralph Loader bug #93005.

2002-10-07  Mark McLoughlin  <mark@skynet.ie>

	Fixes problem with keybindings not working on any screen but
	the default (#93757). Root cause identified by Erwan Chenede.

	* global-keys.[ch]: 
	(screen_from_event): kill.
	(panel_global_keys_filter): don't use screen_from_event,
	just use the passed in screen.

	* xstuff.c: (xstuff_init): register the GdkScreen as
	the filter data.

2002-10-07 Mark McLoughlin  <mark@skynet.ie>

	Support RandR extension by resizing the toplevel panels
	if the screen size has changed. Based on patch from
	Keith Packard - #94561. Requires gtk+ HEAD.

	* basep-widget.[ch]: (basep_widget_screen_size_changed):
	* foobar-widget.[ch]: (foobar_widget_screen_size_changed):
	resize the toplevels when the screen size changed.

	* multiscreen-stuff.c:
	(multiscreen_screen_size_changed): re-initialise and request
	a resize on the toplevels.
	(multiscreen_support_init): connect to the "size_changed"
	signal on all screens.
	(multiscreen_reinit): re-initialise the monitor geometries.

2002-10-04  Frederic Crozat  <fcrozat@mandrakesoft.com>

        * applet.c: (panel_applet_load_from_unique_id):
        Don't swap launchers when loading drawer (bug #84744)

2002-10-04  Mark McLoughlin  <mark@skynet.ie>

	* menu-fentry.c: (fr_read_dir): if there's no
	.directory then use the uri basename as the
	fullname. Fixes new folder not being sorted
	correctly in #91810.

	* menu-fentry.h: kill fr_force_reread.

2002-10-04  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (menu_button_menu_popup): pass the
	widget to the menu position fuction, rather
	than the AppletInfo struct.

2002-10-01  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (applet_show_menu): use
	panel_position_applet_menu.

	* basep-widget.[ch], border-widget.c, drawer-widget.c:
 	  floating-widget.c:  kill all get_menu_pos() code.

	* menu-util.[ch]: (panel_position_applet_menu): impl
	popping up the menu outside of the applets.

	* menu.c:
	(panel_make_sure_menu_within_screen): upd.
	(menu_button_menu_popup): use panel_position_applet_menu.

2002-09-27  Alexander Larsson  <alexl@redhat.com>

	* button-widget.c: 
	* gnome-run.c:
	* launcher.c:
	* main.c: 
	* menu-util.c:
	* menu.c:
	* panel-main.h:
	* panel-stock-icons.c:
	Update to the new icon theme API.

2002-09-24  Mark McLoughlin  <mark@skynet.ie>

	Add a new PanelActionButton widget so we can
	generically do action buttons. Fixes #84740.

	* Makefile.am: remove logout.[ch] from the build
	and add panel-action-button.[ch]. Also generate
	enums from panel-action-button.h.

	* applet.[ch]: add support for a generic "action button"
	applet and convert old lock/logout buttons into one of
	these for backwards compat.

	* foobar-widget.c: (append_actions_menu): use action
	callback from panel-action-button.h and setup dnd
	for screenshot, run and search menu items. Remove
	"Show Desktop" menu item.

	* logout.[ch]: remove.

	* menu.c:
	(add_action_button_to_panel): impl.
	(make_add_submenu): add screenshot, run and search
	buttons.
	(create_desktop_menu), (create_root_menu): setup
	dnd for screenshot, run and search menu items.

	* panel.c: (drop_internal_applet): impl new dnd
	for action buttons.

	* xstuff.[ch]: (xstuff_show_desktop): remove.

2002-09-24  Mark McLoughlin  <mark@skynet.ie>

	Implement support for stock ids in ButtonWidget and
	use them for the lock button and logout button.

	* button-widget.[ch]:
	(button_widget_load_pixbuf_and_scale): add support for
	loading stock icons.
	(button_widget_reload_pixbuf): split out from set_property().
	(button_widget_finalize): free the stock ids.
	(button_widget_get_property), (button_widget_set_property):
	(button_widget_class_init), impl "stock-id" property.
	(button_widget_new_from_stock), (button_widget_set_stock_id):
	impl.

	* logout.c: (create_logout_widget), (create_lock_widget):
	use stock ids for icons.

2002-09-24  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: include xstuff.h.

	* xstuff.c: (draw_zoom_animation): don't
	use gdk_color_alloc() - its deprecated.

2002-09-24  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c:
	(button_widget_load_pixbuf_and_scale): split out from
	size_allocate(). Load the pixbuf here.
	(button_widget_finalize): use a finalize handler instead
	of a destroy handler.
	(button_widget_get_property),
	(button_widget_set_property): use GObject properties for
	all construct time params.
	(button_widget_size_allocate): use load_pixbuf_and_scale().
	(button_widget_new): pass all construct time properties
	to g_object_new and don't load the pixbuf here.
	(button_widget_set_pixmap): just set the GObject property.
	(button_widget_set_params): ditto.

	* button-widget.h: kill button_widget_set_text(), it seems
	this is totally unused as we set the tooltips elsewhere.
	Don't pass size to button_widget_set_pixmap.

	* drawer.c, launcher.c, logout.c, menu.c: update for
	button-widget changes above.

	* panel-types.h: actually define PanelOrient as an enum
	so glib-mkenums will pick it up.

2002-09-19  jacob berkman  <jacob@ximian.com>

	* launcher.c (launch_cb): draw a zoom thingie when clicked

	* xstuff.[ch] (xstuff_zoom_animate): 
	(draw_zoom_animation): draw a square which zooms to the screen
	size

2002-09-19  Arvind Samptur <arvind.samptur@wipro.com

	* gnome-panel-screenshot.c: waitpid could fail
	due to a interuptted system call, loop till you
	succeed. Fixes #92651

2002-09-19  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: Change the launchers icon when the
	icon loader's 'changed' signal is emitted. Based
	on patch from Rajkumar Sivasamy <rajkumar.siva@wpiro.com>.
	Fixes #92598.

2002-09-16  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am, multihead-hacks.h: kill multihead-hacks.h

	* applet.c, basep-widget.c, button-widget.c, foobar-widget.c,
	  global-keys.c, gnome-desktop-item-edit.c, gnome-run.c,
	  launcher.c, logout.c, menu-ditem.c, menu-util.c, menu.c,
	  multiscreen-stuff.c, panel-applet-frame.c, panel-config.c,
	  panel-shell.c, panel-util.c, panel.c, xstuff.c: remove all
	multihead conditionals as we require gtk+ 2.1.0 now.

2002-09-03 Padraig O'Briain  <padraig.obriain@sun.com>

	* basep-widget.[ch]:
	Add action signal "popup-panel-menu"; bind it to Ctrl+F10; add
	basep_widget_popup_panel_menu() to pop up the panel's menu.

	* foobar-widget.[ch]:
	Add action signal "popup-panel-menu"; bind it to Ctrl+F10; add
	foobar_widget_popup_panel_menu() to pop up the panel's menu.

	* panel-widget.[ch]:
	Remove action signal "popup-panel-menu".

	These changes fix bug #92134, cause Ctrl+F10 to display panel's menu
	when focus is on a show/hide button.

2002-09-12  Mark McLoughlin  <mark@skynet.ie>

	* menu.c:
	(icon_to_load_copy), (icon_to_load_free),
	(panel_load_menu_image_deferred_with_size): don't
	bother strdup-ing the stock ids.

2002-09-12  Soeren Sandmann  <sandmann@daimi.au.dk>

	* menu.c:
	(do_icons_to_add), (load_icons_handler):
	Delay actually setting the icon on the GtkImage
	until we have loaded all the icons. This fixes
	a nasty performance issue where the menu's
	allocation was being continually recalculated as
	each icon was set.

2002-09-12  Mark McLoughlin  <mark@skynet.ie>

	* drawer-widget.c: (drawer_pos_get_pos):
	* panel.c: (state_hide_foreach): use the
	absolute value for the width and height when
	hidding the drawer in case the width or height
	is negative. Should fix #91636.

2002-09-12  Mark McLoughlin  <mark@skynet.ie>

	* panel-config.[ch]:
	(update_config_back): just set the history on the
	option menu, don't activate the menu item. Also,
	just use the PanelBackType enum for the history ids.
	(background_type_changed): rename from set_back() and
	kill the crack.
	(background_page): fix broken use of menuitem's 'activate'
	signal instead of the option menu's 'changed' signal.
	Fixes #91378.

2002-08-21  Havoc Pennington  <hp@pobox.com>

	* gnome-run.c (show_run_dialog): remove GTK_WIN_POS_MOUSE, it's a
	load of crack
	(browse): ditto

2002-09-11  Arvind Samptur <arvind.samptur@wipro.com>

	* gnome-panel-screenshot.c: Avoid the defunct process
	by doing waitpid at  the point you fork. Fixes #92651.

2002-09-11  Pasupathi Duraisamy <pasupathi.duraisamy@wipro.com>

	* launcher.c: Add mnemonic to 'Help on %s Application'.
	Fixes bug #92942

2002-08-28  Arvind Samptur <arvind.samptur@wipro.com>

	* menu.c (drag_data_get_menu_cb): disable the tooltips
	when the drag is on.
	(drag_end_menu_cb): enable the tooltips once the drop is
	done. Fixes #91884

2002-09-12  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c:
	(panel_applet_frame_get_background_string): if we haven't
	actually rendered a pixmap background then just pretend
	this is the default background. Fixes #91198.

2002-09-12  Mark McLoughlin  <mark@skynet.ie>

	Fix #90664 by giving focus to the PanelWidget
	in a newly created drawer.
	Patch from Padraig O'Briain.

	* drawer-widget.c: (drawer_widget_new): allow the
	PanelWidget to be focused.

	* drawer.c: (load_drawer_applet): set the focus on
	the PanelWidget.

2002-09-12  Mark McLoughlin  <mark@skynet.ie>

	Fixes #90317 by explicitly destroying panels on receipt
	of a Die from the session manager rather than just
	exiting the mainloop. Apparently embedded out of process
	embedded windows don't cope with this too well - thanks
	to Owen for pointing this fact out.

	* applet.c:
	(panel_applet_clean): do anything required to effect
	permanent removal of the applet here.
	(applet_idle_remove): kill set_clean_remove stuff.
	(panel_applet_destroy): only clear up our data and refs
	here rather than permanently removing the applet.

	* basep-widget.c: remove some bogus whitepsace.

	* menu.c: (remove_panel_accept): if the panel is a drawer,
	then also remove the associated applet. Permanently remove
	the panel here.

	* panel-applet-frame.[ch]:
	(panel_applet_set_clean_remove),
	(panel_applet_get_clean_remove), (popup_handle_remove),
	(panel_applet_frame_instance_init): kill unused 'clean_remove'
	stuff. No idea how/why that got there.

	* panel-widget.c:
	(panel_widget_finalize): don't remove the panel from the
	global list again.
	(panel_widget_destroy): don't permanently remove the panel
	from here.
	* panel.c:

	(panel_remove_applets): kill 'clean_remove' stuff.
	(panel_destroy): don't remove the applet associated with
	the drawer here.

	* session.c: (panel_session_die): iterate over a copy of
	the global list of panels and destroy them.

2002-08-31  Jacob Berkman  <jacob@ximian.com>

	* Makefile.am: add -lpopt to LDFLAGS

Thu Aug 29 10:35:23 2002  George Lebl <jirka@5z.com>

	* gnome-panel-screenshot.c: Check for NULL return from the
	  gdk_window_foreign_new function and exit nicely if that is the
	  case.  Probably very rare, fixes #91744

Thu Aug 29 10:25:24 2002  George Lebl <jirka@5z.com>

	* gnome-panel-screenshot.c: Apply patch from Owen Taylor for bug
	  #10778 to avoid taking screenshot multiple times by using
	  selections.

Thu Aug 29 10:16:16 2002  George Lebl <jirka@5z.com>

	* gnome-run.c: Fix #91766 by converting from utf8 when getting text
	  from the text entry, also convert to utf8 when appending using the
	  file selection.

Tue Aug 27 16:17:09 2002  Jonathan Blandford  <jrb@redhat.com>

	* gnome-panel-preferences.desktop.in: OnlyShowIn=GNOME;

2002-08-23  Alex Graveley  <alex@ximian.com>

	* menu.c: Re-enable menu editing by applying patch from Bug #77848.

2002-08-21  Kjartan Maraas  <kmaraas@gnome.org>

	* menu.c: Fix a typo in a string. #90953.
	
2002-07-13  Havoc Pennington  <hp@pobox.com>

        Try fixing panel to allow Mod2-Mod5 accels. This fix is a drop in
	the bucket though, this code needs a lot of help.
	
	* eggaccelerators.h: copy in from libegg to use in fixing
	global-keys.c. evil cut-and-paste code.

	* global-keys.c (grab_key): dynamically get ignored mods

	* global-keys.h: remove IGNORED_MODS and USED_MODS, any uses of
	those were broken.

2002-08-27  Mark McLoughlin  <mark@skynet.ie>

	* panel-util.h, panel-access.c:
	(is_gail_loaded): simplify.
	(panel_set_atk_name_desc): rename from add_atk_name_desc.
	(panel_set_atk_relation): rename from set_relation, also
	remove unused 'set_for' parameter.

	* foobar-widget.c: (foobar_widget_instance_init):
	* gnome-run.c: (create_program_list_contents):
	* launcher.c: (setup_button):
	* menu.c: (create_new_panel):
	* panel-config.c: (make_position_widget_accessible),
	(make_position_widget), (floating_notebook_page),
	(sliding_notebook_page), (make_size_widget), (background_page):
	* panel-util.c: (create_text_entry), (create_icon_entry):
	update for above changes.

2002-08-25  Anders Carlsson  <andersca@gnu.org>

	* panel.c: (panel_realize):
	No need to set the default cursor here; just use the one from the
	root window.
	
Sun Aug 25 02:57:54 2002  George Lebl <jirka@5z.com>

	* launcher.c: Fix redhat bug #72540 by hoarding launchers not in
	  our private path on gconf load

2002-08-21  Satyajit Kanungo  <satyajit.kanungo@wipro.com>

	* menu.c :show_panel_help(), Removed the sectionId from
	  the help callback to show the TOC page. #91274
 
2002-08-14  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_save_position): don't
	save the position backwards if it isn't a packed
	panel. The saved position only has the effect of
	ordering the applets on packed panels, not actually
	specifying the position. Fixes #90598.

2002-08-13  Mark McLoughlin  <mark@skynet.ie>

	Register all panel icons with GtkIconFacory and
	use stock ids when rendering icons. Also register
	two named icon sizes to allow future icon size
	theming. Fixes #89063.

	* panel-stock-icons.h: list of stock ids.

	* panel-stock-icons.c:
	(panel_menu_icon_get_size), (panel_foobar_icon_get_size):
	accessors for our named GtkIconSizes.
	(panel_init_stock_icons): register stock icons here. Default
	to GTK_STOCK_MISSING_IMAGE if we can't find the icon. Note,
	that GnomeIconLoader is still used to lookup the icon path
	first, so you can still theme these icons using GnomeIconLoader,
	except the gtk theme will override it. Not sure how much sense
	that really makes.
	(panel_init_stock_items): register our modified stock gtk items
	here (only the run button currently).
	(panel_init_stock_icons_and_items): call both of the above but
	also register our named icon sizes.

	* Makefile.am: add panel-stock-icons.[ch] to the
	build.

	* distribution.c: use stock icons.

	* distribution.h: s/menu_icon/stock_icon/

	* foobar-widget.c: (append_actions_menu),
	(foobar_widget_instance_init): use stock icons. Also
	use special icon size for foobar icon. I don't think
	it makes sense for that to be the same size as the menu
	icons.

	* gnome-run.c:
	(add_icon_idle): look up actual icon size.
	(register_run_stock_item): moved into panel-stock-icons.c.
	(show_run_dialog): s/PANEL_STOCK_RUN/PANEL_STOCK_EXECUTE/.

	* main.c: (main): init stock icons.

	* menu-fentry.h: kill MenuFinfo::pixmap_name. Seems to have been
	totally unused. Also removed a pile of related code from menu.c.

	* menu-util.[ch]: (stock_menu_item_new): rename pixmap_menu_item_new
	and use stock ids instead of filenames.

	* menu.c:
	(load_icons_handler): render a stock icon if requested.
	(image_menuitem_size_request): actually lookup the icon size.
	(applet_menu_get_category_icon): use a hash of stock ids instead
	of filenames.
	(create_applet_menu): use stock icons for categories. Applet icons
	should be themed with GnomeIconLoader.
	(create_add_panel_submenu): use stock icons.
	(setup_stock_menu_item): rename from setup_menuitem_try_pixmap.
	(make_add_submenu): use stock icons.
	(make_panel_submenu), (create_panel_submenu): use panel icon size,
	instead of gtk icon size.
	(create_desktop_menu): (add_distribution_submenu),
	(add_kde_submenu), (create_root_menu): use stock icons.
	(panel_load_menu_image_deferred_with_size): allow the use of 
	stock icons and filenames.
	(panel_load_menu_image_deferred): actually lookup the icon size.

	* menu.h: remove create_menu*, they're static now.

2002-08-11  Mark McLoughlin  <mark@skynet.ie>

	* drawer.c: (drawer_save_to_gconf): save the
	associated panel when saving the drawer.

	* main.c: (main): don't kill free drawers. They're
	not used at this point because we're loading drawers
	in idle now. Fixes #90443.

2002-08-11  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.glade: kill the seperator.

2002-08-11  Mark McLoughlin  <mark@skynet.ie>

	* gnome-run.c: (remove_parameters): impl stripping
	desktop item Exec parameters.
	(sync_list_to_entry): Use it when setting the entry
	from the treeview. Fixes #90200.

2002-08-11  Mark McLoughlin  <mark@skynet.ie>

	* edge-widget.c: (edge_widget_new): hey ! edge widgets
	shouldn't have packed PanelWidgets should they? Well,
	they have since Aug99 ... very, very confused.

	* panel-applet-frame.[ch]: (panel_applet_frame_get_size_hints):
	return the number of hints, not the hints themselves.

	* panel-widget.c:
	(allocate_dirty_child), (panel_widget_size_request),
	(panel_widget_size_allocate): handle expanding applets
	on 'packed' panels. Fixes #89266.

2002-08-07 Padraig O'Briain  <padraig.obriain@sun.com>

	* menu.c (create_new_panel): Call gtk_window_present() to give
	newly created panel focus (bug #90084)

2002-08-10  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.glade: handle "delete_event".
	Fixes #90183.

2002-08-09  Satyajit Kanungo  <satyajit.kanungo@wipro.com>

	* gnome-panel-screenshot.c : Corrected the help links for help on 
	  screenshot.

2002-08-08  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add egg-screen-exec file to the build.

	* panel-util.[ch]:
	(panel_show_help), (panel_show_gnome_help),
	(panel_show_kde_help), (panel_show_gnome_kde_help):
	add a GdkScreen* arg and use the egg_screen_help
	variants in all of these.

	* applet.c, launcher.c, menu-ditem.c, menu.c,
	  panel-config.c: pass a GdkScreen* to the help
	functions and use egg_screen_url_show instead of
	gnome_url_show.

2002-08-07  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: link against XSHAPE_LIBS. Fixes #90000.

	* gnome-panel-screenshot.c: (take_window_shot):
	dont' use the shape extension if the header wasn't
	found.

2002-08-06  Mark McLoughlin  <mark@skynet.ie>

	Fixes #84744, applets not loading in the correct order,
	by loading all types of applets in the idle handler, in
	the same order as they should appear on the panels.

	* applet.c:
	(panel_applet_load_idle_handler): handle loading all types
	of applets.
	(panel_applet_load_from_unique_id): queue all applets for
	the idle handler.
	(panel_applet_compare): impl.
	(panel_applet_load_applets_from_gconf): sort the queued
	applets and run the idle handler over them.

2002-08-05  Anders Carlsson  <andersca@gnu.org>

	* gnome-panel-screenshot.c: (save_to_file_internal),
	(on_preview_expose_event), (take_window_shot):
	Add support for making shaped windows transparent.
	
2002-08-05  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (make_add_submenu): s/button/Button/

2002-08-05  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_register): focus the
	object as its added to the panel. #88202.

2002-08-05  Mark McLoughlin  <mark@skynet.ie>

	* foobar-widget.c: (append_actions_menu): if the wm
	supports it, add a 'Show Desktop' item. #61988.

	* xstuff.[ch]:
	(panel_atom_get): remove display arg. We always use the
	default display - no multidisplay support here.
	(xstuff_net_wm_supports): impl.
	(xstuff_show_desktop): send _NET_SHOW_DESKTOP ClientMessage.

2002-08-05  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c: (register_stock_item),
	(panel_applet_frame_loading_failed): determine
	whether or not the user wants to remove the 
	failed applet from the configuration. Fixes #89173.
	(panel_applet_frame_construct): use it.

2002-08-05  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c:
	(basep_calculate_borders): kill really silly silly.
	Fixes #89736.

2002-08-05  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (restore_grabs): don't change cursor
	when restoring menu grab. Fixes #89631.

2002-08-02  Mark McLoughlin  <mark@skynet.ie>

	* menu.c:
	(find_empty_border_and_anchor): impl figuring
	out the best place to use a sliding panel.
	(create_new_panel): use it. Fixes #87733.

	* xstuff.c: (xstuff_set_pos_size): don't set the
	hint unless the size has actually changed.

2002-08-01  Mark McLoughlin  <mark@skynet.ie>

	* session.c: (panel_quit): request a Global
	only session save.

2002-07-31  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c, logout.c: include multihead-hacks.h.

	* multihead-hacks.h: add gtk_widget_get_screen stub.

2002-07-30  Mark McLoughlin  <mark@skynet.ie>

	* menu.c:
	(menuitem_button_press_event): rename from show_item_menu_mi_cb.
	(setup_full_menuitem): only connect to "button_press_event"
	not "event".

2002-07-30  Mark McLoughlin  <mark@skynet.ie>

	Don't allow moving objects to explicitly hidden panels. It
	makes little sense and is less confusing. Fixes #89317.

	* panel-widget.c:
	(panel_widget_applet_move_to_cursor): don't check for
	-1 return value from reparent - it returns a bool.
	(panel_widget_reparent): return FALSE and canel the
	reparent if trying to move to an explicitly hidden
	panel. Also, return TRUE (not the position) if reparent
	succeeds.

2002-07-29  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.glade: set "directory_entry"
	flag on the file selector to false. Fixes #89037.

2002-07-29  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_menuitem): Check if fr->comment
	is an empty string before setting tooltip. Pointed
	out by Arvind, #88484.

2002-07-27  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c: (basep_widget_focus_in_event): update
	blurb about unhiding explicitly hidden panels to include
	pointers to #89179 and #89180.

2002-07-27  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c: (basep_widget_focus_in_event): remove
	bogus autoshowing on focus that was supposed to fix
	#81041. Ths solution for this needs a lot more 
	consideration - see #83476 for issues.

2002-07-27  Mark McLoughlin  <mark@skynet.ie>

	* applet.c:
	(panel_applet_clean_gconf): don't take AppletInfo as an
	arg so we can clean an unregistered applet. Don't free
	the gconf key here.
	(panel_applet_clean): upd for above.

	* panel-applet-frame.c:
	(panel_applet_frame_construct): if loading fails, delete
	applet from the configuration - fixes #89051. This should
	be optional but will have to wait until 2.2.x - see #89713.

2002-07-26  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.c:
	(nibble_on_file), (save_to_file), (gimme_file): sanity
	checks so we don't crash on Solaris trying to do
	printf ("%s", NULL);

2002-07-25 Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-widget.c (panel_widget_reset_focus): This function is called
	when object is deleted from panel. Reimplement function to ensure 
	that focus goes to PanelWidget if no objects remaining on panel and 
	goes to next or previous object if there are remaining objects.
	(bug #88938)

2002-07-24 Padraig O'Briain  <padraig.obriain@sun.com>

	* drawer.c (key_press_drawer): Allow any arrow key to move focus to
	object in drawer when focus is on drawer icon. Ensure that arrow keys 
	have no effect if drawer is closed. (bug #88782)

	* menu.c (panel_menu_key_press_handler): Ensure that Shift+F10 has
	no effect for menus without context menus. (bug #88861)

2002-07-23  Mark McLoughlin  <mark@skynet.ie>

	* drawer.c: (properties_apply_callback): kill unused (apart
	from freeing whatever random data it points too) variable.
	Fixes #88427.

2002-07-24  Mark McLoughlin  <mark@skynet.ie>

	Fixes #84101 - were casting a GtkButton to GtkMenu.

	* logout.c:
	(lock_button_pressed): impl. to use panel_lock_screen.
	(create_lock_widget): use it here.

	* menu.[ch]: (panel_menuitem_lock_screen): rename from panel_lock.
	(create_desktop_menu): update.
	* menu.h:
	* panel-util.[ch]: (panel_lock_screen): implement.

	* foobar-widget.c: (append_actions_menu): use panel_menuitem_lock.

2002-07-23  Frank Worsley  <fworsley@shaw.ca>

	* gnome-panel-screenshot.glade:
	don't expand the options frame when resizing

	* launcher.c: (launcher_get_unique_uri):
	fix memory leak
	
2002-07-23 Padraig O'Briain  <padraig.obriain@sun.com>

	* drawer.c (key_press_drawer_widget): New key-press-event handler for
	DrawerWidget to support Esc closing the drawer and Shift+Esc moving
	focus to drawer button without closing drawer when focus is in
	drawer. (bug #87839)

2002-07-23  Mark McLoughlin  <mark@skynet.ie>

	* drawer.c: (properties_apply_callback): kill unused (apart
	from freeing whatever random data it points too) variable.
	Fixes #88427.

2002-07-19  Deepa Natarajan  <deepa.natarajan@wipro.com>

	* logout.c, menu.c, drawer.c, launcher.c: Add mnemonics for right
	click popup menus of : Launcher, Drawer, Log Out Button, Lock button
	& gnome foot menu. Fixes bug #88503.

2002-07-19  Deepa Natarajan <deepa.natarajan@wipro.com>

	* applet.c, GNOME_Panel_Popup.xml: Add mnemonics for Move and Remove
	From Panel popup menu options. Fixes bug #86501.

2002-07-22  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c:
	(panel_applet_reload_response): if our parent has disappeared
	forget about reloading.
	(panel_applet_frame_cnx_broken): take a ref on the frame. #88432.

	* panel-util.[ch]: (panel_signal_connect_while_alive),
	(panel_signal_connect_object_while_alive): upd signatures
	to be more gobject like.

2002-07-22  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c: (panel_applet_frame_reload_response): 
	Only reload the applet on GTK_RESPONSE_YES. #88098.

2002-07-19  Mark McLoughlin  <mark@skynet.ie>

	Based on patch from Arvind to fix #88430.

	* launcher.[ch]:
	(launcher_properties_destroy): impl to destroy the properties dialog.
	(destroy_launcher): use it.

	* panel.c: (panel_remove_applets): ditto.

2002-07-19  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.glade: fix clash in mnemonics.

2002-07-18  Mark McLoughlin  <mark@skynet.ie>

	* panel-config-global.c: include panel-gconf.h to
	fix warning.

Tue Jul 16 12:29:31 2002  George Lebl <jirka@5z.com>

	* panel-config.c, basep-widget.c: Two more RTL language fixes.  First
	  the position widget for the panel position can't be switched and
	  second the table in the basep is also visual rather then logical.
	  This fixes all the RTL issues I could find when playing with an
	  arabic panel (it's hard to test something if you don't speak the
	  language :)

Tue Jul 16 12:18:02 2002  George Lebl <jirka@5z.com>

	* foobar-widget.c: set the direction of the foobar hbox to be LTR
	  as otherwise it is completely whacked in RTL locales.

2002-07-15  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c:
	(button_widget_new), (button_widget_set_pixmap): realise
	error dialogs on the default screen.

	* menu.c: (remove_panel_query): remove #ifdef HAVE_GTK_MULTIHEAD.

2002-07-14  Frank Worsley  <fworsley@shaw.ca>

	* gnome-run.c: (launch_selected), (run_dialog_response): 
	always save command in history (fix #83891)
	(fill_list): check item not null before adding to list (fix #85762)
	(update_contents): display 5 items in list by default (fix #81930)

Fri Jul 12 10:06:16 2002  George Lebl <jirka@5z.com>

	* quick-desktop-reader.c: Apply parts of the patch from
	  Hidetoshi Tajima that made sense, bug #84074

	* gnome-panel-preferences.desktop.in: add "Encoding=UTF-8" to
	  conform to standard, damn we don't have this anywhere.

2002-07-12  Mark McLoughlin  <mark@skynet.ie>

	* panel-per-panel-config.schemas.in: fix the gnome-terminal
	launcher uri and use Nautilus instead of Netscape since
	we can't be sure of the location of Netscape.

2002-07-12  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_load_from_unique_id):
	* launcher.c: (create_launcher), (launcher_load_from_gconf):
	* menu.c: (menu_load_from_gconf): patch from Havoc to 
	check for and print warnings about broken gconf settings. #84808.

2002-07-12  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: (load_launcher_applet_full): revert the disabling
	of the 'Help' menuitem that Glynn snuck past me in another
	patch.

Wed Jul 10 20:17:37 2002  George Lebl <jirka@5z.com>

	* button-widget.c: properly handle the empty icon case.  Don't
	  give an error on empty icon (NULL or "")

Wed Jul 10 17:54:45 2002  George Lebl <jirka@5z.com>

	* launcher.c: fix segfault, and icon errors with adding launchers,
	  don't free the return from getstring from a ditem, it's constant

Wed Jul 10 16:50:27 2002  George Lebl <jirka@5z.com>

	* button-widget.[ch], launcher.c, logout.c, darawer.c, menu.c,
	  panel-util.h: redo the icon loading logic a bit and leave more
	  logic up to the loading code in button_widget.  Failsafe code so
	  that we always succeed even if we can't find gnome-unknown.png,
	  in which case we make a white rectangle with a red X thorough it.

Wed Jul 10 15:13:37 2002  George Lebl <jirka@5z.com>

	* quick-desktop-reader.c: revert all the patches that broke
	  everything and fix #84074 the proper way.  That is by checking
	  for NULL at the place it crashed, rather then replacing the
	  functions by other functions that do something completely
	  different.

2002-07-10  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c:
	(button_load_pixbuf): rename and handle GErrors.
	(button_widget_new): display an error dialog if we
	can't load the pixbuf.
	(button_widget_set_pixmap): ditto.
	* drawer.c:
	(drawer_click): kill debug.
	(free_drawer): implement.
	(create_drawer_applet): if creating button fails, free
	the drawer and return.
	(load_drawer_applet): use free_drawer as destroy notify
	handler.

	* logout.c: (create_logout_widget), (create_lock_widget),
	(load_lock_applet): return if we failed to create the
	button.

	* menu.c: (create_panel_menu): ditto.

2002-07-10  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.desktop.in: patch from Glynn
	to change tooltip. #87755.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.glade: centre the animation
	speed menu. Should fix #84074.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.glade: give the close button
	the default focus.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* panel-config.c: slightly modified version of
	a patch from Glynn to add mnemonics and clean
	up the panel properties dialog. #85623.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c:
	(free_launcher): remove launcher from hoarding list.
	(launcher_idle_hoard), (launcher_hoard): hoard launchers
	in idle. Hopefully fixes #83373.

	* applet.c: (applet_destroy): Don't add dead launcher
	unless it has been hoarded.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* panel-gconf.[ch]: (panel_gconf_string_to_enum): impl
	with a fallback argument. Fixes #87133.

	* gnome-panel-preferences.c: (load_animation_menu): use
	panel_gconf_string_to_enum.

	* panel-config-global.c: (panel_global_config_set_entry):
	ditto.

	* panel.c: (panel_load_panels_from_gconf): ditto.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.c:
	(animation_menu_changed): rename from option_menu_changed.
	(load_animation_menu): rename from load_option_menu, removing
	generic handling of option menus and checking string value
	before mapping to an enum. Fixes #86667.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_add_panel_submenu): make ordering
	of the 'New Panel' menu sane. Fixes #61599.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.desktop.in: use X-GNOME-DocPath.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c, menu.c: Patch from Glynn Foster
	to use X-GNOME-DocPath instead of DocPath.
	Fixes #87431.

2002-07-09  Mark McLoughlin  <mark@skynet.ie>

	* quick-desktop-reader.c: (get_encoding): Patch from
	Hidetoshi Tajima to use g_get_charset get the canonical
	name of the locale's charset. Fixes #84074.

2002-07-08  Mark McLoughlin  <mark@skynet.ie>

	* global-keys.c: (panel_global_keys_filter): patch
	from Glynn to pop up the global menu instead of
	panel context menu.

2002-07-05  Rohit R <rohit.raveendran@wipro.com>

	* gnome-panel/gnome-panel-screenshot.c:
	Remove temp dir correctly and update the permissions
	for files and directories created.
	Fixes #87259

2002-07-04  Satyajit Kanungo <satyajit.kanungo@wipro.com>

	* menu.c: Changed the section Id for Panel Manual to point  
	  correct section in the help document.

2002-07-03  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add egg-screen-exec.[ch] to build.

	* applet.c, foobar-widget.c, global-keys.c, gnome-run.c,
	  menu.c: use egg-screen-exec methods instead of the
	  ones in panel-util.c.

	* panel-util.[ch]: kill screen-exec methods.

2002-07-02  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.c:
	* gnome-panel-screenshot.glade: Patch from Glynn Foster
	to add help button.

2002-07-02  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-preferences.c: clean up, a lot. No
	global variables, use glade properly, error dialog
	if glade file not found ...

	* gnome-panel-preferences.glade: implement string changes
	recommended in #85651. Also remove extra useless widgets.

2002-07-02  Mark McLoughlin  <mark@skynet.ie>

	* panel-config.c: Various string changes from #85623.

Mon Jul  1 16:44:35 2002  Jonathan Blandford  <jrb@gnome.org>

	* gnome-run.c (sync_entry_to_list): do the icon finding in an idle
	instead of a timeout.  There's no reason to be so slow here.

	* disclosure-widget.c (unrealize): We should really remove the
	timeout in an unrealize handler instead of finalize.  Doesn't hurt
	to keep the finalize one around.

2002-07-01  Glynn Foster  <glynn.foster@sun.com>

	* menu.c: Set default response to delete your panel.

2002-07-01  Glynn Foster  <glynn.foster@sun.com>

	* menu.c: (create_panel_menu): s/Main Menu/GNOME Menu for the
	tooltip.

2002-07-01  Glynn Foster  <glynn.foster@sun.com>

	* menu.c: (remove_panel_query): Don't expose the 
	term 'applet' to the user - yeah, yeah, I know we still
	have this stuff in the user docs.

2002-07-01  Mark McLoughlin  <mark@skynet.ie>

	String changes and UI consistency changes from
	#85344, #85619, #85620, #82586 and 85622. Based
	partially on a patch from Glynn Foster.

	* Makefile.am: remove menu-properties.[ch].

	* applet.c: (applet_callback_callback): remove
	properties callback.

	* distribution.c, drawer.c, foobar-widget.c,
	  launcher.c: string changes.

	* menu.c: various string changes, mnemonics, fixing
	the delete panel dialog, removing global preferences
	menuitem and removing menu properties menu item.

	* panel-applet-frame.c: (panel_applet_frame_cnx_broken):
	string change.

2002-07-01  Mark McLoughlin  <mark@skynet.ie>

	Fixes #86459

	* panel-applet-frame.c: (panel_applet_frame_get_name): Sanity
	check sequence length and buffer before using.

2002-07-01  Mark McLoughlin  <mark@skynet.ie>
	
	Fixes #86455

	* disclosure-widget.c:
	(finalize): remove the timeout.
	(expand_collapse_timeout): unset timeout tag if last time
	running.

	* panel-applet-frame.c: (panel_applet_frame_load_from_gconf):
	kill debug.

2002-07-01  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (drag_data_recieved_cb), (panel_monitor_from_toplevel),
	(panel_is_applet_right_stick): move here from applet.c

	* panel-applet-frame.[ch]:
	(panel_applet_frame_load): add exactpos param and pass to
	panel_applet_register.
	(panel_applet_frame_load_from_gconf), pass exactpos = TRUE.
	(panel_applet_frame_reload_response): ditto.

	* applet.h: kill panel_applet_get_right_stick.

	* applet.c: (panel_applet_save_position): update for right_stick ()
	change.

	* menu.c: (add_bonobo_applet): add exactpos = FALSE.

2002-06-26  Mark McLoughlin  <mark@skynet.ie>

	* multihead-hacks.h:
	s/gdk_get_default_screen/gdk_screen_get_default/
	s/gdk_get_default_display/gdk_display_get_default/

	* panel-util.c:
	s/launch_env/launch_with_env/

2002-06-25  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add multihead-hacks.h

	* border-widget.[ch]:
	* drawer-widget.[ch]:
	* edge-widget.[ch]:
	* floating-widget.[ch]: 
	* sliding-widget.[ch]: 
	* aligned-widget.[ch]: pass screen and xinerama
	monitor number around.

	* basep-widget.[ch]:
	(basep_widget_class_init), (basep_widget_real_screen_change),
	(basep_widget_screen_change): screen_change signal now takes
	monitor and screen.
	(basep_widget_construct): set the screen to realize the
	window on.
	(get_borders), (basep_calculate_borders), (basep_border_recalc),
	(queue_recalc_handler), (basep_border_queue_recalc),
	(basep_border_get): package the screena and monitor info
	up in a struct and pass it around.

	* applet.c: (applet_user_menu_get_screen): impl helper.
	(applet_callback_callback): use panel_execute_shell.
	(applet_show_menu): set screen info for menu.

	* drawer.c:
	(create_empty_drawer_applet): make sure the drawer is on the
	correct screen.

	* foobar-widget.c:
	(foobar_screenshot), (foobar_search): use panel_execute_sync.
	(add_window), (create_task_menu): make sure we use the right WnckScreen.
	(foobar_widget_new): set the screen on which to realize the panel.

	* global-keys.c: (screen_from_event): impl helper.
	(panel_global_keys_filter): make sure all menus, dialogs and
	programs come up on the right screen.

	* gnome-run.c: (get_environment): if DISPLAY is not already
	in the command, set it to the screen the dialog is on.
	(launch_selected), (run_dialog_response), (create_simple_contents),
	(show_run_dialog), (show_run_dialog_with_text): make sure dialogs
	etc. come up on the right screen.

	* launcher.c: (launcher_get_screen): helper method.
	(launch_url), (launch_cb), (drag_data_received_cb),
	(create_properties_dialog), (launcher_properties), (launcher_save),
	(launcher_show_help): dialogs on the right screen.

	* menu-ditem.c, menu-properties.c, menu-util.c,
	  panel-applet-frame.c, panel-shell.c: ditto.

	* menu.c: make sure dialogs, menus and launcher apps come
	up on the right screen. Various updates for other changes.

	* multihead-hacks.h: some hacks to reduce the number
	of HAVE_GTK_MULTIHEADs needed.

	* multiscreen-stuff.c: (multiscreen_support_init): impl using
	gtk multihead apis.
	(multiscreen_init): use gdk_screen_get_(width|height).
	(multiscreen_screens), (multiscreen_monitors),
	(multiscreen_x), (multiscreen_y), (multiscreen_width),
	(multiscreen_height), (multiscreen_locate_coords),
	(multiscreen_locate_widget): use the screen number to
	index the geometries vector.

	* panel-config.c:
	(update_config_screen), (screen_set), (monitor_set),
	(make_misc_widget): add crappy UI for changing screens.

	* panel-per-panel-config.schemas.in: set "screen" and
	"monitor" key on all panels.

	* panel-util.[ch]:
	(panel_screen_from_number): helper method.
	(panel_display_string): impl method to munge the
	DISPLAY string into one that will set the default screen
	to the one specified.
	(panel_munge_environment): impl method to change the
	value of DISPLAY in the environ array.
	(panel_execute_async), (panel_execute_shell),
	(panel_execute_command_line), (panel_ditem_launch): impl
	versions of these methods that will bring the launched
	app up on the correct screen.
	(panel_dialog), (panel_error_dialog), (panel_info_dialog):
	allow the screen on which to realize to be specified.

	* panel-widget.c: (panel_widget_applet_move_to_cursor): make
	sure the panels are on the same screen before trying to
	reparent the applet.

	* panel.c: (move_panel_to_cursor): use the correct root window
	when getting pointer coords.
	(panel_popup_menu): popup on the right screen.
	(panel_ensure_panel_per_screen): impl method to make sure
	there's at least one panel per screen.
	(panel_load_panels_from_gconf): use "screen" and "monitor"
	keys but keep support for "screen_id" key.
	(panel_save_to_gconf): save screen and monitor numbers.
	(panel_screen_from_toplevel), (panel_monitor_from_toplevel),
	(panel_screen_from_panel_widget), (panel_monitor_from_panel_widget):
	implement these utility methods.

	* xstuff.c:
	(xstuff_is_compliant_wm): use new multihead apis.
	(xstuff_init): set the event filter on the root window
	of every screen.

2002-06-22  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (remove_panel_query): remove a stray
	gtk_window_set_screen.

2002-06-21  Mark McLoughlin  <mark@skynet.ie>

	Cleanups and bugfixes while doing mulitscreen support.
	Committing them now will make branching a lot easier.

	* Makefile.am: just link gnome-panel-preferences against
	rgb-stuff.c, not panel-util.c.

	* applet.c: (applet_callback_callback): use launcher_show_help.

	* basep-widget.c:
	(basep_widget_class_init): use the glib marshaller.
	(basep_calculate_borders): simplify this code greatly.

	* disclosure-widget.c: fix some warnings. Should sync
	with gnome-media really.

	* foobar-widget.c:
	(foobar_widget_instance_init): pass the panel widget to
	create_root_menu to fix warnings.

	* gnome-panel-preferences.c: kill copied and pasted code.

	* gnome-run.c: kill loads of headers.

	* launcher.c:
	(launcher_show_help): move code frmo applet_callback_callback.

	* menu-util.c: move screenshot and search launching code to
	menu.c.

	* menu.c: (menu_get_panel): rename from get_panel_from_menu_data
	and simplify + fix.
	(create_new_panel): save the panels to gconf as they are created.

	* multiscreen-stuff.c:
	(multiscreen_init): split libxinerama code and plain code into	
	seperate methods. Also leave room in geometries for multscreen
	as well as xinerama.
	(multiscreen_locate_coords), (multiscreen_locate_widget): renamed
	methods.

	* panel-gconf.h: (panel_gconf_sprintf): use G_GNUC_PRINTF.

	* panel-marshal.list: kill VOID:INT. glib provides it.

	* panel-util.c: kill old battery code.

	* panel-widget.c: kill unused applet_about_to_die stuff.

	* panel.c: (move_panel_to_cursor): use the root window in
	gdk_window_get_pointer.
	(panel_setup): return PanelData.
	(panel_save_to_gconf): save xinerama monitor info in the
	one place.
	(panel_monitor_from_toplevel): impl monitor info accessor.

	* session.c: kill loads of headers.

	* xstuff.c: (panel_atom_get): remove multidisplay stuff.
	(xstuff_setup_desktop_area): remove GNOME_PANEL_DESKTOP_AREA
	stuff. Nautilus now use _NET_WM_WORKAREA.

2002-06-21  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.glade2: rename to .glade.

	* Makefile.am:
	* gnome-panel-screenshot.c: (main): update.

2002-06-17  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (applet_callback_callback):
	* menu-properties.c: (properties_apply_callback):
	* menu.c: (show_item_menu): disable more non-working
	menu editing menu items.

2002-06-18  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: use $(prefix)/$(DATADIRNAME)/locale instead
	of $datadir/locale for locale directory location. Reported
	by Hidetoshi Tajima in #83623.

2002-06-10  Kjartan Maraas  <kmaraas@gnome.org>

	* gnome-panel-preferences.c: Mark a string for translation.
	
2002-06-08  Arvind Samptur   <arvind.samptur@wipro.com>

	* panel-config.h : change the data types of 
	x and y co-ordinates in _PerPanelConfig structure to 
	match with that of _FloatingPos structure. Fixes #83375.
        
2002-06-09  Mark McLoughlin  <mark@skynet.ie>

	* quick-desktop-reader.c: (quick_desktop_item_load_uri): don't
	crash when we don't know the Name's locale. #84074. Patch from
	Hidetoshi Tajima.

2002-06-03  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (setup_full_menuitem),
	(panel_load_menu_image_deferred_with_size): fix
	scary, scary g_free on GObjects instead of 
	g_object_unref. More than likely fixes #81690.

2002-06-02  Satyajit Kanungo <satyajit.kanungo@wipro.com>

	* gnome-panel-preferences.c: Added a help button to the panel capplet
          and link the help document present in "user-guide".			

2002-05-31  Dave Camp  <dave@ximian.com>

	* gnome-desktop-item-edit.c (get_uri): If the argument is already a uri,
	canonicalize it.  

	* panel-util.c (panel_uri_exists): Return FALSE without a warning
	for invalid uris.  These two changes fix #83705.

2002-05-31  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c (basep_widget_focus_in_event): add
	some code to handle auto-showing on FocusIn. Don't
	enable it because of problems. See #81041.

2002-05-14  Jayaraj Rajappan <jayaraj.rajappan@wipro.com>

	* gnome-panel/panel-config.c - accessibility features described
	in #79204

	* gnome-panel/gnome-panel-preferences.glade - set atk relation
	between the label "Animation Speed:" and the option menu in
	the panel preferences window.

Wed May 29 10:06:54 2002  George Lebl <jirka@5z.com>

	* basep-widget.c, panel-widget.[ch], panel.c, panel-marshal.list:
	  remove all args from the back_change, size_change and orient_change
	  signals.  This removes some complexity that was not needed and
	  fixes a marshalling bug found by Jorgen Viksell
	  <jorgen.viksell@telia.com>

	* gnome-desktop-item-edit.c: allow editting of directories, fix
	  error output.  Allow editting non-existing .desktops and
	  .directories, though it doesn't work too great with vfolders
	  and .desktops.

2002-05-29  Padraig O'Briain  <padraig.obriain@sun.com>

	* button-widget.c (button_widget_expose): Caculate focus indication
	box correctly, i.e. include line with for start and end lines.

2002-05-28  Satyajit Kanungo  <satyajit.kanungo@wipro.com>
	* applet.c, gnome-run.c,launcher.c, menu-ditem.c,menu-properties.c,
	  menu.c, panel-config.c : modified the help callbacks to fetch the
	  help documents from the user-guide.  
        
	* panel-util.c : panel_show_help() is modified to pass the user-guide name.

Tue May 28 14:49:09 2002  George Lebl <jirka@5z.com>

	* menu-ditem.c: fix uri issues with creating new items, fix crash
	  on creating new items, and convert name from utf8 before we attempt
	  to use it as a filename

2002-05-29  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: don't define PANELRC.

	* gnome-panelrc: zero this file.

	* panel.c: (panel_event): don't set state to SELECTED
	on focus.

2002-05-28  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.c: (add_file_to_path): convert translated
	filenames from utf8 to the locale encoding for filenames.

	* panel-applet-frame.c: (panel_applet_frame_construct): use
	g_signal_connect_object instead of constructing the closure
	ourselves.

2002-05-25  Mark McLoughlin  <mark@skynet.ie>

	* applet.[ch]: (panel_applet_menu_set_recurse): rename and
	export this function.
	(applet_show_menu): upd.

	* menu.c:
	(menu_applet_reparented): impl to reset the menu data
	when the applet is reparented. Fixes #79719.
	(create_panel_menu): hook up to the reparent signal.

	* sliding-widget.[ch]: (sliding_pos_class_init),
	(sliding_widget_change_params): change the signatures
	of the offset_change and anchor_change signals. We don't
	use the params, we just need the notification.

2002-05-23  Alex Larsson  <alexl@redhat.com>

	reviewed by: mark@skynet.ie

	* main.c: (main):
	Create a global panel_icon_loader to handle icon theming.
	
	* button-widget.c: (loadup_file):
	* gnome-run.c: (find_icon_timeout), (selection_changed):
	* launcher.c: (setup_button), (ditem_set_icon):
	* menu-util.c: (get_pixmap):
	Use panel_icon_loader
	
	* menu.c: (icon_theme_changed), (panel_menu_new),
	(panel_make_menu_icon), (create_kde_menu), (image_menu_destroy),
	(panel_load_menu_image_deferred_with_size):
	Use panel_icon_loader, handle icon loader changes.
	
	* panel-main.h:
	Export panel_icon_loader

2002-05-23  Padraig O'Briain  <padraig.obriain@sun.com>

	* gnome-panelrc:
	rc file which ensures that SELECTED state for PanelWidget and its 
	children is not visible, by default

	* Makefile.am:
	Update so that gnome-panelrc file is installed in $(datadir)

	* basep-widget.[ch]: foobar-widget.[ch]
	Remove move-focus-out signal as moving focus from applet to PanelWidget
	is not supported
	Remove basep_key_press, default signal handler for key_press_event

	* button-widget.c:
	(button_widget_expose) Highlight widget when it has focus
	Draw focus indication using style's focus-line-width" and 
	"focus-padding"

	* panel-marshal.list:
	Add BOOLEAN:VOID for new signal popup_panel_menu

	* panel-widget.c:
	Add new signal popup_panel_menu which pops up context menu for
	PanelWidget; use Ctrl+F10 to activate the signal. This works when
	PanelWidget or applet has focus.
	Remove function panel_widget_save_key_event()
	Remove function panel_widget_focus_in_event() and 
	panel_widget_focus_out_event()
	(panel_widget_finalize): Remove reference to panel->key_event
	(panel_widget_real_focus): Remove reference to panel->key_event
	which supported giving focus to PanelWidget when focus was inside 
	an applet in another process. Remove CAN_FOCUS flag if PanelWidget
	has children.
	
	panel.c:
	(panel_end_move) Do not give focus to PanelWidget on mouse click
	(panel_widget_event): For key press, check whether focus widget is a 
	GtkSocket; if so, activate binding for Ctrl+F10, popup panel menu.
	Set state to GTK_STATE_SELECTED for focus in.

2002-05-24  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c: (basep_widget_class_init),
	(basep_pos_class_init), (basep_widget_focus_in_event): on
	focus in, autoshow an autohide panel. Fixes #81041.

2002-05-23  Glynn Foster  <glynn.foster@sun.com>

	* gnome-panel-screenshot.c: Add a default window icon. Clean up after
	a few widgets.

Wed May 22 10:50:23 2002  George Lebl <jirka@5z.com>

	* gnome-run.c: fix #82428 by focusing the entry on show.  Also zero
	  out the GValue when trying to get icon, this should get rid of
	  those random GValue warnings

	* menu.c, foobar-widget.c: patch from Gman to remove the RUN:NEW drag
	  stuff since there is no longer such an applet fixes #82593

	* basep-widget.c: solved the moving (animation) while in metacity bug,
	  still updates are not propagated as they should.  Hmmm we'll have
	  to figure something out with that.  I think it has to do
	  with double buffering or some such.

Wed May 22 10:34:19 2002  George Lebl <jirka@5z.com>

	* menu.c: fix sim menu refcounting

	* menu-ditem.c: save after 2 seconds of inactivity.  5 was too long

	* gnome-run.c: fix some compile warning, also fix possible crash
	  in #82332

2002-05-22  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_load_from_unique_id),
	(panel_applet_save_position): interpret the meaning of
	the 'right_stick' property slightly differently to
	fix #76925. This will break the ordering of your applets
	the first time you load a panel with this fix.

2002-05-22  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (whack_applet_to_load): kill setting
	panel_widget to NULL, just before we try and
	use it ...

2002-05-22  Mark McLoughlin  <mark@skynet.ie>

	Kill broken status dock. Will be replaced by a
	system tray (see freedesktop.org) impl beyond 2.0

	* applet.c, main.c, menu.c, panel.[ch], panel.h,
	  session.c, xstuff.[ch]: kill all status dock
	related code.

	* Makefile.am: removed status.[ch] from the build.

	* status-docklet.[ch], status.[ch]: removed these files.

Mon May 20 17:12:06 2002  George Lebl <jirka@5z.com>

	* applet.c, basep-widget.c, gnome-panel-preferences.c,
	  gnome-run.c, menu-fentry.c, menu.c, panel-config-global.c,
	  panel-util.c, panel-widget.c, panel.c:  Tried to verify GSList
	  code and while at it did a bunch of slist code cleanup.  Also
	  I HATE !strcmp with a passion so I changed all such instances
	  to strcmp(a, b) == 0.

	* basep-widget.c: some more descriptive property names/descs

2002-05-20  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c:
	(panel_applet_frame_reload_response),
	(panel_applet_frame_get_name), (panel_applet_frame_cnx_broken),
	(panel_applet_frame_construct): impl an 'applet died' dialog box
	using the CORBA connection "broken" signal. (#72362)

	* panel-config-global.h: kill auto_raise cruft.

	* panel-global-config.schemas.in: ditto.

	* applet.[ch]: (panel_applet_clean_gconf),
	(panel_applet_clean): add clean_gconf arg so we don't kill prefs
	when we are re-loading.
	(applet_idle_remove), (applet_destroy), (panel_applet_register):
	update for above change.

	* panel.c: (panel_destroy), (drop_internal_applet): update for
	panel_applet_clean change.

2002-05-20  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: generate the .schemas file from the
	.schemas.in files.

	* panel-global-config.schemas.in:
	* panel-per-panel-config.schemas.in: renamed these from
	the .schema version - preserving cvs history.

2002-05-19  Mark McLoughlin  <mark@skynet.ie>

	* foobar-widget (set_das_pixmap): don't destroy the GtkImage
	every time the icon needs to be changed. Should fix #81690.

Fri May 17 21:34:44 2002  George Lebl <jirka@5z.com>

	* panel-shell.c: fix #81437 by disconnecting the destroy
	  function on response before we do gtk_dialog_run

	* menu.c: don't do gtk_dialog_run on something returned from
	  panel_error_dialog.  Hmmm, will need some better idea for the
	  closing instead of hard destroying the thing which causes crashes

	* panel-util.c: avoid warning when creating dialogs with
	  parent == NULL

Fri May 17 21:14:16 2002  George Lebl <jirka@5z.com>

	* gnome-run.c: when getting an iterator check the result of the
	  function and don't continue if this is false.  this should
	  fix #82082

Fri May 17 14:50:21 2002  George Lebl <jirka@5z.com>

	* menu.c: never add an icon to show twice, this should fix #71213

Thu May 16 03:31:14 2002  George Lebl <jirka@5z.com>

	* multiscreen-stuff.c: fix off-by-1 errors in
	  multiscreen_screen_from_pos as pointed out by xavier.bestel@free.fr

Thu May 16 03:25:53 2002  George Lebl <jirka@5z.com>

	* multiscreen-stuff.c: when the screen is invalid, assume the zero
	  (the first) screen, Fixes #70095.  It is probably the saner
	  behaviour since that makes sure that at least SOME panel is
	  visible.

	* menu.[ch], foobar-widget.[ch]: s/run_item/extra_items/ and
	  don't add the search and screenshot item on foobar like we
	  do with the run item

Wed May 15 20:11:31 2002  George Lebl <jirka@5z.com>

	* gnome-run.c: remove some dead code, and support dnd on the entry
	  doing the same thing as append file.  Also when entry is empty
	  don't add a space

Tue May 14 18:37:24 2002  George Lebl <jirka@5z.com>

	* gnome-run.c, disclosure-widget.[ch], Makefile.am,
	  quick-desktop-item.[ch]:  Apply and massage Frank Worsley
	  <fworsley@shaw.ca>'s patch to use Iain's cddb disclosure
	  widget and launch files and lookup icons and just do bunches
	  of cool stuff

	* gnome-run.c, menu-fentry.[ch]: add an exec field to the FileRec
	  so that we can add an EXEC column.  Also add an icon column so
	  that for the icon lookup we do no loading of entries.  Should
	  reduce overhead of icon lookup by quite a bit.

	* gnome-run.c, menu.c: Modify error dialogs to all use the
	  bold/details style that is used elsewhere in the panel

Tue May 14 11:37:24 2002  George Lebl <jirka@5z.com>

	* menu.c: move the screenshot/search to a more appropriate location,
	  one where it actually works all the time, and now it's not such a
	  dirty hack (since that's the way the runbox is done) so remove
	  that comment

	* multiscreen-stuff.c: add checking for "GNOME_PANEL_NO_XINERAMA"
	  env var, and if it exists ignore xinerama.  This is a quick
	  and simple workaround for #73475

2002-05-14  Anders Carlsson  <andersca@gnu.org>

	* foobar-widget.c: (add_window), (create_task_menu),
	(setup_task_menu):
	* xstuff.c: (xstuff_go_through_client_list):
	Use new multi-screen safe libwnck API.
	
2002-05-14  Padraig O'Briain  <padraig.obriain@sun.com>

	* menu.c (create_new_panel):
	Correct window argument passed to gtk_window_set_title()

	* panel-widget.c:
	Add function panel_widget_reset_saved_focus() to reset focus to
	saved_focus_widget
	Add function panel_widget_force_grab_focus() which sets focus to
	specified widget event if widget does not have CAN_FOCUS flag set.
	Add new function panel_woidget_reset_focus() which resets the focus
	widget when the currently focused widget is removed from a panel
	(panel_widget_cremove): Call panel_widget_reset_focus() to reset
	focus when applet is removed from panel.
	(panel_widget_reparent): Set focus to new widget, unset GTK_CAN_FOCUS
	flag on new PanelWidget, if set, and make panel window active when 
	applet is moved from another panel.
	(panel_widget_tab_move): Do not unset saved_focus_widget after moving
	applet to another panel using Tab key.
	(This fixes bug #80688)

2002-05-13  Seth Nickell  <snickell@stanford.edu>

	* foobar-widget.c: (append_actions_menu):
	* menu.c: (create_root_menu):

	Use gnome-screenshot.png instead of gnome-mdi.png

2002-05-13  Glynn Foster  <glynn.foster@sun.com>

	* drawer.c: (focus_in_drawer), (focus_out_drawer):
	* panel-util.c: (panel_dialog), (panel_error_dialog_with_parent),
	(panel_info_dialog_with_parent): Fix up build warnings.

2002-05-12  Arvind Samptur  <arvind.samptur@wipro.com>

	* Reviewed by Glynn Foster
	
	* menu.c :
	Hack to add search tool and screen shot in GNOME menu.
	bug(#81124)

2002-05-12  Alexander Larsson  <alla@lysator.liu.se>

	* panel-applet-frame.c (panel_applet_frame_get_size_hints):
	Make size hints work for applets with handles.

2002-05-11  Glynn Foster  <glynn.foster@sun.com>

	* gnome-panel-preferences.c: Give it a default response.

2002-05-10  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-widget.c:
	(add_all_move_bindings) If focus widget is a GtkSocket unset focus
	while doing move so that key bindings for panel will work
	(remove_all_move_bindings) Reset focus widget at end of move if
	focus widget was unset (#79515)
	(panel_widget_tab_move) Correct bug when panel is not first panel on
	list; cycle around end of panel list

2002-05-09 Stephen Browne <stephen.browne@sun.com>

	* distribution.c
	Changed name of CDE Menu back to "CDE Menus" 
	HCI ppl made the call

2002-05-07  Padraig O'Briain  <padraig.obriain@sun.com>

	* menu-util.[ch]:
	Add function menu_item_menu_position which ensures that menu item's
	menu is displayed close to the menu item; it might be displayed
	because of a key stroke instead of mouse click

	* menu.c:
	Add panel_menu_key_press_handler as signal handler for 
	"key_press_event"
	In panel_menu_key_press_handler() display active menu item's
	menu if Shift+F10 was pressed.
	setup_full_menuitem: Store menu item's ShowItemMenu as data of the
	menu item so it can be found in panel_menu_key_press_handler().

Fri May 03 17:35:40 2002  George Lebl <jirka@5z.com>

	* gnome-run.c, panel-per-panel-config.schemas: Apply the following
	  patch and fix bugs etc... in it

2002-05-02  Frank Worsley  <fworsley@shaw.ca>

	* gnome-run.c: revamp the run dialog. Show 'Advanced' entry field
	by default and rename advanced button to 'Known Applications' to
	display list of known applications when clicked. Plus other fixes.

2002-05-03  Padraig O'Briain  <padraig.obriain@sun.com>
 
	* drawer.[ch]:
	focus_in_drawer: Do not open a drawer when it is focused 
	focus_out_drawer: Do not close a drawer when it is unfocused
	it unfocused.
	Remove just_focused flag in Drawer data structure and 
	unset_just_focused
	Fixed #78782

2002-05-02  Glynn Foster  <glynn.foster@sun.com>

	* foobar-widget.c, menu-util.c, menu-util.h, menu.c: Add 'Search
	for Files' and 'Take a Screen Shot' to the GNOME menu so we don't
	have functionality only available on the Menu panel. Fixes #80357
	and #79366.

2002-05-02  Bastien Nocera  <hadess@hadess.net>

	* foobar-widget.c: (focus_window), (get_default_image):
	change workspaces before focusing a window with the task_list,
	(Closes: #80534)
	change default "no windows focused" image to "gnome-gmenu.png"

2002-05-02 Stephen Browne <stephen.browne@sun.com>

	* panel-util.c: (panel_ensure_dir)
	fix bug 79641 where launchers dir cannot be created on a solaris
	machine with an nfs mounted user home dir

2002-05-01  Arvind Samptur <arvind.samptur@wipro.com>

	Reviewed by: Alex Larsson, Glynn Foster.

	* panel-applet-frame.c: panel_applet_frame_button_changed
	updated with new parameters event button and time for
	GNOME_Vertigo_PanelAppletShell_popup_menu call

2002-05-01  Glynn Foster  <glynn.foster@sun.com>

	* foobar-widget.c: (append_actions_menu): Re-order Actions menu
	according to usability guidance from Nils.

Wed May 01 10:01:16 2002  George Lebl <jirka@5z.com>

	* panel-util.[ch]: create parented versions of the info/error dialog
	  functions

	* menu-ditem.c: Apply a modified version of a patch from Frank
	  Worsley  <fworsley@shaw.ca> to fix saving of items, fix
	  some strings and fix popping of the busy cursor after user
	  dismisses an error dialog.

2002-04-29  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am: Remove install of gnome-panel-screenshot .desktop
	file.
	* foobar-widget.c: (foobar_screenshot), (append_actions_menu):
	Add 'Take a Screen Shot' to the Menu Panel's Actions menu.
	* gnome-panel-screenshot.c: (main): Implement a delay option
	for the command line.
	* gnome-panel-screenshot.desktop.in: Kill.

Mon Apr 29 12:47:15 2002  Jonathan Blandford  <jrb@gnome.org>

	* panel-config-global.c (panel_global_config_set_entry): s/-/_/
	for schemas.

	* panel-global-config.schemas: clean up schemas names.  Have had
	this for months and didn't realize I hadn't committed b/c it
	worked locally.  The keybinding capplet should work much better
	now.

2002-04-22  Frank Worsley  <fworsley@shaw.ca>

	* gnome-panel/gnome-desktop-item-edit.c:
	call panel functions with correct parameters
	fix so that existing files can be edited
	
	* gnome-panel/launcher.c:
	change window titles to match other panel/nautilus terminology
	
	* gnome-panel/menu-ditem.c: 
	change window titles to match other panel/nautilus terminology	
	(is_item_writable): check correct parameter when dir != NULL
	(panel_edit_direntry): don't free dirfile if we use it again
	(create_launcher): display a message box if location not writable

2002-04-26  Abel Cheung  <maddog@linux.org.hk>

	* gnome-panel-screenshot.c (main): Removed reference of gnome-core
	inside translation string.

2002-04-25  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-widget.c:
	If applet's height is odd and orientation is horizontal set its 
	position 1 pixel lower so that the tab order will be correct 
	(bug 79465); similarly for width and vertical orientation.

2002-04-23  Padraig O'Briain  <padraig.obriain@sun.com>

	* gnome-panel-preferences.glade:
	Set mnemonic widget for Animation Speed label

2002-04-22  Padraig O'Briain  <padraig.obriain@sun.com>

	* basep-widget.c foobar-widget.c panel-widget.c:
	Remove bindings for GDK_ISO_Left_Tab as this breaks Shift+Tab
	(bug 79465)

2002-04-19  Padraig O'Briain  <padraig.obriain@sun.com>

	* drawer-widget.c (drawer_pos_hidebutton_click):
	Move focus to drawer icon when hide button in DrawerWidget 
	is activated to close drawer.

2002-04-18  Mark McLoughlin  <mark@skynet.ie>

	* main.c: (main): don't force BONOBO_ACTIVATION_DEBUG_OUPUT on
	everyone. (#79037)

2002-04-18  Mark McLoughlin  <mark@skynet.ie>

	* panel-config-global.c: (panel_global_config_set_entry):
	* panel-config-global.h:
	* panel.c: (panel_save_global_config): 
	* gnome-panel-preferences.c: (load_checkboxes):
	* gnome-panel-preferences.glade: remove 'Raise panels on
	mouseover' option. We're not a window manager.

	* basep-widget.c: (basep_enter_notify):
	* drawer.c: (enter_notify_drawer):
	* foobar-widget.c: (foobar_enter_notify): don't do the
	crackpot auto raise thing.
	
2002-04-18  Mark McLoughlin  <mark@skynet.ie>

	Might as well rename the files while I'm at it.

	* menu.c: (panel_config_global): upd binary name.

	* gnome-panel-preferences.c: (setup_the_ui), (main): upd
	name and glade file etc.

	* gnome-panel-preferences.desktop.in: update tooltip
	and exec.

	* gnome-panel-properties.c:
	* gnome-panel-properties.desktop.in: replace with
	gnome-panel-preferences variants.

	* gnome-panel-properties.glade:
	* gnome-panel-properties.glade2: replace with
	gnome-panel-preferences.glade (the glade2 version)

	* Makefile.am: install the .desktop file in
	  control-center-2.0/capplets and update for the rest of the
	  changes.

	* .cvsignore: upd.

2002-04-18  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-properties.c: (main):
	* gnome-panel-properties.glade2: rename dialog to
	'Panel Preferences'.

2002-04-17  Arvind S N  <arvind.samptur@wipro.com>

	* menu.c: changed "Remove this panel" to "Delete this panel"
	(#61598)

2002-04-18  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.c: (main): fixed warning.

	* menu-fentry.[ch]:
	(fr_read_dir), (fr_check_and_reread), (fr_get_dir): kill
	DirRec.force_reread and all its uses.
	(fr_force_reread): kill, we always do check for re-reads now.

	* panel-config-global.h: kill menu_check and menu_flags.

	* menu.c: (panel_launch_nautilus): kill.
	(make_panel_submenu): kill 'Edit menus...' item (#75977).
	(create_panel_root_menu), (make_panel_submenu),
	(add_menu_widget), (menu_button_menu_popup): use default menu
	flags. They're not configurable anymore.
	(load_menu_applet): kill 'Edit menus...' here too.

	* panel-applet-frame.c: (panel_applet_frame_class_init): fix
	warning.

	* panel-shell.c: include panel-util.h to fix warning.

	* panel.c:
	(panel_load_global_config), (panel_save_global_config): remove
	'FIXME STUFF THAT IS BORKED' options.
	(panel_apply_global_config): don't handle applying these
	options.

2002-04-17  Arvind S N  <arvind.samptur@wipro.com>

	* button-widget.c: workaround to get the drawer panel
	working. In translate_to(),from->allocation.x and from->allocation.y
	getting -ve values and thus causing problems in selecting launchers.

2002-04-17  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (applet_do_popup_menu): return FALSE if its
	a bonobo applet.
	(applet_button_press): always return FALSE if its not
	handled.

	* panel-applet-frame.c: (panel_applet_frame_get_flags): impl helper
	method.
	(panel_applet_frame_get_expand_flags): use it here.
	(panel_applet_frame_change_orient): don't set orient and resize
	unless the orient has actually changed.
	(panel_applet_frame_finalize): release the AppletShell.
	(panel_applet_frame_class_init): hook up new methods.
	(panel_applet_frame_instance_init): initialise new members.
	(panel_applet_frame_get_applet_shell): switch this back on.
	(panel_applet_frame_construct): use it here.
	(panel_applet_frame_paint), (panel_applet_frame_expose),
	(panel_applet_frame_size_request), (panel_applet_frame_size_allocate),
	(button_event_in_rect), (panel_applet_frame_button_changed): implement
	a handle on the AppletFrame. Adapted from Havoc's FooHandle.

2002-04-17  Padraig O'Briain  <padraig.obriain@sun.com>

	* basep-widget.c foobar-widget.c: Add key-press handler; 
	this function calls panel_widget_save_key_event()
	so that if the focus is within an applet in a different process and 
	Ctrl+Tab is the key event panel_widget_real_focus() can focus the
	PanelWidget

	* panel-widget.[ch]: Add key_event field to PanelWidget data structure
	and function panel_widget_save_key_event.
	(panel_widget_finalize): Free the saved key event
	(panel_widget_real_focus): Check whether the previous key event had a 
	modifier of Ctrl and if so set the focus on the panel.

2002-04-16  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-applet-frame.[ch]
	Remove action signal move_focus_out_of_applet to move focus from 
	applet to next or previous object on panel. This signal is being moved
	to PanelApplet so it will work for applets in a different process to
	the panel.

Mon Apr 15 10:16:13 2002  George Lebl <jirka@5z.com>

	* gnome-run.c: fix crash reported in #78559 by just using the
	  run_dialog variable, which is NULL if the widget is dead
	  instead of using a potentially out of date data parameter.

Mon Apr 15 10:04:14 2002  George Lebl <jirka@5z.com>

	* launcher.c: Applied patch from Christophe Fergeau
	  <christophe.fergeau@laposte.net> (slightly modified) to
	  fix the empty lines when comment is empty

2002-04-15  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am, panel.hints: kill panel.hints.

	* menu-util.c: (get_real_menu_path): fix main menu dragging.

2002-04-15 Stephen Browne <stephen.browne@sun.com>

	* distribution.c:
	Changed the name of the CDE menu name and the icon that should
	be used for it.

2002-04-15  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-widget.c:
	Allow Return and space keys to exit move mode; completion of #75935

2002-04-13  Alexander Larsson  <alla@lysator.liu.se>

	* panel-widget.c:
	Implement size hints for expanding applets.

	* panel-applet-frame.h: 
	Add panel_applet_frame_get_size_hints()
	
	* panel-applet-frame.c (panel_applet_frame_get_size_hints):
	Get the size hints from the property bag.

Fri Apr 12 15:19:34 2002  George Lebl <jirka@5z.com>

	* panel-config.c: remove some cruft for some gtk bug workarounds
	  which don't seem to be needed anymore

Fri Apr 12 14:57:22 2002  George Lebl <jirka@5z.com>

	* menu.c: fix checking for foobar when adding/removing the item to
	  add it.  Also fix #75970 by favouring the bottom of the screen.

2002-03-18  Jayaraj Rajappan <jayaraj.rajappan@wipro.com>
	* accessibility changes for panel. Atk relation is set
	between the label and the corresponding widgets. Tooltips
	are provided for some widgets.
	Files changed : menu.c launcher.c gnome-run.c foobar-widget.c
	panel-config.c swallow.c panel-util.h panel-util.c
	gnome-panel-properties.glade2 Makefile.am
	New file : panel-access.c

Fri Apr 12 13:58:28 2002  George Lebl <jirka@5z.com>

	* menu.c: remove some old menuitem/applet cruft.  Fix the removal
	  of items from menu by porting this thing to actually use
	  gnome-vfs.  Fixes #74963

Fri Apr 12 13:39:48 2002  George Lebl <jirka@5z.com>

	* applet.c: Change order and labels of the remove/move thingies
	  to match the way the Applet one is done fixes #74924

2002-04-12  Mark McLoughlin  <mark@skynet.ie>

	* foobar-widget.c: (focus_window): don't move to current
	workspace so as to be consistent with the tasklist (78248)

2002-04-12  Mark McLoughlin  <mark@skynet.ie>

	* menu-ditem.c: (ditem_properties_apply_timeout):
	kill bogus ditem unref.

2002-04-12  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_register): make master_widget
	a weak pointer.

	* basep-widget.c: (basep_widget_do_hiding),
	(basep_widget_do_showing): cleanups.

	* button-widget.c: (calculate_overlay_geometry): remove hidden crack.
	Fixes #75904 and doesn't seem to break anything.

	* gnome-panel-properties.glade2:
	* gnome-panel-properties.c: (option_menu_changed),
	(load_option_menus): remove panel window layer option. It doesn't work.

	* launcher.c: (create_launcher): kill redundant casts.

	* gnome-run.c: (create_simple_contents), (update_contents): cleanups.

	* panel-global-config.schemas, panel-types.h,
	  panel-config-global.[ch]: (panel_global_config_set_entry):
	  panel.c: (panel_save_global_config), (panel_apply_global_config): more
	window layer culling.

2002-04-10  Mark McLoughlin  <mark@skynet.ie>

	* menu-util.c: (get_real_menu_path): don't crash when dragging
	a menu (77275)

2002-04-10  Mark McLoughlin  <mark@skynet.ie>

	* panel-config.c: (make_misc_widget): don't make misc frame
	unless we want the multiscreen option. Also kill avoid param
	Fixes (77125)
	(edge_notebook_page), (aligned_notebook_page),
	(floating_notebook_page), (sliding_notebook_page): upd.

2002-04-10  Mark McLoughlin  <mark@skynet.ie>

	* panel-util.c: (panel_show_help): check error != NULL,
	fixes (77104)

2002-04-10  Seth Nickell  <snickell@stanford.edu>

	* gnome-panel-screenshot.desktop.in:

	Fix the wording a little. Its still broken because this does
	not function like an application, it functions like a dialogue.
	It would be better suited to "Actions".

2002-04-10  Mark McLoughlin  <mark@skynet.ie>

	* panel-widget.c: (add_all_move_bindings),
	(remove_all_move_bindings): make "free_move" on by default
	and make enter end the move. Patch by Padraig O'Briain (75953)

Tue Apr 09 15:04:36 2002  George Lebl <jirka@5z.com>

	* panel-shell.c: use panel_error_dialog instead of the homebrewed
	  dialog thingie

2002-04-04  Anders Carlsson  <andersca@gnu.org>

	* gnome-panel-screenshot.c (main): Obey the "desktop is homedir" 
	nautilus preference for saving to the desktop.

2002-04-02  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (whack_applet_to_load),
	(panel_destroyed_while_loading),
	(panel_applet_load_from_unique_id): use g_signal_handler_disconnect
	instead of g_source_remove (76981)

	* gnome-run.c: (launch_selected), (run_dialog_response),
	(selection_activated), (selection_changed),
	(create_simple_contents): launch the selected item when you double click
	on it (77088)

	* menu-ditem.c: (panel_edit_direntry): pass the .directory uri to
	set_ditem_sensitive instead of the directory. Also the destroy handler
	crack (74871)

2002-04-02  Mark McLoughlin  <mark@skynet.ie>

	* foobar-widget.c: (foobar_search), (append_actions_menu):
	add 'Search for File...' to actions menu. Based on patch by
	Dennis Cranston, #73183.

2002-04-02  Diego González  <dggonz@yahoo.com>

	* gnome-panel/menu-ditem.c (really_add_new_menu_item):
	fix how the filename for the launcher is obtained.

2002-03-29  Arvind S N  <arvind.samptur@wipro.com>

	* gnome-panel-screenshot.desktop.in: file for gnome-panel-screenshot

	* Makefile.am : added gnome-panel-screenshot.desktop.in

2002-03-29  Mark McLoughlin  <mark@skynet.ie>

	* panel-config.c: (floating_notebook_page): connect to the
	"value-changed" signal on the spinbutton, not "changed".

2002-03-29  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: kill swallow.[ch].

	* applet.[ch]: (applet_idle_remove), (applet_callback_callback),
	(applet_do_popup_menu), (panel_applet_load_from_unique_id),
	(panel_applet_save_to_gconf), (panel_applet_register): kill all
	traces of swallowed apps.

	* floating-widget.c: (yclamp): fix clamp permutation (76393)

	* gnome-panel-properties.glade2: kill auto-update-menus (75150)

	* menu.c: (make_add_submenu): kill swallowed app menuitem.
	
	* panel-per-panel-config.schemas: add a mixer applet to the menu
	panel by default.

	* panel-widget.c: (panel_widget_applet_drag_start): if the grab didn't
	succeed, drop the drag.

	* panel.c: (orientation_change), (panel_remove_applets),
	(drop_internal_applet): remove allw swalled app code.
	(panel_load_panels_from_gconf), (panel_save_to_gconf): move a few more
	keys to using underscores.

	* session.c: (panel_session_die): kill more swallow code.

	* xstuff.c: (xstuff_go_through_client_list): ditto.

2002-03-28  Mark McLoughlin  <mark@skynet.ie>

	* foobar-widget.[ch]: kill the foobar clock.

	* panel-per-panel-config.schemas: add the clock applet to
	the default menu panel setup.

	* gnome-run.c: (run_dialog_response):
	* menu.c: (create_new_panel):
	* panel.c: (panel_load_panels_from_gconf): update for foobar change.

2002-03-27  Mark McLoughlin  <mark@skynet.ie>

	* gnome-run.c: (fill_list), (create_simple_contents): make the idle
	handlers lowest priority as per boc's request.

Wed Mar 20 10:15:43 2002  Jonathan Blandford  <jrb@redhat.com>

	* gnome-panel-properties.c: Remove keybinding settings from this
	capplet.  Merge the rest of the pages into one.  This thing could
	use some UI love in general, but it's better than before (IMHO).

2002-03-27  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (remove_panel_accept), (remove_panel_query): make
	the remove from panel dialog OK_CANCEL.

2002-03-27  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (applet_callback_callback):
	* logout.c: (load_lock_applet): redo the menuitems for
	the lock button, to be somewhat more clear.

2002-03-27  Mark McLoughlin  <mark@skynet.ie>

	* logout.c: (load_logout_applet), (load_lock_applet):
	* status.c: (load_status_applet): kill bogus pre-conditions.

2002-03-27  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_load_from_unique_id):
	if we can't find the panel for the object, warn and stop loading.

	* drawer.c: (drawer_load_from_gconf):
	* launcher.c: (launcher_load_from_gconf):
	* logout.c: (load_logout_applet), (load_lock_applet):
	* menu.c: (menu_load_from_gconf):
	* status.c: (load_status_applet):
	* swallow.c: (swallow_load_from_gconf):
	fix up pre-conditions.

2002-03-27  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: (drag_data_get_cb): set up the launcher uri correctly.

Mon Mar 25 20:27:00 2002  George Lebl <jirka@5z.com>

	* panel-applet-frame.c: include panel-util.h, and use
	  panel_error_dialog

	* menu.c: use panel_info_dialog instead of custom gtk_message_box

	* main.c: add POPT_AUTOHELP

	* menu-ditem.c: a nicer way to find if a file already exists or not
	  for new launchers.  Also test schema:file since this is good
	  thing to do for vfolder schemas really.

	* gnome-desktop-item-edit.c: better handeling of uris vs. local
	  filenames

	* applet.c: when adding bonobo applets in the idle, we also connect
	  the panel destroy signal and whack from the add list if that
	  happens.  This should fix #76169

	* panel-types.c: add comma to the end of an enum

2002-03-25  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_add_panel_submenu): don't display the
	'Menu panel' option if we have a foobar already.

2002-03-25  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_create_menu): cleanup and use
	a GtkSeparator menu item as a separator.

	* basep-widget.c: kill uneeded panel_applet_in_drag def.

	* foobar-widget.c: (append_actions_menu): use 'Run Program...' instead
	of 'Run...' as suggested by calum.

	* main.c: (main): add a notify to /desktop/gnome/interface instead of
	/desktop/gnome/menus.

	* menu.c:
	(panel_menu_have_icons): kill old crack and use the correct key.
	(menus_have_icons_changed), (panel_menu_new): use the correct key
	for menus_have_icons.
	(image_menuitem_size_request): impl hack to make sure menu items
	without images are the same height as ones with images.
	(setup_full_menuitem): hook up to size_request.
	(create_root_menu): use 'Run Program...' instead of 'Run..'

	* menu.h: kill panel_menu_have_icons and bogus key definition.

	* panel-widget.[ch]:
	(panel_widget_get_free_space), (panel_widget_move): kill unused.
	(panel_widget_switch_applet_right): return is we're at the end of
	the panel.
	(panel_widget_switch_applet_left): return is we've hit the start of
	the panel.
	(panel_widget_switch_move_applet): only switch applets when we actual
	hit an applet.

2002-03-22  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_clean): kill the applet
	from the queued position saves list.

2002-03-22  Mark McLoughlin  <mark@skynet.ie>

	* panel-global-config.schemas:
	* panel-per-panel-config.schemas: change all gconf keys to
	use underscore instead of hypen. This is the gconf convention.

	* applet.[ch]: (panel_applet_create_menu): kill panel submenu
	from the applet popup menu. Also make static.
	Update for gconf key changes.

	* basep-widget.c: don't include gnome-windo-icon.h

	* foobar-widget.c: ditto.
	(append_format_items): upd for gconf key change.

	* gnome-panel-properties.c: ditto.

	* gnome-panel-properties.glade2: keep widget names in sync
	with gconf keys.

	* gnome-run.c: (run_dialog_response), (toggle_contents),
	(update_contents), (show_run_dialog): store the 'advanced' flag
	in gconf.

	* launcher.c: (launcher_save_to_gconf), (launcher_load_from_gconf):
	gconf key changes.

	* menu.[ch]: (make_panel_submenu): make static

	* panel-applet-frame.c: (panel_applet_frame_save_to_gconf),
	(panel_applet_frame_load_from_gconf): gconf key changes.

	* panel-config-global.c: (panel_global_config_set_entry): ditto.

	* panel-gconf.c: (panel_gconf_setup_profile): ditto.

	* panel-widget.c: (panel_widget_focus_in_event),
	(panel_widget_focus_out_event): kill prelight.

	* panel.c: (panel_save_global_config),
	(panel_load_panels_from_gconf), (panel_save_to_gconf),
	(panel_remove_from_gconf): gconf key changes.

2002-03-21  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: kill glade conversion, we're going with
	the Glade2 versions now.

	* gnome-panel-properties.glade2:
	* gnome-panel-screenshot.glade2: add .glade2 files.

	* gnome-run.c: (add_icon_idle), (fill_list),
	(run_dialog_destroyed):
	* panel-gconf.c: (panel_gconf_associate_schemas_in_dir):
	some minor cleanups

2002-03-21  Mark McLoughlin  <mark@skynet.ie>

	* panel-widget.c:
	(panel_widget_add): rename from panel_widget_add_full and
	kill bind_lower arg.
	(bind_top_applet_events): kill bind_lower arg.
	(panel_widget_cadd): upd.

	* applet.c: (panel_applet_register): upd for panel_widget_add
	change.

	* button-widget.c: (button_widget_class_init),
	(button_widget_parent_set): impl so we don't leave the overlay
	window behind when the widget gets re-parented (#75455)

2002-03-20  Mark McLoughlin  <mark@skynet.ie>

	* panel-marshal.list: kill VOID:ENUM, its in glib.

	* aligned-widget.c: (aligned_pos_class_init):
	* basep-widget.c: (basep_widget_class_init):
	* border-widget.c: (border_pos_class_init):
	* panel-applet-frame.c: (panel_applet_frame_class_init):
	* panel-widget.c: (panel_widget_class_init):
	* sliding-widget.c: (sliding_pos_class_init): use the glib
	version of the marshaller.

2002-03-20  Mark McLoughlin  <mark@skynet.ie>

	* panel-per-panel-config.schemas: default to having the pager
	in the bottom right as per GUP suggestion (71689)

2002-03-20  Mark McLoughlin  <mark@skynet.ie>

	* floating-widget.c: (floating_pos_class_init): the co-ordinate
	chage signal has a VOID__INT_INT signature, not INT__INT.

	* panel-marshal.list: kill INT_INT and add VOID_INT_INT.

2002-03-20  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-screenshot.glade: hook up the OK button.

2002-03-20  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_root_menu): s/Programs/Applications/ for consistancy.

2002-03-11  Shivram U  <shivaram.upadhyayula@wipro.com>

	reviewed by Mark McLoughlin <mark@skynet.ie>

	* panel-applet-frame.c : (panel_applet_frame_get_background_string)
	We will not be adding '#' to the color string. '#' is used as a
	delimiter in parsing the moniker name. Fixes #73440.

2002-03-18  Shivram U  <shivaram.upadhyayula@wipro.com>

	reviewed by Mark McLoughlin <mark@skynet.ie>

	* panel-applet-frame.c: (panel_applet_frame_finalize) unref the
	property_bag and the ui_component. Fixes #67468

2002-03-19  Mark McLoughlin  <mark@skynet.ie>

	* panel-config-global.c: (panel_global_config_set_entry): check value
	as well as key, and don't do it in a g_return ... This isn't debugging.

2002-03-19  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c: (basep_widget_construct):
	* foobar-widget.c: (foobar_widget_new): don't setup the default
	window icon here.

	* panel.[ch]: (panel_register_window_icon): impl a method to do it here.

	* main.c: (main): and use it here.

	* session.c: (panel_session_set_restart_command): only register to be
	re-spawned if GNOME_PANEL_DEBUG env variable is not set.

2002-03-18  Benedikt Roth  <Benedikt.Roth@gmx.net>

	* menu.c: (applet_menu_append), (create_applets_menu):
	Display the applets' descriptions as tooltips in the 
	'Add to panel menu'.

2002-03-18  Mark McLoughlin  <mark@skynet.ie>

	* panel-gconf.[ch]: (panel_gconf_sprintf): impl new method to use a signle
	static buffer for all our key creators to seriously cut down on the
	amount of mallocs we do.
	(panel_gconf_global_key), (panel_gconf_general_key):
	(panel_gconf_full_key): use above.

	* applet.c, drawer.c, foobar-widget.c, menu.c, panel-applet-frame.c,
	  panel.c, swallow.c: update for panel-gconf changes. 

	* gnome-panel-properties.c: update for panel-gconf changes and clean up
	a bit.

	* session.[ch]: (panel_session_set_restart_command): break out the
	restart command setting to here and set the restart style to respawn.
	(panel_session_save): use above.

	* main.c: (main): call set_restart_command.

	* xstuff.c: (xstuff_atom_intern): add some pre-conditions.

2002-03-14  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am: We now use panel_gconf_foo magic in 
	gnome-panel-properties.

	* gnome-panel-properties.c: (option_menu_changed),
	(load_option_menus), (setup_the_ui): Fix the properties
	dialog to correctly handle the option menus. Fixes 
	#74027 [part of].
	* panel-config-global.c: (panel_global_config_set_entry),
	gnome-panel-properties.glade, panel-types.h: Re-order 
	enums so that we are consistant everywhere.
	* panel-global-config.schemas: Change default to have 
	medium animation speed.

2002-03-12  Glynn Foster  <glynn.foster@sun.com>

	* menu.c: s/GNOME menu/GNOME Menu/

2002-03-12  Glynn Foster <glynn.foster@sun.com>

	* Makefile.am: s/gnome-panel-2/gnome-panel

	* basep-widget.c: (basep_widget_construct): Add window icon
	so that we show up nicely in gnome-system-monitor.
	* foobar-widget.c: (foobar_widget_new): ditto

	* gnome-desktop-item-edit.c: (main): fix warning

	* gnome-panel-properties.c: (main): 
	s/Panel Global Properties/Global Panel Properties/
	* gnome-panel-properties.glade: Rename some strings according
	to usability/doc wishes.

	* main.c: (main): s/panel/gnome-panel/ so that we show up 
	nicely in gnome-system-monitor
	
	* menu-util.[ch]: (got_distro_menus), (get_real_menu_path),
	(get_pixmap): Remove these functions and put into menu-util.[ch]
	with a view to EOL'ing menu-properties.[ch]

	* menu.c: (show_item_menu), (make_add_submenu): 
        
	Remove the Add to Panel -> Menu layer so that we can
        only add a 'GNOME Menu' now. We need to proceed to make sure
        that we can't edit the preferences of this for the time being
        until we get some plan sorted out. Part of #73511.

	* panel-config-global.h, panel-global-config.schemas, panel.c: 
	s/autoraise-panel/auto-raise-panel/ Fixes #74027. Also remove
	duplicate entry from schema file.
	
2002-03-12  Michael Meeks  <michael@ximian.com>

	* panel-util.c (panel_is_uri_writable): actually return
	the value.

2002-03-08  Michael Meeks  <michael@ximian.com>

	* panel-applet-frame.c (panel_applet_frame_new):
	sink that ref down the plug hole on error,
	squash warning.
	(panel_applet_frame_construct): improve exception handling, and
	throw up descriptive dialogs ourself.
	(panel_applet_frame_load): don't throw up the warning here, do it

Mon Mar 11 19:55:21 2002  George Lebl <jirka@5z.com>

	* gnome-desktop-item-edit.c, menu-ditem.[ch], menu.c,
	  panel-util.[ch]:  Separate out the new launcher functionality
	  and support that in the desktop item edit thingie.

Mon Mar 11 17:48:16 2002  George Lebl <jirka@5z.com>

	* panel-util.[ch], menu-ditem.c: fix the writable checking to handle
	  gnome-vfs.

2002-03-08  Gediminas Paulauskas <menesis@delfi.lt>

	* gnome-panel-properties.c: use Close button instead of OK (#72716)

2002-03-06  Arvind S N <arvind.samptur@wipro.com>

	* panel-applet-frame.c (panel_applet_frame_load):
	Pass "frame" as a data argument instead of NULL to fix crash when
	removing a panel (#73224).

2002-03-06  Mark McLoughlin  <mark@skynet.ie>

	* applet.[ch]: (panel_applet_position_save_timeout),
	(panel_applet_save_position), (panel_applet_save_to_gconf):
	queue position saves so things are nice and smooth again.

	* menu.c: (create_applets_menu): use the untranslated category
	names for grouping.

	* panel-applet-frame.c: (panel_applet_frame_construct): use
	bonobo_control_frame_get_popup_ui_component.

	* panel.c: (panel_applet_move):
	* session.c: (panel_session_save_applets), (panel_session_die):
	update for panel_applet_save_position change.

Tue Mar 05 14:56:15 2002  George Lebl <jirka@5z.com>

	* menu.c, menu-ditem.[ch], nothing.cP: move the ditem editting
	  stuff to a separate file

	* Makefile.am, gnome-desktop-item-edit.c: add a new proggie that
	  can just pop up dialogs for editting launchers, just like
	  in the panel, but from anywhere.  Note that it doesn't all yet
	  really work since a bunch of stuff is still broken.

2002-03-04  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-widget.c:
	Tidy up keynav code: use keybindings for Tab and arrow keys only
	for moving applets; define panel_widget_real_focus as default
	signal handler for GtkWidget's focus signal so GtkWindow's
	key bindings are used to move focus when the PanelWidget has focus.

Fri Mar  1 22:09:26 2002  Soeren Sandmann  <sandmann@daimi.au.dk>

	* panel-config-global.c (panel_global_config_set_entry): fix typo:
	s/autoraise-panel/auto-raise-panel/

Fri Mar 01 10:35:55 2002  George Lebl <jirka@5z.com>

	* aligned-widget.c: fix swapped parameters to g_signal_new,
	  yay for type-unsafety!  Yay!  We get to hunt down bugs like this
	  because we're too stupid to use gob.

Fri Mar 01 00:55:39 2002  George Lebl <jirka@5z.com>

	* panel-config-global.c: fix compilation warning

	* panel-widget.c, panel.c: fix some memory leaks and some corruptions
	  on destruction

2002-02-28  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c:
	(set_revert_sensitive): pass TRUE to gtk_widget_set_sensitive.
	(create_properties_dialog): connect the signals to the right
	button.

2002-02-28  Diego González  <dggonz@yahoo.com>

	* nothing.cP, status-docklet.c, session.c, foobar-widget.c,
	  panel-widget.c, menu.c, main.c, button-widget.c:
		s/gtk_timeout_add/g_timeout_add 
		s/gtk_timeout_remove/g_source_remove

Wed Feb 27 23:58:15 2002  George Lebl <jirka@5z.com>

	* applet.c, panel-applet-frame.[ch], session.c, panel.c: save
	  applet position on move, don't save it when we're removing the
	  applets.  Implement back the clean_remove setting for
	  bonobo_applets in preparation for the 'dead applet' dialog

	* basep-widget.[ch], menu.c, panel.c:  Try to figure out memory
	  issues with removing panels/applets.  The menu applet now removes
	  without a warning, but removing a panel will still corrupt memory
	  somewhere.  While I was at it I converted the Pos objects to
	  GObject rather then GtkObject, which gets rid of some sinking
	  issues.

	* menu-properties.c: remove a dead argument to a function

	* panel-widget.c: minor cleanup

Wed Feb 27 19:45:40 2002  George Lebl <jirka@5z.com>

	* panel-applet-frame.c: fix initial setting of medium size 

Mon Feb 25 16:00:00 2002  Arvind S N  <arvind.samptur@wipro.com>

	* launcher.c: (create_properties_dialog): disable the revert
	buttton when changes are made.

2002-02-27  Mark McLoughlin  <mark@skynet.ie>

	* foobar-widget.c: (foobar_save_to_gconf): impl.
	(foobar_widget_set_clock_format): save the clock format.

	* panel.c: (panel_save_to_gconf): add pre-condition.

2002-02-27  Mark McLoughlin  <mark@skynet.ie>

	* menu.c:
	(menu_button_notify), (create_panel_menu): binary chop
	the button notify handler temporarily. Fixes #72430.

Tue Feb 26 17:34:45 2002  George Lebl <jirka@5z.com>

	* panel.c: fix #70518 among others, by queing a resize on all button
	  widgets.  Dunno what's up with that really, but this will force it
	  to work.  Also fixed up the panel move stuff to be a bit saner as
	  well, and fix a possible crash.

	* menu-util.[ch], menu.c: hmm, the menu menu is still off the button
	  and not at cursor location ... damnit

Tue Feb 26 16:17:09 2002  George Lebl <jirka@5z.com>

	* menu-util.c: the applet menu should also be at the cursor location
	  fixes #70502

2002-02-25  Mark McLoughlin  <mark@skynet.ie>

	Dynamically apply the schemas to new profiles as they are
	created. Removes a lot of conditional 'use_default' code
	and the bugs lurking there. Also lots of gconf related cleanups
	and bug fixes.

	* panel-gconf.[ch]: kill default_profile functions.
	(panel_gconf_get_profile): move here from session.c
	(panel_gconf_global_key), (panel_gconf_general_key),
	(panel_gconf_full_key): rename from really long names.
	(panel_gconf_dir_exists): kill unused.
	(panel_gconf_clean_dir): rename.
	(panel_gconf_associate_schemas_in_dir): impl.
	(panel_gconf_setup_profile): impl.

	* panel-per-panel-config.schemas: kill all applytos.

	* applet.c: update for gconf function name changes. Remove all
	use_default stuff. Pass gconf key to logout, lock and status loader
	to fix #69716.

	* drawer.[ch]:
	(properties_apply_callback): actually save properties changes.
	(load_drawer_applet): save the AppletInfo.
	(drawer_save_to_gconf), (drawer_load_from_gconf): update for gconf
	function name changes, cleanupa and don't try and save the tooltip
	when its null. Kill use_default stuff.

	* floating-widget.c: (floating_pos_get_hide_size),
	(floating_pos_get_hide_pos): read minimized size from the global_config
	struct, not gconf.

	* foobar-widget.c: (append_format_items): clock format is not in global
	config.

	* launcher.c:
	(properties_apply): actually save properties changes.
	(launcher_save_to_gconf), (launcher_load_from_gconf): update for gconf
	function name changes.
	(launcher_file_name): use PANEL_LAUNCHERS_PATH.

	* launcher.h: define PANEL_LAUNCHERS_PATH. Nobody else was using
	PANEL_CONFIG_PATH.

	* logout.[ch]l: (load_logout_applet),
	(load_lock_applet): add gconf_key arg.

	* main.c: (main): use panel_gconf_setup_profile.

	* menu-properties.c: (properties_apply_callback): only save menu props.

	* menu.c: kill use_default stuff, update for gconf function changes.

	* panel-applet-frame.c: ditto.

	* panel-config-global.c: use panel_apply_global_config.

	* panel-config.c: (config_apply): actually save config changes.

	* panel-widget.c: (panel_widget_destroy), (panel_widget_get_by_id),
	(panel_widget_set_id): update for gconf renaming. Clean up.

	* panel.[ch]: lots of cleanups, update for gconf name changes, shorten
	function names, kill use_default stuff.

	* session.c:
	(session_get_current_profile), (session_get_current_profile): kill
	(panel_session_do_save), (panel_session_save),
	(session_load): updates.

	* session.h: kill unused cruft.

	* status.[ch]: (load_status_applet): add gconf_key arg.

	* swallow.c: (swallow_save_to_gconf), (swallow_load_from_gconf):
	updates, kill use_default stuff etc.

Fri Feb 22 15:27:35 2002  George Lebl <jirka@5z.com>

	* foobar-widget.c: when a clock format is set, make sure the format
	  menu thing is synchronized.

2002-02-22  Kjartan Maraas  <kmaraas@gnome.org>

	* menu.c: Remove unsupported #ifdef ENABLE_NLS.
	
Thu Feb 21 18:15:42 2002  George Lebl <jirka@5z.com>

	* gnome-run.c: load both the list of apps and then the icons
	  in idle time, so that we display the dialog immediately and then
	  load all this crap a bit later.  This makes the whole thing feel
	  a lot snappier.

Thu Feb 21 17:25:56 2002  George Lebl <jirka@5z.com>

	* menu.c, panel.[ch]: when adding applets or launchers and such
	  things from the context menu, add them at the spot where the
	  context menu was triggered.

Thu Feb 21 15:49:33 2002  George Lebl <jirka@5z.com>

	* basep-widget.c: properly do hidebutton sensitivities and tooltips
	  on startup and when changing orientation.  Should also hopefully
	  close #61419

2002-02-21  jacob berkman  <jacob@ximian.com>

	* Makefile.am (EXTRA_DIST): add $(ui_DATA)

2002-02-21  Mark McLoughlin  <mark@skynet.ie>

	* GNOME_Panel_Popup.xml: split out the popup xml to here
	so it can be translated.

	* Makefile.am: install the xml file.

	* panel-applet-frame.c: (panel_applet_frame_construct): kill
	the static xml string and use the xml file instead.

Wed Feb 20 19:13:33 2002  George Lebl <jirka@5z.com>

	* menu.[ch], applet.c, foobar-widget.c, gnome-run.c:  Add
	  panel_make_menu_icon, which exposes the pixbuf loading function
	  from the menu icon cache so that we can use it in other places,
	  such as the run box.

	* button-widget.c: use the desktop-item icon finding function for
	  icon finding

	* launcher.c: when getting the best launcher icon look for 48x48 and
	  not 20x20

Wed Feb 20 18:15:38 2002  George Lebl <jirka@5z.com>

	* menu-fentry.c: sure_string the fullname before making a collation
	  key.

Wed Feb 20 18:12:25 2002  George Lebl <jirka@5z.com>

	* menu-fentry.[ch], menu.c: the fr_compare function takes into
	  account directories being sorted before files.  MFiles can't be
	  sorted so sort after we load the QItems.  Fix a memory leak.  Cache
	  the scaled version of an icon to avoid lots of scaling and add
	  the icon size to the cache key.

Wed Feb 20 17:14:00 2002  George Lebl <jirka@5z.com>

	* gnome-run.c, menu-fentry.[ch]: Add a fentry sorting function and
	  cache the name collate key, so that sorting is faster.  Also
	  properly sort menu items if no set sort order has been given by
	  a SortOrder thing in a .directory.  Also remove fr_get_all_dirs
	  since it's a stupid function and isn't being used anyway.

2002-02-20  Mark McLoughlin  <mark@skynet.ie>

	* main.c: (session_notify_global_changes): move notify
	handler to panel_global_config_notify.

	* panel.c: (panel_load_global_config): use
	panel_global_config_set_entry.
	(panel_session_save_global_config): audit for missing items.

	* panel-config-global.c:
	(panel_global_config_set_entry): impl method to map
	between gconf key and config struct member.
	(panel_global_config_notify): handle global config notifies.

	* panel-config-global.h: clean up and add
	panel_global_config_set_entry and panel_global_config_notify.

	* panel-global-config.schemas: kill "auto-update-menus".

	* panel-util.[ch]: (panel_parse_accelerator): rename from
	convert_string_to_keysym_state and upd to handle
	GlobalConfigKeys.

	* global-keys.c: (panel_global_keys_setup),
	(panel_global_keys_filter): upd to use GlobalConfigKey.

	* gnome-panel-properties.c: (load_checkboxes): kill
	"auto-update-menus".

	* Makefile.am: add panel-config-global.c

2002-02-20  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (show_panel_help): pass 'panel' as file
	name, not 'index'.

	* panel-util.c: (panel_show_help): use
	gnome_help_display_desktop for docs installed in
	$(prefix)/share/gnome/help

2002-02-20  Mark McLoughlin  <mark@skynet.ie>

	Fixes #71279 and #69147. Fix suggested by Shivram U.

	* panel-util.c: (stretch_widget_calc_geometry): move geometry
	calc code to here.
	(stretch_widget_realize): use calc_gemoetry.
	(stretch_widget_size_allocate): check geometry has changed
	before unmapping.

2002-02-19  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (compare_filerecs), (create_menu_at_fr): re-indent
	to same style as surrounding code and compress comments to
	one single explanatory comment outside the method.

2002-02-19  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_menuitem): revert unapproved increase of
	icon size to 32x32. Retain sensible cleanups, though.

2002-02-17  Gediminas Paulauskas <menesis@delfi.lt>

	Fix #70512

	* gnome-run.c: add mnemonics to all labels, rename buttons.
	(browse): rename dialog.
	(run_dialog_response): if window was just closed, don't run command.
	(sort_by_name): Sort according to locale.
	(add_columns): Remove column header
	(create_simple_contents): Add label above list (so that	you can focus
	list with mnemonic). Make description label selectable, show Advanced
	options below "Advanced >>" button.
	

2002-02-16  Seth Nickell  <snickell@stanford.edu>

	* menu.c: (compare_filerecs):

	Check if strings are NULL before collating
	them.

2002-02-16 John Fleck <jfleck@inkstain.net>

	* help/C/panel.xml
	* help/C/figures/launcherprop1_dialog.png
	* help/C/figures/launcherprop2_dialog.png
	* help/C/figures/menu_panel.png
	* help/C/figures/panelprop_dialog.png
	* help/C/figures/sample_applet.png
	finish updating panel docs for GNOME2

2002-02-16  Seth Nickell  <snickell@stanford.edu>

	* menu.c: (remove_pixmap_from_loaded), (load_icons_handler):

	Use weak refs rather than destroy signal, so we can
	use the pixbufs directly rather than needing a
	GtkWidget.

2002-02-16  Seth Nickell  <snickell@stanford.edu>

	* menu.c: (load_icons_handler), (create_kde_menu):

	Only cache the pixbufs as directly loaded from the icon
	files. That way if a smaller icon is loaded first
	we don't end up scaling it up later when its needed
	for a larger version.

	Really we should just include size as well as filename
	in the hashtable, but the number of calls is small
	enough that this isn't problematic.

2002-02-16  Seth Nickell  <snickell@stanford.edu>

	* menu.c: (compare_filerecs), (create_menu_at_fr),
	(applet_menu_get_category_icon):

	Sort menus into locale-correct "alphabetical" order.

2002-02-15  Michael Meeks  <michael@ximian.com>

	* panel-applet-frame.c (panel_applet_frame_construct): 
	don't get the 'shell' interface, it's not used and this
	screws with fatal ref cleanup.

2002-02-15 John Fleck <jfleck@inkstain.net>

	* configure.in
	* gnome-panel/Makefile.am
	* gnome-panel/help/Makefile.am
	* gnome-panel/help/C/Makefile.am
	* gnome-panel/help/C/panel-C.omf
	* gnome-panel/help/C/panel.xml
	* gnome-panel/help/C/figures/controlcenter_icon.png,
	help_icon.png, open_drawer.png, statusdock_button.png,
	launcherprop1_dialog.png, panel_object_popup_menu.png,
	swallapp_dialog.png, drawerprop_dialog.png,
	launcherprop2_dialog.png, panelprop_dialog.png,
	swallow_applet.png, footprint_icon.png, lockscreen_icon.png,
	runprogram_dialog.png, tasklist_applet.png, four_hide_button.png,
	logout_icon.png, runprogram_icon.png, typical_menu.png,
	gnome_panel.png, menu_panel.png, sample_applet.png,
	gnometerminal_icon.png, netscape_icon.png, statusdock2_button.png
	adding first draft of Sun panel documentation to the build

2002-02-15  Padraig O'Briain  <padraig.obriain@sun.com>

	* basep-widget.[ch] : Rename "focus_panel" signal to "move_focus_out"
	as same action (Ctrl+Tab) on DrawerWidget moves focus from
	DrawerWidget to Drawer. Add code to basep_widget_move_focus_out()
	to implement moving focus from DrawerWidget to Drawer.

	(basep_widget_construct) Sink BasePPos to avoid warning on panel
	deletion.

	* drawer-widget.c (drawer_widget_new): Do not allow panel in
	DrawerWidget to receive focus.

	* drawer.h (Drawer): Add two new fields moving_focus and jyst_focused.
	The field moving_focus is used to prevent drawer being closed
	when keyboard focus moves from Drawer to DrawerWidget and being
	opened whem keyboard focus moves from DrawerWidget to Drawer
	The field just_focused is used to prevent the drawer being closed
	when a Drawer, which does not have focus, is clicked.

	* drawer.c: Add signal handlers for focus_in_event, focus_out_event
	and key_press_event on Drawer.
	focus_in_drawer ensures that drawer is opened when focused
	focus_out_drawer ensures that drawer is closed when unfocused
	key_press_drawer implements arrow keys to move focus from Drawer to
	DrawerWidget and focus the first or last object on the panel and Escape
	to close the drawer.

	* foobar-widget.[ch] : Rename "focus_panel" signal to "move_focus_out"

	* panel-widget.c (panel_widget_focus): Do not configure.infocus panel for
	DrawerWidget

	* panel.c (panel_menu_get): Sink menu object to avoid warning on
	panel deletion

2002-02-14  Seth Nickell  <snickell@stanford.edu>

	* menu.c: (icon_to_load_copy), (load_icons_handler),
	(create_menuitem), (panel_load_menu_image_deferred_with_size),
	(panel_load_menu_image_deferred):

	Increase the size of the icons in the Applications menu to
	32x32.

2002-02-14  Shivram U <shivaram.upadhyayula@wipro.com>

	reviewed by Mark McLoughlin <mark@skynet.ie>

	* launcher.c: Fixed the problem with the revert button in the
	launcher not reverting back to the original settings. (#70692)

2002-02-12  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: don't set GNOME_CORE_BUILD_INTERNAL and use
	(top_srcdir)/gnome-panel.

	* launcher.c, launcher.h, menu-fentry.h, menu-properties.c,
	  menu.c, session.c, swallow.c: upd for the fact that
	libgnome-desktop is in a seperatre module now.

2002-02-11  Kjartan Maraas  <kmaraas@gnome.org>

	* drawer-widget.c: #include <config.h>
	* panel-config.c: Same
	
2002-02-11  Takayuki KUSANO <AE5T-KSN@asahi-net.or.jp>

	reviewed by: Mark McLoughlin  <mark@skynet.ie>

	* foobar-widget.c: (append_gnomecal_items): actually use
	the translated strings.

2002-02-11  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-properties.c:
	* gnome-run.c: don't include gnome-window-icon.h directly.
	Its in libgnomeui.h now.

2002-02-11  Richard Hult  <rhult@codefactory.se>

	* panel-applet-frame.c (panel_applet_frame_construct): Remove
	debug code, missed this in my last commit.

2002-02-11  Richard Hult  <rhult@codefactory.se>

	* panel-applet-frame.c: Put popup menu items at the bottom of the
	applet popup menu.

2002-02-09  Mark McLoughlin  <mark@skynet.ie>

	* applet.c:
	(panel_applet_load_idle_handler): load applets in an idle handler
	at startup.
	(panel_applet_load_from_unique_id): use it.

2002-02-09  Mark McLoughlin  <mark@skynet.ie>

	* GNOME_Panel.server.in: move to Vertigo namespace.

	* menu.c: ditto.

2002-02-09  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.[ch]:
	(panel_applet_frame_load): update for panel_applet_frame_new change.
	(panel_applet_frame_get_expand_flags): get the flags from the
	property sack.
	(panel_applet_frame_get_background_string): impl method to
	prepare background strings.
	(panel_applet_frame_change_background): merge background changing
	methods in to one.
	(panel_applet_focus): rename to panel_applet_frame_focus.
	(panel_applet_frame_get_orient_string),
	(panel_applet_frame_get_size_string): impl method to prepare size
	and orient strings.
	(panel_applet_frame_construct_moniker): add the bacgkround, size
	and orient items.
	(panel_applet_frame_construct): add PanelWidget arg.
	(panel_applet_frame_new): ditto.

	* panel-types.h: GNOME_Panel_BackType enum doesn't exist anymore.

	* panel-widget.[ch] (panel_widget_class_init): upd for above.	
	(panel_widget_get_applet_orient): re-named from get_applet_orient.

	* panel.c: (get_applet_orient): move to panel-widget.c.
	(back_change): use panel_applet_background_change.

	* drawer.c: (load_drawer_applet): update for get_applet_orient
	change.

	* status.[ch] (status_spot_remove): use Vertigo_StatusSpot.

2002-02-10  Havoc Pennington  <hp@pobox.com>

	* basep-widget.c (basep_widget_size_allocate): Consider the x/y
	position of the panel when setting struts. This means we get the
	right strut if some crack-smoker puts multiple panels on the same
	side of the screen. Currently only seems to matter for stacking an
	edge panel under the foobar.

2002-02-10  Gediminas Paulauskas <menesis@delfi.lt>

	* Makefile.am: use intltool for .desktop files.
	* gnome-panel-properties.desktop.in: add files without
	translations.
	* gnome-panel-properties.desktop: removed, they are generated.

2002-02-10  Gediminas Paulauskas <menesis@delfi.lt>

	* quick-desktop-reader.c: do charset conversion only if source
	encoding is not NULL. Avoids lots of warnings.

2002-02-08  Mark McLoughlin  <mark@skynet.ie>

	* session.c: (panel_session_save): another leak. That seems
	to be most of them ...

2002-02-08  Mark McLoughlin  <mark@skynet.ie>

	* panel-widget.c: (panel_widget_set_new_id),
	(panel_widget_new): kill more leaks.

2002-02-08  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (panel_gconf_profile_set_string),
	(panel_gconf_profile_set_int), (panel_gconf_profile_set_bool):
	fix more hideous leaks and re-name like below.
	(panel_session_save_panel): upd for above.

2002-02-07  Mark McLoughlin  <mark@skynet.ie>

	* menu-properties.c: (properties_apply_callback): save to gconf.

	* menu.c: (menu_save_to_gconf): check icon file is set before
	setting it in gconf.

2002-02-08  Mark McLoughlin  <mark@skynet.ie>

	* session.[ch]: (panel_session_save): don't dup string. it
	was been leaked allmost everywhere anyway.

	* applet.c: (panel_applet_clean_gconf), (panel_applet_load_list),
	(panel_applet_save_position), (panel_applet_save_to_gconf):
	* drawer.c: (drawer_save_to_gconf), (drawer_load_from_gconf):
	* launcher.c: (launcher_save_to_gconf):
	* menu.c: (menu_save_to_gconf), (menu_load_from_gconf):
	* panel-applet-frame.c: (panel_applet_frame_save_to_gconf):
	* panel.c: (panel_session_save_panel):
	* swallow.c: (swallow_save_to_gconf), (swallow_load_from_gconf):
	update for above change.

	* distribution.c: (get_distribution_info): fix warning.

2002-02-08  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: (setup_button): free icon string.

	* menu-fentry.c: (fr_check_and_reread): unref the vfs file
	info before returning.

	* menu.c: (load_icons_handler): free the icon info before
	returning.

	* panel.c: (panel_gconf_profile_get_string),
	(panel_gconf_profile_get_int), (panel_gconf_profile_get_bool):
	rename from atrociously long names.
	(panel_session_init_panels): fix loads of string leaks and try
	to tidy up a bit.

2002-02-08  Mark McLoughlin  <mark@skynet.ie>

	* panel-util.[ch]: (panel_stretch_events_to_toplevel): use
	 a flags arg instead of booleans. Simplifies things.

	* foobar-widget.c: update for above change.

2002-02-07  Mark McLoughlin  <mark@skynet.ie>

	* main.c: (main): move BONOBO_ACTIVATION_DEBUG_OUTPUT up.

	* panel-shell.c: (panel_shell_register): enable per-display
	registration, however this doesn't work yet 'cause its not enabled in
	bonobo-activation.

2002-02-07  Mark McLoughlin  <mark@skynet.ie>

	* distribution.c: (get_distribution_info): fix core. Sorry people.

2002-02-07  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: split deprecation related cflags and gnome_program
	related defines into their own variable.

	* applet.c:
	(panel_applet_clean_gconf): free gconf_key here.
	(panel_applet_clean): don't clean gconf until after the widget has
	been destroyed.
	(applet_destroy): don't free key here.

	* distribution.[ch]: (get_distribution_info): allow distribution menus
	to be re-locatable.

	* gnome-panel-properties.c: (main): set the window icon.

	* gnome-run.c: (register_run_stock_item): impl to register a new stock
	icon and icon set for the run button.
	(show_run_dialog): use above instead of stock execute item. Lookup
	window icon with gnome_program_locate_file.

2002-02-06  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel-applet-frame.[ch]
	Add action signal move-focus_out_of_panel to move focus from applet to
	next or previous object on panel. Currently Tab and Shift+Tab are the 
	keys which do this.

	* foobar-widget.[ch]
	Add action signal focus_panel to support moving focus to the panel

	* panel.c:
	Remove unused argument PanelData specified for panel_event()
	Set focus on panel if button release happens in panel and panel is
	not focus widget.

2002-02-06  Mark McLoughlin  <mark@skynet.ie>

	* gnome-run.c:
	(create_advanced_contents): don't set focus widget here, we do
	it later.
	(update_contents): focus the entry, not the vbox.

Tue Feb 05 17:48:58 2002  George Lebl <jirka@5z.com>

	* gnome-run.c: set window icon

	* menu-util.c: remove the applets sub from the default menu flags

	* menu.c: About box fixups, use a logo, add documentors, fix
	  translation credits, and use the comment for the commie mode
	  paragraph.  Use the standard defaults when adding a menu.
	  When saving a ditem in the timeout, save the error and display
	  it in an error dialog when we close the property window.
	  Add more descriptive standard menu tooltips.  When there is
	  no full menu name use the directory basename rather then "Menu".
	  Translate the things from the bonobo server entry.  Use
	  a lazy hash for category->icon lookups, and use untranslated
	  category name to lookup icons.  Use standard panel error
	  dialog api for 'only one foobar' dialog.

	* panel-widget.c: unused var warning

	* xstuff.c: fix possible race (I'm anal, perhaps it's not a race
	  at all in fact, but it's not there anymore)
	  
2002-02-05  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (panel_session_init_panels): audit use of
	gconf_enum_to_string to make sure all (gint *) casts
	are correct. Solaris refuses to entertain mis-aligned
	pointers.

2002-02-04  jacob berkman  <jacob@ximian.com>

	* Makefile.am: our object files require the built sources

2002-02-04  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: (properties_apply): save the launcher.
	(launcher_save_to_gconf): don't save location if its not set.
	(launcher_file_name), (launcher_save): make static.
	(launcher_hoard): save to gconf.

	* launcher.h: kill launcher_file_name and launcher_save.

2002-02-04  Padraig O'Briain  <padraig.obriain@sun.com>

	* panel.c: Correct popping up of panel's context menu using keyboard.

2002-02-04  Padraig O'Briain  <padraig.obriain@sun.com>

	These changes update the changes which give focus to the panel and
	object on the panel to take account of the fix to bug 50339 which
	requires that a widget in a GtkWindow have focus initially, rather
	than the GtkWindow itself.

	* basep-widget.[ch]: Rename focus_return as the more meaningful name
	focus_panel. Remove the functions basep_widget_focus_in_event,
	basep_widget_focus_out_event and basep_widget_set_focus. Specify
	focus chain in basep_widget_construct so that focus goes initially to
	the panel.

	* panel-widget.[ch]:
	Add functions panel_widget_focus_in_event, which sets PRELIGHT state
	for panel and adds keybindings for Tab and Shift+Tab, and 
	panel_widget_focus_out_event, which unsets the PRELIGHT state for the
	panel, removes keybindings for Tab and Shift+Tab and unsets 
	GTK_WIDGET_CAN_FOCUS flag, if focus is going to another widget in the
	window. Rename move_to_panel to tab_move.
	Add key bindings for Tab and Shift+Tab when panel has focus or when in
	move mode. Set GTK_WIDGET_CAN_FOCUS flag on panel when it is created.
	Add code to panel_widget_tab_move to move focus to object in panel; 
	this requries unsetting GTK_WIDGET_CAN_FOCUS flag on panel.
	Add function panel_widget_focus which moves the focus from an object
	on the panel to the panel.
	
2002-02-04  Mark McLoughlin  <mark@skynet.ie>

	* gnome-panel-properties.glade.h:
	* gnome-panel-screenshot.glade.h: remove.

	* Makefile.am: remove .glade.h files.

	* applet.c, panel-applet-frame.c: fixup pre-conditions.

Fri Feb 01 17:00:02 2002  George Lebl <jirka@5z.com>

	* foobar-widget.c, menu.[ch], menu-fentry.[ch]:  remove old applet
	  cruft

	* global-keys.c: call the run dialog yet again

	* menu.c: add some more people to the authors list in the about box,
	  incomplete though

	* menu.c, panel.c: handle applet dnd again, and reenable adding
	  applet menu as part of the main.  Though perhaps we should just
	  whack that completely.  Also fix a small leak.

2002-01-31  Mark McLoughlin  <mark@skynet.ie>

	* button-widget.c: (button_widget_class_init): kill
	binding_set.

	* panel-widget.c: (panel_widget_move_to_panel): initialise
	previous_panel.

2002-01-31  Glynn Foster  <glynn.foster@sun.com>

	* panel-marshal.list: Add VOID:BOOLEAN to fix build.

2002-01-31  Padraig O'Briain  <padraig.obriain@sun.com>

	* button-widget.[c], panel-widget.[ch] panel-marshal.lst: 
	Remove keyboard move functionality from ButtonWidget. It is now
	necessary to be in Move mode before it is possible to move applets
	using the keyboard.
	Tab or Shift+Tab will move applet to next or previous panel.
	Shift+arrow will push applet a small amount
	Control+arrow will switch applet
	Alt+arrow will free move an applet
	Escape will exit Move mode
 
Tue Jan 29 01:50:01 2002  George Lebl <jirka@5z.com>

	* basep-widget.[ch], panel.c, floating-widget.c, drawer.c: the change
	  signal arguments now give the old value and by the time they
	  are emitted, the new value was already set.  Get rid of the
	  BASEP_MOVING state since it wasn't really treated as one and
	  add a ->moving flag.  When we hide the panel, make sure the
	  widgets that aren't visible are at least insensitive.  Also
	  autohide/autoshow now use idle when at 0 value.

2002-01-28  Seth Nickell  <snickell@stanford.edu>

	* menu.c: (create_root_menu):

	Replace "Execute" with "Run", to avoid using threatening
	language.

2002-01-28  Seth Nickell  <snickell@stanford.edu>

	* Makefile.am:
	* gnome-panel-properties.desktop:

	Install into the new CC capplets location.

2002-01-28  Anders Carlsson  <andersca@gnu.org>

	* gnome-run.c (add_columns): Use a single tree view column
	and pack both cell renderers in it. 
	(create_simple_contents): Add a shadow to the scrolled window.

2002-01-28  Padraig O'Briain  <padraig.obriain@sun.com>

	Initial implementation of keyboard move functionality for ButtonWidget.
	* button-widget.[ch]
	Define action signals "push-move", "switch-move" and "free-move"
	and associate keybindings with them
	Implement default signal handlers button_widget_push_move,
	button_widget_switch_move, button_widget_free_move

	* panel-widget.[ch]
	Define action signal end-move to allow termination of move using
	keyboard. Use Escape as keybinding for this action. This is different
	from Calum's original spec but I have discussed it with him.
	Update panel_sub_event_handler() and panel_widget_applet_event() so 
	that Escape causes panel_widget_end_move() is called.
	Add panel_widget_push_applet, panel_widget_switch_applet,
	panel_widget_free_move_applet to implement "push-move", "switch-move"
	and "free-move"
	Remove calls to g_return_if_fail (foo != NULL) if followed by calls
	to g_return_if_fail (GTK_IS_BAR (foo));
	
2002-01-27  Seth Nickell  <snickell@stanford.edu>

	* panel-per-panel-config.schemas:

	And switch seconds off to minimize the disturbance caused
	by the resizing problems.

2002-01-27  Seth Nickell  <snickell@stanford.edu>

	* panel-per-panel-config.schemas:

	Move "pager" into the upper right hand corner.

2002-01-27  Glynn Foster  <glynn.foster@sun.com>

	* foobar-widget.c, panel.c: Hopefully fixes bug #69838.

2002-01-26  Glynn Foster  <glynn.foster@sun.com>

	* panel-per-panel-config.schemas: Bugger, forgot to hide the hide
	buttons.

2002-01-26  Glynn Foster  <glynn.foster@sun.com>

	* applet.c: Change right-stick to panel-right-stick. It still doesn't 
	really describe to the user what it is, but it's a bit more intuitive.
	* panel-per-panel-config.schemas: Add in a few applets and change things
	around according to Nils' proposal. [Still perhaps missing some icons?].

2002-01-26  Roy-Magne Mo <rmo@sunnmore.net>

	* panel.hints: syncronizing panel.hints 
	  with the gnome-1-4 core. This means
          adding nn and sl languages.

Thu Jan 24 16:20:47 2002  George Lebl <jirka@5z.com>

	* menu.c: fix the reposition hack not to spew warnings

Wed Jan 23 18:20:13 2002  George Lebl <jirka@5z.com>

	* menu.[ch], menu-util.c, applet.c, foobar-widget.c:  Make sure
	  menus appear within xinerama boundaries.  Those that don't like
	  menu.c style of coding should NOT look at this code.  But it
	  works.

	* multiscreen-stuff.c: reorder the screens in the fake debugging
	  setup.

	* basep-widget.c: fix screen_change signal signature

	* foobar-widget.c: add some corners.  Yay we half look like a mac
	  now.  Now if we could only get bottom corners as well.  Maybe
	  in time.

2002-01-23  Padraig O'Briain  <padraig.obriain@sun.com>

	* applet.c: Add applet_do_popup_menu() and applet_popup_menu() to
	support popping up of menu using Shift+F10 for buttons on the panel.

	* basep_widget.c (base_widget_focus_return):
	Update to forget previously focussed widget so that Ctrl+Tab followed
	by Tab gives always gives focus to first button 

	* menu.c: Add menu_button_menu_popup() and menu_button_notify() to
	support menu popup when menu icon receives focus.
	Define callback for "clicked" to be menu_button_pressed so that
	pressing Enter or Space on a focussed menu icon activates its menu.
	
Tue Jan 22 16:11:47 2002  George Lebl <jirka@5z.com>

	* quick-desktop-reader.c: when testing for tryexec, just do an
	  access (foo, X_OK) if it's an absolute filename.  Also put
	  the debug conditional around ALL the g_prints

2002-01-22  Anders Carlsson  <andersca@gnu.org>

	* button-widget.c: Lower the button displacement.

2002-01-22  Padraig O'Briain  <padraig.obriain@sun.com>

	* basep_widget.c: Add new function basep_widget_move_focus to
	implement GtkWidgetClass's move_focus; it causes a icon in the panel
	to receive focus initially instead of hide/show button when Tab is
	pressed when the panel has focus

Mon Jan 21 19:20:06 2002  George Lebl <jirka@5z.com>

	* logout.c: block the logout signal while we're in the signal handler

	* main.c: remove the I'm on crack dialog.  it's pissing the shit out
	  of me.  So we're no longer elitist.  Plus the panel shouldn't screw
	  up your old config now so it should be ok.

	* xstuff.[ch]: remove the nautilus check thing, it's broken and
	  not used anyway

2002-01-21  Glynn Foster  <glynn.foster@sun.com>

	* panel-global-config.schemas, panel-per-panel-config.schemas: Add 
	xml tags to these files.

Mon Jan 21 00:50:06 2002  George Lebl <jirka@5z.com>

	* panel.c: use g_filename_from_uri

2002-01-20  Seth Nickell  <snickell@stanford.edu>

	* main.c: (tell_user_Im_on_crack):

	Mr. Picky Strikes! Remove the separator from
	the dialog as per the HIG.

2002-01-19  Seth Nickell  <snickell@stanford.edu>

	* menu.c: (create_add_panel_submenu):
	* panel-config.c: (update_config_type), (panel_config):

	Rename "Aligned panel" to "Corner panel".

	Add pixmaps for the menu items under "Create panel->".
	
2002-01-19  Seth Nickell  <snickell@stanford.edu>

	* menu.c: (create_applets_menu), (make_add_submenu),
	(create_root_menu):

	Start collapsing Applet submenu into the "add" submenu. The distinction
	between applets and other "things you can put on the panel" isn't very
	clear and is primarily a technical distinction (particular for objects
	such as the status dock. This looks bigger, but its the amount of data
	many users effectively have to sift through to find what they're looking
	for. Now we can confront the problem of better categorization head on.

2002-01-19  Seth Nickell  <snickell@stanford.edu>

	* gnome-panel-properties.glade:

	Reword "on mouseover" to "when the mouse moves over them". Yeah,
	its longer, but its also a lot more natural (and still not the
	longest string in that dialog ;-)
	
	* menu.c: (create_panel_context_menu):
	* menu.h:
	* panel.c: (panel_menu_get):

	Make the panel right click menu only be a context menu for
	panels rather than a "full" Main menu.

2002-01-17  Padraig O'Briain  <padraig.obriain@sun.com>

	* basep_widget.c: Fill in panel background with prelight color/pixmap 
	when panel has focus. This requires introducing new function
	basep_widget_focus_in_event, base_widget_focus_out_widget,
	basep_widget_set_focus

Thu Jan 17 01:43:20 2002  George Lebl <jirka@5z.com>

	* panel-util.[ch], applet.c, basep-widget.c, drawer.c, logout.c,
	  menu.c: Some renaming of functions and minor cleanup of cruft.

	* panel-applet-frame.c, applet.c, panel.c:  Don't use the 'data'
	  field to store the frame, that's what the 'widget' item is for

	* xstuff.c, swallow.c: port the status and swallow checking to
	  libwnck and some swallowing cleanup including a ditem launch
	  error dialog

Wed Jan 16 18:14:43 2002  George Lebl <jirka@5z.com>

	* panel-util.[ch], applet.c , launcher.c, menu.c: Reenable the
	  DocPath help showing stuff, but slightly differently now

	* panel-util.[ch], panel-widget.c: s/my_g_/panel_g_/

	* panel-util.c, menu.c: a bit more work on error dialogs,
	  also have the error/info dialogs use the markup.

2002-01-16 Stephen Browne <stephen.browne@sun.com>

	* distribution.c

	changed the file to look for on Solaris

2002-01-16  Glynn Foster <glynn.foster@sun.com>

	* TODO: Update

2002-01-16  Padraig O'Briain  <padraig.obriain@sun.com>

	* basep_widget.[ch]
	Add "focus_return" signal to return focus from a child widget to the
	panel. Define key binding (Ctrl+Tab) to activate focus_return.
	Remove calls to g_return_if_fail (foo != NULL) if followed by calls
	to g_return_if_fail (GTK_IS_BAR (foo));

Wed Jan 16 01:01:38 2002  George Lebl <jirka@5z.com>

	* applet.[ch], panel-applet-frame.c: Make sure the AppletInfo is
	  freed, fix a possible race with applet destruction.  There are
	  some somewhat evil things still around here.  Fear.

	* panel-util.[ch], applet.c, gnome-run.c, menu-fentry.c, menu.c, 
	  panel.c: make deep_free list functions and use them

Tue Jan 15 15:05:46 2002  George Lebl <jirka@5z.com>

	* button-widget.[ch], panel-types.h, drawer.c, menu.c, launcher.c,
	  logout.c:  Remove the button widget type enum, it's not needed
	  without tiles

	* button-widget.c: draw the focus frame thingie over the icon
	  if we are focused.  You can now tab between launchers and
	  see where you are :)

	* panel-util.c: some warning fixes

2002-01-15  Padraig O'Briain  <padraig.obriain@sun.com>

	* menu-util.c (panel_menu_position):
	Ensure that menu position is close to panel even if popped up by
	keystroke.

	* panel.c:
	Add panel_do_popup_menu() and panel_popup_menu() to support popping
	up of menu using Shift+F10

2002-01-14  Padraig O'Briain  <padraig.obriain@sun.com>

	reviewed by: Mark McLoughlin <mark@skynet.ie>

	* basep_widget.c  foobar-widget.c menu.c 
	Use GtkButton's in_button field instead of ButtonWidget's

	* button-widget.[ch]:
	Derive ButtonWidget from GtkButton instead of GtkWidget; use
	GtkButton's pressed, released and clicked signals instead of signals
	defined in ButtonWidget; ButtonWidget now can receive focus and react
	to keystrokes.
	Remove calls to g_return_if_fail (foo != NULL) if followed by calls
	to g_return_if_fail (GTK_IS_BAR (foo));
	
2002-01-14  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: distcheck fix.

Mon Jan 14 01:40:25 2002  George Lebl <jirka@5z.com>

	* launcher.c, panel-util.[ch]: Add a directory ensuring function
	  that ensures the whole path exists and use it instead of mkdir
	  when hoarding launchers.  This seems to make things work for me.

2002-01-14  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am: Make dist fixes. Actually these probably don't
	help at all...it's any excuse to get it to build ;)

2002-01-13  Alexander Larsson  <alla@lysator.liu.se>

	* panel-util.[ch]:
	Make convert_string_to_keysym_state() use gtk_accelerator_parse()
	and convert_keysym_state_to_string() use gtk_accelerator_name().

	* gnome-panel-properties.glade:
	Convert to new keysym string format.

	* panel-config-global.h:
	Make the _state variables GdkModifierType.

	* panel-widget.[ch]:
	Remove "applet_draw" signal.
	
2002-01-12  Glynn Foster  <glynn.foster@sun.com>

	* applet.c, panel-gconf.c, panel.c: Tighten up the 
	dir_exists keys for when we have instant apply..post 2.0

2002-01-12  Glynn Foster  <glynn.foster@sun.com>

	* menu.c: Make the multiple foobar alert dialog modal so it 
	disappears. Fixes #68596.

2002-01-12  Glynn Foster  <glynn.foster@sun.com>

	* main.c: (main): Add in the name of the executable to avoid
	crashing on logout. Thanks to owen for spotting this. Everyone
	else is too afraid to run gnome-session :)

2002-01-11  Mark McLoughlin  <mark@skynet.ie>

	* panel-gconf.c: (panel_gconf_dir_exists): use GError.

	* rgb-stuff.[ch]: kill everything but transform_pixbuf.

2002-01-11  Glynn Foster  <glynn.foster@sun.com>

	* panel-applet-frame.c: Use normal profile key for saving to, not 
	default profile key.

2002-01-11  Mark McLoughlin  <mark@skynet.ie>

	* applet.c:
	(panel_applet_load_from_unique_id), (panel_applet_load_list):
	fix memleaks.

	* panel-gconf.h: add PANEL_GCONF_DEFAULT_PROFILE.

	* panel.c: (panel_session_init_panels): use it.

Thu Jan 10 23:27:54 2002  George Lebl <jirka@5z.com>

	* Makefile.am, foobar-widget.c, menu.[ch], panel-config.c,
	  panel-util.c, panel.c, session.c, tearoffitem.[ch]:
	  Remove tearoff menus, they sucked.  We can readd them when
	  we implement them properly.

	* gnome-run.c:  Port to TreeView, so we are now completely
	  de-deprecated.  Also read from all-applications:/  To
	  actually allways get all entries.

2002-01-11  Glynn Foster  <glynn.foster@sun.com>

	* applet.c, drawer.c, drawer.h, gnome-panel-properties.c,
	  launcher.c, launcher.h, logout.c, logout.h, menu.c, 
	  menu.h, panel-applet-frame.c, panel-applet-frame.h, panel-gconf.c,
	  panel-gconf.h, panel-per-panel-config.schemas, panel.c,
	  status.c, status.h, swallow.c, swallow.h: 
	Okay, I've already forgotten what has gone into this patch. Think I've 
	got the global propeties animation speed thing nailed. Tweaked the default
	schema just enough to get everyone pissed because the panel won't load up
	for them. Make everyone happy and tell them that it's only a short 'rm -rf'
	command away from panel utopia...until I break it the next time. Moved some 
	stuff around to where it makes more sense. Now I'm seeing elephant trunks
	in my ChangeLog...I need to sleep.

2002-01-11  Anders Carlsson  <andersca@gnu.org>

	* panel-shell.c (panel_shell_register): Print out the error
	code if the panel fails to register.

2002-01-10  Padraig O'Briain  <padraig.obriain@sun.com>

	* basep_widget.c
	Add function show_tip to set tooltips for hidebuttons
	(basep_widget_state_change): Update tooltip when state changes
	(make_hidebutton): Allow button to receive focus
	(basep_widget_explicit_hide): Move focus from hidden button

2002-01-10  Mark McLoughlin  <mark@skynet.ie>

	* applet.[ch]: (panel_applet_load_from_unique_id),
	(panel_applet_save_to_gconf): enable swallow loading/saving.
	(panel_applet_callback_set_sensitive): kill.

	* basep-widget.[ch]:
	(basep_widget_enable_buttons): make sane.
	(basep_widget_pre_convert_hook):
	(basep_widget_get_hide_size): kill.
	(basep_widget_get_hide_orient): ditto.
	(basep_widget_set_state): ditto.

	* button-widget.c: (make_hc_pixbuf): upd.
	(do_saturate_darken): kill do_saturate_darken - not used.

	* drawer-widget.[ch]:
	(rawer_widget_restore_state): kill

	* floating-widget.[ch]:
	(floating_widget_change_orient): kill.

	* gnome-run.c, launcher.c, menu-properties.c: don't include
	  xstuff.h

	* panel-config.c:
	(update_config_mode), (update_config_mode): kill unused.

	* panel-gconf.[ch]: (panel_gconf_get_session_key): ditto.

	* panel-util.c:
	(string_is_in_list), (strtok_with_escape), (escape_string):
	kill unused.

	* panel-widget.[ch]:
	(panel_widget_get_applet_count), (make_background),
	(panel_widget_get_pos), (panel_widget_change_orient), 
	(panel_widget_get_applet_rgb_bg): ditto.
	(panel_widget_move), (panel_widget_get_free_space): not used,
	but is probably useful ... #ifdef out.

	* panel.[ch]:
	(panel_realize), (panel_setup): upd.
	(panel_data_by_id): kill unused.

	* rgb-stuff.[ch]: #ifdef everything out apart from
	transform_pixbuf. Can we kill all that stuff?

	* status-docklet.c: (status_docklet_instance_init): rename
	from status_docklet_init. An he claims i suck? :-)

	* xstuff.c: (redo_interface), (desk_notifier),
	(task_notifier): kill unused.
	(xstuff_init): kill old notifiers.

2002-01-10  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am, main.c, panel.c, session.c: Remove old cruft that 
	that was added during the war years. We don't need it now.

2002-01-10  Glynn Foster  <glynn.foster@sun.com>

	* main.c, panel-widget.c, panel.c, panel.h, session.c, session.h:
	More namespacing. I will do real work soon honest.

2002-01-09  Glynn Foster  <glynn.foster@sun.com>

	* basep-widget.c: Use #defines for panel speed for convenience
	* gnome-panel-properties.c: Fix animation speeds [hopefully].
	* panel-types.h: Change order of PanelSpeed enum.
	* main.c, panel.c, panel.h, session.c, session.h: Start to order
	some stuff around for proper namespacing. 
	I'm 99.99% sure that this builds...because I looked dumb the last 
	time [thanks Darin!].

2002-01-09  Darin Adler  <darin@bentspoon.com>

	* menu.c: Another include of conditional.h

2002-01-09  Darin Adler  <darin@bentspoon.com>

	* main.c: Remove include of conditional.h

2002-01-09  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am: Remove building of conditional.[ch]
	* conditional.c, conditional.h: Kill Kill Kill!!
	* menu.c: ifdef out, hasn't been implemented using gconf yet
	* main.c, panel-gconf.c, panel-util.c, session.c: Move stuff around 
	a little bit to remove as much cruft from main ()
	* panel-util.c: Add some of the useful [possibly] batter stuff from 
	conditional.[ch]

2002-01-09  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c:
	(panel_applet_frame_change_background_pixmap): implement new
	"pixmap:xid,x,y" format.

	* panel.c: (back_change): upd.

2002-01-09  Alexander Larsson  <alla@lysator.liu.se>

	* button-widget.[ch]:
	Make it a normal widget that exposes using
	gdk_pixbuf_render_to_drawable_alpha ().

	* panel-widget.[ch]:
	Override signals instead of connecting to them.
	Remove lots of code that handled button-widgets.
	Expose like normal Gtk widgets.
	Remove no_window_applet_list, as it's not needed anymore.
	
2002-01-08  Glynn Foster  <glynn.foster@sun.com>

	* AUTHORS: Adding Mark and myself.

2002-01-08  Glynn Foster  <glynn.foster@sun.com>

	* gnome-panel-properties.c: Fix up to reflect the user intuitive
	global property config changes.

2002-01-08  Glynn Foster  <glynn.foster@sun.com>

	* panel-gconf.c: Add some more error checking to the loading of 
	gconf. Still far from adequate, but it might just stop panel from 
	crapping out. Thanks to Mark for bugging me about this ;)

2002-01-08  Mark McLoughlin  <mark@skynet.ie>

	* APPLET_WRITING, applet-object.c, applet-object.h,
	  applet-private.h, applet-widget.c, applet-widget.h,
	  appletsConf.sh.in, bad-applet.c, dockletsConf.sh.in,
	  extern.c, extern.h: kill cruft.

2002-01-07  Glynn Foster  <glynn.foster@sun.com>
	
	* basep-widget.c, basep-widget.h, main.c panel-config-global.h, 
	  panel-global-config.schemas, panel-per-panel-config.schemas,
	  panel-types.h, session.c: 

	Remove mostly all traces of non-usable gconf schema keys in preference
	to using gconf_string_to_enum and vice versa. This will hang your panel
	unless you remove ~/.gconf/apps/panel and 'make install'.

2002-01-07  Mark McLoughlin  <mark@skynet.ie>

	* applet.c:
	(applet_callback_callback): kill APPLET_RUN stuff.
	(panel_applet_load_from_unique_id),
	(panel_applet_save_to_gconf): load/save drawers, swallowed
	apps, status docks, logout and lock buttons.

	* drawer.[ch]:
	(load_drawer_applet): add gconf_key arg.
	(drawer_save_to_gconf), (drawer_load_from_gconf): impl.

	* swallow.[ch]: (really_add_swallow): upd.
	(load_swallow_applet): add gconf_key param.
	(swallow_save_to_gconf), (swallow_load_from_gconf): impl.

	* menu.[ch]: (add_drawers_from_dir), (add_drawer_to_panel):
	upd for drawers changes.

	* panel.c: (drop_internal_applet): ditto.

	* panel-main.h: kill panel_main_get_current_profile.

	* session.c: (panel_session_save_applets), (panel_quit):
	kill old applets loading/saving stuff.

2002-01-07  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_load_from_unique_id),
	(panel_applet_save_to_gconf): load menus.

	* menu.[ch]: (add_menu_to_panel): upd.
	(load_menu_applet): add gconf_key arg.
	(menu_save_to_gconf), (menu_load_from_gconf): impl.

	* panel.c: (drop_menu): update for load_menu_applet change.

	* launcher.c: (launcher_save_to_gconf), (launcher_load_from_gconf):
	use object's keys, not applet's keys. doh.

2002-01-07  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (panel_applet_get_full_gconf_key): fix silly.
	(panel_applet_load_from_unique_id): use
	panel_applet_frame_load_from_gconf and load launchers.
	(panel_applet_load_list): replace list_key arg with type arg.
	(panel_applet_load_applets_from_gconf): upd.
	(panel_applet_save_position): suggest a sync.
	(panel_applet_save_to_gconf): save launchers.

	* launcher.[ch]:
	(launcher_save_to_gconf), (launcher_load_from_gconf): impl.
	(load_launcher_applet_full), (load_launcher_applet): add a
	gconf_key arg.
	(really_add_launcher), (load_launcher_applet_from_info),
	(load_launcher_applet_from_info_url): upd.

	* menu.c: (add_app_to_panel), (add_drawers_from_dir),
	(add_launcher): upd for launcher change.

	* panel.c: (drop_urilist), (drop_internal_icon): ditto.

	* panel-applet-frame.[ch]:
	(panel_applet_frame_load_from_gconf): impl.

2002-01-07  Mark McLoughlin  <mark@skynet.ie>

	Move applet loading/saving to/from gconf into applet.c where
	it can be used by all type of panel objects.

	* applet.[ch]:
	(panel_applet_clean_gconf): impl.
	(panel_applet_clean): clean_gconf and remove the applet from
	the list.
	(applet_idle_remove): save position for all object.
	(applet_destroy): free gconf_key.
	(panel_applet_get_full_gconf_key),
	(panel_applet_load_from_unique_id), (panel_applet_load_list),
	(panel_applet_load_applets_from_gconf),
	(panel_applet_save_position),
	(panel_applet_save_to_gconf): impl.
	(panel_applet_register): add gconf_key arg, save_to_gconf.
	(panel_applet_get_position),
	(panel_applet_get_panel_id), (panel_applet_get_right_stick):
	add preconditions.

	* drawer.c: (load_drawer_applet):
	* launcher.c: (load_launcher_applet_full):
	* logout.c: (load_logout_applet), (load_lock_applet):
	* menu.c: (load_menu_applet):
	* status.c: (load_status_applet):
	* swallow.c: (load_swallow_applet): update for
	panel_applet_register param change.

	* panel-applet-frame.[ch]:
	(panel_applet_frame_save_to_gconf): only save the bonobo iid.
	(popup_handle_remove): kill gconf stuff.
	(panel_applet_frame_load): generate a gconf_keyt if we're
	loading the applet for the first time.
	(panel_applet_frame_finalize), (panel_applet_frame_construct),
	(panel_applet_frame_new): upd.

	* panel-gconf.[ch]: (panel_gconf_objects_profile_get_full_key),
	(panel_gconf_objects_default_profile_get_full_key): rename
	from panel_gconf_launchers_*.

	* panel.c: (panel_remove_applets): save position for all
	objects.

	* session.c:
	(panel_session_save_applets): save position for all object.
	(panel_session_die): ditto.
	(session_load): use panel_applet_load_applets_from_gconf.

2002-01-07  Mikael Hallendal  <micke@codefactory.se>

	* gnome-panel-screenshot.c: always include locale.h, it's used in
	main.

2002-01-04  Glynn Foster  <glynn.foster@sun.com>

	* .cvsignore: GAG and lock in dark room
	
	* panel-gconf.c, panel-gconf.h: Some new convenience code
	for launcher loading.
	* panel-per-panel-config.schemas: Some new default launchers to
	load - still very much work in progress.
	* session.c: Remove use of old conditional code.

2002-01-04  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c:
	(panel_applet_frame_load_from_unique_id),
	(panel_applet_frame_save_to_gconf),
	(panel_applet_frame_save_position): use
	panel_gconf_applets_profile_get_full_key

2002-01-04  Mark McLoughlin  <mark@skynet.ie>

	Saving and loading of applets to gconf should work now.

	* panel-applet-frame.[ch]:
	(panel_applet_frame_load_from_unique_id),
	(panel_applet_frame_load_applets),
	(panel_applet_frame_save_to_gconf): impl.
	(popup_handle_remove): upd to remove all gconf settings.
	(panel_applet_frame_load): add extra gconf_key param.
	(panel_applet_frame_instance_init): don't initialise
	unique_key here.
	(panel_applet_frame_construct): add extra gconf_key param.
	(panel_applet_frame_new): add extra gconf_key param.

	* panel-widget.c: include session.h

	* session.c:
	(panel_session_save_panel): don't set the list unless we've
	changed it.
	(session_load): use panel_applet_frame_load_applets.

	* menu.c: (add_bonobo_applet): upd.

2002-01-04  Glynn Foster  <glynn.foster@sun.com>

	* TODO, TODO.old: mv TODO TODO.old. touch TODO. Add some items
	that are relevant to me - hopefully everyone will do the same.

Thu Jan 03 14:56:46 2002  George Lebl <jirka@5z.com>

	* basep-widget.c: fix possible GList mempool corruption

	* gnome-run.c: look for pixmaps in app directories as well.

2002-01-02  Glynn Foster  <glynn.foster@sun.com>

	* panel-gconf.c, session.c: I am an ass. Use gconf_client instead
	of gconf_engine. Don't know what I was thinking about. Anyway, it 
	works okay now, although doesn't unlink the directory, although
	there's probably a way of doing that.

2002-01-02  Glynn Foster  <glynn.foster@sun.com>

	* panel-gconf.c, panel-widget.c, session.c, session.h: 
	Implemented new session_remove_panel_config () function to clean
	up the gconf database after we start removing panels. Doesn't work
	at all yet, but it doesn't make things crash which is a bonus.

2002-01-01  Glynn Foster  <glynn.foster@sun.com>
	 
	* config/Makefile.am, config/panel.config,
	* config/panel.global: Removed, old crusty config stuff
	that we don't need anymore. WARNING! keep the launcher
	config still, I want to look at that.
	
	* main.c, menu.c, session.c, session.h: Removed some more crufty 
	code that we don't need anymore. Mark tearoff loading FIXME'd.

2001-12-31  Glynn Foster  <glynn.foster@sun.com>

	* panel-gconf.c, panel-gconf.h, session.c: 

	All because the lady likes new API. Implemented / copied code for
	a recursive unset of a gconf directory. Nothing uses it yet, but 
	it soon will.
	
2001-12-30  Glynn Foster  <glynn.foster@sun.com>

	* panel-per-panel-config.schemas: Complete the schema for 
	large size. Just waiting for some usability input now ;)

2001-12-30  Glynn Foster  <glynn.foster@sun.com>

	* panel-gconf.c, session.c: 

	1:30am + 6 hours of tv = mushed (brain). Think I've got all
	the panels saving and loading properly now. They even do 
	session management, but I'm too scared to run gnome-session-2 to
	check if that actually works.

Fri Dec 28 03:00:03 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c: correctly handle icon changing

	* menu.c: Fix some ugliness around the applets menu, still
	  much ugliness prevails

	* session.c: fix a few leaks.  When we find no panels install
	  a menu panel and tell the user.  Else the user would have no
	  interface to fix his configuration.

Wed Dec 26 17:45:49 2001  George Lebl <jirka@5z.com>

	* gnome-panel-screenshot.c, menu.c, panel.c, panel-util.c,
	  panel-widget.c:  I'm a dubmass!  GdkCursor is NOT a GObject

	* foobar-widget.c:  a bit of cleanup

Wed Dec 26 16:25:50 2001  George Lebl <jirka@5z.com>

	* Makefile.am, basep-widget.c, button-widget.c, foobar-widget.c,
	  global-keys.c, gnome-panel-properties.c, gnome-panel-screenshot.c,
	  gnome-run.c, launcher.c, main.c, menu.c, nothing.cP, panel-util.c,
	  panel-widget.c, panel.c, rgb-stuff.c, xstuff.c:  Compile also
	  with GDK_DISABLE_DEPRECATED and GDK_PIXBUF_DISABLE_DEPRECATED,
	  and all except gnome-run.c with GTK_DISABLE_DEPRECATED

	* foobar-widget.c: always convert to utf8 after getting something
	  from strftime

Wed Dec 26 14:01:24 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c: fix width of clock label.  Now if the time
	  'grows' beyond initial size then the label grows as well (it never
	  shrinks horizontally though, unless you change the format)

	* nothing.cP: we need pause

Wed Dec 26 12:03:37 2001  George Lebl <jirka@5z.com>

	* panel-gconf.c: fix default return for get_string

	* nothing.cP: a bit more evil was required here

Tue Dec 25 16:13:56 2001  George Lebl <jirka@5z.com>

	* nothing.cP: some more evil

Tue Dec 25 15:51:27 2001  George Lebl <jirka@5z.com>

	* gnome-run.c, nothing.cP, nothing.h: Since I suppose one shouldn't
	  be productive during christmass to not seem like a loser, I wasn't
	  actually productive.  GEGLs ARE INVADING!

	* menu.c: cosmetic change

Mon Dec 24 01:55:19 2001  George Lebl <jirka@5z.com>

	* panel.c, panel-util.[ch]: deal with dropped uris a tad better and
	  actually use gnome-vfs more.  Still kind of stupid and needs more
	  work, but better then before.  We should now again handle drops
	  from the menus since those were not from a 'file:' uri's.  Also
	  drop the shell quoting routine since we already have that in glib.

	* panel-widget.c: a bit of constization

Sat Dec 22 23:12:54 2001  George Lebl <jirka@5z.com>

	* Makefile.am, foobar-widget.c, gnome-panel-screenshot.c, panel.c,
	  session.c: Compile with G_DISABLE_DEPRECATED and
	  GNOME_DISABLE_DEPRECATED

Sat Dec 22 17:14:50 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c, menu.[ch], main.c: redo how the updating of
	  icons and tearoffs keys is done, load the foobar items in the
	  deffered way as well and sanitize this whole bit somewhat more.
	  It now fully nicely updates when you set/unset the icons/tearoff
	  keys.  And without having to reread folders.

	* gnome-panel-properties.c, gnome-run.c, launcher.c,
	  menu-properties.c, menu.c, panel-config.c, swallow.c:
	  Make dialog window settings sane after mucking with them.

	* gnome-panel-screenshot.c: get rid of tempnam usage to avoid warning

Sat Dec 22 15:12:42 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c, gnome-run.c, panel-config.c, swallow.c: fix up
	  the size request stuff so we get back some widgets which
	  disappeared because I was a wanker.

Sat Dec 22 14:52:42 2001  George Lebl <jirka@5z.com>

	* gnome-panel-screenshot.c, gnome-panel-properties.c, status.c:
	  more fixes.  Having things actually compile is usually good.

Sat Dec 22 13:56:23 2001  George Lebl <jirka@5z.com>

	* menu.c: fix stupid typo

Sat Dec 22 13:44:25 2001  George Lebl <jirka@5z.com>

	* basep-widget.c, drawer-widget.c, drawer.c, extern.c,
	  foobar-widget.c, gnome-panel-properties.c,
	  gnome-panel-screenshot.c, gnome-run.c, launcher.c,
	  menu-properties.c, menu.c, nothing.cP, panel-config.c,
	  panel-util.c, panel.c, panel.h, status-docklet.c, status.c,
	  swallow.c, xstuff.c: Yet more de-deprecation.  Now all that's
	  left is the clist stuff in gnome-run, but jrb says he has a
	  new runbox in production so it seems pointless to spend time
	  on porting that now.

Fri Dec 21 18:44:22 2001  George Lebl <jirka@5z.com>

	* Makefile.am, aligned-widget.c, applet.c, basep-widget.c,
	  button-widget.c, distribution.c, drawer-widget.c, drawer.c,
	  edge-widget.c, floating-widget.c, foobar-widget.c, foobar-widget.h,
	  gnome-panel-properties.c, gnome-run.c, menu.c, nothing.cP,
	  panel-config.c, panel-util.c, panel-widget.c, panel-widget.h,
	  panel.c, session.c, sliding-widget.c, status.c, tearoffitem.c:
	  Some deprecated excorcism, fix some panel unique_id foo and
	  some warning fixes etc...

2001-12-21  Glynn Foster  <glynn.foster@sun.com>

	* panel-gconf.c, session.c: Big heap of debug crap. It should
	help someone trying to figure out the profile stuff because I'm
	not going to fix it until after Christmas. Yeesh, like I should 
	be out drinking at this very moment. May your Christmas give you
	a warm tingly feeling and most importantly, have the craic...

2001-12-21  Mark McLoughlin  <mark@skynet.ie>

	* applet.[ch]:
	(panel_applet_get_position), (panel_applet_get_panel_id),
	(panel_applet_get_right_stick): impl.

	* drawer.c: (load_drawer_applet): panel_od fixage.

	* main.c: (main): move sync timeout setup to session.c,

	* menu.[ch]:
	(panel_menu_session_save_tornoffs): rename from save_tornoff
	(panel_menu_session_load_tornoffs): rename from load_tornoff

	* panel-applet-frame.c: (panel_applet_frame_save_position): save
	everything in the right place.

	* session.[ch]:
	(session_save_timeout): kill.
	(panel_session_save_applets): impl. only bonobo applets saving for the
	moment.
	(panel_session_save_panel): rename from save_panel_configuration.
	(save_next_applet): kill.
	(panel_session_do_save): drastically clean up.
	(panel_config_sync): upd.
	(panel_session_do_sync), (panel_sesssion_setup_config_sync): moved from
	main.c.
	(panel_session_save): remove timeout stuff. Nothing asynchronous is
	happening at the moment.

2001-12-21  Glynn Foster  <glynn.foster@sun.com>

	* main.c, menu.c, panel-gconf.c, session.c: 
	Miscellaneous fixes to try and get basic, basic profiles
	working, and to clear out my tree for Mark.

2001-12-21  Anders Carlsson  <andersca@gnu.org>

	* Makefile.am: Re-add gnome-panel-screenshot
	
	* gnome-panel-screenshot.c: (main): Build with gnome2.

	* gnome-panel-screenshot.glade: Switch button order.
	
	* panel-applet-frame.c: (panel_applet_frame_load),
	(panel_applet_frame_construct), (panel_applet_frame_new):
	* panel-applet-frame.h:
	Don't segfault when applets can't be loaded.
	
	* panel-gconf.c: (panel_notify_object_dead),
	(panel_gconf_notify_add_while_alive):
	Use g_object_weak_ref here instead.
	
	* panel.c: (drop_background_reset), (drop_bgimage),
	(get_target_list), (drag_data_recieved_cb):
	Use x-special/gnome-reset-background to reset backgrounds.

2001-12-21  Glynn Foster  <glynn.foster@sun.com>

	* aligned-widget.c, aligned-widget.h, basep-widget.c, basep-widget.h,
	  border-widget.c, border-widget.h, drawer-widget.c, drawer-widget.h,
	  drawer.c, drawer.h, edge-widget.c, edge-widget.h, extern.c,
	  floating-widget.c, floating-widget.h, foobar-widget.c, foobar-widget.h,
	  menu.c, panel-widget.c, panel-widget.h, panel.c, panel.h, session.c,
	  sliding-widget.c, sliding-widget.h:

	I know I'm going to regret this later on. Store unique id's as strings 
	instead of guints. It makes handling them in gconf much easier.

2001-12-20  Mark McLoughlin  <mark@skynet.ie>

	* panel.c: (panel_applet_about_to_die): kill warnig and
	replace with a FIXME.

2001-12-20 Stephen Browne <stephen.bronwe@sun.com>
	
	* distribution.[ch]
	
	Harmless addition of Solaris to the distributions

2001-12-20  Glynn Foster  <glynn.foster@sun.com>

	* floating-widget.c, foobar-widget.c, main.c,
	* menu.c, panel-applet-frame.c, panel-gconf.c,
	* panel-gconf.h, session.c: 

	Load up some default configuration if something dies. Now mostly
	saves again.

Wed Dec 19 20:27:04 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c: apply patch from "Dennis M. Cranston"
	  <dennis_cranston@yahoo.com> to modify the clock menu to make
	  it nice and all that.

	* menu-properties.c: apply a patch from Robert Mibus
	  <mibus@bigpond.com> to correctly set the initial sensitivity

Wed Dec 19 20:15:09 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c: an evil hack stolen from tasklist to set some
	  style properties such as the bevel type and internal padding

	* gnome-run.c, launcher.c, menu-properties.c, menu.c,
	  quick-desktop-reader.[ch]: use the new icon finding routines from
	  the desktop item thingie.

	* menu.c, session.c: dereferencing a guint32 as a pointer is
	  dangerous to one's health.

Wed Dec 19 16:48:41 2001  George Lebl <jirka@5z.com>

	* xstuff.[ch], gnome-run.c, launcher.c, menu-properties.c,
	  panel-config.c: remove the raise function and just replace
	  it with gtk_window_present, remove some other cruft left around

	* menu.c: don't prepend home dir to distro menu paths, these
	  are uris now

2001-12-19  Seth Nickell  <snickell@stanford.edu>

	* panel-global-config.schemas:

	Change default values for show delay to 300
	and hide delay to 500.

2001-12-19  Seth Nickell  <snickell@stanford.edu>

	* gnome-panel-properties.c: (load_config_into_gui):
	* gnome-panel-properties.glade:
	* gnome-panel-properties.glade.h:

	Remove "show delay" and "hide delay" options from global
	panel config. Leave them in GConf.
	
2001-12-19  Glynn Foster  <glynn.foster@sun.com>

	* session.c: Saving is fucked. Patch to at least have 
	a non-b0rked panel.

2001-12-19  Glynn Foster  <glynn.foster@sun.com>

	* main.c, menu.c, panel-applet-frame.c, panel-gconf.c,
	* panel-gconf.h, session.c, session.h:

	Move the get and set methods for the profiles to session where 
	they probably belong. Start saving the panel config per profile.
	It's like totally buggy right now, but it's sort of getting there.
	Panels crash because of lack of schema.

2001-12-19  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add panel-main.h.

	* panel-main.h: new file.

	* main.c: (panel_main_get_current_profile): impl.
	  make panel_profile_name static.

	* panel-applet-frame.c: (panel_applet_frame_construct): append
	the prefs_key item to the iid to make the moniker.

	* menu.c: (create_new_panel): use panel_main_get_current_profile.

	* session.c: (session_init_panels): ditto.

2001-12-19  Glynn Foster  <glynn.foster@sun.com>

	* aligned-widget.c, aligned-widget.h, applet-object.c, applet-widget.c,
	* basep-widget.c, basep-widget.h, border-widget.c, border-widget.h,
	* drawer-widget.c, drawer-widget.h, edge-widget.c, edge-widget.h,
	* floating-widget.c, floating-widget.h, foobar-widget.c, menu.c,
	* panel-config.c, panel-config.h, panel-gconf.c, panel-gconf.h,
	* panel-global-config.schemas, panel-per-panel-config.schemas, panel-util.c,
	* panel-util.h, panel-widget.c, panel-widget.h, panel.c,
	* session.c, sliding-widget.c, sliding-widget.h:

	Mindless hacking. If you can have color, I can have stretch.
	Cleaned up some of the gconf panel loading.

2001-12-18  Havoc Pennington  <hp@pobox.com>

	* basep-widget.c (basep_widget_realize): remove
	xstuff_set_wmspec_state_hints

	* xstuff.c (xstuff_window_raise_on_current_wspace): this was all a
	bunch of bullshit, it should just be gtk_window_present()
	(xstuff_set_wmspec_state_hints): I don't think we should do this, 
	because the semantic type is adequate. should only set this kind
	of thing if we are trying to override semantic type
	(xstuff_set_pos_size): delete this broken atrocity. well, I wish.
	make it suck mildly less.

2001-12-18  Glynn Foster  <glynn.foster@sun.com>

	* panel-gconf.c, panel-per-panel-config.schemas,
	* session.c: 
	Stupid commit to fix bug.

2001-12-17  Glynn Foster  <glynn.foster@sun.com>

	* panel-per-panel-config.schemas, session.c: Change code to use
	the schema for the medium sized screen, so at least people don't
	get freaked out that I killed the foobar.

2001-12-17  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am, floating-widget.c, foobar-widget.c,
	* gnome-run.c, main.c, main.h, menu.c, nothing.cP,
	* nothing.h, panel-gconf.c, panel-gconf.h,
	* panel-per-panel-config.schemas, session.c, session.h,
	* tearoffitem.c:
	
	This patch will upset quite a lot of people. The move towards
	gconf and profiles Part I "Oh What a Tangled Web we Weave". Please
	don't look at the code, it's horrible. Basically we now have a 
	default schema for small, medium and large screens. The panel will 
	in future take a --profile option to load a profile. For now, applet
	inits don't work, panel inits are taken from the 'small' profile. Don't 
	file bugs about panel not saving, we know.
		
2001-12-17  Mark McLoughlin  <mark@skynet.ie>

	* menu.h: fix PANEL_MENU_HAVE_ICONS_KEY.

Sun Dec 16 16:00:49 2001  George Lebl <jirka@5z.com>

	* xstuff.c: when rasing windows also wnck activate them

2001-12-16  Gediminas Paulauskas <menesis@delfi.lt>

	* gnome-run.c, launcher.c, menu-properties.c, menu.c, panel-config.c,
	swallow.c: use GTK_RESPONSE_* instead of custom *_BUTTON
	enumerations -- this makes Help buttons left-aligned. Reorder buttons
	to comply with HIG, set default response to leftmost button.

Fri Dec 14 16:50:07 2001  George Lebl <jirka@5z.com>

	* drawer.c: reenable property apply code

Fri Dec 14 16:41:23 2001  George Lebl <jirka@5z.com>

	* menu.[ch], launcher.c: some deFIXMEization.  Remove some dead
	  code, add some error handeling, fix some comments.  Directory
	  only ditem entry set, and also init type for applications.  Also
	  what the hint stuff from the tearoff menus.  It wouldn't work
	  properly anyway and it's supposed to be handled by the WM
	  anyway.  Also hardcode default to true for icons and tearoff keys,
	  and re-enable the use of the gconf key in the icons thing.  Also
	  use the new key for icons.  I can't find a tearoff one.  Is there
	  one?

2001-12-14  Alex Larsson  <alexl@redhat.com>

	* panel-applet-frame.c (panel_applet_frame_change_background_color):
	Make colors 4 chars per channel, they are 16bit.

2001-12-14  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c: (panel_applet_frame_get_applet_shell):
	one last Vertigo change.

2001-12-14  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.[ch]:
	(panel_applet_frame_save_session): kill

	* session.c: (save_applet_configuration): upd.

2001-12-14  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.[ch], panel-shell.[ch]:
	  panel-types.h: move to our reserved GNOME_Vertigo
          namespace.

2001-12-14  Seth Nickell <snickell@stanford.edu>

	* menu.c: (panel_menu_have_icons):

	Disable GConf and make the panel menu icons actually work.
	Spit out one g_warning as penance.

2001-12-14  Seth Nickell  <snickell@stanford.edu>

	* applet.c: (applet_callback_callback):
	* menu-properties.c: (get_real_menu_path):
	* menu.c: (init_menus), (add_menu_to_panel), (create_system_menu),
	(make_add_submenu), (make_panel_submenu):
	* session.c: (session_init_user_applets),
	(session_init_user_panels):

	Change to using "applications:/" rather than "programs:/"
	
2001-12-14 Stephen Browne <stephen.browne@sun.com>

	* gnome-panel-properties.c, gnome-panel-properties.glade,
	  gnome-panel-properties.glade.h

	  Removed keep menus in memory option (always on now)
	  Removed Confirm panel removal option (always on now)

Thu Dec 13 15:30:01 2001  George Lebl <jirka@5z.com>

	* launcher.c: some fixes in getting/setting locale specific
	  name/comment

2001-12-13  Glynn Foster  <glynn.foster@sun.com>

	* launcher.c, main.c, session.c: Remove PER_SESSION cruft
	that just confuses me.

Wed Dec 12 23:35:46 2001  George Lebl <jirka@5z.com>

	* session.c: doh, remove a debugging g_print

Wed Dec 12 23:33:33 2001  George Lebl <jirka@5z.com>

	* basep-widget.c, session.c, panel-config-global.h,
	  gnome-panel-properties.c, panel-global-config.schemas,
	  gnome-panel-properties.glade:  Remove the user large icons,
	  avoid collissions and merge menus config options and keys and
	  all that.  large icons were gone already, merged menus as well,
	  and who would ever want to turn off collision avoidance.  Also
	  fix some memleaks and some cleanups.

	* foobar-widget.c: fix memleaks

Wed Dec 12 12:47:38 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c: reposition menu after hiding an item

	* menu.[ch]: the keys for icons and tearoffs are now defined in the
	  menu.h as a define.  Also setup keys on the menu to display
	  the current state of the icons/tearoffs key at the time the menu
	  was created so that we can recreate it if it changes.  Doesn't yet
	  work everywhere, only for menus that use check_reread

	* panel-gconf.[ch]: notify_add returns an id, and add a _while_alive
	  version as well

2001-12-12  Mark McLoughlin  <mark@skynet.ie>

	Bit of renaming for Glynn.

	* panel_config.c: rename to panel-config.c
	* panel_config.h: rename to panel-config.h
	* panel_config_global.h: rename to panel-config-global.h
	* panelglobalconfig.schemas: rename to
	  panel-global-config.schemas

	* Makefile.am, aligned-widget.c, applet.c, basep-widget.c,
	  border-widget.c, button-widget.c, drawer-widget.c, drawer.c,
	  drawer.h, edge-widget.c, extern.c, floating-widget.c,
	  foobar-widget.c, global-keys.c, launcher.c, logout.c,
	  main.c, menu-fentry.c, menu-util.c, menu.c, panel-config.c,
	  panel-util.c, panel.c, session.c, sliding-widget.c:
	update.

2001-12-12 Stephen Browne <stephen.browne@sun.com>

	* gnome-panel-properties.c, gnome-panel-properties.glade,
	  gnome-panel-properties.glade.h

	Added config for auto update menus.
	I think the global config dialog is pretty much finished now.

2001-12-12 Stephen Browne <stephen.browne@sun.com>

	* gnome-panel-properties.c
	
	Gets rid of incorrect arg warning.

2001-12-12  Stephen Browne <stephen.browne@sun.com>

	* Makefile.am, gnome-panel-properties.c,
	  gnome-panel-properties.glade, gnome-panel-properties.glade.h

	Added LDFLAGS for gnome-panel-properties.
	Added support for configuring keybindings

2001-12-12  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am, main.c, panel-gconf.c,
	panel-per-panel-config.schemas: 

	Did a little work according to Alex's guidelines. 
	Things are still a long way off. MUCH work.

2001-12-12  Glynn Foster  <glynn.foster@sun.com>

	* button-widget.c, launcher.c, panel-widget.c,
	* session.c:

	Fix stuff so that panel context menus work again.

2001-12-12  Mark McLoughlin  <mark@skynet.ie>

	* xstuff.c: (xstuff_set_wmspec_strut):
	_NET_WM_STRUT properties are of type XA_CARDINAL 
	not XA_ATOM.

2001-12-11  Glynn Foster  <glynn.foster@sun.com>
	* foobar-widget.c:
	  Scale pixmaps when required for proper display.
	  Add padding to the size of the foo clock so we dont
	  get movement when the label allocates more space.

2001-12-11  Glynn Foster  <glynn.foster@sun.com>

	* button-widget.c, launcher.c,  menu.c
	  panel-widget.c, panelglobalconfig.schemas
	  session.c:

	Make the foo clock use gconf.

2001-12-11 Stephen Browne <stephen.browne@sun.com>

	* gnome-properties.c gnome-properties.glade
	  menu.c

	 Fixed confirm-panel-removal and drawer-autoclose config
	 Gave the global props dialog a proper name

2001-12-11  Anders Carlsson  <andersca@gnu.org>

	* main.c (main): Always restart here.

2001-12-10  Glynn Foster  <glynn.foster@sun.com>

	* gnome-panel-properties.desktop, menu.c:
	
	Rename for global properties dialog.

2001-12-10  Glynn Foster  <glynn.foster@sun.com>

	* basep-widget.c, gnome-panel-properties.c
	  gnome-panel-properties.glade, main.c
	  panel-gconf.c, panel-gconf.h, panel_config_global.h
	  panelglobalconfig.schemas, session.c: 

	Fix up gconf stuff. Now things work with the global
	properties dialog.

2001-12-10 Stephen Browne <stephen.browne@sun.com>

	* gnome-panel-properties.c
	* gnome-panel-properties.glade

 	now uses /apps/panel/global keys
	removed stuff from glade file that isnt working yet
	made remaining properties work

2001-12-10  Alexander Larsson  <alla@lysator.liu.se>

	* basep-widget.c (basep_widget_realize):
	Call xstuff_set_wmspec_state_hints ()

	* xstuff.[ch] (xstuff_set_wmspec_state_hints):
	New function to set the WMSPEC hints for the panel
	SKIP_PAGER, SKIP_TASKLIST and STICKY.

Sun Dec 09 22:35:26 2001  George Lebl <jirka@5z.com>

	* Makefile.am, title-item*.(c|h|gob):  Title item no longer needed,
	  so removed

	* applet.c: a bit of gdkpixbuf fixage

	* foobar-widget.c: Some warning fixes, also reposition task menu
	  on show, Fix icon unreffage issues, look for default task icon
	  better, when no windows are present add 'No windows open'
 	  insensitive item to the task menu, Actually show the icon on
	  the menu, and strech events for the task item to the right
	  corner

	* panel-util.[ch], foobar-widget.c: add _while_alive wrappers
	  that are sort of like the gtk ones but for GObjects

	* menu.c: gtk_signal_* excorcism

	* xstuff.[ch], gnome-run.c, launcher.c, menu.c, menu-properties.c,
	  panel_config.c: Add a function to show/raise/move to current
	  workspace for windows and use it for all the dialogs where
	  we only always have one copy of.  So that say the run dialog
	  will appear on your workspace even if it's open on another
	  one already

	* session.c: add to the auto-update-menus conversation warning

2001-12-09  Anders Carlsson  <andersca@gnu.org>

	* menu.c (get_panel_from_menu_data): Use gtk_menu_get_attach_widget
	to traverse up in the menu hierchary. Thanks to Owen Taylor for
	suggesting this.

	* applet.c: (panel_applet_add_callback), (setup_an_item),
	(applet_setup_panel_menu), (panel_applet_create_menu):
	Ref/Sink our menu, scale the panel menu icon.
	
	* main.c: (main): Don't respawn if I_LOVE_PANEL_CRACK is set.
	
	* menu.c: (setup_full_menuitem): gtk_widget_show our image.
	
	* panel.c: (drop_urilist): Implement so we can dnd urls to the panel.

Sun Dec 09 03:34:18 2001  George Lebl <jirka@5z.com>

	* Makefile.am, tasklist_icon.[ch], foobar-widget.c, main.c, menu.c,
	  xstuff.c: remove the gwmh and gstc hack stuff and remove them from
	  build and also remove the tasklist_icon.[ch] as well.  We use
	  libwnck now:)

Sun Dec 09 03:25:13 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c, menu-util.[ch]: initial crack at porting the
	  tasklist thing to libwnck, reenable the clock menu thing, use main
	  menu stuff for the "applications" menu so that we can get a KDE
	  and/or distribution submenu and remove some dead code

	* menu.[ch], foobar-widget.c, menu-fentry.h: whack the title flags
	  from things.  Menu titles are long dead

	* applet.c: also launch nautilus for edit menus

Sat Dec 08 23:16:39 2001  George Lebl <jirka@5z.com>

	* menu.[ch], menu-fentry.h, menu-util.c, menu-properties.c,
	  session.c, main.c, gnome-run.c:  Remove favourites menu.  It is
	  useless with the current push towards editable menus.  Also instead
	  of running gedit, run nautilus on programs:/ as a menu editor.

	* panel-widget.c: fix warning.

	* applet.c, foobar-widget.c: use gtk image menu items instead of
	  normal items where appropriate.

Sat Dec 08 11:28:37 2001  George Lebl <jirka@5z.com>

	* gnome-run.c, launcher.c, menu.c, swallow.c:  Use the new desktop
	  item launch api.

2001-12-07  Alex Larsson  <alexl@redhat.com>

	* button-widget.[ch]:
	Draw buttons using gdk-pixbuf instead of libart, should
	be faster and more correct.

	* panel-widget.c (make_background): Take a rowstride arg.
	(queue_resize_on_all_applets): New function
	(send_draw_to_all_applets): Use pixbuf
	(panel_widget_change_params): Queue resize on applets.

2001-12-08  Glynn Foster  <glynn.foster@sun.com>

	* gnome-run.c, gnome-run.h, menu.c,
	panel.c, session.c:  Whack gnome-run button applet thing which
	serves very little purpose.

2001-12-08  Glynn Foster  <glynn.foster@sun.com>

	* launcher.c: (setup_button): Make adding launchers not crash.

Fri Dec 07 14:48:01 2001  George Lebl <jirka@5z.com>

	* xstuff.[ch], basep-widget.c, foobar-widget.c: add an extra type
	  for autohide panels so that windowmanagers can behave more nicely.

2001-12-07  Alexander Larsson  <alla@lysator.liu.se>

	* launcher.c (launcher_file_name):
	mkdir launcer directory if it doesn't exist.

2001-12-06  Alexander Larsson  <alla@lysator.liu.se>

	* panel-widget.c:
	Fixed off-by-one pixel error with expand_major that made broke
	switching between horz/vertical with a tasklist at the end.

2001-12-06  Mark McLoughlin  <mark@skynet.ie>

	* session.c: (session_read_global_config): fix sillys.

2001-12-06  Mark McLoughlin  <mark@skynet.ie>

	* session.c: (session_read_global_config): cast to
	GConfEntry. Weird - gconf does this itself, but it seems
	to break some things.

2001-12-06  Alexander Larsson  <alla@lysator.liu.se>

	* launcher.c (launcher_save):
	launcher_get_unique_file renamed to launcher_get_unique_uri,
	now returns file: uri.

Wed Dec 05 19:04:58 2001  George Lebl <jirka@5z.com>

	* xstuff.[ch], basep-widget.[ch], foobar-widget.c:  Set the WM_STRUT
	  hint for panels

2001-12-05  Alex Larsson  <alexl@redhat.com>

	* launcher.c (create_launcher):
	Don't only load from file: uri's. This makes it at least do something
	for program: uris.

2001-12-05  Glynn Foster  <glynn.foster@sun.com>

	* basep-widget.c: Fix segfault George.
	* session.c: Start using GConfChangeSet. Dunno
	if this is really necessary or not.

2001-12-05  Kjartan Maraas  <kmaraas@gnome.org>

	* foobar-widget.c: Make it use bugzilla.
	* help/no/panel.sgml: Update.
		
Wed Dec 05 13:36:43 2001  George Lebl <jirka@5z.com>

	* aligned-widget.[ch], basep-widget.[ch],
	  border-widget.[ch], drawer-widget.[ch],
	  edge-widget.[ch], floating-widget.[ch],
	  drawer.c, menu.c, panel_config.[ch],
	  session.c, sliding-widget.[ch]:  Remove the avoid
	  on maximize configuration crack.  It was just pure
	  crack.  With WM_STRUT we should be mostly sane
	  on this issue anyway.

	* basep-widget.[ch]: whack some of the old hint stuff
	  and make user the update_winhints virtual method
	  is called

	* applet.c: fix warning.

	* xstuff.[ch]: add some api for atom interning, that
	  caches atoms per display, and be in general more
	  multiple display safe.  Also use X atoms only and
	  not GdkAtoms.  Also implement checking for _NET
	  standard being supported.  We'll screw the old
	  gnome hitns and just have two states:  _NET
	  supported or completely dumb WM (use override
	  redirect).  Add a WM_STRUT setting function (not
	  yet actually used.

2001-12-04 Stephen Browne <stephen.browne@sun.com>

	* gnome-panel-properties.c
	* gnome-panel-properties.glade
	Updated GUI and made enable animations work

2001-12-04  Alex Larsson  <alexl@redhat.com>

	* applet.c (panel_applet_register):
	Call panel_applet_frame_get_expand_flags
	set insert_at_pos to FALSE if !exactpos.

	* panel-applet-frame.[ch]
	(panel_applet_frame_get_expand_flags): new function

	* panel-widget.[ch]:
	Implement expand_major and expand_minor for applets.

2001-12-04  Mark McLoughlin  <mark@skynet.ie>

	Load all global entries at once.

	* panel-gconf.[ch]:
	(panel_gconf_all_global_entries): impl.

	* session.c: (session_read_global_config): use.

2001-12-04  Mark McLoughlin  <mark@skynet.ie>

	Cache "menus-have-icons" and "menus-have-tearoff"
	keys with notification.

	* menu.[ch]:
	(panel_menu_have_icons_notify): impl.
	(panel_menu_have_icons): impl.
	(panel_menu_have_tearoff_notify): impl
	(panel_menu_have_tearoff): impl.
	(setup_title_menuitem), (setup_full_menuitem), (menu_add_tearoff),
	(create_menuitem), (applet_menu_append),
	(setup_menuitem_try_pixmap): upd.

	* tearoffitem.c: (tearoff_item_new): upd.

	* foobar-widget.c: (pixmap_menu_item_new), (add_tearoff): upd.

2001-12-04  Glynn Foster  <glynn.foster@sun.com>

	* main.c: (main), panel-gconf.c, panelglobalconfig.schemas:
	  session.c, session.h:

	Small amount of work to clean up the session stuff..More later.

2001-12-03  Glynn Foster  <glynn.foster@sun.com>

	* extern.c, session.c, session.h: 
	s/load_up_globals/load_global_config. Can't be arsed doing much
	more on this until this evening.
	
	* main.c: The most useful commit of the panel2's history thus 
	far. Use 'I_LOVE_PANEL_CRACK' to get rid of that fucking annoying
	caveat dialog.

2001-12-03  Malcolm Tredinnick <malcolm@commsecure.com.au>
	* menu.c: Replace a bunch of references to .gnome/ with the
	  GNOME_DOT_GNOME constant from <libgnome/gnome-init.h>. For
	  now, this makes everything gravitate to $HOME/.gnome2/.

Sun Dec 02 19:23:25 2001  George Lebl <jirka@5z.com>

	* panel-util.[ch], foobar-widget.c: implement a utility for 'event
	  streching', so that we can accept clicks on the edge of the
	  screen for example in foobar, no matter how wide the border of the
	  panel/menubar is.

Sun Dec 02 15:11:31 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c: get rid of some deprecated menu_bar function usage

Sun Dec 02 14:52:39 2001  George Lebl <jirka@5z.com>

	* foobar-widget.c: fix pixmap loading, do Applications/Actions
	  setup as from nils's proposal (sort of).  Still needs a lot of
	  work.

2001-12-01  Seth Nickell  <snickell@stanford.edu>

	* foobar-widget.c: (foobar_widget_instance_init):

	Change menu name to "Applications" per Nils' panel
	menu design.
	
	* menu.c: (image_menu_shown):

	Icons for upper most menus should be loaded first. Most users
	start reading from top to bottom. When you load icons
	from bottom to top scanning is essentially disrupted until
	all icons are loaded.
	
Sat Dec 01 22:44:28 2001  George Lebl <jirka@5z.com>

	* menu.c: get rid of the large icon stuff, if we already have 
	  a GtkImage for the file we're looking for loaded, just use that,
	  makes the KDE screensaver menu icons load faster then a speeding
	  bullet (among others:).  Also fix the horizontal jump by directly
	  setting the empty image requisition.

Sat Dec 01 21:21:17 2001  George Lebl <jirka@5z.com>

	* menu.c: removed a bit of the jumpiness effect due to menu icons,
	  there is a horizontal one left which I don't understand.  Make sure
	  foldres without an icon get the folder icon.  Only load icons
	  after the item has been shown, meaning that preloading menus won't
	  start hogging the disk, also when an item is hidden it's no
	  longer loaded.  Change behaviour to FILO so that most recently
	  shown items get loaded first.

2001-12-01  Seth Nickell  <snickell@stanford.edu>

	* menu.c: (load_icons_handler), (show_item_menu),
	(setup_full_menuitem_with_size), (start_favourites_menu),
	(create_menuitem), (create_menu_at_fr), (applet_menu_append),
	(create_add_panel_submenu), (setup_menuitem_try_pixmap),
	(make_add_submenu), (make_panel_submenu), (create_panel_submenu),
	(create_desktop_menu), (add_distribution_submenu),
	(add_kde_submenu), (create_root_menu), (load_menu_applet),
	(load_menu_image_deferred):

	Make panel menus use GtkImage rather than GtkPixmap. Furthermore
	convert to using GtkImageMenuItem at the coercion of jrb. This
	does some weird things (note that the height of menu items changes
	pre and post image allocation) which I'll have to repair.

	Got rid of the fake icon stuff since (hypothetically) this should
	be handled by GtkImageMenuItem.
	
Fri Nov 30 17:34:01 2001  George Lebl <jirka@5z.com>

	* *.[ch]: kill PanelOrientation and use GtkOrientation, Kill dialog
	  levels, kill BasePLevels, and kill a bit of cruft

2001-11-30  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.[ch]:
	(panel_applet_frame_save_position): remove base_key arg.
	(panel_applet_frame_save_session): ditto.

	* panel.c: (panel_remove_applets): upd.

	* applet.c: (applet_idle_remove): upd.
	* session.c:
	(save_applet_configuration),
	(panel_session_die): upd.

2001-11-30  Mark McLoughlin  <mark@skynet.ie>

	* panel-gconf.c: (panel_gconf_get_session_key): fix silly.

2001-11-30  Mark McLoughlin  <mark@skynet.ie>

	* panel-gconf.c: (panel_gconf_get_session_key): warn if we
	can't get the client id.

	* session.c: (save_applet_configuration): check the return
	from panel_gconf_get_session_key.

2001-11-30  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.[ch]:
	(panel_applet_frame_save_position): add base_key arg.
	(panel_applet_frame_save_session): impl.
	(panel_applet_frame_finalize): free keys.
	(panel_applet_frame_construct): generate keys.

	* applet.c: (applet_idle_remove): update for
	  panel_applet_frame_save_position change.

	* panel.c: (panel_remove_applets): ditto.

	* session.c: (panel_session_die): ditto.
	(save_applet_configuration): save session.

2001-11-30  Glynn Foster  <glynn.foster@sun.com>

	* panel-gconf.c, panel-gconf.h:
	Added panel_gconf_get_session_key () to return
	session ID based key. Probably not we will end 
	up using eventually, but will do for now

2001-11-29 Stephen Browne <stephen.browne@sun.com>

	* Makefile.am

	added PANELCONFIG_CFLAGS to includes to fix build 
	of gnome-panel-properties

2001-11-29 Stephen Browne <stephen.browne@sun.com>

	* Makefile.am

	Added gnome-panel-properties build target and 
	associated glade stuff.

	* gnome-panel-properties.c

	This is a work in progress but at least its started.
	Mostly ripped this out and started again.
	Now uses libglade and gconf.
	The GEGL Lives on.

2001-11-29  Glynn Foster  <glynn.foster@sun.com>

	* basep-widget.c, button-widget.c,  menu.c,  
	panel-widget.c,  panel_config_global.h,
	panelglobalconfig.schemas, session.c: 

	Changed some of the configuration around to be more 
	sensible. Removed titles on menus code forever. Fix
	bug where launchers/applets would move off the left 
	hand side of the screen.

2001-11-29  Glynn Foster <glynn.foster@sun.com>
	
	* panel-gconf.[ch]: Add some more convience methods.
	Not entirely sure if this is useful yet.

2001-11-29  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (applet_button_press): tidy.

2001-11-28  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c: (basep_border_queue_recalc): use
          g_idle_add instead of gtk_idle_add and save a few
          stackframes.

2001-11-28  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: don't build extern.[ch].

	* applet.c:
	(applet_idle_remove): handle bonobo applets, remove 
	extern stuff.
	(applet_remove_callback): use g_idle_add.
	(applet_callback_callback): fixme for bonobo applets,
	remove extern stuff.

	* applet.h: kill extern stuff.

	* main.c: don't include extern.h. kill panel_in_startup.
	(main): move panel shell registration to panel-shell.h.

	* menu.c:
	(add_test_applet): kill.
	(add_applet): kill.
	(make_add_submenu): kill testing menuitem.

	* panel-applet-frame.[ch]:
	(panel_applet_frame_save_position): impl stub.

	* panel-shell.[ch]:
	(panel_shell_show_error_dialog): impl.
	(panel_shell_register), (panel_shell_unregister): impl.

	* panel.c: kill freeze/thaw changes stuff.
	(orientation_change), (size_change),
	(back_change): kill extern handling.
	(panel_remove_applets): handle bonobo applets.
	(panel_applet_draw): kill.
	(panel_applet_about_to_die): fixme.
	(drag_data_recieved_cb): fixme.
	(panel_widget_setup): don't connect to draw signal.

	* panel_config.c: (config_apply): don't freeze/thaw.

	* session.c:
	(send_tooltips_state): kill.
	(send_applet_session_save): kill.
	(save_applet_configuration): kill extern stuff.
	(panel_session_die): add bonobo applets support.
	(try_evil_config_hacks): kill.
	(init_user_applets): handle bonobo applets.

	* logout.c: don't include extern.h

	* status.c: ditto.

	* swallow.c: ditto.

2001-11-27  Seth Nickell  <snickell@stanford.edu>

	* Makefile.am:

	install .desktop files to datadir/applications
	
	* gnome-panel-properties.desktop:

	Add Categories field

2001-11-28  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am, panelglobalconfig.schema,
	panelglobalconfig.schemas:
	
	I just copied *cough* libgnome.

2001-11-27  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: cleanup enums and marshallers generation.

	* panel-marshal-main.c: remove.

2001-11-27  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: rename binary to gnome-panel-2.

2001-11-27  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: install GNOME_Panel.server again.

2001-11-27  Mark McLoughlin  <mark@skynet.ie>

	* doc/libpanel-applet-changes.txt, 
	  doc/reference/.cvsignore: remove

2001-11-27  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: remove building of libpanel-applet-2.0.

	* GNOME_Panel_TestApplet.server.in, libpanelapplet-2.0.pc.in:
	  panel-applet-private.h, panel-applet-shell.c,
	  panel-applet-shell.h, panel-applet.c,
	  panel-applet.h, test-bonobo-applet.c: move to
	../libpanel-applet, preservin history.

2001-11-27  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: include quick-desktop-reader.h.
	(create_launcher): remove duplicate, redundant call to
	gnome_program_locate_file.

Tue Nov 27 00:42:05 2001  George Lebl <jirka@5z.com>

	* Makefile.am, menu-rh.[ch], distribution.[ch]: whack the redhat
	  menu stuff.  Note this was the OLD redhat menu stuff which was
	  just plain crack.  Though this reduces the overall ugliness
	  quotient of the menu*.c files by quite a bit, but I'll live.

	* panel-utils.[ch], quick-desktop-reader.c, menu.c,
	  menu-properties.c, launcher.c: Make pixmap finding work better
	  also find kde icons from kde2 properly (well ... properly ...
	  somewhat properly).  Load last mapped first for fakes.  Fix
	  the gtk_menu_reposition hack to be shorter but just as evil.

2001-11-27  Glynn Foster  <glynn.foster@sun.com>

	* menu.c, panel.c: Revert Mark's reverts...Yay, commit war!

	s/g_signal_connect_object/g_signal_connect/swapped
	s/g_signal_disconnect_by_func/g_signal_handlers_disconnect_by_func

2001-11-26  Mark McLoughlin  <mark@skynet.ie>

	* menu-fentry.c: (fr_fill_dir), (fr_read_dir): #ifdef out
	  debugging messages.

	* quick-desktop-reader.c: (quick_desktop_item_load_uri): ditto.

	* menu.c: (fake_mapped_fake), (show_item_menu),
	(create_menu_at_fr): revert g_signal_connect_object changes
	back to gtk_signal_connect_object. Giving out warnings and not
	sure how to fix it.
	Use g_signal_handlers_disconnect_matched instead of
	g_signal_disconnect_by_func which doesn't exist.

	* panel-widget.c: (panel_widget_applet_event):
	reverse order of params in g_signal_lookup calls.

	* panel.c: (basep_pos_connect_signals): revert
	 g_signal_connect_object changes back to 
	 gtk_signal_connect_object. Giving out warnings and not sure
	 how to fix it.

2001-11-26  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: cleanup libpanel-applet-2 building. Add
	  GNOME_Panel_TestApplet.server.in to EXTRA_DIST.
	
	* doc/reference/Makefile.am:
	* doc/reference/panel-applet-docs.sgml:
	* doc/reference/panel-applet-sections.txt:
	* doc/reference/panel-applet.types:
	* doc/reference/tmpl/panel-applet-unused.sgml:
	* doc/reference/tmpl/panel-applet.sgml: move to
	  ../doc/reference/panel-applet.

2001-11-26  Glynn Foster  <glynn.foster@sun.com>

	* applet.c: * drawer.c: * extern.c: * gnome-panel-screenshot.c: 
	* gnome-run.c: * menu.c: * nothing.cP: * panel-util.c: 
	* panel-widget.c: * panel.c: * panel_config.c: * session.c: 
	* status-docklet.c: * status.c: * swallow.c: 

	I see a glorious dream for the panel. Using no deprecated stuff
	for the 2.0 release. This brings us one step closer to that dream.
	Some more gtk_signal_* porting. Now there is only the weird stuff
	left that I don't know what to do with.
	
2001-11-26  Glynn Foster  <glynn.foster@sun.com>

	* launcher.c, session.c: Quick hack to get launchers on the panel
	again. Don't expect it to be working 100% of the time. We really
	need to get this stuff using gnome-vfs all over.

2001-11-26  Glynn Foster  <glynn.foster@sun.com>

	* drawer.c: * extern.c: * foobar-widget.c: 
	* gnome-panel-properties.c: * gnome-panel-screenshot.c: 
	* gnome-run.c: * launcher.c: * logout.c: * main.c:
	* menu-properties.c: * menu.c: * nothing.cP: * panel-marshal.list:
	* panel-util.c: * panel-widget.c: * panel.c: * panel_config.c:
	* session.c: * sliding-widget.c: * status-docklet.c: * status.c: 
	* swallow.c: 

	More gtk_signal donkey work. The gtk_signal stuff that is left is 
	a) cruft that we're gonna lose b) stuff that I don't know the 
	GObject replacement for.

Mon Nov 26 00:57:16 2001  George Lebl <jirka@5z.com>

	* applet.c, menu-properties.[ch], menu.[ch], panel.c, session.c:
	  get rid of the "." main menu parameter hack.  I feel sort of
	  sentimental removing this since this dates back from the days
	  when federico maintained the panel.  I don't know why it lived
	  on so long anyway :)

	* menu.c: remove the properties menu stuff, just about everyone
	  agreed it was quite a horrible UI

	* foobar-widget.c, menu.c, panel-util.[ch]: add
	  panel_is_program_in_path which is like g_find_program_in_path
	  but returns just a boolean

	* menu.h, session.c: remove some compatibility hacks dating to
	  some ancient 1.0 versions or whatnot.  We'll break config compat
	  anyway.

Sun Nov 25 20:07:06 2001  George Lebl <jirka@5z.com>

	* launcher.c, menu.c, menu-fentry.[ch], main.c: remove the
	  merged menu hack since that's taken care of in the
	  vfolder-desktop-method nowdays

	* quick-desktop-reader.[ch], panel-util.[ch]: add sort_order
	  to quick desktop item and move the vfs helper routines to
	  the util file

	* menu-fentry.[ch], menu.c, menu-properties.c: port to gnome-vfs
	  and use the programs:/ and favorites:/ uri schemes

	* test-bonobo-applet.c: fix some warnings

2001-11-23  Mark McLoughlin  <mark@skynet.ie>

	* doc/libpanel-applet-changes.txt, doc/panel-decl.txt,
	  doc/panel-sections.txt, doc/panel.hierarchy, doc/panel.sgml,
	  doc/panel.signals, doc/panel.types,
	  doc/tmpl/applet-widget.sgml, doc/tmpl/interact.sgml,
	  doc/tmpl/menu.sgml, doc/tmpl/misc.sgml,
	  doc/tmpl/status-docklet.sgml: remove old docs.

2001-11-23  Mark McLoughlin  <mark@skynet.ie>

	* doc/Makefile.am: disable building old docs.

	* doc/reference/*: added new docs.

	* panel-applet-frame.[ch], panel-applet.[ch],
	  panel.c, test-bonobo-applet.c: s/colour/color/g before I
	cause mayhem with our stateside friends :-)

	* panel-applet-frame.c: add docs.

2001-11-23  Glynn Foster  <glynn.foster@sun.com>

	* aligned-widget.c, basep-widget.c, border-widget.c,
	  button-widget.c, drawer-widget.c, edge-widget.c,
	  floating-widget.c, panel-marshal.list: 
	
	Monkey work. Some more unstructured gtk_signal to g_signal
	porting. I should be doing the gconf stuff, but I've got
	a hangover.

2001-11-23  Mark McLoughlin  <mark@skynet.ie>

	* GNOME_Panel_TestApplet.server.in: add "panel:icon" and
	"panel:category" attributes.

	* menu.c:
	(setup_full_menuitem_with_size): only query gconf once.
	(create_menuitem): improve code path.
	(make_add_submenu): remove test items.
	(applet_menu_get_category_icon), (applet_menu_append),
	(add_bonobo_applet), (create_applets_menu): impl creating the
	'Add Applet' menu by querying bonobo-activation.

	* panel-applet-frame.c: (panel_applet_frame_construct): bomb
	out if loading fails.

2001-11-23  Alexander Larsson  <alla@lysator.liu.se>

	* menu.c:
	Add test for clock applet.

2001-11-21  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: kill gtk_widget_lock_accelerator 
	usage completely.

2001-11-21  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add panel-applet.c to libpanel-applet 
	sources - hmmm.

	* menu.c:
	(add_test_bonobo_applet): take an iid to be generic.
	(make_add_submenu): add an menuitem for the fish. Jeez, I need
	to get this applets menu work soon.

	* panel-applet.h: fix party pooper.

	* test-bonobo-applet.c: remove debugging rubish. Use
	G_CALLBACK instead of (GCallback) cast.

2001-11-21  Glynn Foster  <glynn.foster@sun.com>

	* aligned-widget.c, basep-widget.c, menu-fentry.c,
	panel-widget.c: 

	Moving over to g_signal. Part One of a many taled epic.

Tue Nov 20 19:37:15 2001  Owen Taylor  <otaylor@redhat.com>

	* quick-desktop-reader.h: Change include to glib-object.h.

2001-11-20  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: build libpanel-applet-2 with the new
	applet stuff. Install the new headers.

2001-11-20  Mark McLoughlin  <mark@skynet.ie>

	Use BonoboProperty bags ... sigh ... someone shoulda told me ...

	* panel-applet-frame.c: 
	(panel_applet_frame_change_orient),
	(panel_applet_frame_change_size),
	(panel_applet_frame_change_background_pixmap),
	(panel_applet_frame_change_background_colour),
	(panel_applet_frame_clear_background): use bonobo_pbclient_*
	(panel_applet_frame_construct): get property bag.

	* panel-applet-shell.c, panel-applet-private.h:
	kill useless functions, we now have a very useful useless
	PanelAppletShell object. 

	* panel-applet.c: 
	(panel_applet_parse_colour), (panel_applet_get_prop),
	(panel_applet_set_prop), (panel_applet_property_bag): impl
	property bag stuff.
	(panel_applet_class_init): tweak signal defs.
	(panel_applet_construct): setup the property bag.

	* panel-widget.c: (panel_widget_class_init): tweak signal def.

	* test-bonobo-applet.c:
	(test_applet_new): do a size change so the entry will have
	some text before it gets a size change.

	* Makefile.am: add panel-applet.h to glib-mkenus list.

2001-11-19  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.[ch]: 
	(panel_applet_frame_change_background),
	(panel_applet_frame_change_background_pixmap),
	(panel_applet_frame_change_background_colour),
	(panel_applet_frame_clear_background): impl.

	* panel-applet-shell.c:
	(impl_GNOME_PanelAppletShell_changeBackground): impl.
	(panel_applet_shell_class_init): upd.

	* panel-applet.[ch], panel-applet-private.h: 
	(panel_applet_set_background_colour),
	(panel_applet_set_background_pixmap),
	(panel_applet_clear_background): impl.
	(panel_applet_class_init): register "change_background"
	signal.

	* panel-marshal.list: add VOID:ENUM,POINTER,STRING.

	* panel.c: (back_change): update for bonobo applets.

	* test-bonobo-applet.c:
	(test_applet_handle_background_change): impl - just print out
	a message for now.

2001-11-19  Mark McLoughlin  <mark@skynet.ie>

	* panel-widget.c (panel_widget_class_init): give proper GType
	instead of G_TYPE_ENUM. 

2001-11-19  Mark McLoughlin  <mark@skynet.ie>

	* menu.[ch]:
	(update_size_menu), (make_properties_submenu): also change
	menu size names to something sensible.

2001-11-19  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.[ch]: 
	(panel_applet_frame_change_size): impl.

	* panel-applet-shell.c: 
	(impl_GNOME_PanelAppletShell_changeSize): impl.
	(panel_applet_shell_class_init): upd.

	* panel-applet.[ch], panel-applet-private.h: 
	(panel_applet_change_size): impl.
	(panel_applet_class_init), (panel_applet_instance_init): upd.

	* panel-marshal.list: add VOID:INT.

	* test-bonobo-applet.c: 
	(test_applet_handle_size_change): impl - set text size when
	panel size changes.

	* panel-types.h: change from SIZE_RIDICULOUS to
	PANEL_SIZE_XX_LARGE etc.

	* drawer.c: (create_empty_drawer_applet): upd.

	* extern.c: (s_panelspot_get_parent_size): upd.

	* foobar-widget.c: (foobar_widget_instance_init): upd.

	* menu.c: 
	(create_new_panel), (update_size_menu): upd.
	(make_properties_submenu): change menuitem labels.

	* panel.c: (size_change): upd.

	* panel_config.c: 
	(update_config_size), (make_size_widget): upd.

	* session.c: (init_user_panels): upd.

2001-11-19  Glynn Foster  <glynn.foster@sun.com>

	aligned-widget.c, aligned-widget.h, basep-widget.c,
	edge-widget.h, menu.c, panel-widget.c, panel.c, 
	panel_config.c, status-docklet.c, status-docklet.h,
	tearoffitem.c, tearoffitem.h:

	So I grepped for GtkType and realised that I had missed
	several files. I suck. More GtkType->GType conversion.
	Also unset GTK_NO_WINDOW from the GtkFixed panel-widget
	that broke because of gtk+ changes.	

2001-11-19  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am: Fix one more instance of the new
	glib-object.h stuff...Guess this one got lost under the
	carpet.

Mon, 19 Nov 2001 00:55:44 -0500 Frank Belew <frb@ximian.com>

	* Makefile.am: added panel-shell.h to panel_headers
		       added panel-marshal.list to EXTRA_DIST
	* APPLET_WRITING, gnome-panel-add-launcher.c, gnome-panel-properties.c,i
	  gnome-panel-screenshot.c, main.c, doc/panel.sgml: replaced PACKAGE
	  with GETTEXT_PACKAGE on all calls to bindtextdomain and textdomain

Sun Nov 18 21:24:24 2001  George Lebl <jirka@5z.com>

	* gnome-panel-screenshot.c, launcher.c, menu-properties.c,
	  panel_config.c, menu.c: s/GnomeDialog/GtkDialog/, reenable menu
	  properties again and port the .directory editting in menu.c

2001-11-18  Miles Lane  <miles@megapathdsl.net>

	* quick-desktop-reader.c: replace includes of
	<gobject/[genums, gboxed, gclosure and gvaluetypes].h
	with one include of <glib-object.h>.
	* panel-marshal-main.c:  replace include of
	<gobject/gboxed.h> with include of <glib-object.h>.
	Approved by Michael Meeks
	
Sun Nov 18 18:57:34 2001  George Lebl <jirka@5z.com>

	* swallow.c, extern.c: a bit of s/GnomeDialog/GtkDialog/

2001-11-18  Glynn Foster  <glynn.foster@sun.com>

	* applet.c: * basep-widget.c: * basep-widget.h: * button-widget.c: 
	* button-widget.h: * drawer-widget.c: * drawer-widget.h:
	* drawer.c: * edge-widget.c: * edge-widget.h: * floating-widget.c: 
	* floating-widget.h: * foobar-widget.c: * foobar-widget.h: * launcher.c: 
	* logout.c: * main.c: * menu-util.c: * menu.c: * multiscreen-stuff.c: 
	* panel-applet-frame.c: * panel-widget.c: * panel-widget.h: * panel.c: 
	* panel_config.c: * session.c: * sliding-widget.c: * sliding-widget.h:
	
	Finish off moving GtkType to GType and give a more consistant approach
	to all the header stuff.

Sun Nov 18 00:52:58 2001  George Lebl <jirka@5z.com>

	* Makefile.am, main.c:  set the standard gnome program properties

	* gnome-run.c, menu.c, panel-util.[ch]:  A little bit of
	  s/GnomeDialog/GtkDialog/

	* panel-util.[ch]: error box is now actually closable,
	  added an info box, and function to make dialog 'busy'

	* main.c, menu-fentry.[ch]: whack the mem chunks stuff

	* menu-fentry.c, menu.c, quick-desktop-item.[ch]: Lookup icons
	  before loading them, not during the creation of the menus

	* menu.c: convert one more ditem usage to qitem

	* menu-properties.c: get rid of gnome_icon_entry_gtk_entry usage

Fri Nov 16 22:13:22 2001  George Lebl <jirka@5z.com>

	* quick-desktop-reader.[ch], Makefile.am, gnome-run.c, menu-fentry.c:
	  Implement a quick no-frills .desktop reader to make reading
	  .desktop files quicker and less memory heavy.

	* gnome-run.c, menu.c: use the NO_TRANSLATIONS flag of gnome-desktop
	  where appropriate

	* applet.c, foobar-widget.c, global-keys.c, gnome-run.c,
	  menu-fentry.c, menu-properties.c, menu.c, panel.c, 
	  session.c, panel-util.[ch]: move to g_path_is_absolute,
	  g_find_program_in_path, g_shell_parse_argv and
	  g_ascii_strcasecmp

	* gnome-run.c: whack the usage of gnome-pixmap

Fri Nov 16 13:47:27 2001  George Lebl <jirka@5z.com>

	* Makefile.am: remove $(includedir) from includes to prevent old
	  gnome headers from creeping in

	* status.c: fix compilation a little.

2001-11-16  Mark McLoughlin  <mark@skynet.ie>

	Note: this won't build without the patch to 
	      glib-mkenums attached to #64714

	* panel-applet-frame.[ch]: 
	(panel_applet_frame_load): renamed from 
	panel_bonobo_applet_load.
	(panel_applet_frame_change_orient): impl.
	(panel_applet_frame_get_applet_shell): impl.
	(panel_applet_frame_construct): get applet shell.

	* panel-applet.[ch]: 
	(panel_applet_change_orient): impl.
	(panel_applet_class_init): add "change_orient" signal.
	(panel_applet_instance_init): set default orient.
	(panel_applet_construct): instantiate an applet shell.

	* panel-applet-shell.[ch], panel-applet-private.h:
	implementation of PanelAppletShell.

	* panel-marshal.list: add VOID:ENUM.

	* panel-shell.c: s/runBox/displayRunDialog/.

	* panel.c: (orientation_change): do bonobo applet 
	orient change.

	* test-bonobo-applet.c: handle orient change and give an
	example of how applet tooltips should be done with the new
	api.

	* Makefile.am: add marshalers and enums to applet sources.
	Generate enums from GNOME_Panel.h.

2001-11-15  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c: (popup_handle_verb): kill.
	(popup_handle_move): impl.

2001-11-15  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.[ch]: inherit from GtkEventBox
	(popup_handle_remove), (panel_applet_frame_set_info),
	(panel_applet_frame_finalize), (panel_applet_frame_class_init),
	(panel_applet_frame_instance_init), (panel_applet_frame_get_type),
	(panel_applet_frame_construct), (panel_applet_frame_new): impl.
	(panel_bonobo_applet_load): upd.

2001-11-15  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet.[ch]: update to use GType stuff 
	instead of GtkType.

2001-11-15  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet.c: 
	(panel_applet_setup_menu), only set the popups path, not the
	button3 path - seems we can't insert a list of xml nodes.
	(panel_applet_factory_main): impl.

	* panel-applet.h: nice bonobo factory api.

	* test-bonobo-applet.c: upd.

2001-11-15  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet.[ch]: (panel_applet_setup_menu),
	(panel_applet_setup_menu_from_file): impl convience functions.

	* test-bonobo-applet.c: (test_applet_new): use.

2001-11-15  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet.c, panel-applet.h: start of bonobo applet API.

	* panel-applet-frame.c: add popup menus.

	* test-bonobo-applet.c: ditto.

	* Makefile.am: upd.

2001-11-15  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c, drawer-widget.c, drawer.c: switch 
	debugging off.

	* launcher.c: (ask_about_launcher): change order of buttons as
	per usability propaganda :-)

2001-11-15  Glynn Foster  <glynn.foster@sun.com>

	* menu.c: Fix up compilation by commenting out the
	lock accelerator stuff

2001-11-14  Glynn Foster  <glynn.foster@sun.com>

	* aligned-widget.c, aligned-widget.h, basep-widget.c,
	* border-widget.c, border-widget.h, drawer-widget.c,
	* drawer.c, edge-widget.c, edge-widget.h,
	* foobar-widget.c, menu.c, panel-gconf.c, panel.c,
	* panel_config.c, panelglobalconfig.schema, session.c,
	* sliding-widget.c, sliding-widget.h:

	Fix gconf leaks - thanks to andersca
	Change the schema to cover over a problem with autohide
	panels [still needs to be fixed].
	More GObject porting and header standardization.

2001-11-12  Frank Belew  <frb@ximian.com>

	* Makefile.am: comment out SUBDIRS to fix dist targets

2001-11-12  Glynn Foster  <glynn.foster@sun.com>

	* launcher.c, main.c, session.c:, session.h: Fix up 
	  launcher loads a little so that the launchers load up
	  on the panel.

2001-11-09  Mark McLoughlin  <mark@skynet.ie>

	* session.c, session.h: move dead launchers stuff in here.

	* applet.c, applet.h: update.

2001-11-09  Mark McLoughlin  <mark@skynet.ie>

	* applet.c, applet.h: bit of namespace loving.

	* drawer.c, extern.c, gnome-run.c, launcher.c, 
	  logout.c, menu-properties.c, menu.c, 
	  panel-applet-frame.c, panel.c, session.c, 
	  status.c, swallow.c: update.

2001-11-09  Mark McLoughlin  <mark@skynet.ie>

	* applet.c, applet.h: kill horrible applets_last hack.

	* drawer.c: (load_drawer_applet):
	* drawer.h:
	* extern.c: (reserve_applet_spot):
	* gnome-panel-properties.c:
	* gnome-run.c: (load_run_applet):
	* launcher.c: (load_launcher_applet_full):
	* logout.c: (load_logout_applet), (load_lock_applet):
	* menu.c: (add_drawers_from_dir), (load_menu_applet):
	* panel-applet-frame.c: (panel_bonobo_applet_load):
	* panel.c: (panel_applet_added), (drag_data_recieved_cb):
	* status.c: (load_status_applet):
	* swallow.c: (load_swallow_applet): update to use return val
	of panel_applet_register instead of applets_last.

2001-11-09  Mark McLoughlin  <mark@skynet.ie>

	* applet.c, applet.h: (panel_register_applet): renamed from
	register_toy. Return an AppletInfo *.

	* drawer.c: (load_drawer_applet):
	* extern.c: (reserve_applet_spot):
	* gnome-run.c: (load_run_applet):
	* launcher.c: (load_launcher_applet_full):
	* logout.c: (load_logout_applet), (load_lock_applet):
	* menu.c: (load_menu_applet):
	* panel-applet-frame.c: (panel_bonobo_applet_load):
	* panel.c: (panel_applet_added), (drag_data_recieved_cb):
	* status.c: (load_status_applet):
	* swallow.c: (load_swallow_applet): update.

2001-11-09  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: tidy up popup menu handling.

	* applet.h: (show_applet_menu): privatise.

	* basep-widget.c, border-widget.c, extern.c, menu-util.c:
	
	* menu.c: (show_item_menu_b_cb): kill unused.

2001-11-08  Glynn Foster  <glynn.foster@sun.com>

	* applet.c, basep-widget.c, button-widget.c,
	  menu-util.c, menu.c, panel-gconf.c, panel-gconf.h:
	  panel-types.h, panel_config_global.h, panelglobalconfig.schema,
	  session.c: More shifting towards gconf - some renames of variables
	  lots of FIXME's.

2001-11-08  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c: (basep_pos_get_hide_size),
	(basep_pos_get_hide_pos), (basep_widget_do_hiding),
	(basep_widget_do_showing), (basep_widget_explicit_hide),
	(basep_widget_explicit_show), (basep_widget_autoshow),
	(basep_widget_queue_autoshow), (basep_widget_autohide),
	(basep_widget_queue_autohide): update gconf key names.

	* floating-widget.c: (floating_pos_get_hide_size),
	(floating_pos_get_hide_pos): ditto.

2001-11-08  Glynn Foster  <glynn.foster@sun.com>

	* panelglobalconfig.schema: Update. Well actually
	fix :)

2001-11-08  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: install schema using gconftool.

2001-11-08  Mark McLoughlin  <mark@skynet.ie>

	* basep-widget.c, button-widget.c, menu-fentry.c
	  menu-properties.c, menu-rh.c, menu-util.c, menu.c,
	  panel-widget.c, session.c, status.c: sensible debugging
	defines. undef them all so warnings don't get lost.

2001-11-07  Mark McLoughlin  <mark@skynet.ie>

	* launcher.c: (is_this_drop_ok): use GDK_POINTER_TO_ATOM
	instead of GPOINTER_TO_UINT.

	* menu-fentry.c: (get_applet_goad_id_from_ditem) make static.

	* panel.c: (get_target_list): impl.
	(is_this_drop_ok): kill GPOINTER_TO_UINT atom usage.

	* tasklist_icon.c: (tasklist_icon_check_mini): use GdkAtom.

	* xstuff.[ch]: (xstuff_nautilus_desktop_present),
	(xstuff_set_simple_hint), (status_event_filter),
	(get_typed_property_data), (send_client_message_1L),
	(xstuff_setup_global_desktop_area), (xstuff_setup_desktop_area),
	(xstuff_unsetup_desktop_area): bunch of GdkAtom/Atom related
	warnings fixage.

2001-11-7   Glynn Foster  <glynn.foster@sun.com>

	* basep-widget.c: Fix bug in set_property call.

2001-11-07  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am, basep-widget.c, floating-widget.c, panel-gconf.c,
	  panel-gconf.h, panel_config_global.h, session.c, session.h: 

	  More property stuff...mostly dumb stuff though. Added installation
	  of schema too.

2001-11-05  Glynn Foster  <glynn.foster@sun.com>

	* Makefile.am, basep-widget.c, border-widget.c,
	  floating-widget.c, foobar-widget.c, gnome-panel-properties.c,
	  main.c, main.h, menu.c, panel-gconf.c, panel-gconf.h, panel-widget.c,
	  panel-widget.h, panel_config_global.h, panelglobalconfig.schema,
	  session.c, tearoffitem.c: More work getting the global properties into
	  shape. Removed the option to have the movement type in the capplet - these
	  are now a keybinding only - according to usability happiness. Also moved
	  basep, basepos over to gobject a little bit more. Added the startings of
	  a wrapper around gconf stuff for panel config.

2001-11-05  Mark McLoughlin  <mark@skynet.ie>

	* gnome-run.c: (show_run_dialog): change order of buttons as
	per usability recommendations.

2001-11-05  Mark McLoughlin  <mark@skynet.ie>

	* panel-applet-frame.c: 
	(panel_bonobo_applet_widget): impl. Wrap the windowless 
	BonoboWidget in a GtkEventBox so we can catch events.
	(panel_applet_load): rename to panel_bonobo_applet_load.

	* panel-applet-frame.h: upd.

	* menu.c: (add_test_bonobo_applet): upd.

2001-11-05  Mark McLoughlin  <mark@skynet.ie>

	* applet.c: (applet_button_press): only propagate event to
	button widgets.

2001-11-01  Mark McLoughlin  <mark@skynet.ie>

	A first stab at BonoboControl based applets. It works
	suprisingly well for 84 lines of code :)

	* panel-applet-frame.c, panel-applet-frame.h: new files.
	BonoboControl based applet support.

	* applet.h: add new AppletType - APPLET_BONOBO.

	* menu.c: (add_test_bonobo_applet): impl.
	(make_add_submenu): add new menuitem to activate a
	test bonobo applet.

	* test-bonobo-applet.c: BonoboControl based test applet.

	* GNOME_Panel_TestApplet.server.in: add TestBonoboApplet.

	* Makefile.am: upd.

2001-11-01  Mark McLoughlin  <mark@skynet.ie>

	* applet-object.c: (applet_object_panel_quit), (applet_object_new):
	free panel CORBA refs.

	* applet-widget.c: kill applet_count stuff.

2001-11-01  Mark McLoughlin  <mark@skynet.ie>

	* applet-object.c: (impl_GNOME_Applet2_back_change): add case
	for PANEL_BACK_NONE.

	* main.c: (main): set BONOBO_ACTIVATION_DEBUG_OUTPUT for easy
	applet debugging.

	* applet-init.c, applet-init.h:, applet-widget.c, 
	  test-applet.c: remove crufty debugging stuff. sigh.

2001-11-01  Mark McLoughlin  <mark@skynet.ie>

	* panel-util.c: (panel_show_help): update for gnome-help
	changes.

2001-11-01  Glynn Foster  <glynn.foster@sun.com>

	* applet.c: * basep-widget.c: * basep-widget.h:
	* border-widget.c: * border-widget.h: * button-widget.c: 
	* conditional.c: * conditional.h: * drawer-widget.c: 
	* drawer-widget.h: * drawer.c: * extern.c: * floating-widget.c: 
	* floating-widget.h: * foobar-widget.c: * global-keys.c: 
	* menu-util.c: * menu.c: * multiscreen-stuff.c: * panel.c: 
	* panel_config.h: * session.c: * xstuff.c:

	Start shifting stuff slowly over towards a more GObject approach and
	making things a little bit more consistant with the type defs.
	
2001-10-31  Mark McLoughlin  <mark@skynet.ie>

	* applet-widget.c: kill old goad factory stuff.

	* applet.c, applet.h, extern.c, panel-widget.c:
	move various definitions of APPLET_EVENT_MASK to
	applet.h.

2001-10-26  Mark McLoughlin  <mark@skynet.ie>

	* GNOME_Panel_TestApplet.server.in: s/TestApplet/Panel_TestApplet/g

	* applet-init.c, applet-init.h: crufty debugging functionality.
	(applet_debug_log), (applet_debug_init): impl.
	(applet_factory_main): use it.

	* extern.c: use Applet2 interface.

	* menu.c: (add_test_applet): s/TestApplet/Panel_TestApplet/g.

	* test-applet.c: use logging.

2001-10-25  Mark McLoughlin  <mark@skynet.ie>

	* applet-widget.c, applet-widget.h: kill applet_widget_init.

	* applet-init.c, applet-init.h: new files - init related stuff
	for libpanel-applet-2.

	* GNOME_Panel_TestApplet.server.in,  test-applet.c:
	simple applet for testing purposes. It doesn't work.

	* Makefile.am: update build.

	* extern.c: cosmetics.

2001-10-25  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (menus_have_icons): use gconf.

2001-10-25  Mark McLoughlin  <mark@skynet.ie>

	* session.c: (load_up_globals), (write_global_config),
	(convert_write_config): remove tile_when_over usage.

2001-10-25  Glynn Foster  <glynn.foster@sun.com>

	* panelglobalconfig.schema: First stab at creating 
	 a schema for the panel global config.

2001-10-25  Glynn Foster  <glynn.foster@sun.com>

	* panel_config_global.h: Remove some tile cruft.

2001-10-24  Mark McLoughlin  <mark@skynet.ie>

	* Makefile.am: add WARN_CFLAGS to INCLUDES. Clean up
	  panel-marshal rules. Build libpanel-applet-2. Install
	  applet headers in gnome-2.0/panel/applet.

	* libpanelapplet-2.0.pc.in: update.

	* applet-object.c: s/IS_APPLET_OBJECT/APPLET_IS_OBJECT/.
	(applet_object_panel): return panel_client.
	(applet_object_panel_quit): impl.
	(impl_GNOME_Applet2_do_callback): kill unused variable.

	* applet-widget.c: 
	(marshal_signal_save), (marshal_signal_back):
	s/G_CLOSURE_SWAP_DATA/G_CCLOSURE_SWAP_DATA/
	(applet_widget_destroy): use gtk_main_quit ().
	(gnome_panel_client): kill.
	(applet_widget_get_rgb_background): rename from
	applet_widget_get_rgb_bg.
	(applet_widget_gtk_main, applet_widget_gtk_main_quit,
	 applet_widget_panel_quit): kill.

	* applet-object.h: kill applet_object_register and
	applet_object_get_rgb_background. Add applet_object_panel_quit.

	* applet-widget.h: kill HAVE_* defines.

	* applet-private.h: new header for libpanel-applet private
	functions.

	* doc/libpanel-applet-changes.txt: document applet API changes.

	* basep-widget.c: 
	(basep_widget_do_hiding), (basep_widget_do_showing): use g_usleep,
	not usleep.
	(basep_widget_explicit_hide), (basep_widget_explicit_show),
	(basep_widget_autoshow), (basep_widget_autohide): kill unused
	supinfo variables.

	* conditional.c: #ifdef FIXME updates.

	* extern.c: ditto and 
	(extern_ref, extern_unref, extern_clean): make static
	(s_panel_add_launcher_from_info): kill unused exec_argv.

	* foobar-widget.c: #ifdef FIXME updates and
	(get_default_image): kill unused variables.

	* launcher.c: (create_properties_dialog), (load_launcher_applet_full),
	(ask_about_launcher): kill unused variables.

	* main.c: (panel_get_shell): make static.

	* menu-properties.c: #ifdef FIXME updates

	* menu.c: (add_new_app_to_menu), (edit_dentry): kill unused
	variables.

	* nothing.cP: #ifdef FIXME updates

	* panel-util.c: ditto.

	* panel-marshal-main.c: include panel-marshal.h.

	* panel_config.c: (update_config_back): make text const.

	* session.c: (apply_global_config), (load_up_globals),
	(write_global_config), (convert_write_config),
	(convert_read_old_config): kill unused variables.

	* button-widget.c: (button_widget_draw): ditto.

2001-10-24  Glynn Foster  <glynn.foster@sun.com>

	* button-widget.c, button-widget.h, drawer.c,
	gnome-run.c, launcher.c, logout.c, menu.c,
	panel-types.h, panel_config_global.h, session.c,
	session.h: A first blast of getting rid of the panel
	tiling. Still probably lots of crufty code that can be
	removed.

2001-10-23  Mark McLoughlin  <mark@skynet.ie>

	* applet-widget.c, applet-widget.h: remove all
	corba related stuff.

	* applet-object.c, applet-object.h: implement GNOME:Applet2
	as a BonoboObject.

2001-10-23  Mark McLoughlin  <mark@skynet.ie>

	* applet-widget.c, applet-widget.h: some cosmetics.

2001-10-22  Mark McLoughlin  <mark@skynet.ie>

	Beginning of a proper port from GOAD to bonobo-activation.

	* applet-widget.c, applet-widget.h: start the port. Not
	finished yet, though.
	(custom_servant_destroy): renamed from applet_servant_destroy.
	(gnome_panel_client): impl.
	(custom_servant_activate): renamed from gnome_panel_applet_corba_init.
	(applet_widget_init): use gnome_program_init.
	Elsewhere do s/goad_id/iid/g and use bonobo-activation.

	* extern.c, extern.h: s/goad_id/iid/g
	(extern_activate): renamed from extern_start_new_goad_id.

	* main.c: (main): use GNOME_PARAM_NONE.

	* menu.c: (add_test_applet), (make_add_submenu): add temporary
	menuitem to load a test applet.

	* panel.c: (drag_data_recieved_cb):
	* session.c: (init_user_applets): #ifdef FIXME all other
	applet loading.

2001-10-22  Mark McLoughlin  <mark@skynet.ie>

	* extern.c: (extern_shutdown): release the panel object.

	* menu.c: (make_panel_submenu): add the tearoff to the submenu,
	not the menu itself.

2001-10-22  Mark McLoughlin  <mark@skynet.ie>

	* extern.c, extern.h: 
	(extern_save_applet): renamed from save_applet.
	(s_panelspot_done_session_save): upd.
	(extern_shutdown): renamed from panel_corba_clean_up.
	Unregister the GNOME::Panel object.

	* session.c: (send_applet_session_save),
	(panel_session_die): upd.

2001-10-22  Mark McLoughlin  <mark@skynet.ie>

	* main.c: (main): activate old panel object as well for the
	moment.

	* GNOME_Panel.server.in: kill PanelShell_Factory - there's no
	factory. Add GNOME_Panel.

	* extern.c: (extern_init): clean up. 

2001-10-19  jacob berkman  <jacob@ximian.com>

	* various: s/gnome-panel.h/GNOME_Panel.h/
	
	* GNOME_Panel.server.in: real .server file

	* panel-shell.[ch]: global corba object - will be used by applets
	to find the panel.  this might not get used - making GNOME_Panel a
	BonoboObject could do the trick as well, but i didn't want to
	touch that yet.

	* main.c (main): create a shell object and register with
	bonobo-activation. if there is already a panel or we couldn't
	register, abort.

2001-10-19  Mark McLoughlin  <mark@skynet.ie>

	* extern.c, extern.h: 
	(extern_load_applet): renamed from load_extern_applet.
	(extern_load_queued): renamed from load_queued_externs.
	(extern_init): renamed from panel_corba_gtk_init.
	(extern_start_new_goad_id), (reload_applet_callback),
	(extern_clean), (send_position_change),
	(panel_corba_clean_up), (s_panel_add_applet_full),
	(s_panel_add_status), (send_draw):
	(extern_activate_panelspot): cleaned up.

	* main.c: (main): 
	* menu.c: (add_applet):
	* panel.c: (drag_data_recieved_cb):
	* session.c: (try_evil_config_hacks), (init_user_applets):
	* status.c: (status_spot_remove): update.

2001-10-19  Glynn Foster  <glynn.foster@sun.com>

	* basep-widget.c, gnome-panel-properties.c,
	* panel_config_global.h, session.c: Remove
	'hide_panel_frame' which now defaults to FALSE. So whether
	buttons are flush with the panel depends on background type
	only. Another useless property best removed :)

2001-10-19  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_menu_at_fr), (create_desktop_menu),
	(create_root_menu): fix some silly bugs of mine.

2001-10-19  Mark McLoughlin  <mark@skynet.ie>

	* menu.c: (create_root_menu): fix dumb bug.

	* menu-properties.c: (create_properties_dialog):
	port gnome_file_entry_set_directory.

2001-10-19  Mark McLoughlin  <mark@skynet.ie>

	* panel_config.c: (update_config_back), (value_changed),
	(background_page): gnome_pixmap_entry_gtk_entry to
	gnome_file_entry_gtk_entry.

2001-10-19  Glynn Foster <glynn.foster@sun.com>

	* menu.c: added casts to GTK_MENU to remove some compile
	  warnings 

2001-10-19  Mark McLoughlin  <mark@skynet.ie>

	* bad-applet.c: (main): ported to new stcok icons.

	* foobar-widget.c: (append_gnome_menu): ditto.

	* gnome-run.c: (show_run_dialog), (load_run_applet): ditto.

2001-10-18  Mark McLoughlin  <mark@skynet.ie>

	* applet.c, basep-widget.c, button-widget.c,
	  conditional.c, drawer.c, extern.c, foobar-widget.c
	  gnome-panel-properties.c, gnome-panel-screenshot.c
	  gnome-run.c, launcher.c, logout.c, main.c
	  menu-properties.c, menu-rh.c, menu.c:
	ported gnome_.*_file -> gnome_program_locate_file
	       gnome_unconditional_.*_file -> gnome_program_locate_file
	       g_file_exists -> g_file_test
	       g_unix_error_string -> g_strerror

2001-10-18  jacob berkman  <jacob@ximian.com>

	* session.h (PANEL_CONFIG_PATH): set to panel2.d so you don't
	wreck your normal panel settings

	* main.c (main): 
	* launcher.c (launcher_file_name): 
	* session.c (get_correct_prefix): use PANEL_CONFIG_PATH rather
	than hard coding the path

2001-10-18  Glynn Foster  <glynn.foster@sun.com>

	* basep-widget.c, gnome-panel-properties.c,
	* panel_config_global.h, session.c: Remove 'simple_movement' and
	  opt for the slightly more complicated sin() algorithm as default.

2001-10-18  Mark McLoughlin <mark@skynet.ie>

	* main.h, main.c (panel_main_gconf_client): impl.

	* foobar-widget.c (pixmap_menu_item_new): port from 
	gnome_preferences_* to gconf.
	(add_tearoff): ditto.

	* tearoffitem.c (tearoff_item_new): ditto.

	* menu.c (menu_add_tearoff): impl to use gconf.
	(add_tearoff): kill.
	(submenu_to_display): use menu_add_tearoff.
	(start_favourites_menu): ditto.
	(create_menu_at_fr): ditto.
	(create_add_panel_submenu): ditto.
	(make_panel_submenu): ditto.
	(create_panel_submenu): ditto.
	(create_desktop_menu): ditto.
	(create_root_menu): ditto.

2001-10-18  Glynn Foster  <glynn.foster@sun.com>

	* basep-widget.c, gnome-panel-properties.c, 
	* panel-widget.c, panel-widget.h, panel_config_global.h,
	* session.c, session.h: Remove 'auto_hide_step_size', 
	  'explicit_hide_step_size' and 'drawer_hide_step_size' and replace
	  for a single configuration 'hiding_step_size' for all 

2001-10-18  Glynn Foster  <glynn.foster@sun.com>

	* button-widget.c, gnome-panel-properties.c:
	* panel_config_global.h, session.c:  Remove fast_button_scaling
	  and use GDK_INTERP_HYPER as default instead.

2001-10-18  Glynn Foster <glynn.foster@sun.com> 

	* basep-widget.c, foobar-widget.c, gnome-panel-properties.c
	  menu.c, panel-widget.c, panel-widget.h, panel.c
	  panel_config_global.h,  session.c: Removed the applet_padding
          and applet_padding_border global properties and consequently
	  the no_padding_ends param on panel_widget_new

2001-10-12  Alex Larsson  <alexl@redhat.com>

	* panel_config.c (panel_config):
	un-ifdef out this function. Seems to work reasonably well
	already.

2001-10-12  Alex Larsson  <alexl@redhat.com>

	* main.c (kill_free_drawers):
	Queue up all the destroys until after we've gone through
	the panel_list, since the destroys can change the list.

2001-10-11  Alex Larsson  <alexl@redhat.com>

	* gnome-run.c (simple_contents_shown):
	Remove gtk_clist_columns_autosize() call. It crashed,
	and we only have one column anyway.
	
2001-10-11  Alex Larsson  <alexl@redhat.com>

        * foobar-widget.c (foobar_widget_update_winhints):
	Use the gtk hint calls.

	* basep-widget.c (basep_widget_update_winhints):
	Use the gtk hint calls.
	
2001-10-11  Alex Larsson  <alexl@redhat.com>

	* menu.c (menus_have_icons):
	New function that always returns TRUE. Should use GConf
	instead. Changed all gnome_preferences_get_menus_have_icons
	to menus_have_icons().
	(fake_pixmap_from_fake):
	Connect to the signals before showing the widget.
	
2001-10-11  Alex Larsson  <alexl@redhat.com>

	* applet.c (applet_button_press):
	Don't return TRUE here, it makes the buttons not
	work. I'm not sure about the comment here in the old
	code. Returning TRUE never blocked anything in
	gtk 1.2....

	* panel-widget.c:
	Fix some code inside #ifdef PANEL_DEBUG
	
2001-10-11  Alex Larsson  <alexl@redhat.com>

	* menu-fentry.c (fr_fill_dir, fr_read_dir,
	fr_check_and_reread):
	Move to new GnomeDesktopItem api

	* menu-fentry.h (struct DirRect):
	renams dentry* to ditem*

	* menu.c (edit_direntry, add_applet):
	Warn when running commented function.
	(show_item_menu):
	Update to new GnomeDesktopItem API

	* panel.c (drop_urilist):
	Warn when running commented function.
	
	
2001-10-10  Alex Larsson  <alexl@redhat.com>

	* menu.c (add_drawers_from_dir):
	converted to use gnome-desktop-item, and removed
	#ifdef FIXME

2001-10-10  Mark McLoughlin <mark@skynet.ie>

	* extern.h, extern.c (extern_ref, extern_unref, 
	  extern_clean): privatise.
	  (extern_set_info, extern_(get|set)_orient, ): kill.
	  (extern_handle_*): impl. Privatise the handling of
	this stuff.
	  (socket_set_loading): remove ifdef FIXMEs and port
	usage of gdk_pixbuf_new_from_file.

	* applet.c (applet_callback_callback):
	  panel.c (freeze_changes, thaw_changes, size_change,
	  orientation_change, back_change):
	  session.c (send_tooltips_state):

2001-10-09  Mark McLoughlin <mark@skynet.ie>

	* panel-include.h: remove.

	* *.c, *.h: don't include panel-include.h. Include the
	actual required headers. Give automatic dependancy
	generation a chance.

	* aligned-widget.c (aligned_pos_class_init): use proper
	enum def instead of GTK_TYPE_ENUM.
	  basep-widget.c (basep_widget_class_init): ditto.
	  border-widget.c (border_pos_class_init): ditto.
	  panel-widget.c (panel_widget_class_init): ditto.
	  sliding-widget.c (sliding_pos_class_init): ditto.

	* Makefile.am: only generate the enums we actually
	want. Also don't include panel-include.h from
	panel-typebuiltins.c - include the required headers.

2001-10-08  Mark McLoughlin <mark@skynet.ie>

	* extern.c: privatised the Extern struct. Implemented
	various set/get methods.

	* applet.c, panel.c, session.c: updated for above change.

2001-10-08  Mark McLoughlin <mark@skynet.ie>

	* applet.c (show_applet_menu): get popup menu working.
	  panel.c (panel_event): ditto.
	  menu.c (menu_button_pressed): ditto.

	* menu.c (create_menu_at_fr): fix core dump.
	(make_add_submenu): ditto.

	* menu-util.h, menu-util.c (applet_menu_position): add
	new push_in param for gtk_menu_popup callbacks.
	(panel_menu_position): ditto.
	(get_default_menu_flags): make not const - it calls a
	non-const function.
	
2001-10-08  Mark McLoughlin <mark@skynet.ie>

	* menu.c (create_applets_menu): warn if we can't find applets
	menu directory.
	(create_root_menu): only setup an applets menuitem if we have
	managed to create an applets menu.

	* foobar-widget.c (foobar_widget_init): init foo->tasks.

 	* logout.c, main.c, menu-properties.c, menu-util.c, menu.c,
	  panel-util.c, panel.c, session.c, sliding-widget.c,
	  status.c, aligned-widget.c, applet.c, basep-widget.c,
	  drawer.c, extern.c, global-keys.c, gnome-run.c, swallow.c,
	  launcher.c: remove unused extern defs.

Thu Sep 27 01:03:48 2001  George Lebl <jirka@5z.com>

	* menu.c: port more things to ditem

	* main.c: fix segfault, change the warning dialog so that people
	  don't have to set evil env variables

	* *.c: fix includes, replace g_concat_dir_and_file with
	  g_build_filename, and g_basename with g_path_get_basename,
	  uncomment a couple more things that now compile.  Whack the
	  references to the hacks.  Use new help API for the help stuff.

2001-09-26  Christian Rose  <menthos@menthos.com>

	* panel.hints: Fix reported "medans" typo.

2001-09-24  Glynn Foster <glynn.foster@sun.com>

	* configure.in, Makefile.am, libpanelapplet-2.0.pc.in:
	  Add libpanelapplet-2.0 pkg-config file. It probably
	  isn't 100% correct yet.

Fri Sep 21 12:16:18 2001  George Lebl <jirka@5z.com>

	* applet.c, button-widget.c, foobar-widget.c, global-keys.c
	  gnome-run.c, launcher.[ch], main.c, menu.c, panel-util.c,
	  panel.c, session.c, swallow.c:  Make the beast compile.  Fix
	  uses of panel_error_dialog, fix usage of GnomeDesktopItem,
	  fix typos, fix includes, smoke some crack, and get rid of remaining
	  uses of panel_file_exists

Fri Sep 21 01:40:50 2001  George Lebl <jirka@5z.com>

	* *.[ch]: use GType for types

	* extern.c, gnome-run.c, launcher.[ch]: do more ditem porting

Thu Sep 20 15:17:33 2001  George Lebl <jirka@5z.com>

	* launcher.c, swallow.c: Do some DesktopItem porting, remove some
	  FIXMEs

	* *.[ch], panel-util.[ch]: whack panel_file_exists and
	  panel_is_program_in_path, since those are now nice and working
	  in the libs.

2001-09-10  Frank Belew  <frb@ximian.com>
	* panel/launcher.c: changed references to removed functions to use
		gnome_desktop_item_get_string instead

Fri Sep 07 14:09:51 2001  George Lebl <jirka@5z.com>

	* *.c: include libgnome/libgnome.h and libgnomeui/libgnomeui.h

Tue Sep 04 23:07:54 2001  George Lebl <jirka@5z.com>

	* Makefile.am, basep-widget.[ch], conditional.c, foobar-widget.c,
	  gnome-run.c, main.c, menu.c, panel-util.c, panel-widget.c,
	  panel_config.c, session.c, tasklist_icon.c:  Reenable some things
	  and ifdef out others.  Put gnome-run back.  Compiles with latest
	  libgnome/ui now.

2001-08-31  Kevin Vandersloot <kfv101@psu.edu>

	* panel_widget.c (panel_widget_get_free_space): fix 
	initializing of right, left ints. They were switched. This
	fixes the case where the tasklist wouldn't honor the
	"Only use empty space" option.

2001-09-01  Darin Adler  <darin@bentspoon.com>

	* conditional.c:
	* drawer.c:
	* main.c:
	* menu.c:
	* panel_config.c:
	* session.c:
	* session.h:
	Fix includes to start on the porting to GNOME 2.

2001-08-26  Seth Nickell  <snickell@stanford.edu>

	* foobar-widget.c:

	Include time.h since we use time_t structures.
	
	* gnome-panel-properties.c: (show_page):
	* nothing.cP:

	Call gtk_notebook_set_current_page as gtk_notebook_set_page
	is deprecated.

2001-08-18  Martin Baulig  <baulig@suse.de>

	* Makefile.am: Added rules to create panel-typebuiltins.[ch].

	* panel-typebuiltins.[ch]: Create these files from glib-mkenums.

2001-08-12  Martin Baulig  <baulig@suse.de>

	* Makefile.am: Put gwmh back, less work this way.

2001-08-12  Martin Baulig  <baulig@suse.de>

	* extern.c (panel_corba_gtk_init): Make this actually work.

	* Makefile.am: Renamed panel to panel-2, commented out the
	applet and status libraries, removed everything else.

	* panel.server.in: New file.

	* panel.gnorba, panel.soundlist: Removed.

2001-08-12  Martin Baulig  <baulig@suse.de>

	* main.c: Put in some protection so that panel won't start up
	unless explicitly told to - so it won't ruin your desktop if you
	accidentally start it.

2001-08-11  Martin Baulig  <baulig@suse.de>

	* Makefile.am: Renamed the `panel-temp' target back to `panel'.

2001-08-11  Martin Baulig  <baulig@suse.de>

	* scroll-menu.[ch]: Removed.

2001-08-11  Martin Baulig  <baulig@suse.de>

	* extern.c: Ported to GTK+ 2.0, but `#ifdef FIXME' the CORBA
	stuff - will be fixed after dinner :-)

	* launcher.c Ported to GTK+ 2.0, but `#ifdef FIXME' large parts
	of this file.

	* menu-properties.[ch]: #ifdef FIXME some stuff.

	* scroll-menu.[ch]: Ported to GTK+ 2.0.

	* swallow.[ch]: Ported to GTK+ 2.0, but `#ifdef FIXME'.

2001-08-11  Martin Baulig  <baulig@suse.de>

	* Makefile.am: Disable the gwmh stuff for the moment and
	#ifdef FIXME it everywhere.

2001-08-09  Martin Baulig  <baulig@suse.de>

	* panel-include.h: #include <libgnome/gnome-i18n.h> and
	<libgnome/gnome-util.h>.

2001-08-09  Martin Baulig  <baulig@suse.de>

	* Makefile.am: Added some more files to panel-temp.

	* launcher.[ch]: GnomeDesktopEntry -> GnomeDesktopItem, only
	half-way done, so FIXME.

	* applet.c: Ported to GTK+ 2.0, did some GnomeDesktopItem stuff,
	has `#ifdef FIXME' issues in the ditem code.

	* menu-fentry.[ch]: Ported to GTK+ 2.0, did some
	GnomeDesktopEntry -> GnomeDesktopItem stuff, has larger
	`#ifdef FIXME' issues.

	* menu-properties.c: Don't #include "icon-entry-hack.h".

	* menu-rh.c: `#ifdef FIMXE' some stuff.

	* menu-util.c: Ported to GTK+ 2.0.

	* menu.c: Ported to GTK+ 2.0, but `#ifdef FIXME' large parts
	of this file.

	* panel-util.c: Ported to GTK+ 2.0, has `#ifdef FIXME' issues.

	* panel_config.c: Ported to GTK+ 2.0, but `#ifdef FIXME' large parts
	of this file.

	* nothing.cP: Ported to GTK+ 2.0, `#ifdef FIXME' the sound stuff.

	* swalloc.c: Some GnomeDesktopEntry -> GnomeDesktopItem stuff.

	* session.c: Ported to GTK+ 2.0, has `#ifdef FIXME' issues.

	* drawer.c: Ported to GTK+ 2.0, has `#ifdef FIXME' issues.

	* status.c: Ported to GTK+ 2.0.

	* logout.c: Ported to GTK+ 2.0.

	* basep-widget.c, button-widget.c, foobar-widget.c, main.c:
	Don't use gnome_program_locate_file().

2001-08-09  Martin Baulig  <baulig@suse.de>

	* Makefile.am (panel_temp_SOURCES): Added
	rgb-stuff.[ch],	tearoffitem.[ch], title-item.[ch],
	title-item-private.h, panel.[ch].

	* panel.c: Ported to GTK+ 2.0.
	[FIXME: There's gnome_uri_list #ifdef FIXME'ed].

	* main.c: Forgot a GnomeDialog -> GtkDialog.

2001-08-09  Martin Baulig  <baulig@suse.de>

	* Makefile.am (panel_temp_SOURCES): Added
 	border-widget.[ch], edge-widget.[ch], aligned-widget.[ch],
	drawer-widget.[ch], sliding-widget.[ch], floating-widget.[ch].

2001-08-09  Martin Baulig  <baulig@suse.de>

	* Makefile.am (panel_SOURCES): Removed everything
	which is in panel-temp so that we know which files
	still need to be ported.

2001-08-09  Martin Baulig  <baulig@suse.de>

	* foobar-widget.[ch]: Ported to GTK+ 2.0.

	* Makefile.am: Added foobar-widget.[ch] and
	tasklist_icon.[ch] to panel-temp and fixed
	the marshaller creation.
	
2001-08-07  Martin Baulig  <baulig@suse.de>

	* main.c: Ported to GNOME 2.

	* panel-widget.c: Ported to GTK+ 2.0.

	* button-widget.[ch]: Ported to GTK+ 2.0.

	* basep-widget.[ch]: Ported to GTK+ 2.0.

2001-08-07  Martin Baulig  <baulig@suse.de>

	* Makefile.am: Added `panel-temp' target with all files which are
	already ported to GNOME 2.

	* panel-marshal.list, panel-marshal-main.c: New files.

2001-08-06  Martin Baulig  <baulig@suse.de>

	* aligned-widget.c, applet-widget.c, border-widget.c,
	button-widget.c, floating-widget.c, gnome-panel-screenshot.c,
	main.c, panel-widget.c, sliding-widget.c, status-docklet.c:
	Merged the basic GTK+ 2.0 port from the GNOME20.

2001-08-06  Martin Baulig  <baulig@suse.de>

	* *.[ch]: #include <libgnomeui.h> instead of <gnome.h> and
	#include <bonobo-activation/bonobo-activation.h> instead
	of <libgnorba/gnorba.h>.

2001-08-06  Martin Baulig  <baulig@suse.de>

	* *.h: Use G_BEGIN/END_DECLS everywhere.

2001-08-06  Martin Baulig  <baulig@suse.de>

	* Makefile.am: Updated for the GNOME 2 platform.

2001-08-06  Martin Baulig  <baulig@suse.de>

	* ChangeLog-20010806: Copied current ChangeLog to ChangeLog-20010806
	and started a new ChangeLog file for GNOME 2.0.

